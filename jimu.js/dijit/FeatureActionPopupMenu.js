// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(l,b,d,g,h,m,n,p,q,r){var e=null,k=l([n,p],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(h(this.domNode,"click",d.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||b.isDescendant(a,this.menuNode)||this.hide()})));this.own(h(this.closeBtn,"click",d.hitch(this,this.hide)))},setActions:function(a){this.clearActions();g.forEach(a,d.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];b.empty(this.menuContent)},_addMenuItem:function(a){a=
new r({action:a});b.place(a.domNode,this.menuContent);a.startup();this.menuItems.push(a);this.own(h(a,"click",d.hitch(this,this.hide)))},prepareActions:function(a,b){return q.getInstance().getSupportedActions(a).then(d.hitch(this,function(c){!1===b&&(c=g.filter(c,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));g.forEach(c,function(b){b.data=a},this);this.setActions(c)}))},hide:function(){b.setStyle(this.domNode,"display","none")},show:function(a,e){if(0===this.menuItems.length)b.setStyle(this.domNode,
"display","none");else{"string"===typeof e&&""!==e?(this.labelNode.innerHTML=e,b.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",b.setStyle(this.titleNode,"display","none"));var c,d=a.y+a.h,f;c=window.isRTL?a.x:a.x+a.w;b.setStyle(this.domNode,"display","");b.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});f=m.getMarginSize(this.menuNode);b.setStyle(this.menuNode,{left:(window.isRTL?c+f.w>window.innerWidth?window.innerWidth-f.w:0>c?0:c:0>c-f.w?0:c>window.innerWidth?
window.innerWidth-f.w:c-f.w)+"px",top:(f.h>window.innerHeight?0:d+f.h>window.innerHeight?window.innerHeight-f.h:d+f.h+5<window.innerHeight?d+5:d)+"px"})}}});k.getInstance=function(){null===e&&(e=new k,b.place(e.domNode,document.body),e.startup());e.setActions([]);return e};return k});