// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:jimu/dijit/templates/FeatureSetChooserForMultipleLayers.html":'\x3cdiv class\x3d"jimu-not-selectable"\x3e\r\n  \x3cdiv class\x3d"draw-item-btn"\x3e\r\n    \x3cdiv class\x3d"current-draw-item" data-dojo-attach-point\x3d"currentDrawItem"\x3e\r\n      \x3cdiv class\x3d"btn-select" data-dojo-attach-point\x3d"btnSelect"\x3e\r\n        \x3cdiv class\x3d"select-icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"select-text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"arrow jimu-float-trailing" data-dojo-attach-event\x3d"click:_onArrowClicked"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"draw-items hidden" data-dojo-attach-point\x3d"drawItems"\x3e\r\n      \x3cdiv class\x3d"draw-item draw-item-rectangle" data-dojo-attach-point\x3d"rectangleItem"\x3e\r\n        \x3cdiv class\x3d"draw-icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"draw-text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"draw-item draw-item-polygon" data-dojo-attach-point\x3d"polygonItem"\x3e\r\n        \x3cdiv class\x3d"draw-icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"draw-text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"draw-item draw-item-circle" data-dojo-attach-point\x3d"circleItem"\x3e\r\n        \x3cdiv class\x3d"draw-icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"draw-text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"draw-item draw-item-polyline" data-dojo-attach-point\x3d"polylineItem"\x3e\r\n        \x3cdiv class\x3d"draw-icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"draw-text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"btn-clear" data-dojo-attach-point\x3d"btnClear"\x3e\r\n    \x3cdiv class\x3d"clear-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"clear-text"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/on dojo/sniff dojo/mouse dojo/query dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/FeatureSetChooserForMultipleLayers.html dijit/popup dijit/TooltipDialog jimu/utils jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore".split(" "),function(e,w,k,d,n,c,b,f,p,x,y,z,A,B,q,r,h,C,D){return x([y,z,A,n],{baseClass:"jimu-multiple-layers-featureset-chooser",
templateString:B,drawBox:null,_instances:null,_tooltipDialogTimeoutId1:-1,_tooltipDialogClientX1:-1,_tooltipDialogTimeoutId2:-1,_tooltipDialogClientX2:-1,_tooltipTimeout:1E3,_currentGeoTypeInfo:null,_geoTypeInfos:null,map:null,updateSelection:!1,fullyWithin:!1,geoTypes:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.featureSetChooser;var a=["EXTENT","POLYGON","CIRCLE","POLYLINE"];this.geoTypes&&0<this.geoTypes.length&&(this.geoTypes=f.filter(this.geoTypes,b.hitch(this,
function(b){return 0<=a.indexOf(b)})));this.geoTypes&&0!==this.geoTypes.length||(this.geoTypes=["EXTENT"])},postCreate:function(){this.inherited(arguments);this._instances=[];d(".select-text",this.domNode)[0].innerHTML=this.nls.select;d(".clear-text",this.domNode)[0].innerHTML=window.jimuNls.common.clear;d(".draw-item-rectangle .draw-text",this.domNode)[0].innerHTML=this.nls.selectByRectangle;d(".draw-item-polygon .draw-text",this.domNode)[0].innerHTML=this.nls.selectByPolygon;d(".draw-item-circle .draw-text",
this.domNode)[0].innerHTML=this.nls.selectByCircle;d(".draw-item-polyline .draw-text",this.domNode)[0].innerHTML=this.nls.selectByLine;this._initTooltipDialogs();this._initDrawBox();this._geoTypeInfos=[];0===this.geoTypes.length&&this.geoTypes.push("EXTENT");1===this.geoTypes.length?c.addClass(this.domNode,"single-geotype"):c.addClass(this.domNode,"multiple-geotypes");var a={EXTENT:[this.rectangleItem,this.drawBox.extentIcon],POLYGON:[this.polygonItem,this.drawBox.polygonIcon],CIRCLE:[this.circleItem,
this.drawBox.circleIcon],POLYLINE:[this.polylineItem,this.drawBox.polylineIcon]};f.forEach(["EXTENT","POLYGON","CIRCLE","POLYLINE"],b.hitch(this,function(g){var d=a[g],l=d[0];0<=this.geoTypes.indexOf(g)?(g={geoType:g,dom1:d[0],dom2:d[1]},this._geoTypeInfos.push(g),this.own(e(l,"click",b.hitch(this,this._onDrawItemClicked,g)))):c.addClass(l,"hidden")}));this.own(e(this.btnSelect,"click",b.hitch(this,function(){h.simulateClickEvent(this._currentGeoTypeInfo.dom2);this._hideDrawItems()})));this._setCurrentGeoInfo(this._geoTypeInfos[0]);
this.deactivate()},_initTooltipDialogs:function(){var a=w("mac")?"\u2318":"Ctrl",g="- "+this.nls.newSelectionTip+" ("+this.nls.dragMouse+")",f="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.dragBox+")",l="- "+this.nls.removeSelectionTip+" ("+a+"+"+this.nls.dragBox+")",h="- "+this.nls.newSelectionTip+" ("+this.nls.drawShap+")",n="- "+this.nls.addSelectionTip+" (Shift+"+this.nls.darw+")",p="- "+this.nls.removeSelectionTip+" ("+a+"+"+this.nls.darw+")",a=c.create("div",{innerHTML:'\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3cdiv class\x3d"item new-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item add-selection-item"\x3e\x3c/div\x3e\x3cdiv class\x3d"item remove-selection-item"\x3e\x3c/div\x3e',
"class":"dialog-content"}),m=d(".title",a)[0],t=d(".new-selection-item",a)[0],u=d(".add-selection-item",a)[0],v=d(".remove-selection-item",a)[0];this.tooltipDialog1=new r({content:a});c.addClass(this.tooltipDialog1.domNode,"jimu-multiple-layers-featureset-chooser-tooltipdialog");this.own(e(this.btnSelect,"mousemove",b.hitch(this,function(a){this._tooltipDialogClientX1=a.clientX})));this.own(e(this.btnSelect,k.enter,b.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=
-1;this._tooltipDialogTimeoutId1=setTimeout(b.hitch(this,function(){if(this.tooltipDialog1){var a=this._currentGeoTypeInfo.geoType;"EXTENT"===a?(t.innerHTML=g,u.innerHTML=f,v.innerHTML=l,m.innerHTML=this.nls.selectByRectangle):(t.innerHTML=h,u.innerHTML=n,v.innerHTML=p,"POLYGON"===a?m.innerHTML=this.nls.selectByPolygon:"CIRCLE"===a?m.innerHTML=this.nls.selectByCircle:"POLYLINE"===a&&(m.innerHTML=this.nls.selectByLine));q.open({parent:this.getParent(),popup:this.tooltipDialog1,around:this.btnSelect,
position:["below"]});0<=this._tooltipDialogClientX1&&(this.tooltipDialog1.domNode.parentNode.style.left=this._tooltipDialogClientX1+"px")}}),this._tooltipTimeout)})));this.own(e(this.btnSelect,k.leave,b.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId1);this._tooltipDialogTimeoutId1=-1;this._hideTooltipDialog(this.tooltipDialog1)})));a=c.create("div",{innerHTML:this.nls.unselectAllSelectionTip,"class":"dialog-content"});this.tooltipDialog2=new r({content:a});c.addClass(this.tooltipDialog2.domNode,
"jimu-multiple-layers-featureset-chooser-tooltipdialog");this.own(e(this.btnClear,"mousemove",b.hitch(this,function(a){this._tooltipDialogClientX2=a.clientX})));this.own(e(this.btnClear,k.enter,b.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._tooltipDialogTimeoutId2=setTimeout(b.hitch(this,function(){this.tooltipDialog2&&(q.open({parent:this.getParent(),popup:this.tooltipDialog2,around:this.btnClear,position:["below"]}),0<=this._tooltipDialogClientX2&&
(this.tooltipDialog2.domNode.parentNode.style.left=this._tooltipDialogClientX2+"px"))}),this._tooltipTimeout)})));this.own(e(this.btnClear,k.leave,b.hitch(this,function(){clearTimeout(this._tooltipDialogTimeoutId2);this._tooltipDialogTimeoutId2=-1;this._hideTooltipDialog(this.tooltipDialog2)})))},_onArrowClicked:function(a){a.stopPropagation();this._isDrawItemsVisible()?this._hideDrawItems():this._showDrawItems()},_setCurrentGeoInfo:function(a){var b=this._currentGeoTypeInfo&&this._currentGeoTypeInfo.geoType;
this._currentGeoTypeInfo&&c.removeClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);this._currentGeoTypeInfo=a;c.addClass(this.currentDrawItem,this._currentGeoTypeInfo.geoType);this.isActive()?b!==this._currentGeoTypeInfo.geoType&&h.simulateClickEvent(this._currentGeoTypeInfo.dom2):h.simulateClickEvent(this._currentGeoTypeInfo.dom2)},_isDrawItemsVisible:function(){return!c.hasClass(this.drawItems,"hidden")},_showDrawItems:function(){c.removeClass(this.drawItems,"hidden")},_hideDrawItems:function(){c.addClass(this.drawItems,
"hidden")},_onDrawItemClicked:function(a,b){b.stopPropagation();this._hideDrawItems();this._setCurrentGeoInfo(a)},_initDrawBox:function(){this.drawBox=new C({map:this.map,showClear:!0,keepOneGraphic:!0,deactivateAfterDrawing:!1,geoTypes:this.geoTypes});this.own(e(this.drawBox,"user-clear",b.hitch(this,this._onDrawBoxUserClear)));this.own(e(this.drawBox,"draw-end",b.hitch(this,this._onDrawEnd)));this.own(e(this.drawBox,"draw-activate",b.hitch(this,function(){this.map.infoWindow.hide();c.addClass(this.currentDrawItem,
"pressed");c.addClass(this.btnSelect,"selected");d(".draw-item.selected",this.drawItems).removeClass("selected");c.addClass(this._currentGeoTypeInfo.dom1,"selected")})));this.own(e(this.drawBox,"draw-deactivate",b.hitch(this,function(){c.removeClass(this.currentDrawItem,"pressed");c.removeClass(this.btnSelect,"selected");d(".draw-item.selected",this.drawItems).removeClass("selected")})));this.own(e(this.btnClear,"click",b.hitch(this,function(){h.simulateClickEvent(this.drawBox.btnClear)})))},disable:function(){this.drawBox.disable();
c.addClass(this.domNode,"disabled")},enable:function(){this.drawBox.enable();c.removeClass(this.domNode,"disabled")},isActive:function(){return this.drawBox.isActive()},activate:function(){if(!this.isActive()){var a=this._currentGeoTypeInfo;a||(a=this._geoTypeInfos[0]);this._setCurrentGeoInfo(a)}},deactivate:function(){this.drawBox.deactivate()},setFeatureLayers:function(a){var g=f.filter(this._instances,b.hitch(this,function(b){return 0>a.indexOf(b.featureLayer)}));f.forEach(g,b.hitch(this,function(a){this._removeInstance(a)}));
var c=f.map(this._instances,b.hitch(this,function(a){return a.featureLayer}));f.forEach(a,b.hitch(this,function(a){0>c.indexOf(a)&&this.addFeatureLayer(a)}))},addFeatureLayer:function(a){"esri.layers.FeatureLayer"!==a.declaredClass||this._findInstanceByLayer(a)||(a=new D({map:this.map,featureLayer:a,drawBox:this.drawBox,updateSelection:this.updateSelection,fullyWithin:this.fullyWithin}),this._instances.push(a))},removeFeatureLayer:function(a){"esri.layers.FeatureLayer"===a.declaredClass&&(a=this._findInstanceByLayer(a))&&
this._removeInstance(a)},_removeInstance:function(a){if(a){var b=this._instances.indexOf(a);0<=b&&(a.destroy(),this._instances.splice(b,1))}},_findInstanceByLayer:function(a){var c=null;f.some(this._instances,b.hitch(this,function(b){return b.featureLayer===a?(c=b,!0):!1}));return c},clear:function(a){f.forEach(this._instances,b.hitch(this,function(b){b.clear(a)}))},destroy:function(){this._hideTooltipDialog(this.tooltipDialog1);this._hideTooltipDialog(this.tooltipDialog2);f.forEach(this._instances,
b.hitch(this,function(a){a.destroy()}));this._instances=[];this.drawBox&&this.drawBox.destroy();this.drawBox=null;this.inherited(arguments)},_hideTooltipDialog:function(a){a&&q.close(a)},_onDrawBoxUserClear:function(){this.clear(!0);this.emit("user-clear")},_onDrawEnd:function(){this.drawBox.clear();0<this._instances.length&&setTimeout(b.hitch(this,function(){if(0<this._instances.length){this.emit("loading");this.disable();var a=f.map(this._instances,b.hitch(this,function(a){return a.getFeatures()}));
p(a).always(b.hitch(this,function(){this.enable();this._currentGeoTypeInfo&&h.simulateClickEvent(this._currentGeoTypeInfo.dom2);this.emit("unloading")}))}}),50)}})});