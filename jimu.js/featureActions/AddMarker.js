// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(h,k,l,m,n,p,f){return h(k,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(a){this._getMarkerLayer();return this._isSupportType(a)&&0<a.features.length&&a.features[0]&&a.features[0].geometry&&!1===this._isFeatureInMarkerFeatureActionLayer(a)},onExecute:function(a,e){this._addMarker(a,e)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new m({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var a=this.map.snappingManager.layerInfos;a.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(a)}},_addMarker:function(a,e){var b=a.features[0].geometry,d={},c=e.displayField||a.displayFieldName||e.objectIdField;d.title="";a.features[0].attributes&&c&&(d.title=a.features[0].attributes[c],d.title||(d.title=
""));c={};if("point"===b.type)c=b;else if("polygon"===b.type||"polyline"===b.type||"multipoint"===b.type)c=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:b.getExtent().getCenter();c.getLongitude()&&c.getLatitude()?(d.longitude=c.getLongitude(),d.latitude=c.getLatitude()):c.x&&c.y&&(d.x=c.x,d.y=c.y);var g="";b&&b.spatialReference&&b.spatialReference.wkid&&(g=b.spatialReference.wkid);d.spatialReference={wkid:g};b=f.getXyContent(d);d=f.getShareUrl(this.map,d,!0);d=f.getShareUrlContent(d);
d=b+d;b=new n(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");b.width=26;b.height=26;b.setOffset(0,b.height/2);c=new l(c,b,null,null);c._markerFeatureactionGraphic=a.features[0];c.infoTemplate=this._setInfoTemplate(d);this._markerLayer.add(c);this._closePopupWindow()},_setInfoTemplate:function(a){var e=new p;e.setContent(a);return e},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(a){return a.features[0]&&
a.features[0]._graphicsLayer&&a.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===a.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(a){if(a&&a.geometryType){if(a.features&&a.features.length&&1<a.features.length)return!1;a=a.geometryType;return"point"===a||"polygon"===a||"polyline"===a||"multipoint"===a}return!1}})});