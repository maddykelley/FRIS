// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){function u(a,b){var c=f.clone(a),g=d.widgetProperties;"undefined"===typeof b&&(b=!1);delete c.mode;delete c.configWabVersion;d.visitElement(c,
function(a,h){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,h.isOnScreen&&a.panel&&d.isEqual(a.panel,c.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,delete a.isRemote,delete a.featureActions,g.forEach(function(b){delete a[b]}),
b?"undefined"===typeof a.openAtStart&&(a.openAtStart=!1):(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest,a.itemId&&delete a.uri)});delete c.rawAppConfig;delete c._ssl;delete c.getConfigElementById;delete c.getConfigElementsByName;delete c.processNoUriWidgets;delete c.addElementId;delete c.getCleanConfig;delete c.visitElement;delete c.agolConfig;delete c._itemData;delete c.oldWabVersion;
delete c.titleColor;return c}var v=null,z;z=q(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new h;this.widgetManager=c.getInstance();this.configLoader=p.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(e);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(e);d.isMobileUa()||l(window,"resize",f.hitch(this,this._onWindowResize));l(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){e.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));e.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));e.subscribe("builder/layoutDefinitionChanged",
f.hitch(this,this._onLayoutDefinitionChanged));e.subscribe("builder/onScreenGroupsChanged",f.hitch(this,this._onOnScreenGroupsChanged));e.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));e.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));e.subscribe("builder/mapChanged",f.hitch(this,this._onMapChanged));e.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));e.subscribe("builder/mapRefreshIntervalChanged",f.hitch(this,
this._onMapRefreshIntervalChanged));e.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));e.subscribe("builder/dataSourceChanged",f.hitch(this,this._onDataSourceChanged));e.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));e.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));e.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));e.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));e.subscribe("builder/syncExtent",
f.hitch(this,this._onSyncExtent));e.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));e.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));e.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));e.subscribe("builder/appProxyForUrlChanged",f.hitch(this,this._onAppProxyForUrlChanged));e.subscribe("builder/sharedThemeChanged",f.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode){var a=new b;a.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(b){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);console.timeEnd("Load Config");window.appInfo.isRunInMobile=d.inMobileSize();b=this.getAppConfig();a.destroy();e.publish("appConfigLoaded",b);return b}),f.hitch(this,function(b){a.destroy();console.error(b);b&&b.message&&"string"===typeof b.message&&
this._showErrorMessage(b.message)}))}},_showErrorMessage:function(a){m.create("div",{"class":"app-error",innerHTML:d.sanitizeHTML(a)},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=f.clone(this._getMobileConfig(this.appConfig)),a._originConfig=f.clone(this.appConfig)):a=f.clone(this.appConfig);a.getConfigElementById=function(a){return d.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return d.getConfigElementsByName(this,a)};a.getCleanConfig=function(a){return this._originConfig?
u(this._originConfig,a):u(this,a)};a.visitElement=function(a){d.visitElement(this,a)};return a},_onOrientationChange:function(){this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var a=d.inMobileSize();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=a,this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(a){return d.mixinAppConfigPosition(a,a.mobileLayout)},_updateDataSourceForWidget:function(a){this._deleteDataSourcesFromWidget(a);
this._addDataSourcesForWidget(a)},_deleteDataSourcesFromWidget:function(a){for(var b in this.appConfig.dataSource.dataSources)b.startWith("widget~"+a.id+"~")&&delete this.appConfig.dataSource.dataSources[b]},_addDataSourcesForWidget:function(a){k.forEach(a.provideDataSources,function(b){var c="widget~"+a.id+"~"+b.id;b.id=c;this.appConfig.dataSource.dataSources[c]=b},this);delete a.provideDataSources},_addIdForWidgets:function(a){var b=0,c;this.getAppConfig().visitElement(function(a){if(a.id){a.id=
a.id.replace(/\//g,"_");var g=a.id.lastIndexOf("_");-1<g&&(c=a.id.substr(g+1),b=Math.max(b,c))}});k.forEach(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_onWidgetChanged:function(a){var b=d.reCreateObject(a);a=d.getConfigElementById(this.appConfig,a.id);this._updateDataSourceForWidget(b);!1!==b.inPanel||a.uri||(b.closeable=!0);for(var c in b)a[c]=b[c];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
e.publish("appConfigChanged",this.getAppConfig(),"widgetChange",b)},_onGroupChanged:function(a){var b=d.reCreateObject(a);a=d.getConfigElementById(this.appConfig,a.id);this._handleDataSourceForWidgets(a,b);for(var c in b)a[c]=b[c];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"groupChange",b)},_handleDataSourceForWidgets:function(a,b){var c=k.filter(b.widgets,function(b){return b.id?0===k.filter(a.widgets,function(a){return b.id===
a.id}).length:!0},this);this._addIdForWidgets(c);k.forEach(c,function(a){this._addDataSourcesForWidget(a)},this);c=k.filter(a.widgets,function(a){return 0===k.filter(b.widgets,function(b){return b.id===a.id}).length},this);k.forEach(c,function(a){this._deleteDataSourcesFromWidget(a)},this);k.forEach(b.widgets,function(b){k.forEach(a.widgets,function(a){b.id===a.id&&b.provideDataSources&&this._updateDataSourceForWidget(b)},this)},this)},_onWidgetPoolChanged:function(a){var b=d.reCreateObject(a);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,
b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups):(a=d.getConfigElementById(this.appConfig,b.controllerId),k.forEach(a.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),k.forEach(a.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:
this.appConfig.widgetPool.widgets.concat(b.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups),a.controlledWidgets=k.map(b.widgets,function(a){return a.id}),a.controlledGroups=k.map(b.groups,function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);
e.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)}))},_handleDataSourceForWidgetsSection:function(a,b){var c=b.widgets;k.forEach(b.groups,function(a){c=c.concat(a.widgets)},this);var g=a.widgets;k.forEach(a.groups,function(a){g=g.concat(a.widgets)},this);this._handleDataSourceForWidgets({widgets:g},{widgets:c})},_removeWidgetOrGroupFromPoolById:function(a,b){k.some(a.widgetPool.widgets,function(c,g){if(c.id===b)return a.widgetPool.widgets.splice(g,1),!0});k.some(a.widgetPool.groups,
function(c,g){if(c.id===b)return a.widgetPool.groups.splice(g,1),!0})},_onOpenAtStartChanged:function(a){var b=d.reCreateObject(a),c=this.appConfig;a.isOnScreen?(c=c.widgetOnScreen&&c.widgetOnScreen.widgets)&&0<c.length&&k.forEach(c,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})):((c=c.widgetPool)&&c.groups&&0<c.groups.length&&k.forEach(c.groups,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})),c&&c.widgets&&0<c.widgets.length&&
k.forEach(c.widgets,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})));e.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",b)},_onAppAttributeChanged:function(a){a=d.reCreateObject(a);f.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"attributeChange",a)},_onDataSourceChanged:function(a){var b=
d.reCreateObject(a);this.appConfig.dataSource=b;e.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",a)},_onLoadingPageChanged:function(a){a=d.reCreateObject(a);var b;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(b=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=f.mixin(b,a.backgroundImage)):"loadingGif"in a&&(b=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=
f.mixin(b,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onAppProxyForMapChanged:function(a){a=d.reCreateObject(a);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==a.mapItemId?this.appConfig.map.appProxy=a:k.forEach(a.proxyItems,f.hitch(this,function(a){k.some(this.appConfig.map.appProxy.proxyItems,function(b){if(b.sourceUrl===a.sourceUrl)return b.useProxy=
a.useProxy,b.proxyUrl=a.proxyUrl||"",b.proxyId=a.proxyId||"",!0})})):this.appConfig.map.appProxy=a;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onAppProxyForUrlChanged:function(a){a=d.reCreateObject(a);this.appConfig.appProxies=a;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onTemplateConfigChanged:function(a){a=d.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
e.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapChanged:function(a){var b=d.reCreateObject(a);this.appConfig.map.mapOptions&&d.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};f.mixin(this.appConfig.map,b);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);
e.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)}))},_deleteDataSourcesFromMap:function(){k.forEach(Object.keys(this.appConfig.dataSource.dataSources),function(a){a.startWith("map")&&delete this.appConfig.dataSource.dataSources[a]},this)},_onMapOptionsChanged:function(a){a=d.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,a);e.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onMapRefreshIntervalChanged:function(a){a=
d.reCreateObject(a);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});f.mixin(this.appConfig.map.mapRefreshInterval,a);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;e.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(f.hitch(this,function(b){var c=f.clone(this.appConfig.widgetOnScreen);this.appConfig=b;this._handleDataSourceForWidgetsSection(c,
{});e.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=d.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,
a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});e.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onOnScreenGroupsChanged:function(a){a=d.reCreateObject(a);this.appConfig.widgetOnScreen.groups=a.groups;e.publish("appConfigChanged",this.getAppConfig(),
"onScreenGroupsChange",a.groups)},_onLayoutDefinitionChanged:function(a){a=d.reCreateObject(a);d.isEqual(this.appConfig.layoutDefinition,a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=d.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),e.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},
_onSharedThemeChanged:function(a){var b=this.appConfig.theme.sharedTheme;a=d.reCreateObject(a);a.useHeader&&!b.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));
!a.useHeader&&b.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));a.useLogo&&!b.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,
logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&b.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});f.mixin(b,a);e.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){e.publish("syncExtent",a)},_genStyles:function(a,b){var c=[];c.push(b);k.forEach(a,function(a){0>c.indexOf(a)&&c.push(a)});return c},_getAppConfigFromTheme:function(a){var b=new n,c,g=[],d=this.getAppConfig().getCleanConfig();
d.mode=this.urlParams.mode;k.forEach(d.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)c=f.clone(a.appConfig),c.map=d.map,c.map.position=a.appConfig.map.position,this._copyPoolToThemePool(d,c),c.links=d.links,c.title=d.title,c.subtitle=d.subtitle,c.logo=d.logo;else{var h=a.getCurrentLayout(),g=a.getCurrentStyle();c=f.clone(d);h=f.clone(h.layoutConfig);c.widgetOnScreen=h.widgetOnScreen;h.widgetPool&&(k.forEach(h.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),k.forEach(h.widgetPool.groups,
function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(d,h);c.widgetPool=h.widgetPool;h.map&&h.map.position&&(c.map.position=h.map.position);c.mobileLayout=h.mobileLayout;c.layoutDefinition=h.layoutDefinition;g=this._genStyles(k.map(a.getStyles(),function(a){return a.name}),g.name);c.theme={name:a.getName(),styles:g,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(c.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},
c.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(c.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},c.theme.customStyles={mainBackgroundColor:""});c.titleColor=d.titleColor;c.logoLink=d.logoLink}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(f.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._addDefaultValues(c);b.resolve(c)}));
return b},_copyPoolToThemePool:function(a,b){var c=a.widgetPool;b.widgetPool||(b.widgetPool={});var g=b.widgetPool,d=k.filter(g.widgets,function(a){if(a.isPreconfiguredInTheme||!k.some(c.widgets,function(b){return b.name===a.name}))return!0}),h=k.filter(g.groups,function(a){return a.isPreconfiguredInTheme}),u=k.filter(c.widgets,function(a){return!a.isPreconfiguredInTheme}),r=k.filter(c.groups,function(a){return!a.isPreconfiguredInTheme}),u=this._getPoolWidgetsWithoutDuplicated(u,b.widgetOnScreen.widgets||
[]);g.widgets=u.concat(d);g.groups=r.concat(h)},_getPoolWidgetsWithoutDuplicated:function(a,b){for(var c=f.clone(a),g=this.getAppConfig(),h=a.length-1;0<=h;h--)for(var u=b.length-1;0<=u;u--)if(b[u].uri){var r=b[u].name;r||(r=d.getWidgetNameFromUri(b[u].uri));var p=g.getConfigElementById(a[h].id);a[h]&&a[h].name===r&&!1===p.supportMultiInstance&&(console.log("Widget",a[h].name,"is not copied to new theme because this widget exists in new theme."),c.splice(h,1))}return c},_onAppConfigSet:function(b){b=
d.reCreateObject(b);window.appInfo.isRunInMobile=d.inMobileSize();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);this.configLoader.loadAndUpgradeAllWidgetsConfig(b).then(f.hitch(this,function(b){this._addDefaultValues(b);a.setPortalUrl(b.portalUrl);window.portalUrl=b.portalUrl;this.appConfig?(d.deleteMapOptions(b.map.mapOptions),this.appConfig=b,this._deleteDataSourcesFromMap(),e.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,g.getPortal(b.portalUrl).loadSelfInfo().then(f.hitch(this,
function(a){this.portalSelf=a;e.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultDataSource(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&
0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultDataSource:function(a){a.dataSource?(a.dataSource.dataSources||(a.dataSource.dataSources={}),a.dataSource.settings||(a.dataSource.settings={})):a.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");
a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var b=a&&a.geometryService,b=b&&"string"===typeof b&&f.trim(b)?f.trim(b):this.portalSelf.helperServices.geometry.url;a.geometryService=b;r.defaults.geometryService=new t(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===
typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){d.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=
!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,c;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position=
{relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0!==a.widgets[b].inPanel||a.widgets[b].panel||(a.widgets[b].panel=f.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=
a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++)for(a.groups[b].panel||(a.groups[b].panel=a.panel),a.groups[b].panel&&!a.groups[b].panel.position&&(a.groups[b].panel.position={}),a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map"),a.groups[b].widgets||(a.groups[b].widgets=[]),c=0;c<a.groups[b].widgets.length;c++)a.groups[b].widgets[c].panel=a.groups[b].panel}},_addPoolDefaultPanelAndPosition:function(a){var b,
c,g=a.widgetPool;if(g){b=g.panel&&g.panel.positionRelativeTo?g.panel.positionRelativeTo:"map";"undefined"===typeof g.panel||"undefined"===typeof g.panel.uri?g.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof g.panel.position?g.panel.position={relativeTo:b}:"undefined"===typeof g.panel.position.relativeTo&&(g.panel.position.relativeTo=b);if(g.groups)for(b=0;b<g.groups.length;b++)for(g.groups[b].panel?g.groups[b].panel.position.relativeTo||(g.groups[b].panel.position.relativeTo=
g.groups[b].panel.positionRelativeTo?g.groups[b].panel.positionRelativeTo:"map"):g.groups[b].panel=g.panel,g.groups[b].widgets||(g.groups[b].widgets=[]),c=0;c<g.groups[b].widgets.length;c++)g.groups[b].widgets[c].panel=g.groups[b].panel;if(g.widgets)for(b=0;b<g.widgets.length;b++)!1===g.widgets[b].inPanel?(c=g.widgets[b].positionRelativeTo?g.widgets[b].positionRelativeTo:"map",g.widgets[b].position)?g.widgets[b].position.relativeTo||(g.widgets[b].position.relativeTo=c):g.widgets[b].position={relativeTo:c}:
g.widgets[b].panel||(g.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){d.visitElement(a,f.hitch(this,function(a,b){a.isOnScreen=b.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:window.apiNls.common.groupLabel),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:window.apiNls.common.groupLabel+
" "+b.index)):a.gid=b.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var b=0,c,g;if(a.widgetPool.widgets)for(c=0;c<a.widgetPool.widgets.length;c++)a.widgetPool.widgets[c].index=b,b++;if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++)for(a.widgetPool.groups[c].index=b,b++,g=0;g<a.widgetPool.groups[c].widgets.length;g++)a.widgetPool.groups[c].widgets[g].index=
g}});z.getInstance=function(a){null===v?v=new z(a):a&&(v.urlParams=a,v.configLoader&&(v.configLoader.urlParams=a));window.getAppConfig=f.hitch(v,v.getAppConfig);return v};return z})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E,D,G,H,K,I,N,L,Q,V,O,M){function P(a,b){a=a||"";for(var c=0,g=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!C.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){c++;c===g.length&&b()}}],d=0;d<g.length;d++)testLoad(g[d])}function J(a,b){var c=a.match(/url\([^)]+\)/gi),g,d;if(null===c||""===b)return a;for(g=0;g<c.length;g++)if(d=c[g].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=
d.length){var h=d[2];/^data:image\/.*;/.test(h)||(b.endWith("/")||(b+="/"),a=a.replace(d[1]+h+d[3],d[1]+b+h+d[3]))}return a}function S(a,b){var c=Array.isArray(b),g=c&&[]||{};c?(a=a||[],g=g.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?g[c]=b:"object"===typeof b?g[c]=S(a[c],b):-1===a.indexOf(b)&&g.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){g[b]=a[b]}),Object.keys(b).forEach(function(c){g[c]="object"===typeof b[c]&&b[c]?a[c]?S(a[c],b[c]):b[c]:b[c]}));return g}
function W(a,b){var c=a.map(function(a){return a.id});f.forEach(b,function(b){0>c.indexOf(b)&&a.push({id:b,widgets:[]})},this);var g=[];a=f.filter(a,function(a){return 0>b.indexOf(a.id)?(g.push(a),!1):!0},this);if(0===a.length)return[];var d=a[a.length-1];f.forEach(g,function(a){d.widgets=d.widgets.concat(a.widgets)},this);return a=a.sort(function(a,c){return b.indexOf(a.id)-b.indexOf(c.id)})}function R(a,b,c){function g(a,b){return q.isArray(a[b.key])?a[b.key][b.index]:a[b.key]}b=function(a){var b=
[];a.split("_").forEach(function(a){var c=!1,g;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));g=a.search(/\[[0-9]+\]/);-1===g&&(g=a.length);b.push({key:a.slice(0,g),index:Number(a.slice(g+1,-1)),deleteFlag:c})});return b}(b);for(var d=1;d<b.length-1;d++)if(a=g(a,b[d]),!a)return;if(b[b.length-1].deleteFlag)!0===c&&(q.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(q.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function ba(a,b,c){function g(c){c=C.template.getSearchRange(b,c,"]");var g=b.slice(c.firstPos,c.lastPos);return-1!==c.firstPos?(g=b.slice(c.firstPos+g.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(g=C.getConfigElementById(a,g))?{object:g,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var d=a,h=b=b.replace(/\//g,"_"),u=
g("groups\\[.+\\]");if("deleted"!==u.state&&("isSection"===u.state&&(d=u.object,h=u.key),u=g("widgets\\[.+\\]"),"delete"!==u.state))return"isSection"===u.state&&(d=u.object,h=u.key),R(d,h,c)}var C={},Z={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};q.mixin(C,M);window.atob||(window.atob=function(a){a=u.decode(a);for(var b="",c=0,g=a.length;c<g;c++)b+=String.fromCharCode(a[c]);return b});window.btob||(window.btob=function(a){for(var b=[],c=0,g=a.length;c<
g;c++)b.push(String.charCodeAt(a[c]));return u.encode(b)});var T="unload",X=[];require.on("error",function(a){f.forEach(X,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});C.checkError=function(a,b){X.push({resKey:a,def:b})};C.replacePlaceHolder=function(b,c){var g=a.stringify(b),d=g.match(/\$\{(\w)+\}/g),h;if(null===d)return b;for(h=0;h<d.length;h++){var u=d[h].match(/(\w)+/g)[0];c[u]&&(g=g.replace(d[h],c[u]))}return a.parse(g)};
C.changeUnit=function(a){var b=Math.abs(a),c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};C.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};C.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+parseInt(a[3],10)/10)};
C.preloadImg=function(a,b){var c=[],c="string"===typeof a?[a]:a;f.forEach(c,function(a){(new Image).src=b?b+a:a})};var U=null;C.getImagesSize=function(a){var b=new c;if(!a||0!==a.indexOf("http"))return b.reject(),b;null===U&&(U=k.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var g=p(U,"load",function(){clearTimeout(d);d=null;g.remove();var a=k.getContentBox(U);1===a.w&&1===a.h||0===a.w||0===a.h?b.reject():b.resolve([a.w,a.h])},{}),d=
setTimeout(function(){clearTimeout(d);d=null;b.reject()},5E3);k.setAttr(U,"src",a);return b};C.getPositionStyle=function(a){var b={};if(!a)return b;a=q.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=a.paddingLeft,a.paddingLeft=
a.paddingRight,a.paddingRight=c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var g=0;g<c.length;g++){var d=c[g];"number"===typeof a[d]?b[d]=a[d]+"px":"undefined"!==typeof a[d]?b[d]=a[d]:"padding"===d.substr(0,7)?b[d]=0:b[d]="auto"}b.zIndex="undefined"===typeof a.zIndex?
"auto":a.zIndex;return b};C.isEqual=function(a,b){function c(a,b){var h;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||
a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<g.indexOf(a)||-1<d.indexOf(b))return!1;if(null!==b){for(h in b)if(b.hasOwnProperty(h)!==a.hasOwnProperty(h)||typeof b[h]!==typeof a[h])return!1;for(h in a){if(b.hasOwnProperty(h)!==a.hasOwnProperty(h)||typeof b[h]!==typeof a[h])return!1;switch(typeof a[h]){case "object":case "function":g.push(a);d.push(b);if(!c(a[h],b[h]))return!1;g.pop();d.pop();break;default:if(isNaN(a[h])&&
isNaN(b[h])&&"number"===typeof a[h]&&"number"===typeof b[h])return!0;if(a[h]!==b[h])return!1}}}return!0}var g,d;g=[];d=[];return c(a,b)?!0:!1};C.file={loadFileAPI:function(){var a=new c;if("unload"===T){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};P(b,q.hitch(this,function(){T="loaded";a.resolve()}));T="loading"}else"loaded"===
T&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return m("safari")&&6>m("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(aa){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=
a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-C.file.getNameFromPath(a).length)},readFile:function(a,b,c,g){if(this.supportHTML5()){var d=a.target.files[0];d&&(d.type.match(b)?d.size>=c?g({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){g(null,d.name,a.target.result)},a.readAsDataURL(d)):g({errCode:"invalidType"}))}else if(this.supportFileAPI()){var h=
window.FileAPI.getFiles(a);h[0].type.match(b)?h[0].size>=c?g({errCode:"exceed"}):window.FileAPI.readAsDataURL(h[0],function(a){a&&a.result?g(null,h[0].name,a.result):g({errCode:"readError"})}):g({errCode:"invalidType"})}}};C.getUriInfo=function(a){var b,c={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+1);c.folderUrl=require(C.getRequireConfig()).toUrl(b);c.amdFolder=b;c.url=c.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))c.isRemote=!0;return c};C.widgetJson=function(){return{addManifest2WidgetJson:function(a,
b){q.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b;a.isRemote=b.isRemote;a.isRemote&&(a.itemId=b.itemId);b.featureActions&&(a.featureActions=b.featureActions);a.icon||(a.icon=b.icon);a.thumbnail||(a.thumbnail=b.thumbnail);a.folderUrl=b.folderUrl;a.amdFolder=b.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}}}}();C.getRequireConfig=function(){if(jimuConfig){var a=
[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};C.getTypeByGeometryType=function(a){var b="",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),g=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint",
"esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?b="polyline":0<=g.indexOf(a)&&(b="polygon");return b};C.getSymbolTypeByGeometryType=function(a){var b=null;a=C.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};C.getServices=function(){return Z};C.getArcGISDefaultGeometryService=function(){return new D(Z.geometryService)};C.restoreToDefaultWebMapExtent=function(a,b,g){var d=new c;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){d.reject("Invalid map.")},
0),d;b=b&&b.itemInfo;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var h=new y({wkid:4326}),h=new w(b[0][0],b[0][1],b[1][0],b[1][1],h);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(h);if(a.spatialReference.isWebMercator())return h=E.geographicToWebMercator(h),a.setExtent(h);b=new G;b.geometries=[h];b.outSR=a.spatialReference;h=esriConfig&&esriConfig.defaults&&
esriConfig.defaults.geometryService;h&&"esri.tasks.GeometryService"===h.declaredClass||(g&&"string"===typeof g&&q.trim(g)?(g=q.trim(g),h=new D(g)):h=C.getArcGISDefaultGeometryService());h.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};C.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};C.getAncestorDom=function(a,b,c){if(a&&1===
a.nodeType&&b&&"function"===typeof b){var g=100,d=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(g=c)):1===c.nodeType&&(d=c));for(c=0;a.parentNode&&c<g&&k.isDescendant(a.parentNode,d);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;c++}}return null};C.bindClickAndDblclickEvents=function(a,b,c,g){var d=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&c&&"function"===typeof c){var h=200;g&&"number"===typeof g&&(g=parseInt(g,10),0<g&&(h=g));var u=0,d=p(a,"click",function(a){u++;
1===u?setTimeout(function(){1===u&&(u=0,b(a))},h):2===u&&(u=0,c(a))})}return d};C.isScrollToBottom=function(a){var b=k.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};C.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application",
"Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package",
"Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};C.getItemQueryStringByTypes=function(a){var b="",c=C.getAllItemTypes();if(a&&0<a.length&&0<a.length){var g="";f.forEach(a,function(b,c){g+=' type:"'+b+'" ';c!==a.length-1&&(g+=" OR ")});b=" ( "+g+" ) ";c=a.concat(c);c=f.filter(c,function(b){return f.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});
f.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};C.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};C.isNotEmptyString=function(a,b){var c=a&&"string"===typeof a;return c?b?c&&q.trim(a):!0:!1};C.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};C.isObject=function(a){return a&&"object"===typeof a};C.createWebMap=function(a,b,c,g){a=O.getStandardPortalUrl(a);a=O.getBaseItemUrl(a);z.arcgisUrl=a;return z.createMap(b,
c,g)};C.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};C._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return f.map(b,q.hitch(this,function(a,g){var d=b.slice(g,c),h="",u=d.length-1;f.forEach(d,q.hitch(this,function(a,b){h+=a;b!==u&&(h+=".")}));return h}))};C.removeCookie=function(a,c){var g=this._getDomainsByServerName(window.location.hostname);f.forEach(g,q.hitch(this,function(g){b(a,null,{expires:-1,path:c});b(a,null,{expires:-1,path:c,
domain:g});b(a,null,{expires:-1,path:c,domain:"."+g})}))};C.isLocaleChanged=function(a,b){return!a.startWith(b)};C.hashToObject=function(b){b=b.replace("#","");b=n.queryToObject(b);for(var c in b)if(b.hasOwnProperty(c))try{b[c]=a.parse(b[c])}catch(ca){}return b};C.reCreateObject=function(a){function b(a){var g=[];a.forEach(function(a){Array.isArray(a)?g.push(b(a)):"object"===typeof a?g.push(c(a)):g.push(a)});return g}function c(a){var g={},d;for(d in a)a.hasOwnProperty(d)&&(null===a[d]?g[d]=null:
Array.isArray(a[d])?g[d]=b(a[d]):g[d]="object"===typeof a[d]?c(a[d]):a[d]);return g}return Array.isArray(a)?b(a):c(a)};C.setVerticalCenter=function(a){setTimeout(function(){var b=l(".jimu-vcenter-text",a),c,g;f.forEach(b,function(a){c=k.getContentBox(a).h;k.setStyle(a,{lineHeight:c+"px"})},this);b=l(".jimu-vcenter",a);f.forEach(b,function(a){c=k.getContentBox(a).h;g=k.getContentBox(l(a).parent()[0]).h;k.setStyle(a,{marginTop:(g-c)/2+"px"})},this)},10)};C.merge=S;C.loadStyleLink=function(a,b,g){var d=
new c,h,u=require(C.getRequireConfig()).toUrl(b);if(require.cache["url:"+u]){h=require.cache["url:"+u];var r=u.split("/").pop(),u=u.substr(0,u.length-r.length);h=J(h,u);a=g?k.create("style",{id:a,type:"text/css"},k.byId(g),"before"):k.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=h:a.appendChild(k.toDom(h));d.resolve("load");return d}h=g?k.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},
k.byId(g),"before"):k.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);p(h,"load",function(){d.resolve("load")});var t=setInterval(function(){var a;if(f.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(b),c.href.length)===b)return a=c,!0}))try{!d.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&d.resolve("load"),clearInterval(t)}catch(ia){}},50);return d};C.changeLocation=
function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};C.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=I.urlToObject(a),b.hash=null):(a=a.split("#"),b=I.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?n.queryToObject(a[1]):a[1]:null);return b};C.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+
a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],
delete b["3D"],"undefined"===typeof b.properties&&(b.properties={}),M.processWidgetProperties(b))},processManifestLabel:function(a,b){var c=b.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[c]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&f.forEach(a.layouts,function(c){var g="i18nLabels_layout_"+c.name;c.label=a[g]&&(a[g][b]||a[g].defaultLabel)||c.label||c.name});a.styles&&f.forEach(a.styles,function(c){var g="i18nLabels_style_"+c.name;c.label=a[g]&&(a[g][b]||a[g].defaultLabel)||
c.label||c.name})},addI18NLabel:function(a){var b=new c;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var g;g=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(C.getRequireConfig(),["dojo/i18n!"+g],function(c){var g={};g[dojoConfig.locale]=c;M.addI18NLabelToManifest(a,null,g);b.resolve(a)});return b}}}();C.getUniqueValues=function(a,b,g,d,h){return function(){var b=new c;d?b.resolve(d):b=N({url:a,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"});return b}().then(function(c){return C._getUniqueValues(a,b,g,c).then(function(a){var g=[],g=C.getFieldInfoByFieldName(c.fields,b),d=null,u=0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(g.type);g&&(u&&(a=f.map(a,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a})),g.domain&&g.domain.codedValues&&0<g.domain.codedValues.length?(d={},f.forEach(g.domain.codedValues,function(a){d[a.code]=
a.name})):c.typeIdField===b&&(d={},f.forEach(c.types,function(a){d[a.id]=a.name})));return g=f.map(a,function(a){var b=null,b=null===a||void 0===a?"\x3cNull\x3e":d&&d.hasOwnProperty(a)?d[a]:u?h?C.localizeNumberByFieldInfo(a,h):C.localizeNumber(a):a;return{value:a,label:b}})})})};C._getUniqueValues=function(a,b,g,d){var h=new c;a=a.replace(/\/*$/g,"");g||(g="1\x3d1");/\/ImageServer$/gi.test(a)?h=C._getUniqueValuesByQueryTask(a,b,g):(h=C.getFieldInfoByFieldName(d.fields,b),h=0<C._getCodedValuesOrTypesCount(h,
d)?C._getUniqueValuesByQueryTask(a,b,g):C._getUniqueValuesByGenerateRenderer(a,b,g));return h};C._getCodedValuesOrTypesCount=function(a,b){if(a){if(a.domain&&"codedValue"===a.domain.type&&a.domain.codedValues)return a.domain.codedValues.length;if(b.typeIdField===a.name&&b.types)return b.types.length}return 0};C._getUniqueValuesByQueryTask=function(a,b,c){var g=new L;g.where=c;g.returnDistinctValues=!0;g.returnGeometry=!1;g.outFields=[b];return(new Q(a)).execute(g).then(function(a){var c=[];a.features&&
0<a.features.length&&f.forEach(a.features,function(a){a&&a.attributes&&c.push(a.attributes[b])});return c})};C._getUniqueValuesByGenerateRenderer=function(b,g,d){var h=new c;b=b.replace(/\/*$/g,"")+"/generateRenderer";g=a.stringify({type:"uniqueValueDef",uniqueValueFields:[g]});N({url:b,content:{classificationDef:g,f:"json",where:d},handleAs:"json",callbackParamName:"callback"}).then(q.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=f.map(a,q.hitch(this,function(a){return a.value})));
h.resolve(b)}),q.hitch(this,function(a){h.reject(a)}));return h};C.isCodedValuesSupportFilter=function(a,b){var c=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&10.1<c};C.combineRadioCheckBoxWithLabel=function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var g=a.getAttribute("type")||"",g=g.toLowerCase();if("radio"===g||"checkbox"===g)c=!0}g=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(g=!0);c&&g&&(c=a.getAttribute("id"),c||(c="input_"+
C.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),k.setStyle(b,"cursor","pointer"))};C.groupRadios=function(a,b){var c=[],g="radiogroup_"+C.getRandomString();f.forEach(a,function(a){a.name=g;b&&(a=p(a,"change",b),c.push(a))});return c};C.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,g=a.ymin,d=a.ymax;return new F({rings:[[[b,d],[c,d],[c,g],[b,g],[b,d]]],spatialReference:a.toJson()})};C.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};
f.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new B(b)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new x(b)}function g(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=C.convertExtentToPolygon(a),
b.rings=b.rings.concat(a.rings))});return new F(b)}var d=null;if(a&&0<a.length)if(1===a.length)d=a[0];else{for(var h=null,u=null,r=null,p=null,t=0;t<a.length;t++){h=a[t];switch(h.type){case "point":case "multipoint":p="point";break;case "polyline":p="polyline";break;case "polygon":case "extent":p="polygon";break;default:return null}if(0===t)r=p;else if(r!==p)return null;if(t!==a.length-1&&(u=a[t+1],!h.spatialReference.equals(u.spatialReference)))return null}"point"===p?d=b(a):"polyline"===p?d=c(a):
"polygon"===p&&(d=g(a))}return d};C.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=f.map(a,function(a){return a.geometry}),b=C.combineGeometries(a));return b};C.isFeaturelayerUrlSupportQuery=function(a,b){var c=!1,g=/\/featureserver\//gi.test(a),d=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();g?c=0<=b.indexOf("query"):d&&(c=0<=b.indexOf("data"));return c};C.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};C.isStringEndWith=function(a,
b){return a.lastIndexOf(b)+b.length===a.length};C.localizeNumber=function(a,b){var c=(a.toString().split(".")[1]||"").length,d="",d=b&&isFinite(b.places)&&b.places,d=0<d||0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:0<d?d+1:c},"0"):"#,###,###,##0",c={locale:e.locale,pattern:d};q.mixin(c,b||{});try{return g.format(a,c)}catch(da){return console.error(da),a.toLocaleString()}};C.parseNumber=function(a,b){var c={locale:e.locale};q.mixin(c,b||{});try{return g.parse(a,c)}catch(Y){return console.error(Y),
a}};C.localizeDate=function(a,b){var c={locale:e.locale,fullYear:!0};q.mixin(c,b||{});try{return r.format(a,c)}catch(Y){return console.error(Y),"date"===c.selector?a.toLocaleDateString():"time"===c.selector?a.toLocaleTimeString():a.toLocaleString()}};C.localizeNumberByFieldInfo=function(a,b){var c=null,c=q.exists("format.places",b)&&b.format.places,c=C.localizeNumber(a,{places:c});return q.exists("format.digitSeparator",b)&&!b.format.digitSeparator?c.toString().replace(new RegExp("\\"+t.group,"g"),
""):c};C.localizeDateByFieldInfo=function(a,b){var c=null;try{var g={date:a instanceof Date?a.getTime():a},d=q.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",c=v.substitute(g,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+A.prototype._dateFormats[d]}})}catch(ea){console.error(ea),c=a}return c};C.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=
a.indexOf(" ",b);-1===c&&(c=a.length);var g=-1<a.indexOf("\r\n",b)?a.indexOf("\r\n",b):-1<a.indexOf("\n",b)?a.indexOf("\n",b):c,c=g<c?g:c,g=a.substring(b,c);a=a.substring(0,b)+'\x3cA href\x3d"'+g+'" target\x3d"_blank"\x3e'+g+"\x3c/A\x3e"+a.substring(c,a.length)}}return null===a?"":a},getFormattedNumber:function(a,b){if("number"===typeof a){var c=(a.toString().split(".")[1]||"").length;a=C.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&
b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=C.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var c=0,g=a.codedValues.length;c<g;c++){var d=a.codedValues[c];if(v.isDefined(b)&&q.exists("code",d)&&b.toString()===d.code.toString())return d.name}return b}return b||null},getTypeName:function(a,b){for(var c=b.length,
g=0;g<c;g++)if(a===b[g].id)return b[g].name;return a}};C.addRelativePathInCss=J;C.url={isAbsolute:function(a){return a?a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,b){var c=I.urlToObject(a);c.query&&delete c.query[b];var g=c.path,d;for(d in c.query)g=g===c.path?g+"?"+d+"\x3d"+c.query[d]:g+"\x26"+d+"\x3d"+c.query[d];return g},addQueryParamToUrl:function(a,b,c){a=I.urlToObject(a);a.query||(a.query={});a.query[b]=c;b=a.path;for(var g in a.query)b=b===a.path?b+"?"+g+"\x3d"+
a.query[g]:b+"\x26"+g+"\x3d"+a.query[g];return b}};C.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};C.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};C.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=I.urlToObject(a.href);
a.query&&a.query.apiurl&&(b=C.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};C.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};C.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};C.mixinAppConfigPosition=function(a,b){var c=q.clone(a);if(!b)return c;b=q.clone(b);var g=c.widgetOnScreen,d=b.widgetOnScreen;d&&
d.widgets&&("[object Object]"===Object.prototype.toString.call(d.widgets)?f.forEach(g.widgets,function(a,b){var c;c=a.uri?a.uri:"ph_"+b;d.widgets[c]&&d.widgets[c].position&&(d.widgets[c].position.relativeTo||(d.widgets[c].position.relativeTo="map"),a.position=d.widgets[c].position)},this):f.forEach(d.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");g.widgets[b]&&a.position&&(g.widgets[b].position=a.position)}));if(d&&d.groups)if("[object Object]"===Object.prototype.toString.call(d.groups))f.forEach(g.groups,
function(a,b){var c;c=a.label?a.label:"g_"+b;d.groups[c]&&d.groups[c].panel&&d.groups[c].panel.position&&(d.groups[c].panel.position.relativeTo||(d.groups[c].panel.position.relativeTo="map"),a.panel.position=d.groups[c].panel.position)},this);else{var h;h=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";"jimu/layoutManagers/AbsolutePositionLayoutManager"===h?f.forEach(d.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo=
"map");g.groups[b]&&a.panel&&a.panel.position&&(g.groups[b].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===h&&(g.groups=W(g.groups,d.groups.map(function(a){return a.id})))}b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);
b.mobileLayout&&(c.mobileLayout=b.mobileLayout);return c};C.handleGridLayoutOnScreenGroupChange=W;C.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,c){var g=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),g=b+a+c.length);return{firstPos:b,lastPos:g}},setConfigValue:function(a,b,c){R(a,b,c)},getConfigValue:function(a,b){return R(a,b)},setConfigValueWithId:function(a,b,c){ba(a,b,c)},getConfigValueWithId:function(a,
b){return ba(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=C.template.getSearchRange(a,C.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=C.template.getSearchRange(a,C.template.groupIdentification,
"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],c=C.template.widgetIdentification+"_config",g;f.forEach(a.configurationSettings,function(a){f.forEach(a.fields,function(a){a.fieldName&&(g=C.template.getSearchRange(a.fieldName,c,"]"),0<=g.firstPos&&(a=C.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,
b,c){function g(a){var b=[];f.forEach(a,function(a){a&&b.push(a)},this);return b}var d=a.widgetOnScreen,h=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);c&&(a.map.mapOptions&&C.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=h,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var u in b.values)"webmap"!==u&&C.template.setConfigValueWithId(a,u,b.values[u]);a.widgetPool.widgets=g(a.widgetPool.widgets);d.widgets=g(d.widgets);
if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=g(a.widgetPool.groups[b].widgets);if(d.groups)for(b=0;b<d.groups.length;b++)d.groups[b].widgets=g(d.groups[b].widgets);return a}};C.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};C.graphicsExtent=function(a,b){var c=null;try{0<a.length&&(c=V.graphicsExtent(a))&&"number"===
typeof b&&0<b&&(c=c.expand(b))}catch(Y){console.error(Y)}return c};C.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};C.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};C.encodeHTML=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};C.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};
C.getBestDisplayAttributes=function(a,b){var c={},g=null,d;for(d in a)g=C.getBestDisplayValue(d,a,b),c[d]=g;return c};C.getBestDisplayValue=function(a,b,c){var g="",d=null;q.isArrayLike(c)?d=C.getFieldInfoByFieldName(c,a):"object"===typeof c&&c.name===a&&(d=c);d&&(g=b[a],"esriFieldTypeDate"===d.type?g&&(a=new Date(parseInt(g,10)),g=C._tryLocaleDate(a)):"number"===typeof g&&(d.domain&&"codedValue"===d.domain.type?f.some(d.domain.codedValues,function(a){if(a.code===g)return g=a.name,!0}):g=C._tryLocaleNumber(g)));
if(null===g||void 0===g)g="";return g};C._getCodedValues=function(a){var b=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(b=a.codedValues,b=f.map(b,q.hitch(this,function(a){return{value:a.code,label:a.name}})));return b};C._getSubTypes=function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=f.map(a.types,q.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};C._getCodedValueOrSubtypes=function(a,b,c){var g=C.getFieldInfoByFieldName(b),
d=C._getCodedValues(g);d&&0!==d.length||!a.typeIdField||(g=C._getSubTypes(a),a.typeIdField.toUpperCase()===b.toUpperCase()?d=g:void 0!==c&&null!==c&&a.types&&0<a.types.length&&f.some(a.types,q.hitch(this,function(a){return a.name===c?("codedValue"===a.type&&(d=a.codedValues),!0):!1})));return d};C._getDisplayValueForCodedValueOrSubtype=function(a,b,c,g){var d={isCodedValueOrSubtype:!1,displayValue:c};(a=C._getCodedValueOrSubtypes(a,b,g))&&0<a.length&&f.some(a,q.hitch(this,function(a){return a.value===
c?(d={isCodedValueOrSubtype:!0,displayValue:a.label},!0):!1}));return d};C.getDisplayValueForCodedValueOrSubtype=function(a,b,c){var g=c[b],d,h=a.typeIdField;c.hasOwnProperty(h)&&(d=c[h]);return C._getDisplayValueForCodedValueOrSubtype(a,b,g,d)};C.getDefaultPortalFieldInfo=function(a){var b=a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};
break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};C._tryLocaleNumber=function(a){var b=C.localizeNumber(a);if(null===b||void 0===b)b=a;return b};C._tryLocaleDate=function(a){var b=C.localizeDate(a);b||(b=a.toLocaleDateString());return b};C.getFieldInfoByFieldName=function(a,b){var c=null;a&&0<a.length&&f.some(a,q.hitch(this,function(a){return a.name===b?(c=a,!0):!1}));
return c};C.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};C.has=function(a){var b=m(a);if(b)return b;if("ie"===a.toLowerCase()){a=0;var c=/MSIE (\d+\.\d+);/.test(navigator.userAgent),g=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");c&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);g&&-1!==d&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||
b};C.detectUserAgent=function(){var a={},b={},c=navigator.userAgent,g=navigator.platform,d=c.match(/Web[kK]it[\/]{0,1}([\d.]+)/),h=c.match(/(Android);?[\s\/]+([\d.]+)?/),u=!!c.match(/\(Macintosh\; Intel /),r=c.match(/(iPad).*OS\s([\d_]+)/),p=c.match(/(iPod)(.*OS\s([\d_]+))?/),t=!r&&c.match(/(iPhone\sOS)\s([\d_]+)/),e=c.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),g=/Win\d{2}|Windows/.test(g),l=c.match(/Windows Phone ([\d.]+)/),n=e&&c.match(/TouchPad/),v=c.match(/Kindle\/([\d.]+)/),z=c.match(/Silk\/([\d._]+)/),
f=c.match(/(BlackBerry).*Version\/([\d.]+)/),y=c.match(/(BB10).*Version\/([\d.]+)/),m=c.match(/(RIM\sTablet\sOS)\s([\d.]+)/),A=c.match(/PlayBook/),x=c.match(/Chrome\/([\d.]+)/)||c.match(/CriOS\/([\d.]+)/),w=c.match(/Firefox\/([\d.]+)/),k=c.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),B=c.match(/MSIE\s([\d.]+)/)||c.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),F=!x&&c.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),q=F||c.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);
b.webkit=!!d;b.webkit&&(b.version=d[1]);h&&(a.android=!0,a.version=h[2]);t&&!p&&(a.ios=a.iphone=!0,a.version=t[2].replace(/_/g,"."));r&&(a.ios=a.ipad=!0,a.version=r[2].replace(/_/g,"."));p&&(a.ios=a.ipod=!0,a.version=p[3]?p[3].replace(/_/g,"."):null);l&&(a.wp=!0,a.version=l[1]);e&&(a.webos=!0,a.version=e[2]);n&&(a.touchpad=!0);f&&(a.blackberry=!0,a.version=f[2]);y&&(a.bb10=!0,a.version=y[2]);m&&(a.rimtabletos=!0,a.version=m[2]);A&&(b.playbook=!0);v&&(a.kindle=!0,a.version=v[1]);z&&(b.silk=!0,b.version=
z[1]);!z&&a.android&&c.match(/Kindle Fire/)&&(b.silk=!0);x&&(b.chrome=!0,b.version=x[1]);w&&(b.firefox=!0,b.version=w[1]);k&&(a.firefoxos=!0,a.version=k[1]);B&&(b.ie=!0,b.version=B[1]);q&&(u||a.ios||g)&&(b.safari=!0,a.ios||(b.version=q[1]));F&&(b.webview=!0);a.tablet=!!(r||A||h&&!c.match(/Mobile/)||w&&c.match(/Tablet/)||B&&!c.match(/Phone/)&&c.match(/Touch/));a.phone=!(a.tablet||a.ipod||!(h||t||e||f||y||x&&c.match(/Android/)||x&&c.match(/CriOS\/([\d.]+)/)||w&&c.match(/Mobile/)||B&&c.match(/Touch/)));
return{os:a,browser:b}};C.isMobileUa=function(){var a=C.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};C.inMobileSize=function(){var a=k.getMarginBox(document.body);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};C.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var c=
a[b];if("esriFieldTypeOID"===c.type)return c.name}return null};C.isNeedHttpsButNot=function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext");return(b&&window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};C.toFeatureSet=function(a){var b=new H;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);b.features=a;if(0<a.length){var c;f.some(a,function(a){if(a.geometry)return c=a,!0});if(c){a=c.getLayer();var g={};a&&(b.displayFieldName=a.displayField,
f.forEach(a.fields,q.hitch(this,function(a){var b=a.name;g[b]=a.alias||b})),b.fieldAliases=g);b.geometryType=c.geometry.type;b.spatialReference=c.geometry.spatialReference}}return b};C.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(q.hitch(this,function(){a.focusNode.blur()}),100))}catch(aa){console.error(aa)}};C.getFeatureLayerDefinition=function(a){var b=null,c=a.graphics;a.graphics=[];var g=a.toJson();a.graphics=c;g&&(b=
g.layerDefinition);return b};C.simulateClickEvent=function(a){if(m("safari")){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else a.click()};C.getFeatureSetByLayerAndFeatures=function(a,b){var c=new H;c.fields=q.clone(a.fields);c.features=b;c.geometryType=a.geometryType;c.fieldAliases={};f.forEach(c.fields,q.hitch(this,function(a){var b=a.name;c.fieldAliases[b]=a.alias||b}));return c};C.featureAction=function(){return{zoomTo:function(a,b,c){c||(c={});c.hasOwnProperty("extentFactor")||
(c.extentFactor=1.2);if(a&&b&&0<b.length){var g=f.every(b,function(a){return a&&a.spatialReference&&a.type});if(f.every(b,function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||g)g&&(b=f.map(b,function(a){return{geometry:a}})),1===b.length&&"point"===b[0].type?(c=15,c=-1<a.getMaxZoom()?a.getMaxZoom():.1,a.centerAndZoom(b[0].geometry,c)):(b=V.graphicsExtent(b),a.setExtent(b.expand(c.extentFactor)))}},flash:function(a,b){function c(a,b){f.forEach(d,function(c,g){c.setSymbol(b?
a:u[g]||r)})}function g(a){return function(){setTimeout(function(){c(p,!0);d[0]&&b&&b.redraw();setTimeout(function(){c(null,!1);d[0]&&b&&b.redraw();a()},200)},200)}}if(f.every(a||[],function(a){return a&&a.geometry})){var d=a,h=d[0],u=f.map(d,function(a){return a.symbol}),r=h.symbol||q.getObject("renderer.symbol",!1,b),p=null;b&&"esriGeometryPoint"===b.geometryType?p=new K(require.toUrl("jimu")+"/images/flash.gif",20,20):(p=q.clone(r))&&(p.outline?p.outline.setColor("#ffc500"):p.setColor("#ffc500"));
h&&r&&p&&b&&("esriGeometryPoint"===b.geometryType?(c(p,!0),b.redraw(),setTimeout(function(){c(null,!1);b.redraw()},2E3)):g(g(g(function(){})))())}},panTo:function(a,b){if(f.every(b||[],function(a){return a&&a.geometry})){var c;0<b.length?c=V.graphicsExtent(b).getCenter():(c=b[0].geometry,c="polyline"===c.type||"polygon"===c.type?c.getExtent().getCenter():"extent"===c.type?c.getCenter():"multipoint"===c.type?1<c.points.length?c.getExtent().getCenter():c.getPoint(0):c);a.centerAt(c)}},showPopup:function(a,
b){if(f.every(b||[],function(a){return a&&a.geometry})){var c=a.infoWindow;c.setFeatures(b);var g=b[0];"point"===g.geometry.type?c.show(g.geometry,{closetFirst:!0}):c.show(g.geometry.getExtent().getCenter(),{closetFirst:!0})}}}}();C.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(aa){console.log(aa),a=!1}return!!a};C.getAppHref=function(){var a="";return a=C.isInConfigOrPreviewWindow()?window.parent.location.href:
window.location.href};C.getAppIdFromUrl=function(){var a=!0,b=C.getAppHref();if(-1!==b.indexOf("id\x3d")||-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};
C.getEditorContentHeight=function(a,b,g){var d=new c;this._content=a;this._dom=b;this._domParam=g;var h=setTimeout(q.hitch(this,function(){clearTimeout(h);h=null;var a=0,b=this._domParam.contentWidth;try{var c=document.createElement("div");c.setAttribute("id","fakeContent");k.setStyle(c,"background-size","contain");c.innerHTML=this._content;this._dom.appendChild(c);if(c){var g=l("img",c);g&&g.length&&g.style({maxWidth:b-20+"px"});k.setStyle(c,"position","absolute");k.setStyle(c,"width",b+"px");k.setStyle(c,
"left","-99999px");k.setStyle(c,"top","-99999px");k.setStyle(c,"visibility","hidden");var u=k.getContentBox(c);u.h&&(a=u.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(fa){console.error("can't getEditorContentHeight"+fa),a=200}d.resolve(a)}),1500);return d};C.getBase64Data=function(a){var b=new c;if(a&&a.startWith("data:image"))b.resolve(a);else try{N({url:a,handleAs:"arraybuffer"}).then(function(a){var c=new FileReader;c.onloadend=function(){b.resolve(c.result)};c.onerror=
function(){b.resolve(null)};c.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(ca){console.warn(ca),b.resolve(null)}return b};C.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:C.getColorRecordName(a),forceAttr:b}}};C.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:C.getColorRecordName(a)}}};C.getColorRecordName=function(a){return"wab_cr_"+(a||"")};
C.b64toBlob=function(a,b,c){b=b||"";c=c||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var g=[],d=0;d<a.length;d+=c){for(var h=a.slice(d,d+c),u=Array(h.length),r=0;r<h.length;r++)u[r]=h.charCodeAt(r);h=new Uint8Array(u);g.push(h)}return new Blob(g,{type:b})};C.subtractionArray=function(a,b){for(var c=a.length-1;0<=c;c--)for(var g=a[c],d=b.length-1;0<=d;d--)if(g===b[d]){a.splice(c,1);b.splice(d,1);break}return a};C.resourcesUrlToBlob=function(a){return N({url:a,handleAs:"blob"})};
C.processItemResourceOfAppConfig=function(a,b){function c(a){var b=a.obj,c=a.key,g={obj:b,key:c};"number"===typeof a.i?(g.i=a.i,g.value=b[c][a.i]):g.value=b[c];return g}function g(a){for(var b in a)if("object"===typeof a[b])if(Array.isArray(a[b]))for(var c=a,h=b,u=0;u<c[h].length;u++)"string"===typeof c[h][u]?d(c,h,u):"object"===typeof c[h][u]&&g(c[h][u]);else g(a[b]);else"string"===typeof a[b]&&d(a,b)}function d(a,g,d){"number"===typeof d?b.test(a[g][d])&&(p=b.func(c({obj:a,key:g,i:d})),"function"===
typeof p.then?r.push(p):u.push(p)):b.test(a[g])&&(p=b.func(c({obj:a,key:g})),"function"===typeof p.then?r.push(p):u.push(p))}var u=[],r=[],p;g(a);return 0<r.length?h(r).then(function(b){0<u.length&&(b=b.concat(u));return{appConfig:a,result:b}}):{appConfig:a,result:u}};C.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};C.uniqueArray=function(a){for(var b=[],c=0;c<a.length;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b};C.isNotEmptyObject=function(a,b){return b?
C.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):C.isObject(a)&&0<Object.keys(a).length};C.getMinOfArray=function(a){return Number(Math.min.apply(Math,a))};C.getDataSchemaFromLayerDefinition=function(a){var b=a.fields.filter(function(a){return"esriFieldTypeOID"===a.type}),b=0<b.length?b[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,objectIdField:b,typeIdField:a.typeIdField}};return C})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang",
"./_base/array"],function(q,f,k){var m=q.NodeList;f.extend(m,{_buildArrayFromCallback:function(e){for(var n=[],l=0;l<this.length;l++){var d=e.call(this[l],this[l],n);d&&(n=n.concat(d))}return n},_getUniqueAsNodeList:function(e){for(var n=[],l=0,d;d=e[l];l++)1==d.nodeType&&-1==k.indexOf(n,d)&&n.push(d);return this._wrap(n,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(e,n){var l=this._getUniqueAsNodeList(e),l=n?q._filterResult(l,n):l;return l._stash(this)},_getRelatedUniqueNodes:function(e,
n){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(n),e)},children:function(e){return this._getRelatedUniqueNodes(e,function(e,l){return f._toArray(e.childNodes)})},closest:function(e,n){return this._getRelatedUniqueNodes(null,function(l,d){do if(q._filterResult([l],e,n).length)return l;while(l!=n&&(l=l.parentNode)&&1==l.nodeType);return null})},parent:function(e){return this._getRelatedUniqueNodes(e,function(e,l){return e.parentNode})},parents:function(e){return this._getRelatedUniqueNodes(e,
function(e,l){for(var d=[];e.parentNode;)e=e.parentNode,d.push(e);return d})},siblings:function(e){return this._getRelatedUniqueNodes(e,function(e,l){for(var d=[],c=e.parentNode&&e.parentNode.childNodes,h=0;h<c.length;h++)c[h]!=e&&d.push(c[h]);return d})},next:function(e){return this._getRelatedUniqueNodes(e,function(e,l){for(var d=e.nextSibling;d&&1!=d.nodeType;)d=d.nextSibling;return d})},nextAll:function(e){return this._getRelatedUniqueNodes(e,function(e,l){for(var d=[],c=e;c=c.nextSibling;)1==
c.nodeType&&d.push(c);return d})},prev:function(e){return this._getRelatedUniqueNodes(e,function(e,l){for(var d=e.previousSibling;d&&1!=d.nodeType;)d=d.previousSibling;return d})},prevAll:function(e){return this._getRelatedUniqueNodes(e,function(e,l){for(var d=[],c=e;c=c.previousSibling;)1==c.nodeType&&d.push(c);return d})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-
1]]:[],this)},even:function(){return this.filter(function(e,n){return 0!=n%2})},odd:function(){return this.filter(function(e,n){return 0==n%2})}});return m})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(q){q=q.getObject("dojox.encoding.base64",!0);q.encode=function(f){for(var k=[],m=f.length,e=m%3,m=m-e,n=0;n<m;){var l=f[n++]<<16|f[n++]<<8|f[n++];k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>
12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l&63))}switch(e){case 2:l=f[n++]<<16|f[n++]<<8;k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6&
63));k.push("\x3d");break;case 1:l=f[n++]<<16,k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63)),k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63)),k.push("\x3d"),k.push("\x3d")}return k.join("")};q.decode=function(f){f=f.split("");for(var k=[],m=f.length;"\x3d"==f[--m];);for(var e=0;e<m;){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<18;e<=m&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<
12);e<=m&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<6);e<=m&&(n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++]));k.push(n>>>16&255);k.push(n>>>8&255);k.push(n&255)}for(;0==k[k.length-1];)k.pop();return k};return q})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(q,f,k,m,e,n,l,
d){q=q(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var c=k.map(this.geometries,function(c){return c.toJson()}),h={};h.outSR=this.outSR.wkid||m.toJson(this.outSR.toJson());h.inSR=this.geometries[0].spatialReference.wkid||m.toJson(this.geometries[0].spatialReference.toJson());h.geometries=m.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:c});this.transformation&&(h.transformation=this.transformation.wkid||
m.toJson(this.transformation));l.isDefined(this.transformForward)&&(h.transformForward=this.transformForward);return h}});e("extend-esri")&&f.setObject("tasks.ProjectParameters",q,n);return q})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(q,f){var k=q.clone(f);k.declaredClass="jimu.portalUrlUtils";k.getPortalUrlFromLocation=function(){return k.getPortalServerFromLocation()+k.getDeployContextFromLocation()};k.getPortalSignInUrlFromLocation=
function(){var f=k.getPortalUrlFromLocation();return k.setHttpsProtocol(f+"home/signin.html")};k.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};k.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],e=f.indexOf("/home");0>e&&(e=f.indexOf("/apps"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,e);"/"!==f&&(f="/"+f+"/");return f};k.getRestBaseUrlFromLocation=function(){return window.location.protocol+
"//"+window.location.host+k.getDeployContextFromLocation()+"sharing/rest/"};return k})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var q={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&
(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});q.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&(f=f.slice(2));return f.split("/")[0]};q.getServerWithProtocol=function(f){var k="";if(f=(f||"").trim()){var m=q.getServerByUrl(f);if(!m)return k;var e=q.getProtocol(f);e?k=e+"://"+m:0===f.indexOf("//")&&(k="//"+m)}return k};q.isSameServer=function(f,k){f=q.getServerByUrl(f)||"";k=q.getServerByUrl(k)||
"";return f.toLowerCase()===k.toLowerCase()};q.getDomain=function(f){var k="";if(f=q.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(k=f[0],/^\d+\.\d+$/.test(k)&&(k=""));return k};q.isSameDomain=function(f,k){var m=q.getDomain(f),e=q.getDomain(k);return""!==m&&m===e};q.isOrgOnline=function(f){return 0<=q.getServerByUrl(f).toLowerCase().indexOf(".maps.arcgis.com")};q.isOnline=function(f){return 0<=q.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};q.isArcGIScom=
function(f){f=q.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};q.getStandardPortalUrl=function(f){var k=q.getServerByUrl(f);if(""===k)return"";q.isOnline(k)?(q.isArcGIScom(k)&&(k="www.arcgis.com"),f=q.addProtocol(f),f=q.getProtocol(f)+"://"+k):(f=(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=q.addProtocol(f),f.replace(new RegExp("http(s?)://"+k,"g"),"")||(f+="/arcgis"));return f};q.isSamePortalUrl=function(f,k){var m=/^http(s?):\/\//gi,e=/^\/\//gi;
f=q.getStandardPortalUrl(f).toLowerCase().replace(m,"").replace(e,"");k=q.getStandardPortalUrl(k).toLowerCase().replace(m,"").replace(e,"");return f===k};q.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&-1>=f.toLowerCase().indexOf("https://")){var k="";"undefined"!==typeof window&&window.location?(k=window.location.protocol,f=f.startWith("//")?k+f:f.startWith("/")?k+"//"+window.location.host+f:k+"//"+f):(k="http:",f=f.startWith("//")?k+f:k+"//"+f)}return f};q.getProtocol=function(f){var k=
"";f=f.toLowerCase();0===f.indexOf("https://")?k="https":0===f.indexOf("http://")&&(k="http");return k};q.updateUrlProtocolByOtherUrl=function(f,k){k=k.toLowerCase();0===k.indexOf("https://")?f=q.setHttpsProtocol(f):0===k.indexOf("http://")&&(f=q.setHttpProtocol(f));return f};q.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};q.setHttpProtocol=function(f){f=q.addProtocol(f);return f.replace(/^https:\/\//,"http://")};q.setHttpsProtocol=function(f){f=q.addProtocol(f);return f.replace(/^http:\/\//,
"https://")};q.setProtocol=function(f,k){return 0<=k.indexOf("https")?q.setHttpsProtocol(f):0<=k.indexOf("http")?q.setHttpProtocol(f):f};q.getSharingUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest");return k};q.getOAuth2Url=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2");return k};q.getAppIdUrl=function(f,k){var m="",e=q.getStandardPortalUrl(f);e&&(m=e+"/sharing/rest/oauth2/apps/"+k);return m};q.getSignInUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&
(k=f+"/home/signin.html");return k};q.getBaseSearchUrl=function(f){var k="";f=q.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(k=f+"/sharing/rest/search");return k};q.getBaseItemUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/content/items");return k};q.getItemUrl=function(f,k){var m="",e=q.getBaseItemUrl(f);e&&k&&(m=e+"/"+k);return m};q.getItemDataUrl=function(f,k){var m="",e=q.getItemUrl(f,k);e&&(m=e+"/data");return m};q.getItemGroupsUrl=function(f,k){var m="",e=
q.getItemUrl(f,k);e&&(m=e+"/groups");return m};q.getGenerateTokenUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/generateToken");return k};q.getItemDetailsPageUrl=function(f,k){var m="";f&&k&&(f=q.getStandardPortalUrl(f),m=f+"/home/item.html?id\x3d"+k);return m};q.getUserProfilePageUrl=function(f,k){var m="";f&&k&&(f=q.getStandardPortalUrl(f),m=f+"/home/user.html?user\x3d"+k);return m};q.getBaseGroupUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/groups");
return k};q.getPortalSelfInfoUrl=function(f){var k="";(f=q.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/portals/self");return k};q.getCommunitySelfUrl=function(f){var k="";(f=q.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/community/self");return k};q.getBaseUserUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/users");return k};q.getUserUrl=function(f,k){var m="",e=q.getBaseUserUrl(f);f&&k&&(m=e+"/"+k);return m};q.getUserTagsUrl=function(f,k){var m="",
e=q.getUserUrl(f,k);f&&k&&(m=e+"/tags");return m};q.getUserThumbnailUrl=function(f,k,m){var e="";(f=q.getUserUrl(f,k))&&m&&(e=f+"/info/"+m);return e};q.getContentUrl=function(f){var k="";f&&(f=q.getStandardPortalUrl(f),k=f+"/sharing/rest/content");return k};q.getUserContentUrl=function(f,k,m){var e="",e="";f&&k&&(e=q.getContentUrl(f),e=m?e+"/users/"+k+"/"+m:e+"/users/"+k);return e};q.getUserContentItemUrl=function(f,k,m){var e="",e="";f&&k&&m&&(e=q.getUserContentUrl(f,k),e=e+"/items/"+m);return e};
q.getItemResourceUrl=function(f,k,m){var e="",e="";f&&k&&(e=q.getContentUrl(f),e=m?e+"/items/"+k+"/resources/"+m:e+"/items/"+k+"/resources");return e};q.getAddItemUrl=function(f,k,m){var e="",e="";f&&k&&(e=q.getUserContentUrl(f,k,m),e+="/addItem");return e};q.getDeleteItemUrl=function(f,k,m){var e="";(f=q.getUserItemsUrl(f,k))&&(e=f+"/"+m+"/delete");return e};q.getUserItemsUrl=function(f,k,m){var e="",e="";f&&k&&(e=q.getUserContentUrl(f,k,m),e+="/items");return e};q.getUpdateItemUrl=function(f,k,
m,e){var n="",n="";f&&k&&(n=q.getUserItemsUrl(f,k,e),n=n+"/"+m+"/update");return n};q.shareItemUrl=function(f,k,m,e){var n="",n="";f&&k&&(n=q.getUserItemsUrl(f,k,e),n=n+"/"+m+"/share");return n};q.getHomeIndexUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/home/index.html");return k};q.getHomeMapViewerUrl=function(f,k){var m="",e=q.getStandardPortalUrl(f);e&&(m=e+"/home/webmap/viewer.html",m=k?m+("?webmap\x3d"+k):m+"?useExisting\x3d1");return m};q.getHomeSceneViewerUrl=function(f,k){var m=
"",e=q.getStandardPortalUrl(f);e&&(m=e+"/home/webscene/viewer.html",k&&(m+="?webscene\x3d"+k));return m};q.getHomeGalleryUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/home/gallery.html");return k};q.getHomeGroupsUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/home/groups.html");return k};q.getHomeMyContentUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/home/content.html");return k};q.getHomeMyOrganizationUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&
(k=f+"/home/organization.html");return k};q.getHomeUserUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/home/user.html");return k};q.getPortalHelpUrl=function(f,k){var m="",e=q.getStandardPortalUrl(f);e&&(m=e+"/portalhelp/"+(k||"en")+"/website/help/");return m};q.getPortalAdminHelpUrl=function(f,k){var m="",e=q.getStandardPortalUrl(f);e&&(m=e+"/portalhelp/"+(k||"en")+"/admin/help/");return m};q.getPortalProxyUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/proxy");
return k};q.getOAuth2SignOutUrl=function(f){var k="";(f=q.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2/signout");return k};q.getNewPrintUrl=function(f){var k="";if(f=q.getStandardPortalUrl(f))f=q.setHttpProtocol(f),k=f+"/sharing/tools/newPrint";return k};q.getSwitchAccoutnsUrl=function(f,k,m){var e="";if(f=q.getStandardPortalUrl(f))e=f+"/home/pages/Account/manage_accounts.html#client_id\x3d"+k,m&&(e+="\x26redirect_uri\x3d"+m);e&&(e=q.setHttpsProtocol(e));return e};return q})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],
function(q){function f(e,n){function l(d,c){var h,p,a,b,g="widgetOnScreen"===d;if(e[d]){if(e[d].groups)for(h=0;h<e[d].groups.length;h++)if(a=e[d].groups[h],c(a,{index:h,isWidget:!1,groupId:a.id,isThemeWidget:!1,isOnScreen:g}),e[d].groups[h].widgets)for(p=0;p<e[d].groups[h].widgets.length;p++)b=e[d].groups[h].widgets[p],c(b,{index:p,isWidget:!0,groupId:a.id,isThemeWidget:b.uri&&-1<b.uri.indexOf("themes/"+e.theme.name),isOnScreen:g});if(e[d].widgets)for(h=0;h<e[d].widgets.length;h++)b=e[d].widgets[h],
c(e[d].widgets[h],{index:h,isWidget:!0,groupId:d,isThemeWidget:b.uri&&-1<b.uri.indexOf("themes/"+e.theme.name),isOnScreen:g})}}l("widgetOnScreen",n);l("widgetPool",n)}var k={},m="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");k.visitElement=f;k.getConfigElementById=function(e,n){var l;if("map"===n)return e.map;f(e,function(d){if(d.id===
n)return l=d,!0});return l};k.getConfigElementByLabel=function(e,n){var l;if("map"===n)return e.map;f(e,function(d){if(d.label||d.name===n)return l=d,!0});return l};k.getConfigElementsByName=function(e,n){var l=[];if("map"===n)return[e.map];f(e,function(d){d.name===n&&l.push(d)});return l};k.getWidgetNameFromUri=function(e){e=e.split("/");e.pop();return e.pop()};k.getAmdFolderFromUri=function(e){e=e.split("/");e.pop();return e.join("/")+"/"};k.widgetProperties=m;k.processWidgetProperties=function(e){"undefined"===
typeof e.properties.isController&&(e.properties.isController=!1);"undefined"===typeof e.properties.isThemeWidget&&(e.properties.isThemeWidget=!1);"undefined"===typeof e.properties.hasVersionManager&&(e.properties.hasVersionManager=!1);m.forEach(function(n){"undefined"===typeof e.properties[n]&&(e.properties[n]=!0)})};k.getControllerWidgets=function(e){var n=[];e.visitElement(function(e){e.isController&&n.push(e)});return n};k.addI18NLabelToManifest=function(e,n,l){function d(d,a){a[c]&&(e.i18nLabels[d]=
a[c]);"theme"===e.category&&(e.layouts&&e.layouts.forEach(function(b){e["i18nLabels_layout_"+b.name]||(e["i18nLabels_layout_"+b.name]={});e["i18nLabels_layout_"+b.name][d]=a["_layout_"+b.name]}),e.styles&&e.styles.forEach(function(b){e["i18nLabels_style_"+b.name]||(e["i18nLabels_style_"+b.name]={});e["i18nLabels_style_"+b.name][d]=a["_style_"+b.name]}));"widget"===e.category&&e.featureActions&&e.featureActions.forEach(function(b){e["i18nLabels_featureAction_"+b.name]||(e["i18nLabels_featureAction_"+
b.name]={});e["i18nLabels_featureAction_"+b.name][d]=a["_featureAction_"+b.name]})}e.i18nLabels={};var c="widget"===e.category?"_widgetLabel":"_themeLabel";n&&n.root&&n.root[c]&&(e.i18nLabels.defaultLabel=n.root[c],"theme"===e.category&&(e.layouts&&e.layouts.forEach(function(c){e["i18nLabels_layout_"+c.name]={};e["i18nLabels_layout_"+c.name].defaultLabel=n.root["_layout_"+c.name]}),e.styles&&e.styles.forEach(function(c){e["i18nLabels_style_"+c.name]={};e["i18nLabels_style_"+c.name].defaultLabel=n.root["_style_"+
c.name]})),"widget"===e.category&&e.featureActions&&e.featureActions.forEach(function(c){e["i18nLabels_featureAction_"+c.name]={};e["i18nLabels_featureAction_"+c.name].defaultLabel=n.root["_featureAction_"+c.name]}));for(var h in l)d(h,l[h])};k.isHostedService=function(e){var n=q.getServerByUrl(e);return(new RegExp(n+"/[^/]+/[^/]+/rest/services","gi")).test(e)};return k})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v){var z=null,A=q(l,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(n.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),n.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(n.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),n.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(n.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),n.subscribe("app/sceneViewChanged",
f.hitch(this,this._onSceneViewChanged))):(n.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),n.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(n.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),n.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(n.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),n.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));n.subscribe("userSignIn",
f.hitch(this,this._onUserSignIn));n.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));n.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));n.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(a){var c=new e,d;a=f.clone(a);(d=this.getWidgetById(a.id))?c.resolve(d):b([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(f.hitch(this,function(a){var b=a[0],d=a[1];this.loadWidgetResources(d).then(f.hitch(this,function(a){try{var h=this.createWidget(d,
b,a);m.setAttr(h.domNode,"data-widget-name",d.name);console.log("widget ["+d.uri+"] created.")}catch(H){console.log("create ["+d.uri+"] error:"+H.stack),new u({message:window.jimuNls.widgetManager.createWidgetError+": "+d.uri}),g.byId(d.id)&&g.byId(d.id).destroy(),c.reject(H)}setTimeout(f.hitch(this,function(){c.resolve(h);this.emit("widget-created",h);n.publish("widgetCreated",h)}),50)}),function(a){c.reject(a)})}),function(a){c.reject(a)});return c},loadWidgetClass:function(a){var b=new e,c;c=a.isRemote?
a.uri+".js":a.uri;require(r.getRequireConfig(),[c],f.hitch(this,function(a){b.resolve(a)}));r.checkError(a.uri,b);return b},loadWidgetResources:function(a){var c=new e,g,d,h,u=[];h=f.clone(a);a=this.tryLoadWidgetConfig(h);g=this._tryLoadResource(h,"i18n");d=this._tryLoadResource(h,"style");h=this._tryLoadResource(h,"template");u.push(a);u.push(g);u.push(h);u.push(d);b(u).then(f.hitch(this,function(a){var b={};b.config=a[0];b.i18n=a[1];b.template=a[2];b.style=a[3];c.resolve(b)}),function(a){c.reject(a)});
return c},loadWidgetManifest:function(b){var c=new e,g=r.getUriInfo(b.uri),g=g.isRemote?g.folderUrl+"manifest.json?f\x3djson":g.folderUrl+"manifest.json";if(b.manifest)return c.resolve(b),c;a(g,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(a){if(a.error&&a.error.code)return c.reject(a.error);a.category="widget";f.mixin(a,r.getUriInfo(b.uri));r.manifest.addI18NLabel(a).then(f.hitch(this,function(){this._processManifest(a);r.widgetJson.addManifest2WidgetJson(b,a);c.resolve(b)}))}),
function(a){c.reject(a)});return c},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){r.manifest.addManifestProperies(a);r.manifest.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(a,b,g){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);
g.config&&g.i18n&&(g.config=r.replacePlaceHolder(g.config,g.i18n));a.rawConfig=a.config;a.config=g.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=g.i18n||{};g.template&&(a.templateString=g.template);a["class"]="jimu-widget";a.label||(a.label=a.name);this.map&&(a.map=this.map);a.appConfig=this.appConfig;g={};for(var h in a)a.hasOwnProperty(h)&&(g[h]=a[h]);g.widgetManager=this;a=new b(g);a.clazz=b;c.after(a,"startup",f.hitch(this,this._postWidgetStartup,a));c.before(a,"destroy",
f.hitch(this,this._onDestroyWidget,a));d(a.domNode,"click",f.hitch(this,this._onClickWidget,a));this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=k.map(this.loaded,function(a){return a.id});k.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var d=new e;a=f.clone(a);a.id+="_setting";b([this.loadWidgetSettingClass(a)]).then(f.hitch(this,function(b){var h=b[0];this.loadWidgetSettingPageResources(a).then(f.hitch(this,
function(b){var r;b={nls:b.i18n,templateString:b.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?b.sceneView=this.sceneView:b.map=this.map;for(var p in a)a.hasOwnProperty(p)&&(b[p]=a[p]);try{r=new h(b),m.setAttr(r.domNode,"data-widget-name-setting",b.name),c.before(r,"destroy",f.hitch(this,this._onDestroyWidgetSetting,r)),d.resolve(r)}catch(G){new u({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+a.uri}),g.byId(b.id)&&g.byId(b.id).destroy(),
d.reject(G)}}),function(a){console.log(a)})}),function(a){d.reject(a)});return d},loadWidgetSettingClass:function(a){var b=new e,c;c=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(r.getRequireConfig(),[c],f.hitch(this,function(a){b.resolve(a)}));r.checkError(a.folderUrl+"setting/Setting.js",b);return b},loadWidgetSettingPageResources:function(a){var c=new e,g,d,h=[];a=f.clone(a);g=this._tryLoadResource(a,"settingI18n");d=this._tryLoadResource(a,"settingTemplate");
a=this._tryLoadResource(a,"settingStyle");h.push(g);h.push(d);h.push(a);b(h).then(f.hitch(this,function(a){var b={};b.i18n=a[0]||{};b.template=a[1];b.style=a[2];c.resolve(b)}),function(a){console.log(a)});return c},getWidgetById:function(a){var b;k.some(this.loaded,function(c){if(c.id===a)return b=c,!0},this);return b},getWidgetByLabel:function(a){var b;k.some(this.loaded,function(c){if(c.label===a)return b=c,!0},this);return b},getWidgetsByName:function(a){var b=[];k.some(this.loaded,function(c){c.name===
a&&b.push(c)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);m.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(w){console.log(console.error("fail to close widget "+
a.name+". "+w.stack))}}this.appConfig.mode||this._removeDataSourceUsage(a)},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(w){console.error("fail to startup widget "+a.name+". "+w.stack)}if("closed"===a.state){m.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(w){console.error("fail to open widget "+a.name+". "+w.stack)}}this.appConfig.mode||this._addDataSourceUsage(a)},activateWidget:function(a){if("string"===
typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(w){console.log(console.error("fail to maximize widget "+a.name+". "+w.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");
try{a.onMinimize()}catch(w){console.log(console.error("fail to minimize widget "+a.name+". "+w.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(w){console.log(console.error("fail to normalize widget "+a.name+". "+w.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(w){console.log(console.error("fail to destroy widget "+
a.name+". "+w.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(f.hitch(this,function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var b=c.after(a,"onOpen",function(){b.remove();g.resolve(a)})}var g=new e,d=this.getWidgetById(a);if(d){if("closed"!==d.state)return g.resolve(d),g;b(d)}else var h=n.subscribe("widgetCreated",f.hitch(this,function(b){b.id===a&&(h.remove(),g.resolve(b))}));
n.publish("openWidget",a);return g},_tryLoadWidgetConfig:function(b){var c=new e;if(b.config&&f.isObject(b.config))return c.resolve(b.config),c;if(b.config){if(require.cache["url:"+b.config])return c.resolve(h.parse(require.cache["url:"+b.config])),c;c=r.processUrlInAppConfig(b.config);c=c.split("/");c[c.length-1]=encodeURIComponent(c[c.length-1]);c=c.join("/");return a(c,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(b,"config").then(function(a){b.isDefaultConfig=
!0;return a})},_upgradeWidgetConfig:function(a,b){var c=new e,g=a.manifest.version,d=a.version,h;if(g===d)return c.resolve(b),c;if(!1===a.hasVersionManager)return a.version=g,c.resolve(b),c;require(r.getRequireConfig(),[a.amdFolder+"VersionManager"],f.hitch(this,function(u){u=new u;var r=u.getVersionIndex(d),p=u.getVersionIndex(g);if(r>p)c.reject("Bad widget version number, "+a.name+","+d);else try{h=u.upgrade(b,d,g),a.version=g,c.resolve(h)}catch(K){console.log("Read widget ["+a.name+"] old config error,"+
K.stack),c.resolve(b)}}));return c},loadWidgetStyle:function(a){var b=this._getStyleIdFromWidgetJson(a,!1),c=new e;return m.byId(b)?(c.resolve("load"),c):r.loadStyleLink(b,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b=this._getStyleIdFromWidgetJson(a,!0),c=new e;return m.byId(b)?(c.resolve("load"),c):r.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(b){b=require(r.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+
b]){var c=new e;c.resolve(h.parse(require.cache["url:"+b]));return c}return a(b,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(a){var b=new e;require(r.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new e;require(r.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new e;require(r.getRequireConfig(),["dojo/text!"+a.templateFile],
function(a){b.resolve(a)});r.checkError(a.templateFile,b);return b},loadWidgetSettingTemplate:function(a){var b=new e;require(r.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){b.resolve(a)});r.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!1))},removeWidgetSettingStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!0))},_removeStyle:function(a){if(m.byId(a)){var b=m.attr(a,"data-import-styles");
if(b)for(var c=0;c<parseInt(b,10);c++)m.destroy(a+"_import_"+c);m.destroy(a)}},_getStyleIdFromWidgetJson:function(a,b){return this._replaceId("widget/style/"+(a.itemId?a.itemId:a.uri)+(b?"/setting":""))},getControllerWidgets:function(){return k.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return k.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return k.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},
closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},_addDataSourceUsage:function(a){k.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){v.getInstance().addDataSourceUsage(b,a.id)})},_removeDataSourceUsage:function(a){k.forEach(this._getUsedDataSourceIdFromWidget(a),
function(b){v.getInstance().removeDataSourceUsage(b,a.id)})},_getUsedDataSourceIdFromWidget:function(a){if((a=this.appConfig.getConfigElementById(a.id))&&a.config){var b=h.stringify(a.config);return k.filter(Object.keys(this.appConfig.dataSource.dataSources),function(a){return-1<b.indexOf(a)},this)}},_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,c="widgets["+a.id+"]",g;for(g in b){var d=g.replace(/\//g,"_").indexOf(c+"_config");0<=d&&r.template.setConfigValue(a,g.replace(/\//g,
"_").substr(d,g.length).replace(c,"widget"),b[g])}},_onUserSignIn:function(a){k.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){k.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&m.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&
m.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&m.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),n.publish("widgetActived",a))},_onClickWidget:function(a,b){var c=p(".jimu-widget",a.domNode);if(0<c.length)for(var g=0;g<c.length;g++)if(b.target===c[g]||
m.isDescendant(b.target,c[g]))return;this._activeWidget(a)},_onMoveStart:function(a){k.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);t.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,b,c,g){var d=f.clone(a);this.appConfig=
d;k.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(d,b,c,g),"widgetChange"===b&&this._onConfigChanged(c.id,c.config,g))},this)},_onConfigChanged:function(a,b){var c=this.getWidgetById(a);c&&(c.onConfigChanged(b),f.mixin(c.config,b))},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});k.forEach(this.getControllerWidgets(),
function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;r.setVerticalCenter(a.domNode);c.after(a,"resize",f.hitch(this,r.setVerticalCenter,a.domNode));this.openWidget(a);var b=t.getPortalCredential(this.appConfig.portalUrl);if(b)a.onSignIn(b);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===a.id)a.onAction(b.action.name,
b.action.data)})},_remove:function(a){return k.some(this.loaded,function(b,c){if(b.id===a)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(a,b){var c,g=new e;if("config"===b)c=a.amdFolder+"config.json",a.configFile=c,c="hasConfig";else if("style"===b)c=a.amdFolder+"css/style.css",a.styleFile=c,c="hasStyle";else if("i18n"===b)c=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?c:a.amdFolder+"nls/strings",c="hasLocale";else if("template"===b)c=a.amdFolder+"Widget.html",a.templateFile=
c,c="hasUIFile";else if("settingTemplate"===b)c=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===b)c=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?c:a.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===b)c=a.amdFolder+"setting/css/style.css",a.settingStyleFile=c,c="hasSettingStyle";else return g;a[c]?function(){var c;if("config"===b)c=this.loadWidgetConfig(a);else if("style"===b)c=this.loadWidgetStyle(a);
else if("i18n"===b)c=this.loadWidgetI18n(a);else if("template"===b)c=this.loadWidgetTemplate(a);else if("settingTemplate"===b)c=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)c=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)c=this.loadWidgetSettingI18n(a);else return g;c.then(function(a){g.resolve(a)},function(b){new u({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+a.uri});g.reject(b)})}.apply(this):g.resolve(null);return g},_replaceId:function(a){return a.replace(/\//g,
"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);n.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&
this.removeWidgetStyle(a)}});A.getInstance=function(a){null===z&&(z=new A(a),window._widgetManager=z);return z};return A})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){"function"!==typeof e.getAll&&(e.getAll=function(a){var b=
[];(a=e(a))&&b.push(a);return b});b={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return t.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=r.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(b){var g=
new m,u=r.getStandardPortalUrl(b);b=u+"/sharing";var p=r.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),t=r.setHttpsProtocol(b);d.get(p,{jsonp:"callback"}).then(q.hitch(this,function(b){b.token?(this.webTierPortalUrls.push(u),this.removeWabAuthCookie(),c.id.getCredential(t).then(q.hitch(this,function(c){function t(a){var b=a.creationTime||(new Date).getTime(),c=a.expires;0<b&&0<c&&c>b&&setTimeout(function(){d.get(p,{jsonp:"callback"}).then(function(b){b.token&&(a.token=b.token,a.expires=b.expires,
a.creationTime=(new Date).getTime(),a.refreshServerTokens(),t(a))},function(a){console.error(a)})},.8*(c-b))}c.token||(c.token=b.token);c.expires||(c.expires=b.expires);var e=a.canUseXhr(c.server,!0);-1<e&&h.defaults.io.corsEnabledServers.splice(e,1);this._pushCorsEnabledServerInfo({host:r.getServerByUrl(u),withCredentials:!0});g.resolve(!0);t(c)}),q.hitch(this,function(){g.resolve(!0)}))):g.resolve(!1)}),q.hitch(this,function(a){console.error(a);g.reject(a)}));return g},addAuthorizedCrossOriginDomains:function(a){if(a&&
0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(b){if(b&&"string"===typeof b){var c=h.defaults.io.corsEnabledServers,g=r.getServerByUrl(b);(b=r.getServerWithProtocol(b))||(b="http://"+g);b=a.canUseXhr(b,!0);-1<b&&c.splice(b,1);this._pushCorsEnabledServerInfo({host:g,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=h.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof a&&"string"===typeof a.host){for(var g in a.host)a[g]="function"===typeof a.host[g]?function(){return a.host[g].apply(a.host,arguments)}:a.host[g];a.length=a.host.length;f.forEach(c,function(b){"function"===typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}b.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?f.some(c.id.credentials,q.hitch(this,function(b){return a.token===b.token}))?!1:(c.id.credentials.push(a),!0):!1},
registerToken:function(a){var b=r.getSharingUrl(this.portalUrl);c.id.findCredential(b)&&f.some(c.id.credentials,q.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return c.id.credentials.splice(b,1),!0}));return this._getTokenInfo(a).then(function(a){a&&c.id.registerToken(a)})},_getTokenInfo:function(a){var b=r.getPortalSelfInfoUrl(this.portalUrl);return d.get(b+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(q.hitch(this,function(b){return b.user?{server:r.getSharingUrl(this.portalUrl),
ssl:b.allSSL,token:a,userId:b.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&q.trim(a)},signInPortal:function(a){var b=new m;if(this._isInvalidPortalUrl(a)){a=r.getStandardPortalUrl(a);var g=r.getSharingUrl(a),d=this.getPortalCredential(a);d?setTimeout(q.hitch(this,function(){b.resolve(d)}),0):b=c.id.getCredential(g)}else setTimeout(q.hitch(this,function(){b.reject("Invalid portalurl.")}),
0);return b},_loadPortalSelfInfo:function(a){a=r.getPortalSelfInfoUrl(a);return p({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||"string"!==typeof a||!b||"string"!==typeof b)return null;var d=c.id.findOAuthInfo(a);d||(d=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",d=new g({appId:b,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:d}),c.id.registerOAuthInfos([d]));
d.appId=b;return d},signOutAll:function(){var a=r.getStandardPortalUrl(this.portalUrl),b=!!c.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();c.id.destroyCredentials();c.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(q.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,c=a.server,g=a.scope,b=b&&"string"===typeof b&&
q.trim(b),c=c&&"string"===typeof c&&q.trim(c),g="portal"===g||"server"===g,d=!0;a.expires&&(a=parseInt(a.expires,10),d=(new Date).getTime(),d=a>d);b=b&&c&&g&&d}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var c=!1;if(this.isValidCredential(b))var c="portal"===b.scope,g=r.isSameServer(a,b.server),c=c&&g;return c},getPortalCredential:function(a){var b=null;a=q.trim(a||"");if(!a)return null;a=r.getStandardPortalUrl(a);(b=this._filterPortalCredential(a,c.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();
return b},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=r.getStandardPortalUrl(a),r.isOrgOnline(a)&&!this._filterPortalCredential(a,c.id.credentials))){var b=this._filterPortalCredential("http://www.arcgis.com",c.id.credentials);b&&c.id.registerToken({token:b.token,scope:"portal",userId:b.userId,server:a+"/sharing/rest",expires:b.expires})}},saveAndRegisterCookieToCredential:function(a){a=q.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=
!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;c.id.registerToken(a);return c.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=q.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,c=r.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:c,token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");
e("wab_auth",n.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,b){var c=null;a=r.getStandardPortalUrl(a);if(b&&0<b.length){var g=f.filter(b,q.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,
b)}));0<g.length&&(c=g[g.length-1])}return c},_removePortalCredential:function(a){var b=q.trim(a||"");if(b){b=r.getStandardPortalUrl(b);for(a=f.filter(c.id.credentials,q.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);c.id.credentials=f.filter(c.id.credentials,q.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,a)}))}},getUserIdByToken:function(a,b){var g=new m;if(a&&"string"===typeof a&&b&&"string"===typeof b){var d=
r.getStandardPortalUrl(b),h=f.filter(c.id.credentials,q.hitch(this,function(b){var c=b.token===a&&b.userId;b=r.isSameServer(d,b.server);return c&&b}));if(0<h.length){var u=h[0];setTimeout(q.hitch(this,function(){g.resolve(u.userId)}),0);return g}h=r.getCommunitySelfUrl(d);p({url:h,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){g.resolve(a&&a.username||"")}),q.hitch(this,function(a){console.error(a);g.reject("fail to get userId by token")}))}else setTimeout(q.hitch(this,
function(){g.reject("invalid parameters")}),0);return g},xtGetCredentialFromCookie:function(a){var b=e("wab_auth"),g=null;if(b)try{g=n.parse(b)}catch(A){console.error(A)}if(!g||"object"!==typeof g||!r.isSameServer(a,g.server)||window.location.host!==g.referer)return null;g.expires=parseInt(g.expires,10);b=(new Date).getTime();if(!(g.expires>b))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";g.server=a;(b=c.id.findCredential(a))||c.id.registerToken(g);return b=c.id.findCredential(a)},
removeCookie:function(a){var b=this.getCookiePath();t.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return f.map(b,q.hitch(this,function(a,g){var d=b.slice(g,c),h="",r=d.length-1;f.forEach(d,q.hitch(this,function(a,b){h+=a;b!==r&&(h+=".")}));return h}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("userSignIn",a)}catch(v){console.error(v)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("anyUserSignIn",
a)}catch(v){console.error(v)}},_publishCurrentPortalUserSignOut:function(a){try{l.publish("userSignOut",a)}catch(v){console.error(v)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(v){console.error(v)}},_bindEvents:function(){k.after(c.id,"signIn",q.hitch(this,function(a,b){console.log(b[1]);k.after(a,"callback",q.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},
isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(c.id=b,b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io,b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=a.corsStatus)}}this._bindEvents();this._started=!0}}};b.startup();return b})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(q,f,k,m,e,n){return q(n,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=k.create("div",{"class":"title"},this.domNode),this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=k.create("div",
{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(e(this.closeBtnNode,"click",f.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:m.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",501);k.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a){var b=0;return q(p,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();m.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._moveToMiddle()}),50);this.own(n(window,"resize",f.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=m.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();e.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=m.create("div",{"class":"title"},this.domNode);this.titleLabeNode=m.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=m.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?d.press:"click";this.own(n(this.closeBtnNode,
a,f.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=m.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&m.place(this.content,this.contentContainerNode));this.buttonContainer=m.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&m.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var b=m.getContentBox(this.buttonContainer),c=m.getMarginExtents(this.enabledButtons[0]),d=m.getPadBorderExtents(this.enabledButtons[0]),h=0,d=8===l("ie")?d.l+d.r:0,h=(b.w-(c.l+c.r+d)*a)/a;0<h&&(k.forEach(this.enabledButtons,f.hitch(this,
function(a){m.setStyle(a,"maxWidth",h+"px")})),k.forEach(this.disabledButtons,f.hitch(this,function(a){m.setStyle(a,"maxWidth",h+"px")})))}},_moveableNode:function(a,b){this.moveable&&(this.moveable.destroy(),this.moveable=null);var c=m.getMarginBox(this.container);c.l=c.l-a+b;c.w+=2*(a-b);this.moveable=new h.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(n(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(n(this.moveable,
"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===c("#header").length?{t:0,l:0,w:0,h:0}:m.getMarginBox("header")},_getFooterBox:function(){return 0===c(".footer",this.container).length?{t:0,l:0,w:0,h:0}:m.getMarginBox(c(".footer",this.container)[0])},_calculatePosition:function(){var a=m.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,d=0;d=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:
c;c=(c-d)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;m.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(m.setStyle(this.domNode,"height","auto"),m.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&m.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(m.setStyle(this.domNode,"height",this.height+"px"),m.addClass(this.contentContainerNode,"content-absolute"),m.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&m.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=m.getMarginBox(this.domNode),b=m.getContentBox(this.container),c=this._getHeaderBox(),d=this._getFooterBox(),d=b.h-c.h-d.h-40,h=0,h=a.h||d-200,a=(d-h)/2+c.h+20,a=a<c.h?c.h:a;m.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){m.setStyle(this.domNode,"zIndex",b+200+1);m.setStyle(this.overlayNode,"zIndex",b+200);b++},setTitleLabel:function(b){this.titleNode.innerHTML=a.stripHTML(b)},onMoving:function(a){m.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){m.setStyle(a.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,b=f.clone(this.domNode);m.setStyle(this.domNode,"display","none");m.destroy(this.overlayNode);this.destroy();
this.moveable.destroy();m.place(b,a);e.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){m.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=a.classNames.join(" "));var c=m.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(c);
b=m.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+b,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(b);this.own(n(c,"click",f.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,b){"number"===typeof a&&isFinite(a)||(b=a,a=0);if(b&&0!==this.enabledButtons.length)for(var c in b)"title"===c?(m.setAttr(this.enabledButtons[a],"title",b[c]),
m.setAttr(this.disabledButtons[a],"title",b[c])):"label"===c&&(m.setProp(this.enabledButtons[a],"innerHTML",b[c]),m.setProp(this.disabledButtons[a],"innerHTML",b[c]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(m.setStyle(this.enabledButtons[a],"display","inline-block"),m.setStyle(this.disabledButtons[a],"display","none")):(k.forEach(this.enabledButtons[a],f.hitch(this,function(a){m.setStyle(a,"display","inline-block")})),k.forEach(this.disabledButtons[a],
f.hitch(this,function(a){m.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(m.setStyle(this.disabledButtons[a],"display","inline-block"),m.setStyle(this.enabledButtons[a],"display","none")):(k.forEach(this.disabledButtons,f.hitch(this,function(a){m.setStyle(a,"display","inline-block")})),k.forEach(this.enabledButtons,f.hitch(this,function(a){m.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(m.setStyle(this.disabledButtons[a],"display","none"),m.setStyle(this.enabledButtons[a],"display","none")):(k.forEach(this.disabledButtons,f.hitch(this,function(a){m.setStyle(a,"display","none")})),k.forEach(this.enabledButtons,f.hitch(this,function(a){m.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(q,f,k,m,e,n){m=q("dojo.dnd.move.constrainedMoveable",n,{constraints:function(){},within:!1,constructor:function(e,d){d||(d={});this.constraints=d.constraints;this.within=d.within},onFirstMove:function(e){var d=this.constraintBox=this.constraints.call(this,e);d.r=d.l+d.w;d.b=d.t+d.h;this.within&&(e=f.getMarginSize(e.node),d.r-=e.w,d.b-=e.h)},onMove:function(e,d){var c=this.constraintBox,h=e.node.style;this.onMoving(e,d);d.l=d.l<c.l?c.l:c.r<d.l?c.r:d.l;d.t=d.t<c.t?c.t:c.b<d.t?c.b:d.t;h.left=
d.l+"px";h.top=d.t+"px";this.onMoved(e,d)}});e=q("dojo.dnd.move.boxConstrainedMoveable",m,{box:{},constructor:function(e,d){var c=d&&d.box;this.constraints=function(){return c}}});q=q("dojo.dnd.move.parentConstrainedMoveable",m,{area:"content",constructor:function(e,d){var c=d&&d.area;this.constraints=function(){var d=this.node.parentNode,p=k.getComputedStyle(d),a=f.getMarginBox(d,p);if("margin"==c)return a;var b=f.getMarginExtents(d,p);a.l+=b.l;a.t+=b.t;a.w-=b.w;a.h-=b.h;if("border"==c)return a;
b=f.getBorderExtents(d,p);a.l+=b.l;a.t+=b.t;a.w-=b.w;a.h-=b.h;if("padding"==c)return a;b=f.getPadExtents(d,p);a.l+=b.l;a.t+=b.t;a.w-=b.w;a.h-=b.h;return a}}});return{constrainedMoveable:m,boxConstrainedMoveable:e,parentConstrainedMoveable:q}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){var r=null,t=q(e,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};window.isBuilder?(m.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(m.subscribe("app/appConfigLoaded",
f.hitch(this,this._onAppConfigLoaded)),m.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(m.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));m.subscribe("updateDataSourceData",f.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&m.subscribe("app/dataSourceDataUpdated",f.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(a){return this._dataStore[a]},getDataSourceConfig:function(a){return this.appConfig.dataSource.dataSources[a]},
parseDataSourceId:function(a){var b=a.split("~"),c={};if(2>b.length)return console.error("Bad data source id:",a),c;switch(b[0]){case "map":return b=a.lastIndexOf("~"),c={from:"map",layerId:a.substring(4,b)};case "widget":return c={from:"widget",widgetId:b[1]};case "external":return c={from:"external"};default:console.error("Bad data source id:",a)}},addDataSourceUsage:function(a,b){this._dataSourceUsage[a]?(0>this._dataSourceUsage[a].indexOf(b)&&this._dataSourceUsage[a].push(b),1===this._dataSourceUsage[a].length&&
this._startOneDataSource(this.appConfig.dataSource.dataSources[a])):(this._dataSourceUsage[a]=[b],this._startOneDataSource(this.appConfig.dataSource.dataSources[a]))},removeDataSourceUsage:function(a,b){this._dataSourceUsage[a]&&0<=this._dataSourceUsage[a].indexOf(b)&&(this._dataSourceUsage[a]=k.filter(this._dataSourceUsage[a],function(a){return a!==b}))},_onUpdataDataSourceData:function(a,b){this.appConfig.dataSource.dataSources[a]?"widget"!==this.parseDataSourceId(a).from?console.error("Please update data source from widget only.",
a):this._updateDataSourceData(a,b):console.error("Not found data source id:",a)},_updateDataSourceData:function(a,b){this._dataStore[a]=b;m.publish("dataSourceDataUpdated",a,b);this.emit("update",a,b)},_onDataSourceDataUpdatedInApp:function(a,b){this._updateDataSourceData(a,b)},_onMapLoaded:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},_onMapChanged:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,
this.appConfig,"mapChanged")},_onAppConfigLoaded:function(a){this.appConfig=f.clone(a)},_onAppConfigChanged:function(a,b){var c=f.clone(a);window.isBuilder||("dataSourceChange"===b?this._handleDataSourceConfigChange(this.appConfig,c,b):"mapChange"===b&&this._cleanForConfigChangedDataSource(this.appConfig,c));this.appConfig=c},_handleDataSourceConfigChange:function(a,b,c){a&&(this._removeListeners(),this._removeTimers(),this._cleanForConfigChangedDataSource(a,b));k.forEach(Object.keys(b.dataSource.dataSources),
function(a){b.dataSource.dataSources[a].idObj=this.parseDataSourceId(a)},this);this._listenDataSourceChange(b.dataSource.dataSources);this._startRefreshTimer(b.dataSource,c);this._initStaticDataSource(b.dataSource)},_cleanForConfigChangedDataSource:function(a,b){var c=a.dataSource.dataSources,g=b.dataSource.dataSources;k.forEach(Object.keys(c),function(a){if(!g[a]||g[a]&&!l.isEqual(g[a],c[a]))delete this._jimuQueryObject[a],this._updateDataSourceData(a,{features:[]}),delete this._dataStore[a]},this)},
_isGlobalRefresh:function(a){return a.unifiedRefreshInterval&&0<a.unifiedRefreshInterval},_startOneDataSource:function(a){var b;b=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:a.refreshInterval;if("map"===a.idObj.from)this._listenMapDataSourceChange(a);else if("external"===a.idObj.from&&a.filterByExtent){var c={};c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c)}if("map"===
a.idObj.from||"external"===a.idObj.from)this._refeshDataSource(a),a.isDynamic&&(c={},c.handle=setInterval(f.hitch(this,this._refeshDataSource,a),6E4*b),c.dsId=a.id,this._refreshTimers.push(c))},_stopAndCleanOneDataSource:function(a){this._listeners=k.filter(this._listeners,function(b){return b.dsId===a.id?(b.handle.remove(),!1):!0},this);this._refreshTimers=k.filter(this._refreshTimers,function(b){return b.dsId===a.id?(clearInterval(b.handle),!1):!0},this);this._updateDataSourceData(a.id,{features:[]})},
_listenDataSourceChange:function(a){k.forEach(Object.keys(a),function(b){b=a[b];if("map"===b.idObj.from)this._listenMapDataSourceChange(b);else if("external"===b.idObj.from&&b.filterByExtent){var c={};c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,b));c.dsId=b.id;this._listeners.push(c)}},this)},_listenMapDataSourceChange:function(a){this._getLayerObject(a.idObj.layerId).then(f.hitch(this,function(b){if(b){var c={};c.handle=b.on("edits-complete",f.hitch(this,this._onLayerDataChange,
a));c.dsId=a.id;this._listeners.push(c);c={};c.handle=this._getLayerInfo(a.idObj.layerId).on("filterChanged",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c);a.filterByExtent&&(c={},c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a)),c.dsId=a.id,this._listeners.push(c))}else console.error("Can not find layer that data source depends on.",a.id)}))},_onLayerDataChange:function(a){this._doQueryForDataSource(a)},_doQueryForDataSource:function(a){("config"===
this.appConfig.mode||this._dataSourceUsage[a.id]&&0!==this._dataSourceUsage[a.id].length)&&this.doQuery(a).then(f.hitch(this,function(b){this._updateDataSourceData(a.id,{features:b.features})}))},_getLayerObject:function(a){return(a=d.getInstanceSync().getLayerOrTableInfoById(a))?a.getLayerObject():n(null)},_getLayerInfo:function(a){return d.getInstanceSync().getLayerOrTableInfoById(a)},_startRefreshTimer:function(a,b){var c=a.dataSources,g=a.settings;k.forEach(Object.keys(c),function(d){d=c[d];if("widget"!==
d.idObj.from&&d.isDynamic&&d.url){var h;h=this._isGlobalRefresh(g)?g.unifiedRefreshInterval:d.refreshInterval;"dataSourceChange"===b?"external"!==d.idObj.from&&"map"!==d.idObj.from||this._refeshDataSource(d):"external"===d.idObj.from&&this._refeshDataSource(d);d={handle:setInterval(f.hitch(this,this._refeshDataSource,d),6E4*h),dsId:a.id};this._refreshTimers.push(d)}},this)},_initStaticDataSource:function(a){k.forEach(Object.keys(a.dataSources),function(b){b=a.dataSources[b];"widget"!==b.idObj.from&&
!b.isDynamic&&b.url&&this._doQueryForDataSource(b)},this)},_refeshDataSource:function(a){this._doQueryForDataSource(a)},_getDataSourceFilter:function(a){if("map"===a.idObj.from){var b=d.getInstanceSync().getLayerOrTableInfoById(a.idObj.layerId),c;b&&(c=b.getFilter());var b=a.filter?a.filter.expr:"1\x3d1",g;g=c?"("+c+") and ("+b+")":b;return n(g)}return"external"===a.idObj.from?a.portalUrl&&a.itemId?this._getFilterFromItem(a.portalUrl,a.itemId,a.url).then(f.hitch(this,function(b){var c=a.filter?a.filter.expr:
"1\x3d1";return g=b?"("+b+") and ("+c+")":c})):n(a.filter?a.filter.expr:"1\x3d1"):n(a.filter?a.filter.expr:"1\x3d1")},_getFilterFromItem:function(a,b,g){var d=h.getItemUrl(a,b);if(this._itemsFilter[d])return n(this._itemsFilter[d]);var r=c.getPortal(a);return r.getItemById(b).then(f.hitch(this,function(a){return"Feature Service"!==a.type?this._itemsFilter[d]=null:r.getItemData(b).then(f.hitch(this,function(a){var b=g.split("/"),c=b.pop();c||(c=b.pop());if(!a.layers)return this._itemsFilter[d]=null;
a=a.layers.filter(function(a){return a.id+""===c})[0];return a&&a.layerDefinition?this._itemsFilter[d]=a.layerDefinition.definitionExpression:this._itemsFilter[d]=null}))}))},doQuery:function(c){c.idObj||(c.idObj=this.parseDataSourceId(c.id));return this._getQueryObjectFromDataSource(c).then(f.hitch(this,function(d){var h,r;if("Features"===c.type){if("serviceLimitation"===c.resultRecordType)return h=d,r=new a(c.url),r.execute(h);var e=this._jimuQueryObject[c.id];!e||e.url===c.url&&l.isEqual(e.query.toJson(),
d.toJson())||(delete this._jimuQueryObject[c.id],e=null);e||(e={},e.url=c.url,e.query=d,"all"!==c.resultRecordType&&(e.pageSize=c.resultRecordCount),e=new g(e),this._jimuQueryObject[c.id]=e);return"all"===c.resultRecordType?e.getAllFeatures():e.queryByPage(1)}r=new a(c.url);h=new p;return this._getDataSourceFilter(c).then(f.hitch(this,function(a){h.where=a;c.dataSchema.groupByFields&&0<c.dataSchema.groupByFields.length&&(h.groupByFieldsForStatistics=c.dataSchema.groupByFields);c.dataSchema.orderByFields&&
0<c.dataSchema.orderByFields.length&&(h.orderByFields=c.dataSchema.orderByFields);h.outStatistics=c.dataSchema.statistics.map(function(a){var c=new b;c.statisticType=a.statisticType;c.onStatisticField=a.onStatisticField;c.outStatisticFieldName=a.outStatisticFieldName;return c});return r.execute(h)}))}))},_getQueryObjectFromDataSource:function(a){return this._getDataSourceFilter(a).then(f.hitch(this,function(b){var c=new p;c.where=b;a.filterByExtent&&(c.geometry=this.map.extent);c.outFields=a.dataSchema.fields.map(function(a){return a.name});
a.dataSchema.orderByFields&&0<a.dataSchema.orderByFields.length&&(c.orderByFields=a.dataSchema.orderByFields);c.returnGeometry=!0;c.outSpatialReference=this.map.spatialReference;return n(c)}))},_removeListeners:function(){this._listeners.forEach(f.hitch(this,function(a){a.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(f.hitch(this,function(a){clearInterval(a.handle)}));this._refreshTimers=[]}});t.getInstance=function(){null===r&&(r=new t,window._datasourceManager=
r);return r};return t})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(q,f,k,m,e,n,l,d,c){var h=q([l],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,constructor:function(a,b){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=
[];this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this._tables=b.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._finalLayerInfos);this._initFinalLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getLayerInfoArray(),function(b){for(var c=0;c<this._operLayers.length;c++)if(b.id===this._operLayers[c].id){a.push(b);
break}c===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(b.id)&&a.push(b)},this);return a},getTableInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getTableInfoArray(),function(b){for(var c=0;c<this._tables.length;c++)if(b.id===this._tables[c].id){a.push(b);break}},this);return a},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(a){k.getObject("_wabProperties.isTemporaryLayer",!1,a.layerObject)&&(a._flag._isTemporaryLayerInfo=!0);
return!a._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},addFeatureCollection:function(a,b){var g=this._getUniqueTopLayerInfoId(b),d={layers:[]};f.forEach(a,function(a,b){a.id=g+"_"+b;d.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var h;try{h=c.getInstance().create({featureCollection:d,title:b||g,id:g},this.map),h.init()}catch(u){console.warn(u.message),h=null}h&&(h._extraOfWebmapLayerInfo=!0,this._layerInfos.push(h),this.update(),this._onLayersUpdated(h,
h.getRootLayerInfo()))},addTable:function(a){a=this._addTables([a],this._tableInfos);return a[0]?a[0]:null},removeTable:function(a){var b=-1;f.forEach(this._tableInfos,function(c,g){a.id===c.id&&(b=g)});if(0<=b){var c=this._tableInfos[b];this._tableInfos.splice(b,1);c.destroy();this._onTableChange([a],h.REMOVED)}},_addTables:function(a,b){var g=[],r=[];f.forEach(a,function(a){var d;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),
a.selfType="table",d=c.getInstance().create(a),d.init()}catch(v){console.warn(v.message),d=null}d&&(g.push(d),b.push(d),r.push(d.getLayerObject()))},this);d(r).then(k.hitch(this,function(a){var b=[];f.forEach(a,function(a,c){var d=g[c];a?b.push(d):(this.removeTable(d),d.destroy())},this);this._onTableChange(b,h.ADDED)}));return g},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,
this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,b){var c=1,d;a||(a="table");for(d=a;;){for(var h=0;h<b.length&&b[h].id!==d;h++);if(h===b.length)return d;d=a+"_"+c.toString();c++}},_traversal:function(a,b){for(var c=0;c<b.length;c++)if(b[c].traversal(a))return!0;return!1},traversal:function(a){var b=this.getLayerInfoArray();return this._traversal(a,b)},traversalLayerInfosOfWebmap:function(a){var b=this.getLayerInfoArrayOfWebmap();return this._traversal(a,b)},traversalAll:function(a){var b=
this.getLayerInfoArray(),c=this.getTableInfoArray();return this._traversal(a,b.concat(c))},_traversalAllWithSpecialLayerInfo:function(a){return this._traversal(a,this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var b=null;f.some(this.getTableInfoArray(),function(c){if(c.id===a)return b=c,!0});return b},getLayerOrTableInfoById:function(a){var b=null;this.traversalAll(function(c){if(c.id===a)return b=c,!0});
return b},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},moveUpLayer:function(a,b){var c=null;b=b?b:1;var d=this._getTopLayerInfoIndexById(a.id);0<=d-b&&(c=this._finalLayerInfos[d-b].obtainLayerIndexesInMap().length,this._finalLayerInfos[d].moveLayerByIndex(this._finalLayerInfos[d-b].obtainLayerIndexesInMap()[c-1].index),c=this._finalLayerInfos[d-b],n.publish("layerInfos/layerReorder",d,b,"moveup"));return c},_reorderLayerInfosArray:function(a,b,c){"moveup"===c?(c=this._finalLayerInfos[a],
this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-b,0,c)):(c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+b+1,0,c),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode();return c},moveDownLayer:function(a,b){var c=null;b=b?b:1;var d=this._getTopLayerInfoIndexById(a.id);d+b<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[d].moveLayerByIndex(this._finalLayerInfos[d+b].obtainLayerIndexesInMap()[0].index),c=this._finalLayerInfos[d+b],n.publish("layerInfos/layerReorder",
d,b,"movedown"));return c},getBasemapLayers:function(){var a=[];f.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(b){b=this.map.getLayer(b);"basemap"!==b._basemapGalleryLayerType&&"reference"!==b._basemapGalleryLayerType||a.push(b)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var b=a&&a.layerOptions?a.layerOptions:
null;f.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(b)},this)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},getObjectId:function(){return this._objectId},_initLayerInfos:function(){var a;this._layerInfos=[];f.forEach(this._operLayers,function(b){try{a=c.getInstance().create(b),a.init()}catch(g){console.warn(g.message),a=null,this._unreachableLayersTitleOfWebmap.push(b.title)}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=
[];f.forEach(this._finalLayerInfos||this._layerInfos,function(a,b){var d;if(a._needToRenew()){try{d=c.getInstance().create(a.originOperLayer),d.init()}catch(t){console.warn(t.message),d=null}d&&(a.destroy(),this._finalLayerInfos[b]=d)}else if(a.originOperLayer.featureCollection){var h=[];f.forEach(a.getSubLayers(),function(a){h.push(a.id)});f.forEach(h,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(d=a.getSubLayers()[0],this.map.getLayer(d.id).title=
a.title,a.removeSubLayerById(d.id),this._removedLayerInfoIdsFromFeatureCollection.push(d.id),a.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=f.filter(this._finalLayerInfos,function(a){return!a._flag._invalid}))},_initFinalLayerInfos:function(){var a,b,c=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(a=this.map.graphicsLayerIds.length-1;0<=a;a--)b=this.map.graphicsLayerIds[a],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,
c),b,!0);for(a=this.map.layerIds.length-1;0<=a;a--)b=this.map.layerIds[a],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,c),b,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var a=this._tables&&this._tables.reverse();a&&this._addTables(a,this._tableInfos)},_isBasemap:function(a){for(var b=!1,c=this.getBasemapLayers(),d=0;d<c.length;d++)c[d].id===a&&(b=!0);return b},_addToFinalLayerInfos:function(a,b,d){var g;if(a)a._addedFlag||
a.isGraphicLayer()!==d||(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(b);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"esri.layers.LabelLayer"!==a.declaredClass){try{var h={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};k.mixin(h,k.getObject("_wabProperties.originOperLayer",!1,a));g=c.getInstance().create(h,this.map);g.init()}catch(u){console.warn(u.message),g=null}g&&(k.getObject("_wabProperties.isTemporaryLayer",!1,a)&&(g._flag._isTemporaryLayerInfo=!0),
this._finalLayerInfos.push(g))}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&g&&g._getServiceDefinition().then(k.hitch(this,function(a){var b=[];f.forEach(a.tables,function(a){a.url=g.getUrl()+"/"+a.id;a.id=g.id+"_"+a.id;a.title=this._getLayerTitle(a);b.push(a)},this);this._addTables(b,this._tableInfos)}))}},_getLayerTitle:function(a){if(a.title)return a.title;if(k.getObject("_wabProperties.originalLayerName",!1,a))return a.name||
a.id;var b=a.label||a.name||"";if(a.url){var c;c=a.url.indexOf("/FeatureServer");-1===c&&(c=a.url.indexOf("/MapServer"));-1===c&&(c=a.url.indexOf("/service"));-1<c&&(c=a.url.substring(0,c),c=c.substring(c.lastIndexOf("/")+1,c.length),b=b?c+" - "+b:c)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length;c++)if(d=b[c].findLayerInfoById(a)){d=b[c];break}return d},_findLayerInfoById:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);
for(c=0;c<b.length&&!(d=b[c].findLayerInfoById(a));c++);return d},_findTopLayerInfoById:function(a){var b,c=null,d=this._finalLayerInfos.concat(this._tableInfos);for(b=0;b<d.length;b++)if(d[b].id===a){c=d[b];break}return c},_getTopLayerInfoIndexById:function(a){var b,c=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){c=b;break}return c},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=
0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,b,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(c,k.hitch(this,
function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,k.hitch(this,function(a){a.destroy()}))},_bindEvents:function(){var a,b,c,d,p,u,l,f,m;a=e(this.map,"layer-add-result",k.hitch(this,this._onLayersChange,h.ADDED));
b=e(this.map,"layer-remove",k.hitch(this,this._onLayersChange,h.REMOVED));l=n.subscribe("layerInfos/layerReorder",k.hitch(this,this._onLayerReorder));d=n.subscribe("layerInfos/layerInfo/isShowInMapChanged",k.hitch(this,this._onShowInMapChanged));p=n.subscribe("layerInfos/layerInfo/visibleChanged",k.hitch(this,this._onVisibleChanged));u=n.subscribe("layerInfos/layerInfo/filterChanged",k.hitch(this,this._onFilterChanged));f=n.subscribe("layerInfos/layerInfo/rendererChanged",k.hitch(this,this._onRendererChanged));
m=n.subscribe("layerInfos/layerInfo/opacityChanged",k.hitch(this,this._onOpacityChanged));c=e(this.map,"before-unload",k.hitch(this,function(){a.remove();b.remove();l.remove();d.remove();p.remove();u.remove();f.remove();c.remove();m.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(a){console.warn(a)}},_emitEventForEveryLayerInfo:function(a,b){try{f.forEach(b,function(b){b.emitEvent(a)},this)}catch(g){console.warn(g)}},_onLayersChange:function(a,
b){var c=null,d,p;b.error||"esri.layers.GraphicsLayer"===b.layer.declaredClass||"esri.layers.LabelLayer"===b.layer.declaredClass||b.layer._basemapGalleryLayerType||(a===h.ADDED?(this.update(),c=d=this._findLayerInfoById(b.layer.id),p=h.ADDED,d&&!d.isRootLayer()&&(c=d.getRootLayerInfo(),p=h.SUBLAYER_ADDED)):(c=d=this._findLayerInfoById(b.layer.id),p=h.REMOVED,d&&!d.isRootLayer()&&(c=d.getRootLayerInfo(),p=h.SUBLAYER_REMOVED),d&&d.destroy(),this.update()),c&&this._emitEvent("layerInfosChanged",c,p,
d))},_onTableChange:function(a,b){this._emitEvent("tableInfosChanged",a,b,a)},_onLayersUpdated:function(a,b){a.isTable?this._emitEvent("tableInfosChanged",[a],h.UPDATED,[b]):this._emitEvent("layerInfosChanged",a,h.UPDATED,b)},_onShowInMapChanged:function(a){this._emitEvent("layerInfosIsShowInMapChanged",a);this._emitEventForEveryLayerInfo("isShowInMapChanged",a)},_onVisibleChanged:function(a){this._emitEvent("layerInfosIsVisibleChanged",a);this._emitEventForEveryLayerInfo("isVisibleChanged",a)},_onFilterChanged:function(a){this._emitEvent("layerInfosFilterChanged",
a);this._emitEventForEveryLayerInfo("filterChanged",a)},_onLayerReorder:function(a,b,c){a=this._reorderLayerInfosArray(a,b,c);this._emitEvent("layerInfosReorder",a,h.REORDERED,a)},_onRendererChanged:function(a){this._emitEvent("layerInfosRendererChanged",a);this._emitEventForEveryLayerInfo("rendererChanged",a)},_onOpacityChanged:function(a){this._emitEvent("layerInfosOpacityChanged",a);this._emitEventForEveryLayerInfo("opacityChanged",a)}});h.getLayerInfoArrayByType=function(a,b){var c=new m,p=[],
e=[];h.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;p.push(b)});d(p).then(function(a){f.forEach(a,function(a,c){b===a&&e.push(p[c].layerInfo)});c.resolve(e)})});return c};var p={map:null,layerInfos:null};h.getInstance=function(a,b){var c=new m;c.resolve(h.getInstanceSyncForInit(a,b));return c};h.getInstanceSyncForInit=function(a,b){p.map&&p.map!==a&&(p={map:null,layerInfos:null});p.layerInfos||(c.getInstance(a,p),p.layerInfos=new h(a,b.itemData),
p.map=a);return p.layerInfos};h.getInstanceSync=function(){return p.layerInfos};h.setInstance=function(a,b){p.map=a;p.layerInfos=b};k.mixin(h,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return h})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare dojo/topic jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r){var t=null,u=q(null,{constructor:function(){},create:function(t){var u=null;if(t.featureCollection)u=new k(t,this.map,this,this.layerInfosInstanceWrap);else if("esri.layers.KMLLayer"===t.layerObject.declaredClass)u=new e(t,this.map,this,this.layerInfosInstanceWrap);else if("esri.layers.GeoRSSLayer"===t.layerObject.declaredClass)u=new n(t,this.map,this,this.layerInfosInstanceWrap);else if("esri.layers.WMSLayer"!==t.layerObject.declaredClass||t.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
t.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===t.layerObject.declaredClass)u=new m(t,this.map,this,this.layerInfosInstanceWrap);else if("esri.layers.ArcGISImageServiceLayer"===t.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===t.layerObject.declaredClass)u=new b(t,this.map,this,this.layerInfosInstanceWrap);else if("esri.layers.StreamLayer"===t.layerObject.declaredClass)u=new g(t,this.map,this,this.layerInfosInstanceWrap);else switch("Table"===t.layerObject.type&&
(t.selfType="table"),t.selfType){case "mapservice_dynamic_group":case "mapservice_dynamic":u=new c(t,this.map,this,this.layerInfosInstanceWrap);break;case "mapservice_tiled_group":case "mapservice_tiled":u=new h(t,this.map,this,this.layerInfosInstanceWrap);break;case "wms":u=new p(t,this.map,this,this.layerInfosInstanceWrap);break;case "kml":u=new r(t,this.map,this,this.layerInfosInstanceWrap);break;case "table":u=new a(t,this.map,this,this.layerInfosInstanceWrap);break;default:u=new l(t,this.map,
this,this.layerInfosInstanceWrap)}else u=new d(t,this.map,this,this.layerInfosInstanceWrap);f.publish("layerInfos/layerInfoFactory/create",u);return u}});u.getInstance=function(a,b){null===t&&(t=new u);a&&(t.map=a);b&&(t.layerInfosInstanceWrap=b);return t};return u})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils ./LayerInfo esri/lang".split(" "),function(q,f,k,m,e,n){return q(e,{constructor:function(){this.layerObject=
{declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var e=[],d;f.forEach(this.originOperLayer.featureCollection.layers,function(c){e=e.concat(c.layerObject.graphics)});0===e.length?d=null:(d=1===e.length?e[0].getLayer().fullExtent:m.graphicsExtent(e),d=this._convertGeometryToMapSpatialRef(d));return d},_resetLayerObjectVisiblity:function(e){var d=e?e[this.id]:null;if(d){var c={},h;for(h in e)e.hasOwnProperty(h)&&"function"!==typeof e[h]&&(c[h]=e[h].visible);
this._setSubLayerVisibleByCheckedInfo(c);this._setTopLayerVisible(d.visible)}},_setSubLayerVisibleByCheckedInfo:function(e){f.forEach(this.newSubLayers,function(d){n.isDefined(e[d.id])&&d.layerObject.setVisibility(e[d.id])},this)},_initVisible:function(){var e=!1,d;for(d=0;d<this.newSubLayers.length;d++)e=e||this.newSubLayers[d].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},
this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var e=[];f.forEach(this.originOperLayer.featureCollection.layers,function(d){this._getLayerIndexesInMapByLayerId(d.layerObject.id)&&(k.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,d.layerObject),d=this._layerInfoFactory.create({layerObject:d.layerObject,title:d.layerObject.label||d.layerObject.title||d.layerObject.name||d.layerObject.id||" ",id:d.id||"-",subId:d.id||"-",collection:{layerInfo:this},
selfType:"collection",showLegend:this.originOperLayer.featureCollection.showLegend,parentLayerInfo:this}),e.push(d),d.init())},this);e.reverse();return e},_obtainLayerIndexesInMap:function(){var e=[],d,c;for(c=0;c<this.newSubLayers.length;c++)(d=this._getLayerIndexesInMapByLayerId(this.newSubLayers[c].layerObject.id))&&e.push(d);return e},moveLeftOfIndex:function(e){var d;for(d=this.newSubLayers.length-1;0<=d;d--)this.map.reorderLayer(this.newSubLayers[d].layerObject,e)},moveRightOfIndex:function(e){var d;
for(d=0;d<this.newSubLayers.length;d++)this.map.reorderLayer(this.newSubLayers[d].layerObject,e)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var e=this.getSubLayers();return e[0]?e[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented jimu/portalUrlUtils jimu/portalUtils ./RequestBuffer esri/request esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u){var v=q([c],{originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(a,b,c,d){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=
this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=c;this._layerInfosInstanceWrap=d;this._flag={};this._objectId=Math.random()},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=
this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new a(k.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getObjectId:function(){return this._objectId},getExtent:function(){},
getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){f.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},
findLayerInfoById:function(a){var b=null,c=0;if(this.id&&this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},_setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer()&&b&&this._resetLayerObjectVisiblity(a)},
_initVisible:function(){},isVisible:function(){return this._visible?!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===
a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(a){var b=new m;if(this.map.spatialReference.equals(a.spatialReference))return b.resolve([a]),b;if(this.map.spatialReference.isWebMercator()&&a.spatialReference.equals(new t(4326)))return b.resolve([u.geographicToWebMercator(a)]),b;if(this.map.spatialReference.equals(new t(4326))&&a.spatialReference.isWebMercator())return b.resolve([u.webMercatorToGeographic(a)]),b;b=new r;b.geometries=[a];b.outSR=this.map.spatialReference;
return g.defaults.geometryService.project(b)},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});l.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){l.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var a={};this.isRootLayer()&&
this.traversal(function(b){b.isRootLayer()||(a[b.subId]=b)});this._subLayerInfoIndex=a},_getLayerInfosObj:function(){return this._layerInfosInstanceWrap.layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return n.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==
this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},_needToRenew:function(){return!1},_getServiceDefinition:function(){var a=new m;a.resolve(null);return a},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(a,c,d){return b({url:a,content:c,handleAs:d,callbackParamName:"callback"})},getLayerObject:function(){var a=new m;this.layerObject?a.resolve(this.layerObject):
a.resolve(null);return a},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var a=0,b=this;b.parentLayerInfo;)a++,b=b.parentLayerInfo;return a},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=!0,b=
this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new m;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var a=this.getInfoTemplate(),b=null;a&&(b=a.info);return b},loadPopupInfo:function(){var a=new m;this.loadInfoTemplate().then(k.hitch(this,function(b){var c=null;b&&(c=b.info);a.resolve(c)}));
return a},loadInfoTemplate:function(){var a=new m;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},
getSupportTableInfo:function(){var a=new m,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),d=this.getLayerObject();e({type:c,layerObject:d}).then(k.hitch(this,function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);if(!c)b.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=!1;else if(!c.url||c.capabilities&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=
!0;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(a){a=new m;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];f.forEach(this.newSubLayers,function(c){c.id!==a?b.push(c):c.destroy()});this.newSubLayers=b},releaseResource:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.inherited(arguments)},
update:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,
maxScale:0}},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>b)&&(0===a.maxScale||b>a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},
_getBasicItemInfo:function(){var a=null,b=this.getRootLayerInfo(),c=window.appConfig||window.getAppConfig(),d=k.getObject("_wabProperties.itemLayerInfo",!1,b.layerObject);b.originOperLayer.itemId?(a={},a.itemId=b.originOperLayer.itemId,a.portalUrl=h.getStandardPortalUrl(c.map.portalUrl||c.portalUrl)):d&&d.portalUrl&&d.itemId&&(a={},a.itemId=d.itemId,a.portalUrl=h.getStandardPortalUrl(d.portalUrl));return a},getItemInfo:function(){var a=new m,b=this.getRootLayerInfo();b.isItemLayer()?(b._itemInfo||
(b._itemInfo=new v.ItemInfo(this,b)),b._itemInfo.onLoad().then(k.hitch(this,function(){a.resolve(b._itemInfo)}),k.hitch(this,function(){a.resolve(null)}))):a.resolve(null);return a},isHostedLayer:function(){var a=new m;this._getServiceDefinition().then(k.hitch(this,function(b){a.resolve(b&&b.serviceItemId?!0:!1)}));return a},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},
showLabels:function(){},hideLabels:function(){},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(z){console.error(z)}},_bindEvent:function(){var a;this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",k.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(a),a=d.after(this.layerObject,"setDefinitionExpression",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),
a=d.after(this.layerObject,"setRenderer",k.hitch(this,this._onRendererChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.layerObject.on("opacity-change",k.hitch(this,this._onOpacityChanged)),this._eventHandles.push(a)))},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),b=b?b:null;a!==b&&(l.publish("layerInfos/layerInfo/filterChanged",
[this]),this._oldFilter=b)},_onRendererChanged:function(){l.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){l.publish("layerInfos/layerInfo/opacityChanged",[this])}});v.ItemInfo=q(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,constructor:function(a,b){this._currentLayerInfo=a;this._rootLayerInfo=b;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=
new m;var a=this._rootLayerInfo.isItemLayer();if(a){this._portalUrl=a.portalUrl;this._itemId=a.itemId;var a=window.appConfig||window.getAppConfig(),a=h.getStandardPortalUrl(a&&a.map.portalUrl||window.portalUrl),b=p.getPortal(a),a=b.getItemById(this._itemId),b=b.getItemData(this._itemId),c=this._currentLayerInfo._getServiceDefinition();e({item:a,itemData:b,serviceDefinition:c}).then(k.hitch(this,function(a){this._item=a.item;this._itemData=a.itemData;this._serviceDefinition=a.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),
k.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&this._serviceDefinition.serviceItemId?!0:!1}});return v})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){var r=q([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(b){this.portalUrl=a.getStandardPortalUrl(b);this.selfUrl=a.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var a=this.selfUrl;this.isValidCredential()&&(a=-1<a.indexOf("?")?a+("\x26token\x3d"+this.credential.token):a+("?token\x3d"+this.credential.token));return g.getInstance().getServiceDefinition(a).then(f.hitch(this,function(a){var b=
a.user;delete a.user;f.mixin(this,a);a.user=b;return a}))},_checkCredential:function(){var a=b.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=b.getPortalCredential(this.portalUrl))},signIn:function(){var a=new e;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){a.resolve(this.credential)}),
0):a=b.signInPortal(this.portalUrl);return a},haveSignIn:function(){return b.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new e;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=
b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)})):b.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(f.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(b){this.updateCredential();
var d=new e,g=a.getBaseSearchUrl(this.portalUrl),h={f:"json"};b&&(h=f.mixin(h,b));this.isValidCredential()&&(h.token=this.credential.token);h.sortField||h.sortOrder||(h.sortField="title",h.sortOrder="asc");c({url:g,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=k.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));
return d},getItemData:function(b){this.updateCredential();b={url:a.getItemDataUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return c(b)},_getItemById:function(b,d){var g={url:a.getItemUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};d&&(g.content.token=d);return c(g).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}))},getItemById:function(a,b){this.updateCredential();
return this._getItemById(a).then(f.hitch(this,function(c){return b&&c.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===c.owner?this._getItemById(a,this.credential.token):c}))},getAppById:function(b){var d=new e;this.updateCredential();this.isValidCredential()?(b=a.getAppIdUrl(this.portalUrl,b),d=c({url:b,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},queryGroups:function(b){this.updateCredential();
var d=new e,g=a.getBaseGroupUrl(this.portalUrl),h={f:"json"};b&&(h=f.mixin(h,b));this.isValidCredential()&&(h.token=this.credential.token);c({url:g,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=k.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},registerApp:function(b,d,g){var h=new e;this.updateCredential();
if(this.isValidCredential())var p=this.credential&&this.credential.token,r=a.getOAuth2Url(this.portalUrl),h=c({url:r+"/registerApp",content:{itemId:b,appType:d,redirect_uris:l.stringify(g),token:p,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},createAndRegisterApp:function(a){var b=new e;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",
type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(b){this.updateCredential();
var d=new e;b={url:a.getUserUrl(this.portalUrl,b),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential&&this.credential.token);c(b).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new t(a);d.resolve(this.user)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d}}),t=q([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&
f.mixin(this,a)},_checkCredential:function(){var a=b.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new h({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateItem()},
getGroups:function(){var a=[];this.groups&&(a=k.map(this.groups,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new u(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var b={url:a.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};
this.isValidCredential&&(b.content.token=this.credential.token);return c(b)},getTags:function(){this.updateCredential();var b={url:a.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return c(b)},addItem:function(b,d){this.updateCredential();var g=new e;if(this.isValidCredential()){var h={f:"json",token:this.credential.token};b&&(h=f.mixin(h,b));c({url:a.getAddItemUrl(this.portalUrl,
this.username,d),handleAs:"json",callbackParamName:"callback",content:h},{usePost:!0}).then(f.hitch(this,function(a){g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}))}else setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},deleteItem:function(b){this.updateCredential();var d=new e;this.isValidCredential()?(b=a.getDeleteItemUrl(this.portalUrl,this.username,b),d=c({url:b,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,
function(){d.reject("token is null.")}),0);return d},getItemById:function(b,d){this.updateCredential();var g=new e,h={url:a.getUserItemsUrl(this.portalUrl,this.username,d)+"/"+b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};c(h).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new v(a);g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItem:function(b,d,g){this.updateCredential();var h=new e;
this.isValidCredential()?(d={url:a.shareItemUrl(this.portalUrl,this.username,d,g),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},b&&(d.content=f.mixin(d.content,b)),c(d,{usePost:!0}).then(f.hitch(this,function(a){h.resolve(a)}),f.hitch(this,function(a){console.error(a);h.reject(a)}))):setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},updateItem:function(b,d){this.updateCredential();var g=new e;this.isValidCredential()?this.portal.getItemById(b).then(f.hitch(this,
function(h){var e={f:"json",token:this.credential.token};d&&(e=f.mixin(e,d));c({url:a.getUpdateItemUrl(this.portalUrl,h.owner,b,h.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:e},{usePost:!0}).then(f.hitch(this,function(a){g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}))}),f.hitch(this,function(a){console.error(a);g.reject(a)})):setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(b,d){var g=new e;this.updateCredential();g=a.getUserItemsUrl(this.portalUrl,this.username,d);return g=c({url:g+"/"+b+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(b,
c){var g=new e;this.updateCredential();g=a.getUserItemsUrl(this.portalUrl,this.username,c);return g=d(g+"/"+b+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),u=q([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=b.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=q([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&f.mixin(this,b);this.itemUrl=a.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=a.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=a.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=b.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var b={url:a.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return c(b)}}),z={portals:[],webMapQueryStr:" "+
p.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+p.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(b){for(var c=0;c<this.portals.length;c++){var d=this.portals[c];if(a.isSamePortalUrl(b,d.portalUrl))return d.updateCredential(),d}return null},getPortal:function(c){if(!c||"string"!==typeof c||!f.trim(c))return null;c=a.getStandardPortalUrl(c);var d=this._findPortal(c);d||(d=new r(c),d.credential=b.getPortalCredential(d.portalUrl),d.updateCredential(),this.portals.push(d));
return d},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",c="",d=new e;this.getPortal(a).getUser().then(f.hitch(this,function(a){a&&a.units?b=a.units:(c=m.locale,b=c.startWith("en")?"english":"metric");d.resolve(b)}),f.hitch(this,function(g){console.warn(g);
this.getPortalSelfInfo(a).then(f.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(c=a&&a.culture||m.locale,b=c.startWith("en")?"english":"metric");d.resolve(b)}),f.hitch(this,function(a){console.warn(a);c=m.locale;b=c.startWith("en")?"english":"metric";d.resolve(b)}))}));return d.promise},_getPortalSelfGroup:function(a,b){var c=new e,d=this.getPortal(a);d||setTimeout(f.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){d.queryGroups({f:"json",q:a[b]}).then(f.hitch(this,
function(a){0<a.results.length?(a=a.results[0],a.portalUrl=d.portalUrl,a.credential=d.credential,a.portal=d,a=new u(a),c.resolve(a)):c.reject("Can't find portal self group.")}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new e;this.getBasemapGalleryGroup(a).then(f.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,
function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(b){var c=a.getStandardPortalUrl(b);return this._searchWABDefaultWebScene(c).then(f.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(c).then(f.hitch(this,function(a){return this.getPortal(c).getUser().then(f.hitch(this,function(b){var c=!1;b&&b.privileges&&0<b.privileges.length&&(c=k.some(b.privileges,
function(a){return 0<=a.indexOf("shareToPublic")}));return c?b.shareItem({everyone:!0},a).then(f.hitch(this,function(){return a}),f.hitch(this,function(){return a})):a}),f.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(b){var c=new e;b=a.getStandardPortalUrl(b);this.getPortal(b).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(f.hitch(this,function(a){a&&a.results&&0<a.results.length?c.resolve(a.results[0].id):
c.resolve(null)}),f.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);c.reject(a)}));return c},_createWABDefaultWebScene:function(b){var c=new e;b=a.getStandardPortalUrl(b);this.getPortal(b).getUser().then(f.hitch(this,function(a){var b={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:l.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,
latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},heading:0,tilt:.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};a.addItem(b,"").then(f.hitch(this,function(a){a.success?c.resolve(a.id):(console.error("Can't create default web scene:",a),c.reject())}))}),f.hitch(this,function(a){console.error("Can't create default web scene");
c.reject(a)}));return c},getDefaultWebMap:function(a){var b=new e;this.getPortalSelfInfo(a).then(f.hitch(this,function(c){var d=c.defaultBasemap&&c.defaultBasemap.id;d?b.resolve(d):this._getDefaultWebMapByBasemapGallery(a,c).then(f.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(f.hitch(this,function(a){a?b.resolve(a):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new e,d=this.getPortal(a),g=b.defaultBasemap&&b.defaultBasemap.title;d.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(f.hitch(this,function(a){a=a.results;0<a.length?d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+g}).then(f.hitch(this,function(a){a=a.results;a=k.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):
(console.log("Can't find web map under basemapGalleryGroupQuery."),d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+g}).then(f.hitch(this,function(a){a=a.results;a=k.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];d.getItemData(b.id).then(f.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),f.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),
c.resolve(null)}),f.hitch(this,function(a){console.error(a);c.reject(a)})))}),f.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new e;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,
function(a){a=a.results;a=k.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},comparePortalVersion:function(a,b){var c=a.split("."),d=parseInt(c[0],10),c=1<c.length?parseInt(c[1],10):0,g=b.split("."),h=parseInt(g[0],10),g=1<g.length?parseInt(g[1],10):0;return d>h?1:d<h?-1:c>g?1:c<g?-1:0},getItemResources:function(b,d,g){g||
(g=100);b=a.getStandardPortalUrl(b);b=a.getItemResourceUrl(b,d);return c({url:b,content:{f:"json",num:g}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(b,d,g,h,e){b=a.getStandardPortalUrl(b);var p=this.getPortal(b),r=new FormData;r.append("file",g,h);r.append("fileName",h);r.append("f","json");var t="";e?(r.append("resourcesPrefix",e),t=e+"/"+h):t=h;return p.getItemById(d,!0).then(function(g){g=a.getUserContentItemUrl(b,g.owner,d);return c({url:g+"/addResources",form:r}).then(function(c){var d=
"";c&&c.success&&(d=a.getItemResourceUrl(b,"${itemId}",t));return d},function(a){console.error(a.message||a);return a})})},removeResources:function(b,d,g,h){var e={resource:h?h+"/"+g:g,f:"json"};b=a.getStandardPortalUrl(b);return this.getPortal(b).getItemById(d,!0).then(function(g){g=a.getUserContentItemUrl(b,g.owner,d);return c({url:g+"/removeResources",content:e},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}};n.subscribe("userSignOut",function(a){(a=
z._findPortal(a))&&a.clearCredentialAndUser()});return z})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(q,f,k,m,e){return q(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(e){e=e||{};this.id=e.id;this.baseRole=e.role;this.name=e.name;this.description=e.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,
viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},
opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(n){e.isDefined(n)&&n instanceof Array&&k.forEach(n,f.hitch(this,function(e){this._readPrivilege(e)}))},_readPrivilege:function(e){this._applyEffectToAction(!0,e)},_applyEffectToAction:function(e,l){switch(l){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=
e;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=e;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=e;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=e;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=e;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=e;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=
e;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=e;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=e;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=e;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=e;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=e;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=
e;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=e;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=e;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=e;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=e;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=e;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=
e;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=e;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=e;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=e;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=e;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=e;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=
e;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=e;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=e;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=e;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=e;break;case "features:user:edit":this.privilegeObj.features.user.edit=e;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=e;break;
case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=e;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=e;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=e;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=e;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=e;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=
e;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=e;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=e;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=e;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=e;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=e}},_applyToAll:function(e){this.privilegeObj.portal.admin.inviteUsers=e;this.privilegeObj.portal.admin.disableUsers=
e;this.privilegeObj.portal.admin.viewUsers=e;this.privilegeObj.portal.admin.updateUsers=e;this.privilegeObj.portal.admin.deleteUsers=e;this.privilegeObj.portal.admin.changeUserRoles=e;this.privilegeObj.portal.admin.viewGroups=e;this.privilegeObj.portal.admin.updateGroups=e;this.privilegeObj.portal.admin.deleteGroups=e;this.privilegeObj.portal.admin.reassignGroups=e;this.privilegeObj.portal.admin.assignToGroups=e;this.privilegeObj.portal.admin.manageEnterpriseGroups=e;this.privilegeObj.portal.admin.viewItems=
e;this.privilegeObj.portal.admin.updateItems=e;this.privilegeObj.portal.admin.deleteItems=e;this.privilegeObj.portal.admin.reassignItems=e;this.privilegeObj.portal.admin.manageLicenses=e;this.privilegeObj.portal.publisher.publishFeatures=e;this.privilegeObj.portal.publisher.publishTiles=e;this.privilegeObj.portal.publisher.publishScenes=e;this.privilegeObj.portal.user.createGroup=e;this.privilegeObj.portal.user.joinGroup=e;this.privilegeObj.portal.user.joinNonOrgGroup=e;this.privilegeObj.portal.user.createItem=
e;this.privilegeObj.portal.user.shareToGroup=e;this.privilegeObj.portal.user.shareToOrg=e;this.privilegeObj.portal.user.shareToPublic=e;this.privilegeObj.portal.user.shareGroupToOrg=e;this.privilegeObj.portal.user.shareGroupToPublic=e;this.privilegeObj.features.user.edit=e;this.privilegeObj.opendata.user.openDataAdmin=e;this.privilegeObj.opendata.user.designateGroup=e;this.privilegeObj.premium.user.geocode=e;this.privilegeObj.premium.user.networkanalysis=e;this.privilegeObj.premium.user.spatialanalysis=
e;this.privilegeObj.premium.user.geoenrichment=e;this.privilegeObj.premium.user.demographics=e;this.privilegeObj.premium.user.elevation=e;this.privilegeObj.marketplace.admin.purchase=e;this.privilegeObj.marketplace.admin.manage=e;this.privilegeObj.marketplace.admin.startTrial=e},_buildPrivilegesArray:function(){var e=[];!0===this.privilegeObj.portal.admin.inviteUsers&&e.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&e.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&
e.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&e.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&e.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&e.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&e.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&e.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&
e.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&e.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&e.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&e.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&e.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&e.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&
e.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&e.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&e.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&e.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&e.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&e.push("portal:publisher:publishScenes");
!0===this.privilegeObj.portal.user.createGroup&&e.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&e.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&e.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&e.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&e.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&e.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&
e.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&e.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&e.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&e.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&e.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&e.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&
e.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&e.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&e.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&e.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&e.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&e.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&
e.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&e.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&e.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&e.push("marketplace:admin:startTrial");return e},isUser:function(){return e.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return e.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===
this.id)},isAdmin:function(){return e.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||e.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||e.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||e.isDefined(this.baseRole)&&("org_admin"===this.baseRole||
"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&e.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},
canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},
canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},
canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},
canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},
canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},
canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(f){this.privileges=f;this._initPrivilegesObject();e.isDefined(f)&&this._readPrivileges(f)},stringify:function(){return m.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return m.stringify({id:this.id,
name:this.name,description:this.description})},stringifyPrivileges:function(){return m.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return m.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(q,f){var k=null,m=q(null,{cache:{},getServiceDefinition:function(e,n){n||(n="json");var l=this.cache[e];
0>=this._getDefStatus(l)&&(l=f({url:e,handleAs:n,content:{f:n},callbackParamName:"callback"}),this.cache[e]=l);return l},_getDefStatus:function(e){return e?e.isFulfilled()?e.isResolved()?2:-1:1:0}});m.getInstance=function(){k||(k=new m,window._serviceDefinitionManager=k);return k};return m})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(q,f,k){var m=q(null,{_realRequest:null,_buffer:null,constructor:function(e){this._buffer={};
this._realRequest=e?e:function(){return new k}},getRequest:function(e){this._buffer[e]||(this._buffer[e]=new m.RequestProxy(this._realRequest,e));return this._buffer[e]},request:function(e){var f=Array.prototype.slice.apply(arguments);f.splice(0,1);var l=this.getRequest(e);return l.request.apply(l,f)},setResponse:function(e,f){this.getRequest(e).setResponse(f)},isResolved:function(e){return this.getRequest(e).isResolved()}});m.RequestProxy=q(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(e,
f){this._realRequest=e;this._key=f},request:function(){this._deferred||(this._deferred=new k,this._realRequest.apply(null,arguments).then(f.hitch(this,function(e){this._deferred.resolve(e)}),f.hitch(this,function(e){e&&console.warn(e.message||e);e=this._deferred;this._deferred=null;e.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new k);return this._deferred},setResponse:function(e){this._deferred||(this._deferred=new k);null===e||void 0===e?(this._deferred.resolve(null),
this._deferred=null):this._deferred.resolve(e)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return m})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang".split(" "),function(q,f,k,m,e,n,l,d,c,h){return q(d,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,
constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._needToRefresh().then(k.hitch(this,function(c){c&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_needToRefresh:function(){var c=new m;this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(k.hitch(this,function(a){(a=
a.getItemData().thematicGroup)?(this.originOperLayer.thematicGroup=a,c.resolve(!0)):c.resolve(!1)})):c.resolve(!1);return c},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var c=f.filter(this.originOperLayer.layers,function(a){return h.isDefined(a.id)&&h.isDefined(a.name)&&h.isDefined(a.minScale)&&h.isDefined(a.maxScale)&&h.isDefined(a.parentLayerId)&&h.isDefined(a.defaultVisibility)});
this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?f.filter(this.layerObject.dynamicLayerInfos,function(a){return-1<this.originOperLayer.thematicGroup.layerIds.indexOf(a.id)?!0:!1},this):this.layerObject.dynamicLayerInfos:0<c.length?c:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:k.clone(this.layerObject.infoTemplates)};
this.layerObject._infoTemplates=k.clone(this.layerObject.infoTemplates);n.after(this.layerObject,"setInfoTemplates",k.hitch(this,function(){this.layerObject._infoTemplates=k.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=k.clone(this.layerObject.infoTemplates);this.traversal(function(c){c._afterSetInfoTemplates&&c._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new m}},_initSubLayerVisible:function(c){this._subLayerVisible=
{};for(var a=0;a<this._jsapiLayerInfos.length;a++)this._subLayerVisible[this._jsapiLayerInfos[a].id]=!1;c?f.forEach(c,function(a){this._subLayerVisible[a]=!0},this):this.originOperLayer.visibleLayers?f.forEach(this.originOperLayer.visibleLayers,function(a){this._subLayerVisible[a]=!0},this):f.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&(this._subLayerVisible[a.id]=!0)},this)},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(c){this.originOperLayer.layerObject.setVisibility(c);
this._visible=c},_setSubLayerVisible:function(c){var a=[-1,-1,-1],b,d=[],h=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(h,function(a){if(!this._isGroupLayerBySubId(a)){var b=this._subLayerInfoIndex[a];b&&b._isAllSubLayerVisibleOnPath()&&d.push(a)}},this);var h=d,e;for(e in c)if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var p=Number(e);c[e]?(b=f.indexOf(h,p),0>b&&h.push(p)):(b=f.indexOf(h,p),0<=b&&h.splice(b,1))}a=a.concat(h);this.originOperLayer.layerObject.setVisibleLayers(a)},
_resetLayerObjectVisiblity:function(c){var a=c?c[this.id]:null,b=!1;if(c&&(a&&this.layerObject.setVisibility(a.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var a={},d;for(d in c)c.hasOwnProperty(d)&&"function"!==typeof c[d]&&(b=!0,a[d]=c[d].visible);b&&this._setSubLayerVisibleByCheckedInfo(a)}},_setSubLayerVisibleByCheckedInfo:function(c){var a=[];f.forEach(this._jsapiLayerInfos,function(b){var d=this.id+"_"+b.id;h.isDefined(c[d])?c[d]&&a.push(b.id):this._subLayerVisible[b.id]&&
a.push(b.id)},this);this._initSubLayerVisible(a);this.traversal(function(a){a._initVisible()});var b={};this.traversal(function(a){0===a.getSubLayers().length&&(b[a.originOperLayer.mapService.subId]=a._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(b)},_subLayerVisibleChanged:function(){var c=[];this.traversal(function(a){c.push(a)});l.publish("layerInfos/layerInfo/visibleChanged",c)},obtainNewSubLayers:function(){var c=[],a=this.originOperLayer.layerObject,b=null,b="esri.layers.ArcGISDynamicMapServiceLayer"===
a.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(d){var g=null,g=a.url+"/"+d.id,h=a.id+"_"+d.id;d.subLayerIds&&0<d.subLayerIds.length?(g={url:g,empty:!0},this._addNewSubLayer(c,g,h,d,b+"_group")):(g={url:g,empty:!0},this._addNewSubLayer(c,g,h,d,b))},this);var d=[];f.forEach(this._jsapiLayerInfos,function(a,b){var d=a.parentLayerId;if(-1!==d){for(var g=null,h=0;h<c.length;h++)if(c[h].mapService.subId===d){g=c[h];break}(d=g)&&d.subLayers.push(c[b])}},this);f.forEach(this._jsapiLayerInfos,
function(a,b){var g;-1===a.parentLayerId&&(g=this._layerInfoFactory.create(c[b]),d.push(g),g.init())},this);return d},_addNewSubLayer:function(c,a,b,d,h){var g=d.source&&d.source.mapLayerId;if(void 0===g||null===g)g=d.id;c.push({layerObject:a,title:d.name||d.id||" ",id:b||"-",subId:d.id,subLayers:[],mapService:{layerInfo:this,subId:d.id,mapServiceSubId:g},selfType:"mapservice_"+h,parentLayerInfo:this})},_handleErrorSubLayer:function(c,a,b,d,h,e){c[a]={layerObject:null,title:e.name||e.id||" ",id:b||
" ",subLayers:[],mapService:{layerInfo:this,subId:d}}},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(c){this.layerObject.setOpacity&&this.layerObject.setOpacity(c)},getLegendInfo:function(c){var a=new m;this._legendInfo?a.resolve(this._legendInfo):this._legendRequest(c).then(k.hitch(this,
function(b){this._legendInfo=b.layers;a.resolve(this._legendInfo)}),function(){a.reject()});return a},_legendRequest:function(c){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(c)},_legendRequestServer:function(){var d=this.layerObject.url+"/legend",a={f:"json"};this.layerObject._params.dynamicLayers&&(a.dynamicLayers=e.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===a.dynamicLayers&&(a.dynamicLayers="[]"));return c({url:d,content:a,handleAs:"json",
callbackParamName:"callback"})},_legendRequestTools:function(d){return c({url:d+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(c){var a=[],b;f.forEach(c.dynamicLayerInfos||c.layerInfos,function(d){b={id:d.id};b.source=d.source&&d.source.toJson();var g;c.layerDefinitions&&c.layerDefinitions[d.id]&&(g=c.layerDefinitions[d.id]);g&&(b.definitionExpression=g);var h;c.layerDrawingOptions&&c.layerDrawingOptions[d.id]&&
(h=c.layerDrawingOptions[d.id]);h&&(b.drawingInfo=h.toJson());b.minScale=d.minScale||0;b.maxScale=d.maxScale||0;a.push(b)});return a},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_getSubserviceDefinition:function(c){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(c):this._getLayerAndTable(c)},_getAllLayerAndTable:function(c){var a=this.layerObject.url+"/layers",b=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");
b.isResolved()||b.request(a).then(k.hitch(this,function(a){null===a?this.traversal(k.hitch(this,function(a){a.isRootLayer()||this._serviceDefinitionBuffer.getRequest(a.mapServiceSubId).setResponse(null)})):f.forEach(a.layers,function(a){this._serviceDefinitionBuffer.getRequest(a.id).setResponse(a)},this)}));return this._serviceDefinitionBuffer.getRequest(c).fakeRequest()},_getLayerAndTable:function(c){var a=this.layerObject.url+"/"+c;return this._serviceDefinitionBuffer.getRequest(c).request(a)},
_getSublayerSettingOfWebmap:function(c){var a=f.filter(this.originOperLayer.layers,function(a){return a.id===c});return 1===a.length?a[0]:null},_getSublayerShowLegendOfWebmap:function(c){return(c=this._getSublayerSettingOfWebmap(c))?void 0!==c.showLegend?c.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(c){return null===this._getJsapiLayerInfoById(c)?!1:!0},_getJsapiLayerInfoById:function(c){for(var a=null,b=0;b<this._jsapiLayerInfos.length;b++)if(this._jsapiLayerInfos[b].id===c){a=this._jsapiLayerInfos[b];
break}return a},_isGroupLayerBySubId:function(c){return(c=this._getJsapiLayerInfoById(c))&&c.subLayerIds&&0<c.subLayerIds.length?!0:!1},_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=this.layerObject.on("visible-layers-change",k.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(c),c=n.after(this.layerObject,"setLayerDefinitions",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(c))},_onVisibleLayersChanged:function(c){var a=
c.visibleLayers;if(-1===a[0]&&-1===a[1]&&-1===a[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{c=[];var b=[-1,-1,-1],a=this._converVisibleLayers(a);c=a.visibleLayersForUpdateSubLayerVisible;b=b.concat(a.visibleLayersForSetVisibleLayers);this._initSubLayerVisible(c);this.traversal(function(a){a._initVisible()});this.layerObject.setVisibleLayers(b)}},_converVisibleLayers:function(c){var a={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(c,
function(a){var b=this.findLayerInfoById(this.id+"_"+a);if(this._isGroupLayerBySubId(a))b.traversal(function(a){c.push(a.originOperLayer.mapService.subId)});else for(;b&&b.originOperLayer.mapService;)c.push(b.originOperLayer.mapService.subId),b=b.parentLayerInfo},this);f.forEach(c,function(b){0<=b&&0>a.visibleLayersForUpdateSubLayerVisible.indexOf(b)&&a.visibleLayersForUpdateSubLayerVisible.push(b)},this);f.forEach(a.visibleLayersForUpdateSubLayerVisible,function(b){this._isGroupLayerBySubId(b)||
a.visibleLayersForSetVisibleLayers.push(b)},this);return a},_onFilterChanged:function(){for(var c,a=[],b=this.layerObject.layerDefinitions,d=b.length>this._oldFilter.length?b.length:this._oldFilter.length,h=0;h<d;h++)(b[h]?b[h]:null)!==(this._oldFilter[h]?this._oldFilter[h]:null)&&(c=this.findLayerInfoById(this.id+"_"+h))&&c.isLeaf()&&a.push(c);0<a.length&&(l.publish("layerInfos/layerInfo/filterChanged",a),this._oldFilter=b)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault dojo/Deferred esri/lang".split(" "),
function(q,f,k,m,e,n,l,d,c,h){return q(l,{constructor:function(){},getExtent:function(){var c=this.originOperLayer.layerObject.getLayers(),a=null,b;f.forEach(c,function(c){b=this._convertGeometryToMapSpatialRef(c.initialExtent);a=a?a.union(b):b},this);return a},_resetLayerObjectVisiblity:function(c){var a=c?c[this.id]:null;if(a){var b={},d;for(d in c)c.hasOwnProperty(d)&&"function"!==typeof c[d]&&(b[d]=c[d].visible);this._setSubLayerVisibleByCheckedInfo(b);this._setTopLayerVisible(a.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){this.traversal(k.hitch(this,
function(a){h.isDefined(c[a.id])&&a._setTopLayerVisible(c[a.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(c){c?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var c=[];f.forEach(this._getOperLayerByParentFolderId(-1,this),function(a){a=this._layerInfoFactory.create(a);c.push(a);a.init()},this);return c},_getOperLayerByParentFolderId:function(c,a){var b=[],d=this.layerObject.getLayers()||[],h=f.filter(this.layerObject.folders||
[],function(a){return a.parentFolderId===c?!0:!1}),e=[],e=0===h.length?f.filter(d,function(a){return this._flag.kmzSubLayersWereHandled?!1:!0},this):h;f.forEach(e,function(c){var d;"esri.layers.KMLFolder"===c.declaredClass?d={layerObject:c,title:c.label||c.title||c.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(c),subId:c.id,kml:{layerInfo:this,currentFolder:c},selfType:"kml",parentLayerInfo:a}:"esri.layers.KMLLayer"===c.declaredClass?(d=k.getObject("linkInfo.name",!1,c),d={layerObject:c,
title:c.label||c.title||d||c.name||c.id||" ",id:c.id||"-",subId:c.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",parentLayerInfo:a},k.setObject("_wabProperties.kmllayerWasHandled",!0,c),this._flag.kmzSubLayersWereHandled=!0):(k.setObject("_wabProperties.kmllayerWasHandled",!0,c),k.setObject("_wabProperties.isTemporaryLayer",!0,c));d&&b.push(d)},this);return b},_getAllSubLayerObject:function(){var c=[];this.traversal(k.hitch(this,function(a){a.layerObject&&a.layerObject.getLayers&&
(c=c.concat(a.layerObject.getLayers()))}));return c},_getSubLayerInfoIdForSubFolder:function(c){return this.id+"_folder_"+c.id},_needToRenew:function(){return f.some(this._getAllSubLayerObject(),function(c){if(!k.getObject("_wabProperties.kmllayerWasHandled",!1,c))return!0},this)},_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=e.after(this.layerObject,"setFolderVisibility",k.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(c))},
_onSubFolderVisibleChanged:function(c){c=this._getSubLayerInfoIdForSubFolder(c);(c=this.findLayerInfoById(c))&&n.publish("layerInfos/layerInfo/visibleChanged",[c])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v){return q(e,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(z){console.warn(z.message)}},_updateLayerObjectName:function(){this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!k.getObject("_wabProperties.originalLayerName",!1,this.layerObject)&&(k.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),this.layerObject.name=
this.title)},_initToShowLabels:function(){var b=k.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);b&&!this.layerObject.empty&&a.getPortal(b.portalUrl).getItemData(b.itemId).then(k.hitch(this,function(a){var b;a&&a.layers&&(f.some(a.layers,function(a){return a.id===this.layerObject.layerId?(b=a,!0):!1},this),b&&b.showLabels&&((a=k.getObject("layerDefinition.drawingInfo.labelingInfo",!1,b))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(a=f.map(a,function(a){return new t(a)},
this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),k.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var b=[],c=this.getInfoTemplate();c&&c.info&&c.info.fieldInfos?f.forEach(c.info.fieldInfos,function(a){a.visible&&b.push(a.fieldName)},
this):b=["*"];a.outFields=b;return a},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new m;a.resolve(null);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},_initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=
this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=
!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(a){for(var b={},c=this;c.parentLayerInfo;)b[c.id]=a,c=c.parentLayerInfo;return b},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var a=this.getRootLayerInfo();if(a._setSubLayerVisibleByCheckedInfo){var b=
this._prepareCheckedInfoForShowOrHide(!0);a._setSubLayerVisibleByCheckedInfo(b);a.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var a=h.after(this.layerObject,"setInfoTemplate",k.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||
(this.layerObject.infoTemplate=null)}));this._eventHandles.push(a)},_getServiceDefinition:function(){var a;(a=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?a=this._serviceDefinitionBuffer.getRequest(this.subId).request(a):(a=new m,a.resolve(null));return a},createLegendsNode:function(){var a=l.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);l.create("img",{"class":"legends-loading-img",
src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){l.empty(a);c.remove(a,"jimu-legends-div-flag");var b=new v({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:v.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},l.create("div",
{},a));b.startup();a._legendDijit=b}},_initLegendsNode:function(a){var b=[],c=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(l.empty(a),c.renderer&&(c.renderer.infos?b=k.clone(c.renderer.infos):b.push({label:c.renderer.label,symbol:c.renderer.symbol}),c.renderer&&c.renderer.defaultSymbol&&0<b.length&&b.push({label:c.renderer.defaultLabel||"others",symbol:c.renderer.defaultSymbol}),f.forEach(b,function(b){b.legendDiv=
l.create("div",{"class":"legend-div"},a);b.symbolDiv=l.create("div",{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=l.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},b.legendDiv);if("textsymbol"===b.symbol.type)d.set(b.symbolDiv,"innerHTML",b.symbol.text);else{var c=n.createSurface(b.symbolDiv,50,50);b=g.getShapeDescriptors(b.symbol);c.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(n.matrix.translate(25,25))}},this)))},
obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,function(b){b.parentLayerInfo=this;b=this._layerInfoFactory.create(b);a.push(b);b.init()},this);return a},_isAllSubLayerVisibleOnPath:function(){for(var a=!0,b=this;!b.isRootLayer();)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getCustomPopupInfo:function(a,
c){var d=null;a&&a.fields&&(d={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(a){var g=!1;c?f.some(c,k.hitch(this,function(b){return b&&a.name.toLowerCase()===b.toLowerCase()}))&&(g=!0):g=!0;g&&(g=b.getDefaultPortalFieldInfo(a),g.visible=!0,g.isEditable=a.editable,d.fieldInfos.push(g))},this));return d},_getDefaultPopupInfo:function(a){var b=this._getCustomPopupInfo(a);b&&(b.fieldInfos=f.filter(b.fieldInfos,k.hitch(this,function(b){return b.fieldName.toLowerCase()!==
a.objectIdField.toLowerCase()&&"globalid"!==b.fieldName.toLowerCase()&&"shape"!==b.fieldName.toLowerCase()?!0:!1})));return b},_getDefaultPopupTemplate:function(a){var b=null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(b=new u(a));return b},enablePopup:function(){return this.loadInfoTemplate().then(k.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=
!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},loadInfoTemplate:function(){var a=new m;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(k.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),k.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},
_getRelatedUrls:function(a,b){var c=[];if(!a||!a.url||!a.relationships)return c;var d=a.url.lastIndexOf("/"),g=a.url.slice(0,d);f.forEach(a.relationships,function(a){b&&a.role&&b!==a.role||c.push(g+"/"+a.relatedTableId.toString())},this);return c},getRelatedTableInfoArray:function(a){var b=[],c=new m;this.getLayerObject().then(k.hitch(this,function(d){var g=this._getRelatedUrls(d,a);0!==g.length&&this._getLayerInfosObj().traversalAll(k.hitch(this,function(a){var c=-1;if(0===g.length)return!0;f.forEach(g,
function(d,g){k.getObject("layerObject.url",!1,a)&&p.removeProtocol(d.toString().toLowerCase()).replace(/\/+/g,"/")===p.removeProtocol(a.layerObject.url.toString().toLowerCase()).replace(/\/+/g,"/")&&(b.push(a),c=g)},this);0<=c&&g.splice(c,1);return!1}));c.resolve(b)}),k.hitch(this,function(){c.resolve(b)}));return c},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&
!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&this.layerObject.setDefinitionExpression(a)},_isAlreadyInLabelLayerOfMap:function(a){var b=!1;a&&(b=f.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return b},_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},
_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){var a;this.map._labels?a=this.map._labels:(a=this.map.getLayer("labels"),a||(a=new r({id:"labels"}),this.map.addLayer(a)));return a},obtainLabelControl:function(){var a=this.id+"_labelLayer",b=this.map.getLayer(a);if(!b&&this._isSupportLabelControl()){var c=
this.getLabelLayerOfMap();c&&this._isAlreadyInLabelLayerOfMap(c)&&(b=new r({id:a}),b.addFeatureLayer(this.layerObject),this.map.addLayer(b),this._removeFromLabelLayerOfMap())}return b?b:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),
this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),b=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||b&&this._isAlreadyInLabelLayerOfMap(b))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},
hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../renderers/arcadeUtils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E){function D(a){return"sizeInfo"===a.type}q=f(B,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=k.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
k.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)l.disconnect(this._mapEventHandlers[a]);this.refresh();g.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var g=[];g.push(a.on("update-end",
k.hitch(this,"refresh")));g.push(a.on("suspend",k.hitch(this,"refresh")));g.push(a.on("resume",k.hitch(this,"refresh")));g.push(a.on("edits-complete",k.hitch(this,"refresh")));g.push(a.on("labeling-info-change",k.hitch(this,"refresh")));g.push(a.on("time-extent-change",k.hitch(this,"refresh")));g.push(a.on("show-labels-change",k.hitch(this,"refresh")));g.push(a.on("feature-reduction-change",k.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,
LabelRenderer:b,EventHandlers:g});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=n.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)l.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)l.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=g.setTimeout(this._refreshLabels,g.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,c,d,g,h,e=[],p,u="DYNAMIC"===this._engineType?new r:new t;if(this._map){u.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&c.visibleAtMapScale&&!c._suspended)if(b=
this._featureLayerInfos[a],h=this._convertOptions(null),b.LabelRenderer){if(e=c.labelingInfo)if(p=e[0])g=this._getLabelExpression(p),h=this._convertOptions(p);d=b.LabelRenderer;b.LabelExpressionInfo&&(g=b.LabelExpressionInfo);b.LabelingOptions&&(h=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(e=b.LabelingOptions.pointPriorities,h.pointPriorities="above-center"==e||"AboveCenter"==e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"AboveLeft"==
e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":"above-right"==e||"AboveRight"==e||"esriServerPointLabelPlacementAboveRight"==e?"AboveRight":"below-center"==e||"BelowCenter"==e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"BelowLeft"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"BelowRight"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"CenterCenter"==e||"esriServerPointLabelPlacementCenterCenter"==
e?"CenterCenter":"center-left"==e||"CenterLeft"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"CenterRight"==e||"esriServerPointLabelPlacementCenterRight"==e?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(h.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(h.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(h.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(h.howManyLabels=b.LabelingOptions.howManyLabels));d instanceof x&&(g=this._getLabelExpression(d),d=new F(d.symbol),h=this._convertOptions(d));this._addLabels(c,d,g,h)}else if(e=c.labelingInfo)for(b=e.length-1;0<=b;b--)if(p=e[b])d=new x(p instanceof x?p.toJson():p),g=this._getLabelExpression(p),h=this._convertOptions(p),this._addLabels(c,d,g,h);g=u._process(this._preparedLabels);this.clear();this.drawLabels(this._map,g)}},drawLabels:function(b,c){this._scale=
(b.extent.xmax-b.extent.xmin)/b.width;var d;for(d=0;d<c.length;d++){var g=c[d],h=g.x,e=g.y,r=g.text,t=g.angle,p=g.layer.labelSymbol;"polyline"==g.layer.geometry.type&&g.layer.options.labelRotation&&p.setAngle(180/Math.PI*t);p.setText(r);g=h;p instanceof v&&(h=p.getHeight(),g-=.25*h*this._scale*Math.sin(t),e-=.33*h*this._scale);t=new a(new y(g,e,b.extent.spatialReference));t.setSymbol(p);this.add(t)}},_addLabels:function(a,b,c,d){var g,h,e,r;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var t=this._map,p=!a.url&&!t.spatialReference.equals(a.spatialReference);for(g=0;g<a.graphics.length;g++)if(h=a.graphics[g],!1!==h.visible&&!h._suspended){e=h.geometry;if(p){if(!w.canProject(e,t))continue;e=w.project(e,t)}e&&this._isWhere(b.where,h.attributes)&&this._isWithinScreenArea(e)&&(r=this._buildLabelText(c,h,a.fields,d),this._addLabel(r,b,a.renderer,h,d,e,t))}}},_isWithinScreenArea:function(a){a="point"===a.type?new A(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),g=c[3],h=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(g){case "AND":return d&&h;case "OR":return d||h}}}return!1}catch(Q){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||n.filter(a.visualVariables,D)[0]:null},_addLabel:function(a,b,d,g,h,e,r){var t,p,u,l;if(a&&""!==k.trim(a)&&b){a=a.replace(/\s+/g," ");t=b.getSymbol(g);t instanceof v?(t=new v(t.toJson()),t.setVerticalAlignment("baseline"),t.setHorizontalAlignment("center")):t=t instanceof z?new z(t.toJson()):new v;t.setText(a);b.symbol=t;if(u=this._getProportionalSize(b.sizeInfo,g.attributes))t instanceof v?t.setSize(u):t instanceof
z&&(t.setWidth(u),t.setHeight(u));l=u=0;if(d){p=d.getSymbol(g);var f=this._getSizeInfo(d);if((d=f?d.getSize(g,{sizeInfo:f,resolution:r.getResolutionInMeters()}):g.size)&&null!==d)u=l=d;else if(p)if("simplemarkersymbol"==p.type)l=u=p.size;else if("picturemarkersymbol"==p.type)u=p.width,l=p.height;else if("simplelinesymbol"==p.type||"cartographiclinesymbol"==p.type)u=p.width}d={};d.graphic=g;d.options=h;d.geometry=e;d.labelRenderer=b;d.labelSymbol=t;d.labelWidth=t.getWidth()/2;d.labelHeight=t.getHeight()/
2;d.symbolWidth=c.normalizedLength(u)/2;d.symbolHeight=c.normalizedLength(l)/2;d.text=a;d.angle=t.angle;this._preparedLabels.push(d)}},_buildLabelText:function(a,c,d,g){if(g.hasExpression)return a=g.arcadeCache,c=c._getDataValue(a.attributeInfo,a,E),p.isDefined(c)?""+c:"";var h=c.attributes;return a.replace(/{[^}]*}/g,function(a){var c,r=a;for(c=0;c<d.length;c++)if("{"+d[c].name+"}"==a){var r=h[d[c].name],t=d[c].domain;if(t&&k.isObject(t)){if("codedValue"==t.type&&g.useCodedValues)for(c=r,a=0;a<t.codedValues.length;a++){if(t.codedValues[a].code==
c){r=t.codedValues[a].name;break}}else"range"==t.type&&t.minValue<=r&&r<=t.maxValue&&(r=t.name);break}t=d[c].type;if(g.fieldInfos){var u=g.fieldInfos;for(c=0;c<u.length;c++)if("{"+u[c].fieldName+"}"==a){a=u[c].format;"esriFieldTypeDate"==t?(a="DateFormat"+b.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(r=p.substitute({myKey:r},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=t&&"esriFieldTypeSingle"!=t&&"esriFieldTypeSmallInteger"!=t&&"esriFieldTypeLong"!=t&&"esriFieldTypeDouble"!=t||
!a||(r=m.format(r,{places:a.places}),a.digitSeparator||e.group&&(r=r.replace(new RegExp("\\"+e.group,"g"),"")));break}}break}else r="";return null==r?"":r})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[",
"g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,b){if(!a)return null;var c=p.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,g=null,h="",e=!0,t,r;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),
g=a.fieldInfos,h=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var p=a.expression;p&&!a.value&&(r=!0,t=u.createAttributeCache({valueExpression:p},!0))}if("always-horizontal"==h||"esriServerPolygonPlacementAlwaysHorizontal"==h)e=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:g,pointPriorities:"above-center"==h||"esriServerPointLabelPlacementAboveCenter"==h?"AboveCenter":"above-left"==h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":
"above-right"==h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"esriServerPointLabelPlacementCenterCenter"==h?"CenterCenter":"center-left"==h||"esriServerPointLabelPlacementCenterLeft"==h?"CenterLeft":"center-right"==h||"esriServerPointLabelPlacementCenterRight"==
h?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==h||"below-start"==h||"center-start"==h?"PlaceAtStart":"above-end"==h||"below-end"==h||"center-end"==h?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==h||"esriServerLinePlacementAboveAfter"==h||"above-along"==h||"esriServerLinePlacementAboveAlong"==h||"above-before"==h||"esriServerLinePlacementAboveBefore"==h||"above-start"==h||"esriServerLinePlacementAboveStart"==h||"above-end"==h||"esriServerLinePlacementAboveEnd"==h?"Above":
"below-after"==h||"esriServerLinePlacementBelowAfter"==h||"below-along"==h||"esriServerLinePlacementBelowAlong"==h||"below-before"==h||"esriServerLinePlacementBelowBefore"==h||"below-start"==h||"esriServerLinePlacementBelowStart"==h||"below-end"==h||"esriServerLinePlacementBelowEnd"==h?"Below":"center-after"==h||"esriServerLinePlacementCenterAfter"==h||"center-along"==h||"esriServerLinePlacementCenterAlong"==h||"center-before"==h||"esriServerLinePlacementCenterBefore"==h||"center-start"==h||"esriServerLinePlacementCenterStart"==
h||"center-end"==h||"esriServerLinePlacementCenterEnd"==h?"OnLine":"Above",labelRotation:e,howManyLabels:"OneLabel",hasExpression:r,arcadeCache:t}}});d("extend-esri")&&k.setObject("layers.LabelLayer",q,h);return q})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(q,f,k,m,e,n){q=q(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=
[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(e,d){this._labelLayer=d;this._xmin=e.extent.xmin;this._xmax=e.extent.xmax;this._ymin=e.extent.ymin;this._ymax=e.extent.ymax;this._scale=(this._xmax-this._xmin)/e.width},_process:function(e){this._preparedLabels=e;this._placedLabels=[];var d;for(e=this._preparedLabels.length-1;0<=e;e--){var c=this._preparedLabels[e],h=Math.min(c.labelWidth,c.labelHeight),
p=c.labelWidth+0*h,h=c.labelHeight+0*h,a=(d=c.options)&&void 0!==d.lineLabelPlacement?d.lineLabelPlacement:"PlaceAtCenter",b=d&&void 0!==d.lineLabelPosition?d.lineLabelPosition:"Above",g=d&&void 0!==d.pointPriorities?d.pointPriorities:"AboveRight",r=[2,2,1,3,0,2,3,3,2];"AboveLeft"==g?r=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==g?r=[2,1,2,2,0,2,3,3,3]:"AboveRight"==g?r=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==g?r=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==g?r=[0,0,0,0,1,0,0,0,0]:"CenterRight"==g?r=[3,2,2,3,0,1,3,2,2]:
"BelowLeft"==g?r=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==g?r=[3,3,3,2,0,2,2,1,2]:"BelowRight"==g&&(r=[3,3,2,3,0,2,2,2,1]);var t=d&&void 0!==d.labelRotation?d.labelRotation:!0,g=Math.PI/180*c.angle;d=d&&void 0!==d.howManyLabels?d.howManyLabels:"OneLabel";if("point"==c.geometry.type)this._generatePointPositions(c,c.geometry.x,c.geometry.y,c.text,g,p,h,c.symbolWidth,c.symbolHeight,r);else if("multipoint"==c.geometry.type)for(a=c.geometry,b=0;b<a.points.length;b++)this._generatePointPositions(c,a.points[b][0],
a.points[b][1],c.text,g,p,h,c.symbolWidth,c.symbolHeight,r);else"polyline"==c.geometry.type?this._generateLinePositions(c,c.geometry,c.text,p,h,2*c.symbolHeight+h,a,b,t):"polygon"==c.geometry.type&&this._generatePolygonPositions(c,d,c.geometry,c.text,g,p,h)}return this._placedLabels},_generatePointPositions:function(e,d,c,h,p,a,b,g,r,t){g=(g+a)*this._scale;r=(r+b)*this._scale;var u,l;for(u=1;3>=u;u++)for(l=1;9>=l;l++)if(t[l-1]==u)switch(l){case 1:if(this._findPlace(e,h,d-g,c+r,p,a,b))return;break;
case 2:if(this._findPlace(e,h,d,c+r,p,a,b))return;break;case 3:if(this._findPlace(e,h,d+g,c+r,p,a,b))return;break;case 4:if(this._findPlace(e,h,d-g,c,p,a,b))return;break;case 5:if(this._findPlace(e,h,d,c,p,a,b))return;break;case 6:if(this._findPlace(e,h,d+g,c,p,a,b))return;break;case 7:if(this._findPlace(e,h,d-g,c-r,p,a,b))return;break;case 8:if(this._findPlace(e,h,d,c-r,p,a,b))return;break;case 9:if(this._findPlace(e,h,d+g,c-r,p,a,b))return}},_generateLinePositions:function(e,d,c,h,p,a,b,g,r){var t=
h*this._scale*h*this._scale,u,l,f;for(u=0;u<d.paths.length;u++){var n=d.paths[u],m=n.length,k=Math.floor((m-1)/2),B=0!==(m-1)%2?1:-1;"PlaceAtStart"==b&&(k=0,B=1);"PlaceAtEnd"==b&&(k=m-2,B=-1);for(;0<=k&&k<m-1;){for(l=k;l<m;l++){var x=n[k][0],q=n[k][1],E=n[l][0]-x,D=n[l][1]-q;if(E*E+D*D>t){for(var G=Math.atan2(D,E);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=Math.PI;var H=Math.sin(G),K=Math.cos(G),I=0,N=0;"Above"==g&&(I=a*H*this._scale,N=a*K*this._scale);"Below"==g&&(I=-a*H*this._scale,N=-a*K*
this._scale);if(1==l-k){if(this._clipLine(x,q,n[l][0],n[l][1])&&(x=this._x1-this._x0,f=this._y1-this._y0,x*x+f*f>t&&(l=Math.atan2(f,x),E=h/2+2*p,q=E*this._scale*Math.cos(l),E=E*this._scale*Math.sin(l),"PlaceAtStart"==b?(x=this._x0+q,f=this._y0+E):"PlaceAtEnd"==b?(x=this._x1-q,f=this._y1-E):(x=this._x0+x/2,f=this._y0+f/2),this._findPlace(e,c,x-I,f+N,r?-l:0,h,p))))return}else{var L=0;for(f=k;f<=l;f++)L=Math.max(L,Math.abs((n[f][1]-q)*K-(n[f][0]-x)*H));if(L<p&&this._findPlace(e,c,x+E/2-I,q+D/2+N,r?-G:
0,h,p))return}break}}k+=B}}},_generatePolygonPositions:function(e,d,c,h,p,a,b){var g;if("ManyLabels"==d)for(d=0;d<c.rings.length;d++)g=c.rings[d],n.prototype.isClockwise(g)&&(g=this._findCentroid(g,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(e,h,g[0],g[1],p,a,b));else{g=this._findCentroidForFeature(c,this._xmin,this._ymin,this._xmax,this._ymax);var r=g[1],t=0;for(d=0;10>d;d++){t+=b/4;g=this._findCentroidForFeature(c,this._xmin,r+(t-b/4),this._xmax,r+(t+b/4));if(this._findPlace(e,
h,g[0],g[1],p,a,b))break;g=this._findCentroidForFeature(c,this._xmin,r-(t+b/4),this._xmax,r-(t-b/4));if(this._findPlace(e,h,g[0],g[1],p,a,b))break}}},_findCentroid:function(e,d,c,h,p){var a=e.length,b=[0,0],g=0,r=e[0][0],t=e[0][1];r>h&&(r=h);r<d&&(r=d);t>p&&(t=p);t<c&&(t=c);for(var u=1;u<a-1;u++){var l=e[u][0],f=e[u][1],n=e[u+1][0],m=e[u+1][1];l>h&&(l=h);l<d&&(l=d);f>p&&(f=p);f<c&&(f=c);n>h&&(n=h);n<d&&(n=d);m>p&&(m=p);m<c&&(m=c);var k=(l-r)*(m-t)-(n-r)*(f-t);b[0]+=k*(r+l+n);b[1]+=k*(t+f+m);g+=k}b[0]/=
3*g;b[1]/=3*g;if(isNaN(b[0])||isNaN(b[1]))return b;c=[];this._fillBuffer(e,c,b);b[0]=this._sortBuffer(c,b[0],d,h);return b},_findCentroidForFeature:function(e,d,c,h,p){for(var a,b=0,g=[0,0],r=0;r<e.rings.length;r++){var t=e.rings[r],u=t.length,l=t[0][0],f=t[0][1];l>h&&(l=h);l<d&&(l=d);f>p&&(f=p);f<c&&(f=c);for(a=1;a<u-1;a++){var n=t[a][0],m=t[a][1],k=t[a+1][0],B=t[a+1][1];n>h&&(n=h);n<d&&(n=d);m>p&&(m=p);m<c&&(m=c);k>h&&(k=h);k<d&&(k=d);B>p&&(B=p);B<c&&(B=c);var x=(n-l)*(B-f)-(k-l)*(m-f);g[0]+=x*
(l+n+k);g[1]+=x*(f+m+B);b+=x}}g[0]/=3*b;g[1]/=3*b;if(isNaN(g[0])||isNaN(g[1]))return g;c=[];for(a=0;a<e.rings.length;a++)this._fillBuffer(e.rings[a],c,g);g[0]=this._sortBuffer(c,g[0],d,h);return g},_fillBuffer:function(e,d,c){for(var h=e.length-1,p=e[0][1]>=e[h][1]?1:-1,a=0;a<=h;a++){var b=a,g=a+1;a==h&&(g=0);var r=e[b][0],b=e[b][1],t=e[g][0],g=e[g][1],u=g>=b?1:-1;if(b<=c[1]&&c[1]<=g||g<=c[1]&&c[1]<=b)c[1]!=b&&c[1]!=g?(d.push((c[1]-b)*(t-r)/(g-b)+r),p=u):c[1]==b&&c[1]!=g?(p!=u&&d.push(r),p=u):c[1]!=
b&&c[1]==g?(d.push(t),p=u):c[1]==b&&c[1]==g&&(1==p&&d.push(r),d.push(t),p=u)}},_sortBuffer:function(e,d,c,h){var p=e.length;e.sort();if(0<p){for(var a=0,b=d=0;b<p-1;b+=2){var g=Math.abs(e[b+1]-e[b]);!(e[b]<=c&&e[b+1]<=c||e[b]>=h&&e[b+1]>=h)&&g>a&&(a=g,d=b)}p=e[d];e=e[d+1];p>h&&(p=h);p<c&&(p=c);e>h&&(e=h);e<c&&(e=c);d=(p+e)/2}return d},_findPlace:function(f,d,c,h,p,a,b){if(isNaN(c)||isNaN(h))return!1;for(var g=0;g<this._placedLabels.length;g++){var r=this._placedLabels[g].angle,t=this._placedLabels[g].width*
this._scale,u=this._placedLabels[g].height*this._scale,l=this._placedLabels[g].x-c,m=this._placedLabels[g].y-h;if(0===p&&0===r){if(this._findPlace2(-a*this._scale,-b*this._scale,a*this._scale,b*this._scale,l-t,m-u,l+t,m+u))return!1}else{var k=new e(-a*this._scale,-b*this._scale,a*this._scale,b*this._scale,null),y=0,w=1;0!==p&&(y=Math.sin(p),w=Math.cos(p));var B=l*w-m*y,l=l*y+m*w,r=r-p,y=Math.sin(r),w=Math.cos(r),x=-t*w- -u*y,m=-t*y+-u*w,r=+t*w- -u*y,q=+t*y+-u*w,t=B+x,u=l-m,y=B+r,w=l-q,x=B-x,m=l+m,
B=B-r,l=l+q,r=new n;r.addRing([[t,u],[y,w],[x,m],[B,l],[t,u]]);if(k.intersects(r))return!1}}for(;p>Math.PI/2;)p-=Math.PI;for(;p<-(Math.PI/2);)p+=Math.PI;g={};g.layer=f;g.text=d;g.angle=p;g.x=c;g.y=h;g.width=a;g.height=b;this._placedLabels.push(g);return!0},_findPlace2:function(e,d,c,h,p,a,b,g){return(e>=p&&e<=b||c>=p&&c<=b||e<=p&&c>=b)&&(d>=a&&d<=g||h>=a&&h<=g||d<=a&&h>=g)?!0:!1},_clipLine:function(e,d,c,h){for(var p=this._code(e,d),a=this._code(c,h);0!==p||0!==a;){if(0!==(p&a))return!1;var b=c-e,
g=h-d;0!==p?(e<this._xmin?(d+=g*(this._xmin-e)/b,e=this._xmin):e>this._xmax?(d+=g*(this._xmax-e)/b,e=this._xmax):d<this._ymin?(e+=b*(this._ymin-d)/g,d=this._ymin):d>this._ymax&&(e+=b*(this._ymax-d)/g,d=this._ymax),p=this._code(e,d)):(c<this._xmin?(h+=g*(this._xmin-c)/b,c=this._xmin):c>this._xmax?(h+=g*(this._xmax-c)/b,c=this._xmax):h<this._ymin?(c+=b*(this._ymin-h)/g,h=this._ymin):h>this._ymax&&(c+=b*(this._ymax-h)/g,h=this._ymax),a=this._code(c,h))}this._x0=e;this._y0=d;this._x1=c;this._y1=h;return!0},
_code:function(e,d){var c=0;e<this._xmin&&(c+=8);e>this._xmax&&(c+=4);d<this._ymin&&(c+=2);d>this._ymax&&(c+=1);return c}});k("extend-esri")&&f.setObject("layers.labelLayerUtils.DynamicLabelClass",q,m);return q})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(q,f,k,m,e,n,l){return q(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",
constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(d,c){this._labelLayer=c;this._map=d;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){var c,h,e,a,b,g,r,t,u;this._preparedLabels=
d;this._placedLabels=[];for(d=this._preparedLabels.length-1;0<=d;d--){c=this._preparedLabels[d];b=c.labelWidth;g=c.labelHeight;t=(r=c.options)&&r.lineLabelPlacement?r.lineLabelPlacement:"PlaceAtCenter";u=r&&r.lineLabelPosition?r.lineLabelPosition:"Above";h=r&&r.labelRotation?r.labelRotation:!0;e=Math.PI/180*c.angle;a=r&&r.howManyLabels?r.howManyLabels:"OneLabel";var f=[];if("point"===c.geometry.type)this._generatePointPositions(c.geometry.x,c.geometry.y,c.text,e,b,g,c.symbolWidth,c.symbolHeight,r,
f);else if("multipoint"===c.geometry.type)for(h=0;h<c.geometry.points.length;h++)this._generatePointPositions(c.geometry.points[h][0],c.geometry.points[h][1],c.text,e,b,g,c.symbolWidth,c.symbolHeight,r,f);else if("polyline"===c.geometry.type)if("PlaceAtStart"===t)this._generateLinePositionsPlaceAtStart(c.geometry,!0,c.text,b,g,2*c.symbolHeight+g,t,u,h,f);else if("PlaceAtEnd"===t)this._generateLinePositionsPlaceAtEnd(c.geometry,!0,c.text,b,g,2*c.symbolHeight+g,t,u,h,f);else{r=[];var m=c.geometry.getExtent(),
k=this._map.extent;if(m.getWidth()<b*this._scale/this._OVERRUN&&m.getHeight()<b*this._scale/this._OVERRUN)continue;else.5*m.getWidth()<k.getWidth()&&.5*m.getHeight()<k.getHeight()?this._generateLinePositionsPlaceAtCenter(c.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,c.text,b,g,2*c.symbolHeight+g,t,u,h,r):this._generateLinePositionsPlaceAtCenter(c.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,c.text,b,g,2*c.symbolHeight+g,t,u,h,r);this._postSorting(k,
r,f)}else if("polygon"===c.geometry.type){t=[];for(h=0;h<c.geometry.rings.length;h++)u=c.geometry.rings[h],1<c.geometry.rings.length&&!l.prototype.isClockwise(u)||(r=this._calcRingExtent(u),r.xmax-r.xmin<4*b*this._scale/this._OVERRUN&&r.ymax-r.ymin<4*g*this._scale/this._OVERRUN||t.push(u));t.sort(function(a,b){return b.length-a.length});for(h=0;h<t.length;h++)this._generatePolygonPositionsForManyLabels(t[h],c.geometry.spatialReference,c.text,e,b,g,f)}for(h=0;h<f.length&&(t=f[h].x,u=f[h].y,void 0!==
f[h].angle&&(e=f[h].angle),r=this._findPlace(c,c.text,t,u,e,b,g),"OneLabel"!==a||!r||!this._labelLayer._isWithinScreenArea(new n(t,u,c.geometry.spatialReference)));h++);}return this._placedLabels},_generatePointPositions:function(d,c,h,e,a,b,g,r,t,u){h=t&&t.pointPriorities?t.pointPriorities:"AboveRight";a=(g+a)*this._scale;b=(r+b)*this._scale;switch(h.toLowerCase()){case "aboveleft":d-=a;c+=b;break;case "abovecenter":c+=b;break;case "aboveright":d+=a;c+=b;break;case "centerleft":d-=a;break;case "centercenter":break;
case "centerright":d+=a;break;case "belowleft":d-=a;c-=b;break;case "belowcenter":c-=b;break;case "belowright":d+=a;c-=b;break;default:return}u.push({x:d,y:c})},_generateLinePositionsPlaceAtStart:function(d,c,h,e,a,b,g,r,t,u){g=e*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,f,l,n,m,k,x,q,E;for(f=0;f<d.paths.length;f++){var D=d.paths[f],G=g,H=0;for(l=0;l<D.length-1;l++)n=D[l][0],m=D[l][1],k=D[l+1][0],x=D[l+1][1],q=k-n,E=x-m,q=Math.sqrt(q*q+E*E),H+q>
G?(H=this._generatePositionsOnLine(d.spatialReference,c,G,p,H,n,m,k,x,h,e,a,b,r,t,u),G=p):H+=q}},_generateLinePositionsPlaceAtEnd:function(d,c,h,e,a,b,g,r,t,u){g=e*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,f,l,n,m,k,x,q,E;for(f=0;f<d.paths.length;f++){var D=d.paths[f],G=g,H=0;for(l=D.length-2;0<=l;l--)n=D[l+1][0],m=D[l+1][1],k=D[l][0],x=D[l][1],q=k-n,E=x-m,q=Math.sqrt(q*q+E*E),H+q>G?(H=this._generatePositionsOnLine(d.spatialReference,c,G,p,H,n,
m,k,x,h,e,a,b,r,t,u),G=p):H+=q}},_generateLinePositionsPlaceAtCenter:function(d,c,h,e,a,b,g,r,t,u,f){var p,l,n,m,v,k,q,E;for(r=0;r<d.paths.length;r++){var D=d.paths[r];if(!(2>D.length)){if(2==D.length){m=D[0];p=D[1];n=m[0];m=m[1];D=p[0];k=p[1];v=(D-n)*(D-n)+(k-m)*(k-m);q=Math.atan2(k-m,D-n);k=Math.cos(q);q=Math.sin(q);D=[];E=n;for(var G=m;(E-n)*(E-n)+(G-m)*(G-m)<v;)D.push([E,G]),E+=h/2*k,G+=h/2*q;D.push(p)}var H=0;for(p=0;p<D.length-1;p++)n=D[p][0],m=D[p][1],v=D[p+1][0],k=D[p+1][1],q=v-n,E=k-m,H+=
Math.sqrt(q*q+E*E);for(p=G=0;p<D.length-1;p++){n=D[p][0];m=D[p][1];v=D[p+1][0];k=D[p+1][1];q=v-n;E=k-m;q=Math.sqrt(q*q+E*E);if(G+q>H/2)break;G+=q}p==D.length-1&&p--;n=D[p][0];m=D[p][1];v=D[p+1][0];k=D[p+1][1];q=v-n;E=k-m;G=H/2-G;q=Math.atan2(E,q);E=n+G*Math.cos(q);q=m+G*Math.sin(q);n=this._angleAndShifts(n,m,v,k,g,t,u);f.push({x:E+n.shiftX,y:q+n.shiftY,angle:n.angle});var H=E,K=q,G=0;for(l=p;l<D.length-1;l++)l==p?(n=H,m=K):(n=D[l][0],m=D[l][1]),v=D[l+1][0],k=D[l+1][1],q=v-n,E=k-m,q=Math.sqrt(q*q+
E*E),G=G+q>h?this._generatePositionsOnLine(d.spatialReference,c,h,h,G,n,m,v,k,e,a,b,g,t,u,f):G+q;G=0;for(l=p;0<=l;l--)l==p?(n=H,m=K):(n=D[l+1][0],m=D[l+1][1]),v=D[l][0],k=D[l][1],q=v-n,E=k-m,q=Math.sqrt(q*q+E*E),G=G+q>h?this._generatePositionsOnLine(d.spatialReference,c,h,h,G,n,m,v,k,e,a,b,g,t,u,f):G+q}}},_generatePositionsOnLine:function(d,c,h,p,a,b,g,r,t,u,f,l,n,m,k,B){u=Math.atan2(t-g,r-b);f=b;l=g;var v=f,z=l;do if(a=h-a,f+=a*Math.cos(u),l+=a*Math.sin(u),this._belongs(f,l,b,g,r,t))a=this._angleAndShifts(b,
g,r,t,n,m,k),h=f+a.shiftX,z=l+a.shiftY,c?this._labelLayer._isWithinScreenArea(new e(h,z,h,z,d))&&B.push({x:h,y:z,angle:a.angle}):B.push({x:h,y:z,angle:a.angle}),v=f,z=l,a=0,h=p;else return d=r-v,t-=z,Math.sqrt(d*d+t*t);while(1)},_postSorting:function(d,c,h){if(d&&0<c.length){var e=.5*(d.xmin+d.xmax);d=.5*(d.ymin+d.ymax);for(var a=c[0].x,b=c[0].y,g=Math.sqrt((a-e)*(a-e)+(b-d)*(b-d)),r=c[0].angle,t=0;t<c.length;t++){var u=c[t].x,f=c[t].y,l=Math.sqrt((u-e)*(u-e)+(f-d)*(f-d));l<g&&(a=u,b=f,g=l,r=c[t].angle)}h.push({x:a,
y:b,angle:r})}},_belongs:function(d,c,h,e,a,b){if(a==h&&b==e)return!1;if(a>h){if(d>a||d<h)return!1}else if(d<a||d>h)return!1;if(b>e){if(c>b||c<e)return!1}else if(c<b||c>e)return!1;return!0},_angleAndShifts:function(d,c,h,e,a,b,g){for(d=Math.atan2(e-c,h-d);d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;e=Math.sin(d);var r=Math.cos(d);h=c=0;"Above"==b&&(c=a*e*this._scale,h=a*r*this._scale);"Below"==b&&(c=-a*e*this._scale,h=-a*r*this._scale);a=[];a.angle=g?-d:0;a.shiftX=-c;a.shiftY=h;return a},
_generatePolygonPositionsForManyLabels:function(d,c,h,e,a,b,g){a=this._findCentroidForRing(d);e=a[0];var r=a[1],t=this._calcRingExtent(d);a=t.xmin;b=t.ymin;var p=t.xmax,t=t.ymax,f=(t-b)/(this._map.height*this._scale);if(!(10<(p-a)/(this._map.width*this._scale)&&10<f)){var l=!0;if(p-a>this._map.width*this._scale||t-b>this._map.height*this._scale)l=!1;var f=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*this._scale*(l?.1875:.5),n=!0,m=!0,k=0;do{r+=(k%2?-1:1)*k*l;if(this._scanRingByX(h,
c,d,e,r,a,p,f,g))break;r<b&&(n=!1);r>t&&(m=!1);k++}while(n||m)}},_scanRingByX:function(d,c,h,p,a,b,g,r,t){var u=!0,f=!0,l=0,n=1E3;do{p+=(l%2?-1:1)*l*r;var m=this._movePointInsideRing(h,p,a),k=this._labelLayer._isWithinScreenArea(new e(m,a,m,a,c)),B=this._isPointWithinRing(d,h,m,a);if(k&&B)return t.push({x:m,y:a}),!0;p<b&&(u=!1);p>g&&(f=!1);l++;n--;if(0>=n)return!0}while(u||f);return!1},_movePointInsideRing:function(d,c,h){for(var e=[],a=d.length-1,b=d[0][1]>=d[a][1]?1:-1,g=0;g<=a;g++){var r=g,t=g+
1;g==a&&(t=0);var u=d[r][0],r=d[r][1],f=d[t][0],t=d[t][1],l=t>=r?1:-1;if(r<=h&&h<=t||t<=h&&h<=r)h!=r&&h!=t?(e.push((h-r)*(f-u)/(t-r)+u),b=l):h==r&&h!=t?(b!=l&&e.push(u),b=l):h!=r&&h==t?(e.push(f),b=l):h==r&&h==t&&(1==b&&e.push(u),e.push(f),b=l)}e.sort(function(a,b){return a-b});d=e.length;if(0<d){for(g=h=c=0;g<d-1;g+=2)a=Math.abs(e[g+1]-e[g]),a>c&&(c=a,h=g);c=(e[h]+e[h+1])/2}return c},_calcRingExtent:function(d){var c,h;h=new e;for(c=0;c<d.length-1;c++){var p=d[c][0],a=d[c][1];if(void 0===h.xmin||
p<h.xmin)h.xmin=p;if(void 0===h.ymin||a<h.ymin)h.ymin=a;if(void 0===h.xmax||p>h.xmax)h.xmax=p;if(void 0===h.ymax||a>h.ymax)h.ymax=a}return h},_isPointWithinPolygon:function(d,c,h,e){var a;for(a=0;a<c.rings.length;a++)if(this._isPointWithinRing(d,c.rings[a],h,e))return!0;return!1},_isPointWithinRing:function(d,c,h,e){var a,b,g,r,t=[],p=c.length;for(d=0;d<p-1;d++)if(a=c[d][0],b=c[d][1],g=c[d+1][0],r=c[d+1][1],a!=g||b!=r){if(b==r)if(e==b)t.push(a);else continue;a==g?(b<r&&e>=b&&e<r&&t.push(a),b>r&&e<=
b&&e>r&&t.push(a)):(b=(g-a)/(r-b)*(e-b)+a,a<g&&b>=a&&b<g&&t.push(b),a>g&&b<=a&&b>g&&t.push(b))}t.sort(function(a,b){return a-b});for(d=0;d<t.length-1;d++)if(a=t[d],g=t[d+1],h>=a&&h<g)if(d%2)break;else return!0;return!1},_findCentroidForRing:function(d){for(var c=d.length,h=[0,0],e=0,a=d[0][0],b=d[0][1],g=1;g<c-1;g++){var r=d[g][0],t=d[g][1],u=d[g+1][0],f=d[g+1][1],l=(r-a)*(f-b)-(u-a)*(t-b);h[0]+=l*(a+r+u);h[1]+=l*(b+t+f);e+=l}h[0]/=3*e;h[1]/=3*e;return h},_findCentroidForFeature:function(d){for(var c=
0,h=[0,0],e=0;e<d.rings.length;e++)for(var a=d.rings[e],b=a.length,g=a[0][0],r=a[0][1],t=1;t<b-1;t++){var u=a[t][0],f=a[t][1],l=a[t+1][0],n=a[t+1][1],m=(u-g)*(n-r)-(l-g)*(f-r);h[0]+=m*(g+u+l);h[1]+=m*(r+f+n);c+=m}h[0]/=3*c;h[1]/=3*c;return h},_findPlace:function(d,c,h,p,a,b,g){if(isNaN(h)||isNaN(p))return!1;for(var r=0;r<this._placedLabels.length;r++){var t=this._placedLabels[r].angle,u=this._placedLabels[r].width*this._scale,f=this._placedLabels[r].height*this._scale,n=this._placedLabels[r].x-h,
m=this._placedLabels[r].y-p;if(0===a&&0===t){if(this._findPlace2(-b*this._scale,-g*this._scale,b*this._scale,g*this._scale,n-u,m-f,n+u,m+f))return!1}else{var k=new e(-b*this._scale,-g*this._scale,b*this._scale,g*this._scale,null),w=0,B=1;0!==a&&(w=Math.sin(a),B=Math.cos(a));var x=n*B-m*w,n=n*w+m*B,t=t-a,w=Math.sin(t),B=Math.cos(t),q=-u*B- -f*w,m=-u*w+-f*B,t=+u*B- -f*w,E=+u*w+-f*B,u=x+q,f=n-m,w=x+t,B=n-E,q=x-q,m=n+m,x=x-t,n=n+E,t=new l;t.addRing([[u,f],[w,B],[q,m],[x,n],[u,f]]);if(k.intersects(t))return!1}}for(;a>
Math.PI/2;)a-=Math.PI;for(;a<-(Math.PI/2);)a+=Math.PI;r={};r.layer=d;r.text=c;r.angle=a;r.x=h;r.y=p;r.width=b;r.height=g;this._placedLabels.push(r);return!0},_findPlace2:function(d,c,h,e,a,b,g,r){return(d>=a&&d<=g||h>=a&&h<=g||d<=a&&h>=g)&&(c>=b&&c<=r||e>=b&&e<=r||c<=b&&e>=r)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E,D,G,H,K,I,N,L,Q,V,O,M,P,J,S,W){var R=f([S,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new l([64,64,64]),defaultText:"Aa",sizeRampLightColor:new l([255,255,255]),sizeRampDarkColor:new l([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",
gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){k.mixin(this,W.widgets.legend);this._i18n=W.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===R.ALIGN_RIGHT?R.ALIGN_RIGHT:R.ALIGN_LEFT,this.arrangement===R.ALIGN_RIGHT&&
(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=d(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],q.locale&&-1!==q.locale.indexOf(c)&&(-1!==q.locale.indexOf("-")?-1!==q.locale.indexOf(c+
"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>c("ie")&&(this._repaintItems=k.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();
this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||m.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],m.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=
a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)r.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],m.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];var a=[],b=[];m.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),m.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),m.forEach(d,function(a){b.push(a.id)},this))},this);m.forEach(this.map.graphicsLayerIds,function(c){var d=
this.map.getLayer(c);-1==m.indexOf(a,c)&&-1==m.indexOf(b,c)&&this._isSupportedLayerType(d)&&this._isLayerDrawingEnabled(d)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&a.isFeatureReductionActive())},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=e.connect(this.map,
"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=e.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=e.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=e.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),m.forEach(this.layers,function(a){var b={};b.oarcConnect=e.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers");b.oaicConnect=e.connect(a,"onFeatureReductionChange",this,"_refreshLayers");
b.ovcConnect=e.connect(a,"onVisibilityChange",this,"_refreshLayers");b.oocConnect=e.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=e.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=e.connect(a,"_onDynamicLayersChange",k.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=e.connect(a,"onRenderingChange",k.partial(this._updateImageServiceLayers,
this,a)),b.oivrConnect=e.connect(a,"onRendererChange",k.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(b.oivrConnect=e.connect(a,"onRendererChange",k.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&e.disconnect(this._ozeConnect);this._olaConnect&&e.disconnect(this._olaConnect);this._olroConnect&&e.disconnect(this._olroConnect);this._olrConnect&&e.disconnect(this._olrConnect);
m.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.oarcConnect&&e.disconnect(a.oarcConnect);a.oaicConnect&&e.disconnect(a.oaicConnect);a.ovcConnect&&e.disconnect(a.ovcConnect);a.oocConnect&&e.disconnect(a.oocConnect);a.oscConnect&&e.disconnect(a.oscConnect);a.odcConnect&&e.disconnect(a.odcConnect);a.oirConnect&&e.disconnect(a.oirConnect);a.oivrConnect&&e.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},
_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];m.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);m.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var b=
!1,c=!1;t.set(this.domNode,"position","relative");r.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var d=[];m.forEach(this.layers,function(a){if("esri.layers.KMLLayer"==a.declaredClass||"esri.layers.GeoRSSLayer"==a.declaredClass){var g;a.loaded?("esri.layers.KMLLayer"==a.declaredClass?g=a.getLayers():"esri.layers.GeoRSSLayer"==a.declaredClass&&(g=a.getFeatureLayers(),this.hideLayersInLegend[a.id]&&(g=m.filter(g,function(b){return-1==
m.indexOf(this.hideLayersInLegend[a.id],b.id)},this))),m.forEach(g,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&a._titleForLegend&&(b._titleForLegend=a._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==b.geometryType&&(b._titleForLegend+=this.NLS_areas),d.push(b))},this)):e.connect(a,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===
a.declaredClass)if(!a.loaded)e.connect(a,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&a.visible)&&0<a.layerInfos.length&&m.some(a.layerInfos,function(a){return a.legendURL})){var h=!1;m.forEach(a.layerInfos,function(c){if(c.legendURL&&-1<m.indexOf(a.visibleLayers,c.name)){h||(r.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(a._titleForLegend||a.name||a.id)+"\x3c/span\x3e"},this.domNode),h=!0);
var d;c=c.legendURL;if(a.customParameters||a.customLayerParameters){var g=k.clone(a.customParameters||{});k.mixin(g,a.customLayerParameters||{});for(d in g)c+=(-1===c.indexOf("?")?"?":"\x26")+d+"\x3d"+g[d]}r.create("div",{innerHTML:"\x3cimg src\x3d'"+c+"'/\x3e"},this.domNode);b=!0}},this)}}else"esri.layers.WFSLayer"!==a.declaredClass||a.renderer?d.push(a):(g=r.create("div",{id:this.id+"_"+a.id,"class":"esriLegendService"}),r.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},
r.create("td",{align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%"},g))))),r.place(g,this.id,"first"),g=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),g=r.create("tbody",{},g),"esriGeometryComplex"===a.geometryType?(this._buildRow_Renderer(a,a._pointSymbol,null,this.NLS_points,null,g),this._buildRow_Renderer(a,a._lineSymbol,null,this.NLS_lines,null,g),this._buildRow_Renderer(a,a._polygonSymbol,null,this.NLS_areas,null,g)):
"esriGeometryPoint"===a.geometryType?this._buildRow_Renderer(a,a._pointSymbol,null,"",null,g):"esriGeometryPolyline"===a.geometryType?this._buildRow_Renderer(a,a._lineSymbol,null,"",null,g):"esriGeometryPolygon"===a.geometryType&&this._buildRow_Renderer(a,a._polygonSymbol,null,"",null,g),c=!0)},this);var h=[];m.forEach(d,function(a){if(!a.loaded)var b=e.connect(a,"onLoad",this,function(a){e.disconnect(b);b=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&
(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var c=r.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});r.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},r.create("td",{align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%"},c)))));r.place(c,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass?this._createLegendForLayer(a):
this.isHostedTileService(a)?this._getLayerInfos(a).then(k.hitch(this,function(a){this._createLegendForLayer(a)}),k.hitch(this,function(a){h.push(this._legendRequest(a))})):h.push(this._legendRequest(a))}},this);0!==h.length||b||c?(new a(h)).addCallback(k.hitch(this,function(a){b||c?g.byId(this.id+"_msg").innerHTML="":g.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(g.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||
a.renderer||this.isHostedTileService(a)){var b=!1;if(a.legendResponse||this.isHostedTileService(a)){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?m.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1===m.indexOf(this.hideLayersInLegend[a.id],c.id)){var g=this._buildLegendItems(a,c,d);b=b||g}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(t.set(g.byId(this.id+"_"+a.id),"display","block"),t.set(g.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);e.connect(a,"onLoad",k.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var c=a.url,d=c.indexOf("?"),c=-1<d?c.substring(0,d)+"/legend"+c.substring(d):c+"/legend";
(d=a._getToken())&&(c+="?token\x3d"+d);var g=k.hitch(this,"_processLegendResponse"),h={f:"json"};a._params.dynamicLayers&&(h.dynamicLayers=b.stringify(this._createDynamicLayers(a)),"[{}]"===h.dynamicLayers&&(h.dynamicLayers="[]"));a._params.bandIds&&(h.bandIds=a._params.bandIds);a._params.renderingRule?h.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&m.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(h.renderingRule=
b.stringify({rasterFunction:a.name}))});return x({url:c,content:h,callbackParamName:"callback",load:function(b,c){g(a,b,c)},error:B.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!c("ie")||8<c("ie"))b+="\x26returnbytes\x3dtrue";var d=k.hitch(this,"_processLegendResponse");return x({url:b,content:{f:"json"},callbackParamName:"callback",
load:function(b,c){d(a,b,c)},error:B.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,g.byId(this.id+"_"+a.id)&&r.empty(g.byId(this.id+"_"+a.id)),r.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},r.create("td",{align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%"},g.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+
n.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,h=g.byId(this.id+"_"+a.id),e=b.parentLayerId;if(b.subLayerIds)a=r.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==e?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==e?h:g.byId(this.id+"_"+a.id+"_"+e+"_group")),r.create("td",{innerHTML:y.encode(b.name),align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&
a.visibleLayers)if(c=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===m.indexOf(a.visibleLayers,b.id))return d}else{if(c=this._getReallyVisibleLayers(c,a.visibleLayers),-1===m.indexOf(c,b.id))return d}else if(-1===m.indexOf(a.visibleLayers,b.id))return d;h=r.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<e?this._legendAlign:""},-1==e?h:g.byId(this.id+"_"+a.id+"_"+e+"_group"));r.create("td",{innerHTML:y.encode(b.name)||"",align:this._align},r.create("tr",
{},r.create("tbody",{},r.create("table",{width:"95%","class":"esriLegendLayerLabel"},h))));c=a.dynamicLayerInfos||a.layerInfos;e=!1;c&&c.length&&(e=m.some(c,function(a){return!!a.drawingInfo}));if(a.legendResponse)d=d||this._buildLegendItems_Tools(a,b,h);else if(a.renderer||e)d=d||this._buildLegendItems_Renderer(a,b,h)}return d},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],d=[],g;for(g=0;g<a.length;g++)if(a[g].subLayerIds){if(-1===m.indexOf(b,a[g].id)||-1<m.indexOf(d,
a[g].id))d=d.concat(a[g].subLayerIds)}else-1<m.indexOf(b,a[g].id)&&-1===m.indexOf(d,a[g].id)&&c.push(a[g].id);return c},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,h=this.map.getScale(),e=!1,p=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,
b,h)){var u=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var f=this._getEffectiveScale(a,b);if(f.minScale&&f.minScale<h||f.maxScale&&f.maxScale>h)u=!1}if(u){var h=p(a.legendResponse.layers,b),l=h.legendType,n=h.layerType,k=h.legend;if(k){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,h,b);c=r.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},c);var v=r.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);var x=[];m.forEach(k,function(c){if(!(10.1<=a.version&&!c.values&&1<k.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==c.label&&(c.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===n)){var d=c.label;if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)e=!0,d&&-1!==m.indexOf(x,d)||(x.push(d),this._buildRow_Tools(c,
v,a,b.id,l))}},this)}}}e&&(t.set(g.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(g.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return e},_getLayerInfos:function(a){var b=new p,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(m.some(c,function(a){return!!a.drawingInfo}))b.resolve(a);else{var d=a.url,g=d.indexOf("?"),d=-1==g?d+"/layers":d.substring(0,g)+"/layers"+d.substring(g,d.length);x({url:d,content:{f:"json"},callbackParamName:"callback",
load:function(d,g){d.layers?(m.forEach(c,function(a){var b=m.filter(d.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});b&&b[0]&&b[0].drawingInfo&&(a.drawingInfo=b[0].drawingInfo,a.fields=b[0].fields)}),b.resolve(a)):b.reject(a)},error:function(c){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=k.getObject("layerDefinition.drawingInfo.renderer",!1,c);var g,h;a||(a=k.getObject("drawingInfo.renderer",
!1,c));m.some(d,function(a){if(a.values)return!0})&&m.some(d,function(a,b){a.values||(h=b,g=a);return!!g});a?"uniqueValue"===a.type?g&&(d.splice(h,1),d.push(g)):"classBreaks"===a.type&&(g&&d.splice(h,1),d.reverse(),g&&d.push(g)):g&&(d.splice(h,1),d.push(g));b._sanitized=!0}},_buildRow_Tools:function(a,b,d,g,h){var e=r.create("tr",{},b),t;this.alignRight?(b=r.create("td",{align:this._isRightToLeft?"left":"right"},e),t=r.create("td",{align:this._isRightToLeft?"left":"right",width:35},e)):(t=r.create("td",
{width:35,align:"center"},e),b=r.create("td",{},e));e=a.url;(!c("ie")||9<=c("ie")||9>c("ie")&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&a.imageData&&0<a.imageData.length?e="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(e=d.url+"/"+g+"/images/"+a.url,(g=d._getToken())&&(e+="?token\x3d"+g));g=r.create("img",{src:e,border:0,style:"opacity:"+d.opacity},t);a=r.create("td",{innerHTML:y.encode(a.label),align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",
{width:"95%",dir:"ltr"},b))));h&&"Stretched"===h&&10.3<=d.version&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",g.style.marginBottom="-1px",g.style.display="block",b.style.verticalAlign="top");9>c("ie")&&(g.style.filter="alpha(opacity\x3d"+100*d.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,
"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?m.filter(a,function(a){return!(!a||a.field!==b||a.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var d=b.infoTemplate||(b.infoTemplates&&c&&b.infoTemplates[c.id]?b.infoTemplates[c.id].infoTemplate:null),d=d&&d.getFieldInfo&&d.getFieldInfo(a);a=k.isFunction(a)?null:this.getField(b,a,c);b=d||a;c="";b&&(c=d&&d.label||a&&a.alias||b.name||b.fieldName);return c},_getDomainName:function(a,b,c,d){var g;a&&!k.isFunction(a)&&(g=(c=(a=
this.getField(c,a,d))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null);return g},_getRampTitle:function(a,b,c){var d,g=a.field,h=a.normalizationField,e=!1,t=!1,r=!1,g=k.isFunction(g)?null:g,h=k.isFunction(h)?null:h;if(a.legendOptions&&a.legendOptions.title)d=a.legendOptions.title;else if(a.valueExpressionTitle)d=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var p=b.renderer.authoringInfo.visualVariables;for(a=
0;a<p.length;a++){var u=p[a];if("colorInfo"===u.type&&"ratio"===u.style){e=!0;break}else if("colorInfo"===u.type&&"percent"===u.style){t=!0;break}else if("colorInfo"===u.type&&"percentTotal"===u.style){r=!0;break}}}(e=r&&"showRatioPercentTotal"||t&&"showRatioPercent"||e&&"showRatio"||h&&"showNormField"||g&&"showField"||null)&&(d=F.substitute({field:g&&this._getFieldAlias(g,b,c),normField:h&&this._getFieldAlias(h,b,c)},this._i18n[e]))}return d},_getRendererTitle:function(a,b,c){var d;if(a){var g,h,
e;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(g=a.attributeField,h=a.normalizationField,e="percent-of-total"===a.normalizationType);g=k.isFunction(g)?null:g;h=k.isFunction(h)?null:h;a.legendOptions&&a.legendOptions.title?d=a.legendOptions.title:a.valueExpressionTitle?d=a.valueExpressionTitle:(a=h&&"showNormField"||(e?"showNormPct":null)||g&&"showField"||null)&&(d=F.substitute({field:g&&this._getFieldAlias(g,b,c),normField:h&&this._getFieldAlias(h,b,c)},this._i18n[a]))}return d},_buildLegendItems_Renderer:function(a,
b,c){var d=b.parentLayerId,h=this.map,e=h.getScale(),p,u=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,e)){var f,l,n,v,x,z,B,q;n="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:b&&b.drawingInfo?J.fromJson(k.clone(b.drawingInfo.renderer)):a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===n.declaredClass&&(n=(h="zoom"===n.rangeType?n.getRendererInfoByZoom(h.getZoom()):
n.getRendererInfoByScale(e))&&h.renderer,!n))return!1;var A=this._getVariables(n),w=m.filter(A,function(a){return!!a}).length,e=A[0],h=A[1],A=A[2],F,E,N,G,D;e&&(v=this._getMedianColor(n,e),e.field&&(z=k.isFunction(e.field)?null:this.getField(a,e.field,b)),F=!(e.legendOptions&&!1===e.legendOptions.showLegend));h&&(h.field&&(q=k.isFunction(h.field)?null:this.getField(a,h.field,b)),E=!(h.legendOptions&&!1===h.legendOptions.showLegend));A&&(A.field&&(B=k.isFunction(A.field)?null:this.getField(a,A.field,
b)),N=!(A.legendOptions&&!1===A.legendOptions.showLegend));if("esri.renderer.HeatmapRenderer"===n.declaredClass)p=u=!0,this._showHeatRamp(a,b,n,c);else if("esri.renderer.DotDensityRenderer"===n.declaredClass)p=u=!0,this._showDotDensityLegend(a,b,n,c);else if("esri.renderer.TemporalRenderer"===n.declaredClass)p=u=!0,l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),f=r.create("tbody",{},l),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,a,b),n.latestObservationRenderer&&
"esri.renderer.SimpleRenderer"===n.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(a,n.latestObservationRenderer.symbol,v,y.encode(n.latestObservationRenderer.label)||this.NLS_currentObservations,null,f),n.observationRenderer&&"esri.renderer.SimpleRenderer"===n.observationRenderer.declaredClass&&this._buildRow_Renderer(a,n.observationRenderer.symbol,v,y.encode(n.observationRenderer.label)||this.NLS_previousObservations,null,f);else if("esri.renderer.UniqueValueRenderer"===n.declaredClass){if(n.infos&&
0<n.infos.length){p=u=!0;if(n.legendOptions&&n.legendOptions.title||n.valueExpressionTitle)l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),f=r.create("tbody",{},l),w=n.legendOptions&&n.legendOptions.title?n.legendOptions.title:n.valueExpressionTitle,this._buildRow_Renderer(a,null,v,y.encode(w),null,f);l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);f=r.create("tbody",{},l);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,
a,b);n.attributeField&&A&&this._addSubHeader(f,this._getFieldAlias(n.attributeField,a,b));var H=[];m.forEach(n.infos,function(c){var d=null;a._editable&&a.types&&(d=this._getTemplateFromTypes(a.types,c.value));var g=c.label;null==g&&(g=this._getDomainName(n.attributeField,c.value,a,b)||c.value);-1===m.indexOf(H,g)&&(H.push(g),this._buildRow_Renderer(a,c.symbol,v,y.encode(g),d,f))},this)}D=this._displayDefaultSymbol(a,n,c)}else if("esri.renderer.ClassBreaksRenderer"===n.declaredClass){if(n.infos&&
0<n.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)p=u=!0,G=this._isUnclassedRenderer(n),e||1!==n.infos.length||(x=(x=n.infos[0])&&x.symbol),G||(l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),f=r.create("tbody",{},l),w=this._getRendererTitle(n,a,b),this._buildRow_Renderer(a,null,v,y.encode(w),null,f)),l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),f=r.create("tbody",{},l),(a._hoverLabel||
a._hoverLabels)&&this._createHoverAction(l,a,b),G&&A&&N||(w=n.infos.slice(0).reverse(),m.forEach(w,function(b){var c=b.label;null!=c||G||(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,v,y.encode(c),null,f)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==Q.STYLE_SCALAR&&a.renderer.style!==Q.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,n.defaultSymbol,null,"",null,f),a._hideDefaultSymbol=!0);G||(D=this._displayDefaultSymbol(a,n,c))}else"esri.renderer.SimpleRenderer"===
n.declaredClass&&(p=u=!0,l=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),f=r.create("tbody",{},l),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,a,b),x=null,a._editable&&a.templates&&0<a.templates.length&&(x=a.templates[0]),l=1<w?null:z&&F||q&&E||B&&N,this._buildRow_Renderer(a,n.symbol,v,y.encode(l?this._getRampTitle(1<w?null:e||h||A,a,b):n.label),x,f),x=e?null:n.symbol,l&&(z=q=B=null));p&&(e&&F&&(e.field||e.valueExpression)&&this._showGradientRamp(a,
b,n,null,c,e,z,null,A&&N?!0:!1),A&&N&&(A.field||A.valueExpression)&&(p=e&&F||"esri.renderer.UniqueValueRenderer"===n.declaredClass?!1:!0,this._showSizeLegend(a,b,n,A,v,c,B,null,p)),h&&E&&(h.field||h.valueExpression)&&this._showGradientRamp(a,b,n,x&&!x.url&&x.color?x.color:this.transparencyRampColor,c,h,q,null,!1));D||G&&!F&&!N&&!E||(D=this._displayDefaultSymbol(a,n,c));u=u||D}u&&(t.set(g.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(g.byId(this.id+"_"+a.id+"_"+d+"_group"),"display",
"block"),this._findParentGroup(a.id,d)));return u},_isUnclassedRenderer:function(a,b){var c;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var d;!a._hideDefaultSymbol&&b.defaultSymbol&&(d=!0,c=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=r.create("tbody",{},c),this._buildRow_Renderer(a,
b.defaultSymbol,null,y.encode(b.defaultLabel)||"others",null,c));return d},_showGradientRamp:function(a,b,c,d,g,h,e,t,p){p=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(p?"":" esriLegendSubFragment")},g);g=r.create("tbody",{},p);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(p,a,b,t);(e||h.valueExpression||h.legendOptions&&h.legendOptions.title)&&this._addSubHeader(g,this._getRampTitle(h,a,b));e=h.field;var u;e&&(u=k.isFunction(e)?null:this.getField(a,
e,b));(b=this._getRampStops(c,h,d,u&&"esriFieldTypeDate"===u.type))&&b.length&&this._drawGradientRamp(g,b,!0,a,this._getRampBorderColor(c),!!d)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,d){var g,h,e,t,r=!1;b.colors||b.opacityValues?(h=b.maxDataValue-b.minDataValue,g=m.map([0,.25,.5,.75,1],function(a){e=b.minDataValue+a*h;
return Number(e.toFixed(6))}),this._checkPrecision(0,4,g)):b.stops&&(g=m.map(b.stops,function(a){return a.value}),(r=m.some(b.stops,function(a){return!!a.label}))&&(t=m.map(b.stops,function(a){return a.label})));var p=g[0],u,f;h=g[g.length-1]-p;return m.map(g,function(e,n){c?(u=new l(c.toRgba()),f=a.getOpacity(e,{opacityInfo:b}),null!=f&&(u.a=f)):u=a.getColor(e,{colorInfo:b});var m="";if(r)m=t[n];else{var m=d?D.formatDate(e,D.timelineDateFormatOptions):E.format(e),k="";0===n?k=this._specialChars.lt+
" ":n===g.length-1&&(k=this._specialChars.gt+" ");m=k+m}return{value:e,color:u,offset:1-(e-p)/h,label:m}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,g=c[a],h=c[d],e=c[b],t=Math.floor(g),r=Math.floor(h),p=Math.floor(e);t===g&&p===e&&r!==h&&t!==r&&p!==r&&(c[d]=r);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;else if("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,b,d,g,h,e){var p=r.create("tr",{},a),u,f,n,k,v,x=b.length-1,B;k=0;this.alignRight?(a=r.create("td",{align:this._isRightToLeft?"left":"right"},p),u=r.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},p)):(u=r.create("td",{width:this.gradientWidth,align:"center"},p),a=r.create("td",
{},p));p=h&&0<h.a&&!(240<=h.r&&240<=h.g&&240<=h.b);f=r.create("div",{"class":p?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},u);u=r.create("div",{"class":"esriLegendColorRamp"+(e?" esriLegendTransparencyRamp":"")},f);e=t.get(u,"width");p&&(h=9>c("ie")?h.toHex():"rgba("+h.toRgba().join(",")+")",t.set(u,"border",this.colorRampBorder+" "+h));d?(h=this.gradientHeight*x,t.set(u,"height",h+"px")):h=t.get(u,"height");t.set(f,"height",h+"px");p=z.createSurface(u,
e,h);9>c("ie")&&(k=p.getEventSource(),t.set(k,"position","relative"),t.set(k.parentNode,"position","relative"),k=1);try{d&&m.forEach(b,function(a,b){a.offset=b/x}),v=p.createRect({x:-k,y:-k,width:e+k,height:h+k}),v.setFill({type:"linear",x1:0,y1:0,x2:0,y2:h,colors:b}).setStroke(null),p.createRect({width:e,height:h}).setFill(new l([255,255,255,1-g.opacity])).setStroke(null),this._surfaceItems.push(p)}catch(ha){p.clear(),p.destroy()}m.forEach(b,function(a,c){if(a.label){B="top:"+100*a.offset+"%;";var d=
"";0===c&&(d+=" esriLegendColorRampTickFirst");c===b.length-1&&(d+=" esriLegendColorRampTickLast");r.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",style:B},f)}});n=r.create("div",{"class":"esriLegendColorRampLabels",style:{height:h+this.gradientHeight+"px"}},a);d?m.forEach(b,function(a){r.create("div",{"class":"esriLegendColorRampLabel",innerHTML:y.encode(a.label)||"\x26nbsp;"},n)}):(r.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},n),r.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(h+this.gradientHeight-2*this.gradientHeight)+"px;"},n))},_showHeatRamp:function(a,b,c,d,g){var h,e=c.field;h=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=r.create("tbody",{},h);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(h,a,b,g);(e=e&&this.getField(a,e,b))&&this._addSubHeader(d,this._getFieldAlias(e.name,a,b));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(d,
b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,g,h;b&&b[0]?(c=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[c])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),c++):(d=b[0].value,g=b[c].value-d,b=m.map(b,function(a){return{color:a.color,ratio:(a.value-d)/g}}))):a&&a[0]&&(c=a.length-1,h=1/(a.length-1),b=m.map(a,function(a,b){return{color:a,ratio:b*h}}));b=m.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});
return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var g=c.legendOptions,h,e,t,p,u,f,l,n=this.dotDensitySwatchSize,v=Math.round(n/2);g&&(e=g.backgroundColor,t=g.outline,p=g.valueUnit,u=g.dotCoverage);u=(u||this.dotCoverage)/100;l=Math.round(n*n/Math.pow(c.dotSize,2)*u);d=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);f=r.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(f,F.substitute({value:c.dotValue,
unit:p||""},this.NLS_dotValue));m.forEach(c.fields,function(d){d=k.mixin({},d);d.numPoints=l;h=new O(c._generateImageSrc(n,n,[d],{x:0,y:0},{x:n,y:n},e),t||c.outline,n,n);d=this.getField(a,d.name,b)||d;this._buildRow_Renderer(a,h,null,y.encode(this._getFieldAlias(d.name,a,b)),null,f,{type:"path",path:"M "+-v+","+-v+" L "+v+","+-v+" L "+v+","+v+" L "+-v+","+v+" L "+-v+","+-v+" E"})},this)},_showSizeLegend:function(a,b,c,d,g,h,e,t,p){var u=d.legendOptions,u=u&&u.customValues;g=this._getSizeSymbol(c,
g);if((!d.valueUnit||"unknown"===d.valueUnit)&&g&&(u||null!=d.minSize&&null!=d.maxSize&&null!=d.minDataValue&&null!=d.maxDataValue||d.stops&&!(1>=d.stops.length))){p=r.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(p?"":" esriLegendSubFragment")},h);h=r.create("tbody",{},p);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(p,a,b,t);(e||d.valueExpression||d.legendOptions&&d.legendOptions.title)&&this._addSubHeader(h,this._getRampTitle(d,a,b));e=d.field;
var f;t=k.isFunction(e);e&&(f=t?null:a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(e):this.getField(a,e,b));b=f&&"esriFieldTypeDate"===f.type;var u=u||this._getDataValues(c,g,d,b),l,n=u.length-1;for(f=n;0<=f;f--)p=u[f],g=P.fromJson(g.toJson()),this._applySize(g,c,d,p),p=b?D.formatDate(p,D.timelineDateFormatOptions):E.format(p),l="",f===n?l=this._specialChars.gt+" ":0===f&&(l=e&&!t&&"cluster_count"===e.toLowerCase()&&1===u[f]?"":this._specialChars.lt+" "),l="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+
y.encode(l+p)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,l,null,h)}},_getSizeSymbol:function(a,b){var c,d;if("esri.renderer.SimpleRenderer"===a.declaredClass)c=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)c=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=P.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?
c.setColor(new l(this.sizeRampDarkColor)):(c.setColor(new l(this.sizeRampLightColor)),c.setOutline&&(d=new M,d.setColor(new l(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,c,d,g,h){g=null==g?5:g;h=null==h?20:h;var e=a.getSizeRangeAtScale(c,this.map.getScale());g=this._interpolateSizeRange(e,g);var t=this._getDataRange(c),r=m.map(g,function(a){return this._getDataValueFromSize(a,t,e)},this);if(!d){var p,r=E.round(r);for(d=1;d<r.length-1;d++)if(p=this._roundDataValue(a,
b,c,r[d],r[d-1],h))r[d]=p[0],g[d]=p[1]}return r},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),g,h=[];for(g=0;g<b;g++)h.push(c+d*g);return h},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var g=b.min;b=b.max;return a<=d?g:a>=c?b:(a-d)/(c-d)*(b-g)+g},_roundDataValue:function(a,b,c,d,g,h){var e=this._getSize(b,a,c,d);g=this._getSize(b,
a,c,g);var t,r=E.getDigits(d),p=r.integer,r=r.fractional,u,f,l,n,m,k,v,x,z,B,A;0<d&&1>d&&(t=Math.pow(10,r),d*=t,p=E.getDigits(d).integer);for(--p;0<=p&&(u=Math.pow(10,p),r=Math.floor(d/u)*u,u*=Math.ceil(d/u),null!=t&&(r/=t,u/=t),f=(r+u)/2,f=E.round([r,f,u],{indexes:[1]})[1],l=this._getSize(b,a,c,r),n=this._getSize(b,a,c,u),m=this._getSize(b,a,c,f),k=E.getPctChange(e,l,g,null),v=E.getPctChange(e,n,g,null),x=E.getPctChange(e,m,g,null),z=k.prev<=h,B=v.prev<=h,z&&B&&(k.prev<=v.prev?(z=!0,B=!1):(B=!0,
z=!1)),z?A=[r,l]:B?A=[u,n]:x.prev<=h&&(A=[f,m]),!A);p--);return A},_applySize:function(a,b,c,d){var g=a.type;b=this._getSize(a,b,c,d);switch(g){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":g=a.width;c=a.height;a.setHeight(b);a.setWidth(g/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?
a.style:null})},_buildRow_Renderer:function(a,b,c,d,g,h,e){var t=r.create("tr",{},h),p;this.alignRight?(h=r.create("td",{align:this._isRightToLeft?"left":"right"},t),b&&(p=r.create("td",{align:this._isRightToLeft?"left":"right",width:35},t))):(b&&(p=r.create("td",{width:35,align:"center"},t)),h=r.create("td",{},t));var u=t=30,f;if(b){if("simplemarkersymbol"==b.type)t=Math.min(Math.max(t,b.size+12),125),u=Math.min(Math.max(u,b.size+12),125);else if("picturemarkersymbol"==b.type)t=Math.min(Math.max(t,
b.width),125),u=Math.min(b.height||u,125);else if("textsymbol"==b.type){var l,n;b.text||(l=b.text,n=!0,b.setText(this.defaultText));t=Math.min(Math.max(t,b.getWidth()+12),125);u=Math.min(Math.max(u,b.getHeight()+12),125);n&&b.setText(l)}f=r.create("div",{style:"width:"+t+"px;height:"+u+"px;"},p)}F.isDefined(d)&&"number"===typeof d&&(d=""+d);r.create("td",{innerHTML:d||"",align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%"},h))));b&&(a=this._drawSymbol(f,b,c,t,u,g,
a,e),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=r.create("tr",{},a),c=r.create("td",{align:this._align,colspan:2},c);r.create("td",{innerHTML:y.encode(b)||"",align:this._align},r.create("tr",{},r.create("tbody",{},r.create("table",{width:"95%"},c))))},_drawSymbol:function(a,b,d,g,h,e,r,p){b=P.fromJson(b.toJson());var u=r.opacity;d&&b.setColor(new l(d.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;d=b.color.toRgba();
d[3]*=u;b.color.setColor(d)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(d=b.color.toRgba(),d[3]*=u,b.color.setColor(d)),b.outline&&b.outline.color&&(d=b.outline.color.toRgba(),d[3]*=u,b.outline.color.setColor(d))):"picturemarkersymbol"===b.type&&(a.style.opacity=u,a.style.filter="alpha(opacity\x3d("+100*u+"))");a=z.createSurface(a,g,h);9>c("ie")&&(d=a.getEventSource(),t.set(d,"position","relative"),t.set(d.parentNode,"position","relative"));e=this._getDrawingToolShape(b,
e)||P.getShapeDescriptors(b);var f,u=(d=e.defaultShape)&&"text"===d.type;try{u&&!d.text&&(d.text=this.defaultText),f=a.createShape(p||d).setFill(e.fill).setStroke(e.stroke),u&&f.setFont(e.font)}catch(ga){a.clear();a.destroy();return}var n=f.getBoundingBox();p=n.width;e=n.height;var u=-(n.x+p/2),m=-(n.y+e/2);d=a.getDimensions();u={dx:u+d.width/2,dy:m+d.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)g=r._getScaleMatrix(n,b.size),f.applyTransform(A.scaleAt(g.xx,g.yy,{x:d.width/2,y:d.height/
2}));else if(p>g||e>h)r=p/g>e/h,g=((r?g:h)-5)/(r?p:e),k.mixin(u,{xx:g,yy:g});f.applyTransform(u);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){m.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(C){}a.children&&k.isArray(a.children)&&
m.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,d){if(d=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||d)d=y.encode(d),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=e.connect(a,"onmousemove",k.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(g.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(k.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,g.byId(this.id+"_hoverLabel")){var d=g.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";t.set(d,"top",b+"px");t.set(d,"left",a+15+"px");t.set(d,"display","")}else r.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},d)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=e.connect(a,"onmouseout",k.hitch(this,function(a){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(g.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;m.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)e.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)e.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;m.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();
var g;a.layerDefinitions&&a.layerDefinitions[d.id]&&(g=a.layerDefinitions[d.id]);g&&(c.definitionExpression=g);var h;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(h=a.layerDrawingOptions[d.id]);h&&(c.drawingInfo=h.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,h=
b.dynamicLayerInfos||b.layerInfos;for(d=0;d<h.length;d++)if(c==h[d].id){-1<h[d].parentLayerId&&(t.set(g.byId(this.id+"_"+a+"_"+h[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,h[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,h,e;for(h=0;h<g.length;h++)if(g[h].id===c&&g[h].subLayerIds)for(e=0;e<g[h].subLayerIds.length;e++){var t=g[h].subLayerIds[e];-1===m.indexOf(d,t)&&(d.push(t),b(t,d))}}a.layer.layerInfos&&
m.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,g=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var h=a.legendResponse.layers[d];if(b.id==h.layerId){var e,t;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==h.minScale&&a.tileInfo&&(e=a.tileInfo.lods[0].scale),0==h.maxScale&&a.tileInfo&&(t=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(e=Math.min(a.minScale,
h.minScale)||a.minScale||h.minScale,t=Math.max(a.maxScale,h.maxScale));if(0<e&&e<c||t>c)g=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)g=!1;return g},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],F.isDefined(a)&&(b+=" ("+a+")"));return y.encode(b)},_getEffectiveScale:function(a,
b){var c=b.minScale,d=b.maxScale;if(F.isDefined(b.parentLayerId)){var g=a.layerInfos,h=b.parentLayerId,e;for(e=g.length-1;0<=e;e--)if(g[e].id==h)if(0==c&&0<g[e].minScale?c=g[e].minScale:0<c&&0==g[e].minScale||0<c&&0<g[e].minScale&&(c=Math.min(c,g[e].minScale)),d=Math.max(d||0,g[e].maxScale||0),-1<g[e].parentLayerId)h=g[e].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=
/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,b,c){if(a.getField)return a.getField(b);if(c&&c.fields){var d;m.forEach(c.fields,function(a){a.name===b&&(d=a)});return d}return null}});k.mixin(R,{ALIGN_LEFT:0,ALIGN_RIGHT:1});c("extend-esri")&&k.setObject("dijit.Legend",R,w);return R})},"dojo/debounce":function(){define([],function(){return function(q,f){var k;return function(){k&&clearTimeout(k);var m=
this,e=arguments;k=setTimeout(function(){q.apply(m,e)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(q,f,k,m){var e=function(e,d){return e-d},n={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(e){var d=String(e),c=d.match(n._reNumber);e={integer:0,fractional:0};c&&c[1]?(e.integer=c[1].split("").length,e.fractional=c[3]?c[3].split("").length:0):-1<d.toLowerCase().indexOf("e")&&(c=d.split("e"),d=c[0],c=c[1],d&&c&&(d=
Number(d),c=Number(c),(e=0<c)||(c=Math.abs(c)),d=n.getDigits(d),e?(d.integer+=c,d.fractional=c>d.fractional?0:d.fractional-c):(d.fractional+=c,d.integer=c>d.integer?1:d.integer-c),e=d));return e},getFixedNumbers:function(e,d){var c,h;c=Number(e.toFixed(d));c<e?h=c+1/Math.pow(10,d):(h=c,c-=1/Math.pow(10,d));c=Number(c.toFixed(d));h=Number(h.toFixed(d));return[c,h]},getPctChange:function(e,d,c,h){var p={prev:null,next:null},a;null!=c&&(a=e-c,p.prev=Math.floor(Math.abs(100*(d-c-a)/a)));null!=h&&(a=h-
e,p.next=Math.floor(Math.abs(100*(h-d-a)/a)));return p},round:function(f,d){var c=f.slice(0),h,p,a,b,g,r,t,u,l,m=d&&null!=d.tolerance?d.tolerance:2,k=d&&d.indexes,q=d&&null!=d.strictBounds?d.strictBounds:!1;if(k)k.sort(e);else for(k=[],r=0;r<c.length;r++)k.push(r);for(r=0;r<k.length;r++)if(l=k[r],h=c[l],p=0===l?null:c[l-1],a=l===c.length-1?null:c[l+1],b=n.getDigits(h),b=b.fractional){t=0;for(u=!1;t<=b&&!u;)g=n.getFixedNumbers(h,t),g=q&&0===r?g[1]:g[0],u=n.hasMinimalChange(h,g,p,a,m),t++;u&&(c[l]=
g)}return c},hasMinimalChange:function(e,d,c,h,p){e=n.getPctChange(e,d,c,h);d=null==e.prev||e.prev<=p;c=null==e.next||e.next<=p;return d&&c||e.prev+e.next<=2*p},_reAllZeros:new RegExp("\\"+k.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(e,d){d=d||{places:20,round:-1};var c=f.format(e,d);c&&(c=c.replace(n._reSomeZeros,"$1").replace(n._reAllZeros,""));return c}};q("extend-esri")&&(m.numberUtils=n);return n})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(q,f,k,m,e,n,l,d,c){function h(a){return a&&f.map(a,function(a){return new l(a)})}function p(a,c,d){var g="";0===c?g=b.lt+" ":c===d&&(g=b.gt+" ");return g+a}var a={},b={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},g={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},r={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},t={formatLength:"short",fullYear:!0},u={formatLength:"short"};q.mixin(a,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var d,g=[];null==a||a instanceof
Date||(a=new Date(a));b=b||{};b=q.mixin({},b);var h=b.selector?b.selector.toLowerCase():null;d=!h||-1<h.indexOf("time");h=!h||-1<h.indexOf("date");d&&(b.timeOptions=b.timeOptions||u,b.timeOptions&&(b.timeOptions=q.mixin({},b.timeOptions),b.timeOptions.selector=b.timeOptions.selector||"time",g.push(b.timeOptions)));h&&(b.dateOptions=b.dateOptions||t,b.dateOptions&&(b.dateOptions=q.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",g.push(b.dateOptions)));g&&g.length?(g=f.map(g,
function(b){return m.format(a,b)}),d=1==g.length?g[0]:c["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return g[b]})):d=m.format(a);return d},createColorStops:function(b){var c=b.values,d=b.colors,g=b.labelIndexes,h=b.isDate,e=b.dateFormatOptions;b=[];return b=f.map(c,function(b,t){var r=null;if(!g||-1<f.indexOf(g,t)){var u;(u=h?a.formatDate(b,e):n.format(b))&&(r=p(u,t,c.length-1))}return{value:b,color:d[t],label:r}})},updateColorStops:function(b){var c=b.stops,d=b.changes,
g=b.isDate,h=b.dateFormatOptions,e=[],t,r=f.map(c,function(a){return a.value});f.forEach(d,function(a){e.push(a.index);r[a.index]=a.value});t=n.round(r,{indexes:e});f.forEach(c,function(b,d){b.value=r[d];if(null!=b.label){var e,u=null;(e=g?a.formatDate(t[d],h):n.format(t[d]))&&(u=p(e,d,c.length-1));b.label=u}})},createClassBreakLabel:function(a){var c=a.minValue,g=a.maxValue,h=a.isFirstBreak?"":b.gt+" ";a="percent-of-total"===a.normalizationType?b.pct:"";c=null==c?"":n.format(c);g=null==g?"":n.format(g);
return h+c+a+" "+d.smartMapping.minToMax+" "+g+a},setLabelsForClassBreaks:function(b){var c=b.classBreaks,d=b.classificationMethod,g=b.normalizationType,h=[];c&&c.length&&("standard-deviation"===d?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):b.round?(h.push(c[0].minValue),f.forEach(c,function(a){h.push(a.maxValue)}),h=n.round(h),f.forEach(c,function(b,c){b.label=a.createClassBreakLabel({minValue:0===c?h[0]:h[c],maxValue:h[c+
1],isFirstBreak:0===c,normalizationType:g})})):f.forEach(c,function(b,c){b.label=a.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===c,normalizationType:g})}))},updateClassBreak:function(b){var c=b.classBreaks,d=b.normalizationType,g=b.change,h=g.index,g=g.value,e=-1,t=-1,r=c.length;"standard-deviation"===b.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===h?e=h:h===r?t=h-1:(t=
h-1,e=h),-1<e&&e<r&&(b=c[e],b.minValue=g,b.label=a.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===e,normalizationType:d})),-1<t&&t<r&&(b=c[t],b.maxValue=g,b.label=a.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===t,normalizationType:d})))},calculateDateFormatInterval:function(a){var b,c,d=a.length,h,e,t,r,p,u,l=Infinity,n;a=f.map(a,function(a){return new Date(a)});for(b=0;b<d-1;b++){h=a[b];t=[];p=Infinity;u="";for(c=b+1;c<d;c++)e=a[c],
e=h.getFullYear()!==e.getFullYear()&&"year"||h.getMonth()!==e.getMonth()&&"month"||h.getDate()!==e.getDate()&&"day"||h.getHours()!==e.getHours()&&"hour"||h.getMinutes()!==e.getMinutes()&&"minute"||h.getSeconds()!==e.getSeconds()&&"second"||"millisecond",r=g[e],r<p&&(p=r,u=e),t.push(e);p<l&&(l=p,n=u)}return n},createUniqueValueLabel:function(b){var c=b.value,d=b.fieldInfo,g=b.domain;b=b.dateFormatInterval;var h=String(c);(g=g&&g.codedValues?g.getName(c):null)?h=g:"number"===typeof c&&(h=d&&"esriFieldTypeDate"===
d.type?a.formatDate(c,b&&r[b]):n.format(c));return h},cloneColorInfo:function(a){var b;a&&(b=q.mixin({},a),b.colors=h(b.colors),b.stops=b.stops&&f.map(b.stops,function(a){a=q.mixin({},a);a.color&&(a.color=new l(a.color));return a}),b.legendOptions&&(b.legendOptions=q.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;if(a){b=q.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=f.map(a,function(a){return q.mixin({},a)});if(a=b.legendOptions)b.legendOptions=
q.mixin({},a)}return b},cloneSizeInfo:function(b){var c;b&&(c=q.mixin({},b),c.stops&&(c.stops=f.map(c.stops,function(a){return q.mixin({},a)})),(b=c.minSize)&&"object"===typeof b&&(c.minSize=a.cloneSizeInfo(b)),(b=c.maxSize)&&"object"===typeof b&&(c.maxSize=a.cloneSizeInfo(b)),b=c.legendOptions)&&(c.legendOptions=q.mixin({},b),b=b.customValues)&&(c.legendOptions.customValues=b.slice(0));return c}});k("extend-esri")&&q.setObject("renderer.utils",a,e);return a})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","esri/lang"],function(q,f,k,m,e){return q(m,{constructor:function(){},getExtent:function(){var e=this.layerObject.items;if(0===e.length)return null;e=k.graphicsExtent(e);return this._convertGeometryToMapSpatialRef(e)},_resetLayerObjectVisiblity:function(e){var f=e?e[this.id]:null;if(f){var d={},c;for(c in e)e.hasOwnProperty(c)&&"function"!==typeof e[c]&&(d[c]=e[c].visible);this._setSubLayerVisibleByCheckedInfo(d);this._setTopLayerVisible(f.visible)}},
_setSubLayerVisibleByCheckedInfo:function(n){f.forEach(this.newSubLayers,function(f){e.isDefined(n[f.id])&&f.layerObject.setVisibility(n[f.id])},this)},_initVisible:function(){var e=!1,f;for(f=0;f<this.newSubLayers.length;f++)e=e||this.newSubLayers[f].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(e){e.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var e=[],l=this.layerObject.getFeatureLayers();
f.forEach(l,function(d){d=this._layerInfoFactory.create({layerObject:d,title:d.label||d.title||d.name||d.id||" ",id:d.id||" ",subId:d.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});e.push(d);d.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(l);return e},_markInvalidSubLayerInfoThatAsRootLayer:function(e){var l;f.forEach(e,function(d){if(l=this._getLayerInfosObj()._findTopLayerInfoById(d.id))l._flag._invalid=!0},this)},_needToRenew:function(){var e=this.layerObject.getFeatureLayers();
return(e?e.length:0)===this.newSubLayers.length?!1:!0},_obtainLayerIndexesInMap:function(){var e=[],f,d;for(d=0;d<this.newSubLayers.length;d++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[d].layerObject.id))&&e.push(f);return e},moveLeftOfIndex:function(e){var f;for(f=this.newSubLayers.length-1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)},moveRightOfIndex:function(e){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,
e)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),function(q,f,k,m,e,n,l,d,c,h,p){return q(d,{constructor:function(a,b){},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this._visible=
a;this.layerObject.setVisibility(a)},_setSubLayerVisible:function(a){var b=[],c,b=k.clone(this.originOperLayer.layerObject.visibleLayers),d;for(d in a)if(a.hasOwnProperty(d)&&"function"!==typeof a[d]){var h=a[d],e=d.toString();c=f.indexOf(b,e);h?0>c&&b.push(e):0<=c&&b.splice(c,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(b)},_resetLayerObjectVisiblity:function(a){var b=a?a[this.id]:null,c=!1;if(a){b&&this.layerObject.setVisibility(b.visible);var b={},d;for(d in a)a.hasOwnProperty(d)&&
"function"!==typeof a[d]&&(c=!0,b[d]=a[d].visible);c&&this._setSubLayerVisibleByCheckedInfo(b)}},_setSubLayerVisibleByCheckedInfo:function(a){var b={};this.traversal(function(b){b.isRootLayer()||p.isDefined(a[b.id])&&b._setVisible(a[b.id])});this.traversal(function(a){0===a.getSubLayers().length&&(b[a.subId]=a._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(b)},_getServiceDefinition:function(){var a=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(a)},_serviceDefinitionRequest:function(a){return this._normalRequest(a,
{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var a=[];f.forEach(this.layerObject.layerInfos,function(b,c){var d;d=this._getOperLayerFromWMSLayerInfo(b,this);d=this._layerInfoFactory.create(d);a.push(d);d.init()},this);return a},_getOperLayerFromWMSLayerInfo:function(a,b){return{layerObject:this.layerObject,title:a.label||a.title||a.name||" ",id:this.id+"_"+(a.name||"-"),subId:a.name||"-",wms:{layerInfo:this,subId:a.name||"-",wmsLayerInfo:a},selfType:"wms",parentLayerInfo:b}},
_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&l.after(this.layerObject,"setVisibleLayers",k.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(a){a.isRootLayer()||a._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(b){b.isRootLayer()||a.push(b)});this._setVisibleLayersBySelfFlag=!1;m.publish("layerInfos/layerInfo/visibleChanged",a);
this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),function(q,f,k,m,e,n){return q(n,{constructor:function(e,d){this.layerObject=e.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var e=!1;this.traversal(function(d){if(0<=f.indexOf(d.layerObject.visibleLayers,d.subId))return e=!0});this._visible=
e},_setVisible:function(e){this._visible=e?!0:!1},_setTopLayerVisible:function(e){var d=this.originOperLayer.wms;this._visible=e?!0:!1;var c={};this.traversal(function(d){0===d.getSubLayers().length&&(c[d.subId]=d._isAllSubLayerVisibleOnPath())});d.layerInfo._setSubLayerVisible(c)},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},_serviceDefinitionRequest:function(e){return this._normalRequest(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"},
"xml")},obtainNewSubLayers:function(){var e=[],d=this.originOperLayer.wms;f.forEach(d.wmsLayerInfo.subLayers,function(c){c=d.layerInfo._getOperLayerFromWMSLayerInfo(c,this);c=this._layerInfoFactory.create(c);e.push(c);c.init()},this);return e},drawLegends:function(e){this._initLegendsNode(e)},_initLegendsNode:function(f){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var d=m.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});e(d,"load",function(){m.empty(f);
var c=m.create("div",{"class":"legend-div"},f);k.place(d,c)})}else m.empty(f)},getOpacity:function(){},setOpacity:function(e){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(q,f){return q(f,{constructor:function(f,m){},_initVisible:function(){var f=!1,m=this.originOperLayer.mapService;
m&&m.layerInfo._subLayerVisible[m.subId]&&(f=!0);this._visible=f},_setTopLayerVisible:function(f){var m=this.originOperLayer.mapService;if(m){m.layerInfo._subLayerVisible[m.subId]=f?!0:!1;this._visible=f;var e={};this.traversal(function(f){0===f.getSubLayers().length&&(e[f.originOperLayer.mapService.subId]=f._isAllSubLayerVisibleOnPath())});m.layerInfo._setSubLayerVisible(e)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory".split(" "),
function(q,f,k,m,e,n,l){return q(n,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new l(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(d){var c=new m;this.originOperLayer.mapService.layerInfo.getLegendInfo(d).then(k.hitch(this,function(d){c.resolve(d)}));return c},drawLegends:function(d,c){this._loadLegends(c).then(k.hitch(this,function(c){this._initLegendsNode(c,d)}))},_initLegendsNode:function(d,c){var h=this.originOperLayer.mapService;
if(d){e.empty(c);for(var p=null,a=0;a<d.length;a++)if(d[a].layerId===h.subId){p=d[a];break}if(p){var b=e.create("table",{"class":"legend-table",style:"font-size: 12px"},c);f.forEach(p.legend,function(a){if("\x3call other values\x3e"!==a.label){var c=e.create("tr",{"class":"legend-tr",style:"border: 1px solid"},b),d=e.create("td",{"class":"legend-symbol-td",style:""},c),g=null,g=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;e.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:g},d);e.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},c)}},this)}}},_initControlPopup:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:d.infoTemplates&&d.infoTemplates[c]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
d.infoTemplates&&delete d.infoTemplates[c]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(d){var c=new m;(d?this._layerObjectFacory.getLayerObjectWithUrl(d):this._layerObjectFacory.getLayerObject()).then(k.hitch(this,
function(d){this.layerObject.empty&&d&&(this.layerObject=d);c.resolve(d)}));return c},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var d;return this.isItemLayer()?this.getItemInfo().then(k.hitch(this,function(c){c&&c.getItemData()&&c.getItemData().layers&&f.some(c.getItemData().layers,function(c){if(c.id===this.subId)return d=c.layerUrl,!0},this);return d?this._getLayerObject(d):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var d=
null,c=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(c)for(var h=0;h<c.length;h++)if(c[h].id===this.originOperLayer.mapService.subId){d=c[h].popupInfo;break}return d},getFilterOfWebmap:function(){var d=null,c=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(c)for(var h=0;h<c.length;h++)if(c[h].id===this.originOperLayer.mapService.subId){d=c[h].layerDefinition?c[h].layerDefinition.definitionExpression:null;break}return d},getFilter:function(){var d=this.originOperLayer.mapService;
return d.layerInfo.layerObject&&d.layerInfo.layerObject.layerDefinitions?d.layerInfo.layerObject.layerDefinitions[d.subId]:null},setFilter:function(d){var c,h=this.originOperLayer.mapService;h.layerInfo.layerObject&&h.layerInfo.layerObject.setLayerDefinitions&&(c=h.layerInfo.layerObject.layerDefinitions?f.map(h.layerInfo.layerObject.layerDefinitions,function(c){return c}):[],c[h.subId]=d,h.layerInfo.layerObject.setLayerDefinitions(c))},getLayerType:function(){var d=new m;0<this.getSubLayers().length?
d.resolve("GroupLayer"):this._getServiceDefinition().then(k.hitch(this,function(c){c?d.resolve(c.type.replace(/\ /g,"")):d.resolve(null)}),function(){d.resolve(null)});return d},getSupportTableInfo:function(){var d=new m,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(k.hitch(this,function(h){c.layerType=h;0<=this._getLayerTypesOfSupportTable().indexOf(h)&&(c.isSupportedLayer=!0);this._getServiceDefinition().then(k.hitch(this,function(h){h&&0<=h.capabilities.indexOf("Data")&&
(c.isSupportQuery=!0);d.resolve(c)}),function(){d.resolve(c)})}),function(){d.resolve(c)});return d},enablePopup:function(){var d=this.originOperLayer.mapService.layerInfo,c=d.layerObject,h=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(k.hitch(this,function(){return d.controlPopupInfo.infoTemplates&&d.controlPopupInfo.infoTemplates[h]?(this.controlPopupInfo.enablePopup=!0,c.infoTemplates||(c.infoTemplates={}),c.infoTemplates[h]=d.controlPopupInfo.infoTemplates[h],!0):!1}))},
disablePopup:function(){var d=this.originOperLayer.mapService.layerInfo.layerObject,c=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;d.infoTemplates&&delete d.infoTemplates[c]},loadInfoTemplate:function(){var d=new m,c=this.originOperLayer.mapService.layerInfo,h=this.originOperLayer.mapService.subId;c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[h]&&c.controlPopupInfo.infoTemplates[h].infoTemplate?d.resolve(c.controlPopupInfo.infoTemplates[h].infoTemplate):
(c.controlPopupInfo.infoTemplates||(c.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(k.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);c.controlPopupInfo.infoTemplates[h]={infoTemplate:e,layerUrl:null};d.resolve(e)}),k.hitch(this,function(){d.resolve(null)})));return d},getInfoTemplate:function(){var d=this.originOperLayer.mapService.layerInfo,c=this.originOperLayer.mapService.subId;return d.controlPopupInfo.infoTemplates&&d.controlPopupInfo.infoTemplates[c]&&d.controlPopupInfo.infoTemplates[c].infoTemplate?
d.controlPopupInfo.infoTemplates[c].infoTemplate:null},getScaleRange:function(){var d=this.originOperLayer.mapService;return(d=d.layerInfo._getJsapiLayerInfoById(d.subId))&&0<=d.minScale&&0<=d.maxScale?{minScale:d.minScale,maxScale:d.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(q,f,k,m,e,n,l,d,c,h){return q(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(c){this._layerInfo=c;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new e(f.hitch(this,this._getLayerObject))},getLayerObject:function(){var c=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(c)},getLayerObjectWithUrl:function(c){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(c)},
_getLayerObject:function(e){var a,b=new m;this._layerInfo.getLayerType().then(f.hitch(this,function(g){var r=f.mixin(this._getLayerOptionsForCreateLayerObject(),this._layerInfo.originOperLayer.options||{})||{};switch(g){case "FeatureLayer":a=new n(e,r);break;case "RasterLayer":a=new l(e);break;case "StreamLayer":a=new d(e);break;case "ArcGISImageServiceLayer":a=new c(e);break;case "ArcGISImageServiceVectorLayer":a=new h(e);break;case "Table":if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)a=
new n(e,r);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(a=new n(this._layerInfo.layerObject.featureCollectionData,r),this._setLayerObjectProperties(a),b.resolve(a)):b.resolve(null),b;break;case "GroupLayer":return b=this._getGroupLayerObject();default:return b.resolve(null),b}var t=a.on("load",f.hitch(this,function(){this._setLayerObjectProperties(a);b.resolve(a);t.remove&&t.remove()})),p=a.on("error",f.hitch(this,function(a){b.reject(a);p.remove&&p.remove()}))}),
f.hitch(this,function(){b.reject()}));return b},_getGroupLayerObject:function(){var c=new m;this._layerInfo._getServiceDefinition().then(f.hitch(this,function(a){if(null===a)c.reject();else{var b=this._layerInfo.getUrl();a.url=b;a.id=this._layerInfo.id;c.resolve(a)}}));return c},_getLayerOptionsForCreateLayerObject:function(){var c={},a=[],b=this._layerInfo.getInfoTemplate();b&&b.info&&b.info.fieldInfos?k.forEach(b.info.fieldInfos,function(b){b.visible&&a.push(b.fieldName)},this):a=["*"];c.outFields=
a;return c},_setLayerObjectProperties:function(c){c.name&&!f.getObject("_wabProperties.originalLayerName",!1,c)&&(f.setObject("_wabProperties.originalLayerName",c.name,c),c.name=this._layerInfo.title);c.id=this._layerInfo.id}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r){return q([p,a],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,b){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var a,c;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){a=[];for(c=0;c<this.minValues.length;c++)a.push([this.minValues[c],this.maxValues[c],this.meanValues[c],this.stdvValues[c]]);this.bandCount!==a.length&&(a=null)}c=0;var d=!1;"U8"===this.pixelType?(c=5,d=a?!1:!0):a?(c=5,d=!1):(c=6,d=!0);this.renderingRule&&(c=5,d=!0);this.pixelFilter=(new b({stretchType:c,min:0,max:255,dra:d,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:a,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){var r=h.defaults.map.zoomDuration;return q([g],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,
opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;l.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new b((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var d=this._div=n.create("div",null,b),g={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(g[c._css.names.transform]=c._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;l.set(d,g);this._canvas=n.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},d);p.isDefined(this.opacity)&&l.set(d,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(k.connect(a,"onPan",this,this._panHandler));this._connects.push(k.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(k.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(k.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(k.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(k.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(k.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(k.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(k.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var h=k.connect(a,"onLoad",this,function(){k.disconnect(h);h=null;this.evaluateSuspension()});return d},_unsetMap:function(a,b){m.forEach(this._connects,k.disconnect,this);var c=this._div;c&&(b.removeChild(c),n.destroy(c));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==
a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,l.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),l.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&
this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,d=b.createImageData(a.width,a.height);d.data.set(a.getAsRGBA());var g=this.pixelData.extent,h=this._map.extent,e=this.getCurrentResolution(),r=0,p=0;Math.abs(g.xmin-h.xmin)>e.x&&(r=Math.round((g.xmin-h.xmin)/e.x));Math.abs(h.ymax-g.ymax)>e.y&&(p=Math.round((h.ymax-g.ymax)/e.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,l.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),l.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(l.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),l.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(d,r,p,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()},
_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,l.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))):l.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(a,b){var g={},h=c._css.names;l.set(this._canvas,h.transition,b?"none":
h.transformName+" "+r+"ms ease");this._matrix=a;a=this._multiply?d.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=d.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});g[h.transform]=c._css.matrix(a);l.set(this._canvas,g)},_onZoomHandler:function(a,b,c){var d=this._startRect;a=d.width*b;b*=d.height;var g=d.left-(a-d.width)*(c.x-d.left)/d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;l.set(this._canvas,{left:g+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:g,top:c,
width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){l.set(this._div,{width:b+"px",height:c+"px"});l.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,b,g,h){this.suspended||b&&0===b.x&&0===b.y&&!g||("css-transforms"===this._map.navigationMode&&(b&&(this._dragOrigin.x+=b.x,this._dragOrigin.y+=b.y),g||(this._left=
this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,l.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))),g&&(l.set(this._canvas,c._css.names.transition,"none"),this._multiply=this._multiply?d.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(b){b?a.show(this._div):a.hide(this._div)},_opacityChangeHandler:function(a){l.set(this._div,"opacity",
a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E,D,G,H,K,I){q=q(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues".split(" "),_rasterFunctionTemplateInfos:{},_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=t.urlToObject(a);this.raster=new B(this._url.path);this.infoTemplate=b&&b.infoTemplate;var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?c.compressionTolerance:.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:
null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.renderer=c?c.renderer:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():
{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable=
{};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):g({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,c){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var d=this.minScale,g=this.maxScale;f.mixin(this,
a);this.minScale=d;this.maxScale=g;this.initialExtent=this.fullExtent=this.extent=new u(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var h=this.minValues,e=this.maxValues,r=this.meanValues,t=this.stdvValues,p=this.bands=[],d=0,g=this.bandCount;d<g;d++)p[d]={min:h[d],max:e[d],mean:r[d],stddev:t[d]};this.timeInfo=(d=this.timeInfo)&&d.timeExtent?new D(d):null;g=this.fields=[];if(h=a.fields)for(d=
0;d<h.length;d++)g.push(new G(h[d]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);b.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);b.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);d={};a.defaultMosaicMethod?(d.method=a.defaultMosaicMethod,d.operation=a.mosaicOperator,d.sortField=a.sortField,d.sortValue=a.sortValue):d.method=A.METHOD_NONE;this.defaultMosaicRule=new A(d);this.defaultMosaicRule.ascending=
!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&a.fields&&(this.rasterAttributeTable=f.clone(a)),
a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features)),a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=f.clone(a.fields)),!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._isVectorData()&&!b.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new F,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===
this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(d=this._loadCallback)delete this._loadCallback,d(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new k(r._dfdCanceller);10<this.version?(b._pendingDfd=g({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=!!n.isDebug,b.errback(a));return b},getRasterAttributeTable:function(a){var b=this._url.path+"/rasterAttributeTable",c=new k(r._dfdCanceller),d={f:"json"},h=this.hasRasterAttributeTable;a&&a.renderingRule&&(d.renderingRule=e.toJson(a.renderingRule.toJson()),h=!0);10<this.version&&h?(c._pendingDfd=g({url:b,content:d,handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):
(a=Error("Layer does not support raster attribute table"),a.log=!!n.isDebug,c.errback(a));return c},getRenderingRuleAttributeTable:function(a){var b=new k(r._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),b;a=a.renderingRule;var c=a.functionName;this._renderingRuleAttributeTable&&c&&this._renderingRuleAttributeTable.hasOwnProperty(c)?b.resolve(this._renderingRuleAttributeTable[c]):b=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,
function(a){var b;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(b={features:f.clone(a.features),fields:f.clone(a.fields)},c&&(this._renderingRuleAttributeTable[c]=b));return b}));return b},_getRasterAttributeTableFeatures:function(){var a=new k;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,
function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new k,a.errback(Error("Rendering rule is not specified")),a)},getCustomRasterFields:function(a){var c=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;
a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var d={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},g={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},h={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},e=this.fields?f.clone(this.fields):[];a=e.length;
e[a]=g;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none"))&&(a++,e[a]=h);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,e[a]=d;!b.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(d={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},g={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,e[a]=d,a++,e[a]=g);a=this._rasterAttributeTableFields;(d=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(d)&&(a=this._renderingRuleAttributeTable[d].fields);a&&0<a.length&&(a=m.filter(a,function(a){return"esriFieldTypeOID"!==
a.type&&"value"!==a.name.toLowerCase()}),a=m.map(a,function(a){var b=f.clone(a);b.name=c+a.name;return b}),e=e.concat(a));var r=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&m.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:r+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},e.push(a))});return e},_prepareGetImageParameters:function(a,c,d,g){g=b.isDefined(g)?
g:this._params;if(this.renderer){var h=this.getExportImageRenderingRule();g.renderingRule=h?e.toJson(h.toJson()):null}h=a.spatialReference.wkid||e.toJson(a.spatialReference.toJson(!1));delete g._ts;f.mixin(g,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:c+","+d},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete g.compressionTolerance;g.format&&"LERC"===g.format.toUpperCase()&&(g.compressionTolerance=this.compressionTolerance);g.token=this._getToken()},getImageUrl:function(d,
h,e,r,p){p=b.isDefined(p)?p:this._params;this._prepareGetImageParameters(d,h,e,p);d=f.clone(p);this._cleanupRequestParams(d);h=this._url.path+"/exportImage?";e=t.addProxy(h+c.objectToQuery(f.mixin(d,{f:"image"})));var u=d.token;e.length>a.defaults.io.postLength||this.useMapImage?this._jsonRequest=g({url:h,content:f.mixin(d,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;u&&(c+=-1===c.indexOf("?")?"?token\x3d"+u:"\x26token\x3d"+u);r(t.addProxy(c))},error:this._errorHandler}):
r(e)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");
if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=e.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=
a?e.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:a});if(c)this.onRenderingChange();this._setDefaultFilter();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;this._setDefaultFilter();b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():
c.method=A.METHOD_NONE);c.where=a;c=new A(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),
this.renderingRule)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(){var a=new k(r._dfdCanceller);if(this.hasHistograms)a._pendingDfd=g({url:this._url.path+"/histograms",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(b){a.callback(b)},function(b){a.errback(b)});else{var b=Error("Layer does not have histograms.");b.log=!!n.isDebug;a.errback(b)}return a},computeHistograms:function(a){var b=new k(r._dfdCanceller);
if(10.1<=this.currentVersion){a=a||{};var c=a.geometry||this.fullExtent,d=(a.geometry||this.fullExtent).toJson(),c="extent"===c.type?"esriGeometryEnvelope":"esriGeometryPolygon",h=a.renderingRule||this.renderingRule||this.defaultRenderingRule,h=h?h.toJson():null,e=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule,e=e?e.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};b._pendingDfd=g({url:this._url.path+"/computeHistograms",content:f.mixin({f:"json",geometry:JSON.stringify(d),
geometryType:c,renderingRule:JSON.stringify(h),mosaicRule:JSON.stringify(e),pixelSize:JSON.stringify(a),callbackParamName:"callback"}),handleAs:"json"});b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})}else d=Error("Layer doesn't support computeHistograms."),d.log=!!n.isDebug,b.errback(d);return b},getRenderingRuleServiceInfo:function(a){var b=new r._fixDfd(new k(r._dfdCanceller));if(!a)return b.errback(Error("Rendering rule is not specified")),b;var c=a&&a.functionName&&!a.functionArguments?
a.functionName:null;return c&&this._rasterFunctionTemplateInfos[c]?(b.resolve(this._rasterFunctionTemplateInfos[c]),b):g({url:this._url.path,content:f.mixin(f.mixin({f:"json",renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:f.hitch(this,function(a){var b={};m.forEach(this._rasterFunctionServiceInfoProps,function(c){b[c]=a[c]});return this._rasterFunctionTemplateInfos[c]=b}),error:this._errorHandler})},queryVisibleRasters:function(a,b,c,d){var g=this._map,
h=r._fixDfd(new k(r._dfdCanceller));this._visibleRasters=[];var e,p,t=!0,u=this.infoTemplate?this.infoTemplate.info:null,l=u?f.clone(this.infoTemplate.info.fieldInfos):null;b=b||{};if(u&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var n=[];m.forEach(this.infoTemplate.info.mediaInfos,function(a){n=n.concat(a&&a.value&&a.value.fields||[])});n.length&&m.forEach(l,function(a){a&&-1<n.indexOf(a.fieldName)&&(a.visible=!0)})}if(l&&0<l.length)for(t=!1,e=0;e<l.length;e++)if((p=
l[e])&&p.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(p.visible||u.title&&-1<u.title.toLowerCase().indexOf(p.fieldName.toLowerCase()))){t=!0;break}var x=(p=this._removeVisualizationStretchFunction(this.renderingRule))&&p.functionName,z=[];if(10.4<=this.version){var q=!1;if(this.rasterFunctionInfos&&l){var B=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;m.forEach(this.rasterFunctionInfos,function(a){var b=B+a.name.replace(/ /gi,"_");m.some(l,function(a){return a.visible&&
a.fieldName===b})&&(q=q||x&&x===a.name,z.push(new y({rasterFunction:a.name})))})}p&&!q&&z.push(p)}e=new I;e.geometry=a.geometry;e.returnGeometry=this._map.spatialReference.equals(this.spatialReference);e.returnCatalogItems=t;e.timeExtent=a.timeExtent;this._params.time&&this.mosaicRule?(a=f.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),e.mosaicRule=a):e.mosaicRule=this.mosaicRule||null;e.renderingRule=10.4>this.version&&p||null;e.renderingRules=z||null;g&&(g=new v((g.extent.xmax-g.extent.xmin)/
g.width,(g.extent.ymax-g.extent.ymin)/g.height,g.extent.spatialReference),e.pixelSize=g);b.requestParams=e;var A=this,g=new K(this.url);(h._pendingDfd=g.execute(e)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,b,c,d,h)},function(a){A._resolve([a],null,d,h,!0)});return h},_queryVisibleRastersHandler:function(a,c,d,h,r){function p(){var a=this.getCustomRasterFields(c),g=this._getDomainFields(a),h=c?c.returnDomainValues:!1,e=c&&c.rasterAttributeTableFieldPrefix,p,v,q,z,B,A,w,y,E,G;this._useRenderingRuleAttributeTable&&
this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),G=t):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(p=0;p<k.length;p++){L=k[p];L.setInfoTemplate(this.infoTemplate);L._layer=this;if(t){E=t.replace(/ /gi,"").split(",");v=t;q=E;n&&n.length>=p&&(v=n[p].replace(/ /gi,", "),q=n[p].split(" "));L.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=q;L.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=E;l&&(L.attributes[this._rasterFieldPrefix+
"ServicePixelValue.Raw"]=l.replace(/ /gi,"").split(","));if(this.pixelFilter){var c=new x({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});m.forEach(q,function(a){c.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:c,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)L.attributes[this._rasterFieldPrefix+"Magnitude"]=
c.pixels[0][0],L.attributes[this._rasterFieldPrefix+"Direction"]=c.pixels[1][0]}m.forEach(F,function(a){L.attributes[a.name]=a.value});var D=G||v;if(a&&0<a.length&&(z=m.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==D:a.attributes.VALUE==D}),0<z.length&&(B=f.clone(z[0]),e&&B))){y={};for(A in B.attributes)B.attributes.hasOwnProperty(A)&&(w=e+A,y[w]=B.attributes[A]);B.attributes=y;L.attributes=f.mixin(L.attributes,B.attributes)}}h&&g&&0<g.length&&
m.forEach(g,function(a){if(a){var c=L.attributes[a.name];b.isDefined(c)&&(c=this._getDomainValue(a.domain,c),b.isDefined(c)&&(L.attributes[a.name]=c))}},this);O.push(L);this._visibleRasters.push(L)}this._resolve([O,null,!0],null,d,r)}))}var t=a.value,l=a.value,n,k,v=0,q=0,B=this,A=this.objectIdField,w,y,F=[];h=c.requestParams.renderingRules;var E=a.processedValues,G=this.renderingRule&&e.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(h&&E&&h.length===E.length){var D=
this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;m.forEach(h,function(a,b){if(a.functionName){var c={name:D+a.functionName.replace(/ /gi,"_"),value:E[b].replace(/ /gi,"").split(",")};F.push(c);G&&G===e.toJson(a.toJson())&&(t=E[b])}})}h=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var K=0,N,Q,I=a.catalogItems.features.length;
y=0;k=Array(I);n=Array(I);w=Array(I);for(v=0;v<I;v++)-1<a.properties.Values[v].toLowerCase().indexOf("nodata")&&y++;N=I-y;for(v=0;v<I;v++)y=!0,-1<a.properties.Values[v].toLowerCase().indexOf("nodata")?(Q=N++,h||(y=!1,k.length--,n.length--,w.length--)):Q=K++,y&&(k[Q]=a.catalogItems.features[v],n[Q]=a.properties.Values[v],w[Q]=k[Q].attributes[A])}this._visibleRasters=[];var L;(a=-1<t.toLowerCase().indexOf("nodata"))&&!h&&(k=[],n=[],w=[]);!t||k||a||(A="ObjectId",k=[],L=new H(new u(this.fullExtent),null,
{ObjectId:0}),k.push(L));var O=[];k?!this._map.spatialReference.equals(this.spatialReference)&&w&&0<w.length?g({url:this._url.path+"/query",content:{f:"json",objectIds:w.join(","),returnGeometry:!0,outSR:e.toJson(B._map.spatialReference.toJson()),outFields:A},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)B._resolve([O,null,null],null,d,r);else{for(v=0;v<a.features.length;v++)for(q=0;q<k.length;q++)k[q].attributes[A]==a.features[v].attributes[A]&&(k[q].geometry=
new z(a.features[v].geometry),k[q].geometry.setSpatialReference(B._map.spatialReference));p.call(B)}},error:function(a){B._resolve([O,null,null],null,d,r)}}):p.call(this):this._resolve([O,null,null],null,d,r)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];m.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,
b){if(a&&a.codedValues){var c;m.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=f.clone(this._params);this._cleanupRequestParams(b);b.extent=a;b.format=b.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===b.format.toLowerCase()&&!b.lercVersion&&10.5<=this.version&&(b.lercVersion=2);c=null;this._useBrowserDecoding()&&
(c=new E({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?f.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);
this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,g=0,h=0,e=new Uint8Array(d),r=new Uint8Array(d),p=new Uint8Array(d),
t=new Uint8Array(d),f=Infinity,u=Infinity,l=Infinity,n=-Infinity,m=-Infinity,k=-Infinity,v,q,z,g=0;g<d;g++)v=a[h++],q=a[h++],z=a[h++],f=f<v?f:v,n=n>v?n:v,u=u<q?u:q,m=m>q?m:q,l=l<z?l:z,k=k>z?k:z,e[g]=v,r[g]=q,p[g]=z,t[g]=a[h++]&1;return new x({width:b,height:c,pixels:[e,r,p],pixelType:"U8",mask:t,statistics:[{minValue:f,maxValue:n},{minValue:u,maxValue:m},{minValue:l,maxValue:k}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||
"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new k(r._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=g({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),
function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=!!n.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,d=[],g=new k(r._dfdCanceller),h;if(this._defaultMultidimensionalDefinition)return g.resolve(this._defaultMultidimensionalDefinition),g;g._pendingDfd=this.getMultidimensionalInfo();g._pendingDfd.then(f.hitch(this,function(e){a=e;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&"StdTime"!==b[c].name&&(h=b[c],
d.push(new w({variableName:"",dimensionName:h.name,isSlice:!h.hasRanges,values:[this._getDefaultDimensionValue(h)]})));this._defaultMultidimensionalDefinition=d;g.callback(d)}),function(a){g.errback(a)});return g},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var b,c,d=Infinity,g,h;if(a.hasRanges)return a.values[0];if(a.name&&"stdz"===a.name.toLowerCase()){for(h=0;h<a.values.length&&(g=a.values[h],c=Math.abs(g-0),c<d&&(d=c,b=g),0!==c);h++);return b}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var b,
c={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?(c=f.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=f.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new A({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=
new y(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new A(e.fromJson(a.mosaicRule)),b=this._filterOutTimeDimension(b);a.mosaicRule=e.toJson(b.toJson())}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" "),c;for(c in b)a.hasOwnProperty(b[c])&&delete a[b[c]];return a},_filterOutTimeDimension:function(a){if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var b=
m.filter(a.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});a.multidimensionalDefinition=b}return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&m.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===
this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return m.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new x({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});
var b=this.fullExtent.getCenter(),b=new u(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_convertRendererToRenderingRule:function(a){var b=a&&a.declaredClass;if(!b||"esri.renderer.UniqueValueRenderer"!==b&&"esri.renderer.ClassBreaksRenderer"!==b&&"esri.renderer.StretchRenderer"!==b)return null;var c=null;"esri.renderer.StretchRenderer"===b?c=a.toRenderingRule():"esri.renderer.ClassBreaksRenderer"===b?c=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===
b&&(c=this._convertUniqueValueRenderer(a));return c},_getValueField:function(a){if(a&&a.length){var b,c;m.some(a,function(a){if((c=a.name)&&"value"===c.toLowerCase())return b=c,!0});return b}},_convertClassifyRenderer:function(a){var b,c=[],d=[],g=[],h;b=this.renderingRule&&this.renderingRule.functionName;var e,r,p=this.hasRasterAttributeTable,t,f;b&&(p=this._rasterFunctionTemplateInfos[b]?this._rasterFunctionTemplateInfos[b].hasRasterAttributeTable:this.hasRasterAttributeTable,r=this._renderingRuleAttributeTable[b],
f=this._rasterFunctionTemplateInfos[b]);e=r&&r.features?r.features:this._rasterAttributeTableFeatures;t=this._getValueField(r&&r.fields?r.fields:this._rasterAttributeTableFields);p&&e?(m.forEach(a.infos,function(b,c){var d,h=b.symbol.color;h.a&&m.forEach(e,function(e){d=e.attributes[a.attributeField];(d>=b.minValue&&d<b.maxValue||c===a.infos.length-1&&d>=b.minValue)&&g.push([e.attributes[t],h.r,h.g,h.b])},this)},this),b=f&&f.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(g,b),b=new y,
b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=g,b.variableName="Raster"):(m.forEach(a.infos,function(a,b){h=a.symbol&&a.symbol.color;h.a&&(c.push.call(c,a.minValue,a.maxValue),d.push(b),g.push([b,h.r,h.g,h.b]))}),b=new y,b.functionName="Remap",b.functionArguments={InputRanges:c,OutputValues:d},b.variableName="Raster",r=new y,r.functionName="Colormap",r.functionArguments={Colormap:g,Raster:b},b=r);return b},_convertUniqueValueRenderer:function(a){var b=[],c=this.renderingRule&&
this.renderingRule.functionName,d,g,h,e;c&&(g=this._renderingRuleAttributeTable[c],e=this._rasterFunctionTemplateInfos[c]);d=g&&g.features?g.features:this._rasterAttributeTableFeatures;h=this._getValueField(g&&g.fields?g.fields:this._rasterAttributeTableFields);m.forEach(a.infos,function(c){var g=c.symbol.color;g.a&&(a.attributeField!==h&&d?m.forEach(d,function(d){d.attributes[a.attributeField]==c.value&&b.push([d.attributes[h],g.r,g.g,g.b])},this):b.push([c.value,g.r,g.g,g.b]))},this);this._adjustColormapToPixelTypeRange(b,
e&&e.pixelType||this.pixelType);c=new y;c.functionName="Colormap";c.functionArguments={};c.functionArguments.Colormap=b;c.variableName="Raster";return c},_adjustColormapToPixelTypeRange:function(a,b){var c=this._pixelTypeRanges[b];c&&a.push([Math.floor(c[0]-1),0,0,0],[Math.ceil(c[1]+1),0,0,0]);return a},_combineRenderingRule:function(a,b){if(!a||!b)return a||b;var c=function(a){var b=a.Raster;return b=b&&"esri.layers.RasterFunction"===b.declaredClass?c(b.functionArguments):a},d=f.clone(a);c(d.functionArguments).Raster=
b;return d},_resolve:function(a,b,c,d,g){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&r._resDfd(d,a,g)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=l.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(l.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},
_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});d("extend-esri")&&f.setObject("layers.ImageServiceLayerMixin",q,p);return q})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(q,f,k,m,e,n){var l=q(null,
{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(d){f.isObject(d)&&(f.mixin(this,d),d.mosaicMethod&&(this.method=d.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),d.mosaicOperation&&(this.operation=d.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,
3)&&(this.operation=this._getOperatorEnum(this.operation)),d.fids&&(this.objectIds=d.fids),d.viewpoint&&(this.viewpoint=new n(d.viewpoint)),this.multidimensionalDefinition=d.multidimensionalDefinition||[])},toJson:function(){var d=null,c=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(c)for(var d=[],h=0;h<c;h++)d.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[h].declaredClass?this.multidimensionalDefinition[h].toJson():this.multidimensionalDefinition[h]);
d={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:d};return e.filter(d,function(c){if(null!==c)return!0})},_getMethodEnum:function(d){if(d){var c=l.METHOD_NONE;switch(d.toLowerCase()){case "byattribute":c=l.METHOD_ATTRIBUTE;break;case "center":c=l.METHOD_CENTER;break;
case "lockraster":c=l.METHOD_LOCKRASTER;break;case "nadir":c=l.METHOD_NADIR;break;case "northwest":c=l.METHOD_NORTHWEST;break;case "seamline":c=l.METHOD_SEAMLINE;break;case "viewpoint":c=l.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(d){if(d)switch(d.toLowerCase()){case "first":return l.OPERATION_FIRST;case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});
f.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});k("extend-esri")&&f.setObject("layers.MosaicRule",
l,m);return l})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(q,f,k,m,e){q=q(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(e){f.isObject(e)&&f.mixin(this,e)},toJson:function(){return e.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(e){return null!==
e})}});k("extend-esri")&&f.setObject("layers.DimensionalDefinition",q,m);return q})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u){var v,z,A,y,w,B;f=f(h,{declaredClass:"esri.layers.Raster",
imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,b,c){var h=this,r=new m(g._dfdCanceller);if(10>d("ie"))throw"This browser is not supported.";if(!a.imageServiceParameters)throw"Insufficient parameters to read data";
var t=k.clone(a.imageServiceParameters),f=a.pixelType;e.some(this.validPixelTypes,function(a){return a===f})||(t.pixelType="F32");e.some(this.validFormats,function(a){return a.toLowerCase()===t.format.toLowerCase()})||(t.format="lerc");var u=a.decodeFunc,l;this._prepareGetImageParameters(t);var n=t.width,x=t.height,v=t.extent;delete t.width;delete t.height;delete t.extent;r._pendingDfd=p({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:k.mixin(t,{f:"image"}),load:function(a){h.decode(a,
{width:n,height:x,planes:null,pixelType:f,noDataValue:t.noData,format:t.format,decodeFunc:u}).then(function(a){l={pixelBlock:a,extent:v};h._resolve([l,t],"onRasterReadComplete",b,r)},function(a){h._resolve([a],null,c,r,!0)})},error:function(a){h._resolve([a],null,c,r,!0)}});return r.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,d;b.format&&(c=b.format.toUpperCase());"BSQ"!==c&&"BIP"!==c&&(c=this._getFormat(a));d=b.decodeFunc;if(void 0===d||null===d)d=this._getFormatDecoderDfd(c);
return d(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(c){if(c.size&&c.bbox){var d=c.size.split(",");c.width=parseFloat(d[0]);c.height=parseFloat(d[1]);c.extent||(d=c.bbox.split(","),c.extent=new a(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),new b(c.bboxSR)))}else{if(!c.width||Math.floor(c.width)!==c.width||!c.height||Math.floor(c.height)!==c.height)throw"Incorrect Image Dimensions";if(!c.extent||"esri.geometry.Extent"!==c.extent.declaredClass)throw"Incorrect extent";
var d=c.extent,g=d.spatialReference.wkid||l.toJson(d.spatialReference.toJson());delete c._ts;k.mixin(c,{bbox:d.xmin+","+d.ymin+","+d.xmax+","+d.ymax,imageSR:g,bboxSR:g,size:c.width+","+c.height},c.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,g=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+g*b/c:a.xmax=a.xmin+d*c/b;return a},_resolve:function(a,b,c,d,h){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&g._resDfd(d,a,h)},_getFormatDecoderDfd:function(a){var b=
null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=k.hitch(this,b);return function(c,d){var g=new m;try{var h;"LERC"===a||!0===w?(h=b(c,d),g.resolve(h)):B.then(function(){h=b(c,d);g.resolve(h)})}catch(Q){g.reject(Q)}return g}},
_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b="LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||
77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var c=(new v).decode(a);if(!D(c,b))throw"The decoded image dimensions are incorrect.";var d=[],g,h;for(g=0;g<c.pixels.length;g++)h=c.pixels[g],d.push(this._calculateBandStatistics(h));
return new r({width:c.width,height:c.height,pixels:c.pixels,pixelType:"U8",mask:c.mask,statistics:d})},_decodePng:function(a,b){if(!z)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var c=new Uint8Array(a),d=new z(c),c=new Uint8Array(b.width*b.height*4);d.copyToImageData(c,d.decodePixels());for(var g=d=0,h,g=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)g[d]=c[4*d+3];for(var e=new r({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:g,statistics:[]}),
d=0;3>d;d++){h=new Uint8Array(b.width*b.height);for(g=0;g<b.width*b.height;g++)h[g]=c[4*g+d];e.addData({pixels:h,statistics:this._calculateBandStatistics(h)})}return e},_decodeBsq:function(a,b){if(!A)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);F=b.noDataValue;b.pixelType=E(b.pixelType);var c=A.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:F}),d=[],g,h=null;for(g=0;g<c.pixels.length;g++)h=c.pixels[g],d.push(this._calculateBandStatistics(h));
return new r({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);F=b.noDataValue;b.pixelType=E(b.pixelType);var c=A.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:F}),d=[],g,h=null;for(g=0;g<c.pixels.length;g++)h=c.pixels[g],d.push(this._calculateBandStatistics(h));return new r({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,
statistics:d})},_decodeTiff:function(a,b){this._validateDecodeParams(b);F=b.noDataValue;b.pixelType=E(b.pixelType);var c=y.decode(a),d=[],g,h=null;for(g=0;g<c.pixels.length;g++)h=c.pixels[g],d.push(this._calculateBandStatistics(h,c.maskData));return new r({width:c.width,height:c.height,pixels:c.pixels,pixelType:c.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);F=b.noDataValue;b.pixelType=E(b.pixelType);for(var c=0,d,g=0,h,e=a.byteLength-10;g<e;){var p=
t.decode(a,{inputOffset:g,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:x,noDataValue:F}),g=p.fileInfo.eofOffset;0===c&&(d=p.encodedMaskData,h=new r({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:p.maskData,statistics:[]}));c++;if(!D(p,b))throw"The decoded image dimensions are incorrect";h.addData({pixels:p.pixelData,statistics:{minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue}})}return h},_decodeLerc2:function(a,
b){this._validateDecodeParams(b);F=b.noDataValue;b.pixelType=E(b.pixelType);for(var c=0,d,g,h=0,e,p=a.byteLength-10;h<p;){g=u.decode(a,{inputOffset:h,maskData:d,returnFileInfo:!0});h=g.fileInfo.eofOffset;0===c&&(d=g.maskData,e=new r({width:b.width,height:b.height,pixels:[],pixelType:g.fileInfo.pixelType,mask:g.maskData,statistics:[]}));c++;if(!D(g,b))throw"The decoded image dimensions are incorrect";e.addData({pixels:g.pixelData,statistics:{minValue:g.minValue,maxValue:g.maxValue,noDataValue:g.noDataValue}})}return e},
_calculateBandStatistics:function(a,b){var c=Infinity,d=-Infinity,g=a.length,h,e=0;if(b)for(h=0;h<g;h++)b[h]&&(e=a[h],c=e<c?e:c,d=e>d?e:d);else for(h=0;h<g;h++)e=a[h],c=e<c?e:c,d=e>d?e:d;return{minValue:c,maxValue:d}},_loadRasterFormatModules:function(){w||(B||(B=new m),10>d("ie")?B.isRejected()||B.reject("unsupported browser version"):q(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,c,d){v=a;z=b;A=c;y=d;w=
!0;B.isResolved()||B.resolve(!0)}))}});var x=null,F=null,E=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return F=Math.pow(2,8)-1,x=Uint8Array,"U8";"U16"===a?(F=F||Math.pow(2,16)-1,x=Uint16Array):"U32"===a?(F=F||Math.pow(2,32)-1,x=Uint32Array):"S8"===a?(F=F||0-Math.pow(2,7),x=Int8Array):"S16"===a?(F=F||0-Math.pow(2,15),x=Int16Array):"S32"===a?(F=F||0-Math.pow(2,31),x=Int32Array):x=Float32Array;return a},D=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};d("extend-esri")&&
k.setObject("layers.Raster",f,c);return f})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,f,k,m){q=q([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(e){if(e){if(!e.width||Math.floor(e.width)!==e.width)throw"PixelBlock: incorrect width";if(!e.height||Math.floor(e.height)!==e.height)throw"PixelBlock: incorrect height";if(!e.pixels||!e.statistics)throw"PixelBlock: pixel data or statistics not present";
this.width=e.width;this.height=e.height;this.pixels=e.pixels;this.pixelType=e.pixelType||null;this.statistics=e.statistics;this.mask=e.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(e){if(!e.pixels||!e.statistics)throw"Pixel data or statistics are not present";if(e.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(e.statistics);
this.pixels.push(e.pixels)},getAsRGBA:function(){var e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)},getAsRGBAFloat:function(){var e=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(e);return e},clone:function(){var e=new this.constructor;e.width=this.width;e.height=this.height;e.pixelType=this.pixelType;
this.mask&&(e.mask=new Uint8Array(this.mask));var n,l;if(this.pixels)for(e.pixels=[],l=this.pixels.length,n=0;n<l;n++)e.pixels[n]=new Float32Array(this.pixels[n]);if(this.statistics)for(e.statistics=[],l=this.statistics.length,n=0;n<l;n++)e.statistics[n]=f.clone(this.statistics[n]);return e},_fillFrom8Bit:function(e){var f=this.pixels,l=this.mask;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var d,c,h;d=c=h=f[0];3<=f.length&&(c=f[1],h=f[2]);
var f=new Uint32Array(e),p=this.width*this.height;if(d.length!==p)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(l&&l.length===p)for(e=0;e<p;e++)l[e]&&(f[e]=-16777216|h[e]<<16|c[e]<<8|d[e]);else for(e=0;e<p;e++)f[e]=-16777216|h[e]<<16|c[e]<<8|d[e]},_fillFromNon8Bit:function(e){var f=this.pixels,l=this.mask,d=this.statistics;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var c=1,h=0;d&&0<d.length?(h=d[0].minValue,
c=255/(d[0].maxValue-d[0].minValue)):(c=255,"S8"===this.pixelType?(h=-128,c=127):"U16"===this.pixelType?c=65535:"S16"===this.pixelType?(h=-32768,c=32767):"U32"===this.pixelType?c=4294967295:"S32"===this.pixelType?(h=-2147483648,c=2147483647):"F32"===this.pixelType?(h=-3.4*1E39,c=3.4*1E39):"F64"===this.pixelType&&(h=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-h));e=new Uint32Array(e);var d=this.width*this.height,p,a,b;p=f[0];if(p.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=f.length)if(a=f[1],b=f[2],l&&l.length===d)for(f=0;f<d;f++)l[f]&&(e[f]=-16777216|(b[f]-h)*c<<16|(a[f]-h)*c<<8|(p[f]-h)*c);else for(f=0;f<d;f++)e[f]=-16777216|(b[f]-h)*c<<16|(a[f]-h)*c<<8|(p[f]-h)*c;else if(l&&l.length===d)for(f=0;f<d;f++)a=(p[f]-h)*c,l[f]&&(e[f]=-16777216|a<<16|a<<8|a);else for(f=0;f<d;f++)a=(p[f]-h)*c,e[f]=-16777216|a<<16|a<<8|a},_fillFrom32Bit:function(e){var f=this.pixels,l=this.mask;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var d,c,h;d=c=h=f[0];3<=f.length&&(c=f[1],h=f[2]);var p=this.width*this.height;if(d.length!==p)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var a=0;if(l&&l.length===p)for(f=0;f<p;f++)e[a++]=d[f],e[a++]=c[f],e[a++]=h[f],e[a++]=l[f];else for(f=0;f<p;f++)e[a++]=d[f],e[a++]=c[f],e[a++]=h[f],e[a++]=255}});k("extend-esri")&&f.setObject("layers.PixelBlock",q,m);return q})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var q={defaultNoDataValue:-3.4027999387901484E38,
decode:function(k,m){var e;m=m||{};var n=m.inputOffset||0,l=m.encodedMaskData||null===m.encodedMaskData,d={},c=new Uint8Array(k,n,10);d.fileIdentifierString=String.fromCharCode.apply(null,c);if("CntZImage"!=d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;n+=10;c=new DataView(k,n,24);d.fileVersion=c.getInt32(0,!0);d.imageType=c.getInt32(4,!0);d.height=c.getUint32(8,!0);d.width=c.getUint32(12,!0);d.maxZError=c.getFloat64(16,!0);n+=24;if(!l)if(c=new DataView(k,
n,16),d.mask={},d.mask.numBlocksY=c.getUint32(0,!0),d.mask.numBlocksX=c.getUint32(4,!0),d.mask.numBytes=c.getUint32(8,!0),d.mask.maxValue=c.getFloat32(12,!0),n+=16,0<d.mask.numBytes){var l=new Uint8Array(Math.ceil(d.width*d.height/8)),c=new DataView(k,n,d.mask.numBytes),h=c.getInt16(0,!0),p=2,a=0;do{if(0<h)for(;h--;)l[a++]=c.getUint8(p++);else for(var b=c.getUint8(p++),h=-h;h--;)l[a++]=b;h=c.getInt16(p,!0);p+=2}while(p<d.mask.numBytes);if(-32768!==h||a<l.length)throw"Unexpected end of mask RLE encoding";
d.mask.bitset=l;n+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(l=new Uint8Array(Math.ceil(d.width*d.height/8)),d.mask.bitset=l);c=new DataView(k,n,16);d.pixels={};d.pixels.numBlocksY=c.getUint32(0,!0);d.pixels.numBlocksX=c.getUint32(4,!0);d.pixels.numBytes=c.getUint32(8,!0);d.pixels.maxValue=c.getFloat32(12,!0);n+=16;l=d.pixels.numBlocksX;c=d.pixels.numBlocksY;l+=0<d.width%l?1:0;h=c+(0<d.height%c?1:0);d.pixels.blocks=Array(l*h);for(a=p=0;a<h;a++)for(b=0;b<l;b++){var g=
0,c=new DataView(k,n,Math.min(10,k.byteLength-n)),r={};d.pixels.blocks[p++]=r;var t=c.getUint8(0);g++;r.encoding=t&63;if(3<r.encoding)throw"Invalid block encoding ("+r.encoding+")";if(2===r.encoding)n++;else{if(0!==t&&2!==t){t>>=6;r.offsetType=t;if(2===t)r.offset=c.getInt8(1),g++;else if(1===t)r.offset=c.getInt16(1,!0),g+=2;else if(0===t)r.offset=c.getFloat32(1,!0),g+=4;else throw"Invalid block offset type";if(1===r.encoding)if(t=c.getUint8(g),g++,r.bitsPerPixel=t&63,t>>=6,r.numValidPixelsType=t,
2===t)r.numValidPixels=c.getUint8(g),g++;else if(1===t)r.numValidPixels=c.getUint16(g,!0),g+=2;else if(0===t)r.numValidPixels=c.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";}n+=g;if(3!=r.encoding)if(0===r.encoding){t=(d.pixels.numBytes-1)/4;if(t!==Math.floor(t))throw"uncompressed block has invalid length";c=new ArrayBuffer(4*t);g=new Uint8Array(c);g.set(new Uint8Array(k,n,4*t));c=new Float32Array(c);r.rawData=c;n+=4*t}else 1===r.encoding&&(t=Math.ceil(r.numValidPixels*r.bitsPerPixel/
8),c=new ArrayBuffer(4*Math.ceil(t/4)),g=new Uint8Array(c),g.set(new Uint8Array(k,n,t)),r.stuffedData=new Uint32Array(c),n+=t)}}d.eofOffset=n;var n=null!=m.noDataValue?m.noDataValue:q.defaultNoDataValue,h=m.encodedMaskData,u=m.returnMask,p=0,a=d.pixels.numBlocksX,b=d.pixels.numBlocksY,r=Math.floor(d.width/a),g=Math.floor(d.height/b),t=2*d.maxZError,c=Number.MAX_VALUE,v,h=h||(d.mask?d.mask.bitset:null),z,l=new (m.pixelType||Float32Array)(d.width*d.height);u&&h&&(z=new Uint8Array(d.width*d.height));
for(var u=new Float32Array(r*g),A,y,w=0;w<=b;w++){var B=w!==b?g:d.height%b;if(0!==B)for(var x=0;x<=a;x++){var F=x!==a?r:d.width%a;if(0!==F){var E=w*d.width*g+x*r,D=d.width-F,G=d.pixels.blocks[p],H,K;if(2>G.encoding){if(0===G.encoding)H=G.rawData;else{H=G.stuffedData;K=G.bitsPerPixel;v=G.numValidPixels;A=G.offset;y=t;var I=u,N=d.pixels.maxValue,L=(1<<K)-1,Q=0,V=void 0,O=0,M=void 0,P=void 0,J=Math.ceil((N-A)/y);H[H.length-1]<<=8*(4*H.length-Math.ceil(K*v/8));for(V=0;V<v;V++)0===O&&(P=H[Q++],O=32),O>=
K?(M=P>>>O-K&L,O-=K):(O=K-O,M=(P&L)<<O&L,P=H[Q++],O=32-O,M+=P>>>O),I[V]=M<J?A+M*y:N;H=u}K=0}else e=2===G.encoding?0:G.offset;var S;if(h)for(y=0;y<B;y++){E&7&&(S=h[E>>3],S<<=E&7);for(A=0;A<F;A++)E&7||(S=h[E>>3]),S&128?(z&&(z[E]=1),v=2>G.encoding?H[K++]:e,c=c>v?v:c,l[E++]=v):(z&&(z[E]=0),l[E++]=n),S<<=1;E+=D}else if(2>G.encoding)for(y=0;y<B;y++){for(A=0;A<F;A++)v=H[K++],c=c>v?v:c,l[E++]=v;E+=D}else for(c=c>e?e:c,y=0;y<B;y++){for(A=0;A<F;A++)l[E++]=e;E+=D}if(1===G.encoding&&K!==G.numValidPixels)throw"Block and Mask do not match";
p++}}}e=z;z={width:d.width,height:d.height,pixelData:l,minValue:c,maxValue:d.pixels.maxValue,noDataValue:n};e&&(z.maskData=e);m.returnEncodedMask&&d.mask&&(z.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(m.returnFileInfo&&(z.fileInfo=f(d),m.computeUsedBitDepths)){e=z.fileInfo;S=d.pixels.numBlocksX*d.pixels.numBlocksY;H={};for(K=0;K<S;K++)n=d.pixels.blocks[K],0===n.encoding?H.float32=!0:1===n.encoding?H[n.bitsPerPixel]=!0:H[0]=!0;d=Object.keys(H);e.bitDepths=d}return z}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,
fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return q})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var q={unstuff:function(f,
e,n,l,d,c,h,p){var a=(1<<n)-1,b=0,g,r=0,t,u;f[f.length-1]<<=8*(4*f.length-Math.ceil(n*l/8));if(d)for(g=0;g<l;g++)0===r&&(u=f[b++],r=32),r>=n?(t=u>>>r-n&a,r-=n):(r=n-r,t=(u&a)<<r&a,u=f[b++],r=32-r,t+=u>>>r),e[g]=d[t];else for(d=Math.ceil((p-c)/h),g=0;g<l;g++)0===r&&(u=f[b++],r=32),r>=n?(t=u>>>r-n&a,r-=n):(r=n-r,t=(u&a)<<r&a,u=f[b++],r=32-r,t+=u>>>r),e[g]=t<d?c+t*h:p},unstuffLUT:function(f,e,n,l,d,c){var h=(1<<e)-1,p=0,a=0,b=0,g=b=0,r,t=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(e*n/8));for(var u=Math.ceil((c-
l)/d),a=0;a<n;a++)0===b&&(r=f[p++],b=32),b>=e?(g=r>>>b-e&h,b-=e):(b=e-b,g=(r&h)<<b&h,r=f[p++],b=32-b,g+=r>>>b),t[a]=g<u?l+g*d:c;t.unshift(l);return t},unstuff2:function(f,e,n,l,d,c,h,p){var a=(1<<n)-1,b=0,g,r=0,t=0,u,m,k;if(d)for(g=0;g<l;g++)0===r&&(m=f[b++],r=32,t=0),r>=n?(u=m>>>t&a,r-=n,t+=n):(k=n-r,u=m>>>t&a,m=f[b++],r=32-k,u|=(m&(1<<k)-1)<<n-k,t=k),e[g]=d[u];else for(d=Math.ceil((p-c)/h),g=0;g<l;g++)0===r&&(m=f[b++],r=32,t=0),r>=n?(u=m>>>t&a,r-=n,t+=n):(k=n-r,u=m>>>t&a,m=f[b++],r=32-k,u|=(m&(1<<
k)-1)<<n-k,t=k),e[g]=u<d?c+u*h:p;return e},unstuffLUT2:function(f,e,n,l,d,c){for(var h=(1<<e)-1,p=0,a=0,b=0,g=0,r=0,t=0,u,m=[],k=Math.ceil((c-l)/d),a=0;a<n;a++)0===g&&(u=f[p++],g=32,t=0),g>=e?(r=u>>>t&h,g-=e,t+=e):(b=e-g,r=u>>>t&h,u=f[p++],g=32-b,r|=(u&(1<<b)-1)<<e-b,t=b),m[a]=r<k?l+r*d:c;m.unshift(l);return m},originalUnstuff:function(f,e,n,l){var d=(1<<n)-1,c=0,h,p=0,a,b;f[f.length-1]<<=8*(4*f.length-Math.ceil(n*l/8));for(h=0;h<l;h++)0===p&&(b=f[c++],p=32),p>=n?(a=b>>>p-n&d,p-=n):(p=n-p,a=(b&d)<<
p&d,b=f[c++],p=32-p,a+=b>>>p),e[h]=a;return e},originalUnstuff2:function(f,e,n,l){var d=(1<<n)-1,c=0,h,p=0,a=0,b,g,r;for(h=0;h<l;h++)0===p&&(g=f[c++],p=32,a=0),p>=n?(b=g>>>a&d,p-=n,a+=n):(r=n-p,b=g>>>a&d,g=f[c++],p=32-r,b|=(g&(1<<r)-1)<<n-r,a=r),e[h]=b;return e}},f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var e=65535,n=65535,l=f.length,d=Math.floor(l/2),c=0;d;){var h=359<=d?359:d,d=d-h;do e+=f[c++]<<8,n+=e+=f[c++];while(--h);e=(e&65535)+(e>>>16);n=(n&65535)+(n>>>16)}l&1&&
(n+=e+=f[c]<<8);return((n&65535)+(n>>>16)<<16|(e&65535)+(e>>>16))>>>0},readHeaderInfo:function(f,e){var n=e.ptr,l=new Uint8Array(f,n,6),d={};d.fileIdentifierString=String.fromCharCode.apply(null,l);if(0!==d.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+d.fileIdentifierString;n+=6;l=new DataView(f,n,52);d.fileVersion=l.getInt32(0,!0);n+=4;3<=d.fileVersion&&(d.checksum=l.getUint32(4,!0),n+=4);l=new DataView(f,n,48);d.height=l.getUint32(0,!0);
d.width=l.getUint32(4,!0);d.numValidPixel=l.getUint32(8,!0);d.microBlockSize=l.getInt32(12,!0);d.blobSize=l.getInt32(16,!0);d.imageType=l.getInt32(20,!0);d.maxZError=l.getFloat64(24,!0);d.zMin=l.getFloat64(32,!0);d.zMax=l.getFloat64(40,!0);n+=48;e.headerInfo=d;e.ptr=n;if(3<=d.fileVersion&&(n=this.computeChecksumFletcher32(new Uint8Array(f,n-48,d.blobSize-14)),n!==d.checksum))throw"Checksum failed.";return!0},readMask:function(f,e){var n=e.ptr,l=e.headerInfo,d=l.width*l.height,c=l.numValidPixel,h=
new DataView(f,n,4),l={};l.numBytes=h.getUint32(0,!0);n+=4;if((0===c||d===c)&&0!==l.numBytes)throw"invalid mask";if(0===c)c=new Uint8Array(Math.ceil(d/8)),l.bitset=c,h=new Uint8Array(d),e.pixels.resultMask=h,n+=l.numBytes;else if(0<l.numBytes){var c=new Uint8Array(Math.ceil(d/8)),h=new DataView(f,n,l.numBytes),p=h.getInt16(0,!0),a=2,b=0,g=0;do{if(0<p)for(;p--;)c[b++]=h.getUint8(a++);else for(g=h.getUint8(a++),p=-p;p--;)c[b++]=g;p=h.getInt16(a,!0);a+=2}while(a<l.numBytes);if(-32768!==p||b<c.length)throw"Unexpected end of mask RLE encoding";
h=new Uint8Array(d);for(a=a=p=0;a<d;a++)a&7?(p=c[a>>3],p<<=a&7):p=c[a>>3],p&128&&(h[a]=1);e.pixels.resultMask=h;l.bitset=c;n+=l.numBytes}e.ptr=n;e.mask=l;return!0},readDataOneSweep:function(m,e,n){var l=e.ptr,d=e.headerInfo,c=d.width*d.height,d=d.numValidPixel*f.getDateTypeSize(d.imageType);if(n===Uint8Array)m=new Uint8Array(m,l,d);else{var h=new ArrayBuffer(d);(new Uint8Array(h)).set(new Uint8Array(m,l,d));m=new n(h)}if(m.length===c)e.pixels.resultPixels=m;else for(e.pixels.resultPixels=new n(c),
h=h=n=0;h<c;h++)e.pixels.resultMask[h]&&(e.pixels.resultPixels[h]=m[n++]);e.ptr=l+d;return!0},readHuffman:function(m,e,n){var l=e.headerInfo,d=l.width*l.height,c=this.HUFFMAN_LUT_BITS_MAX,l=new DataView(m,e.ptr,16);e.ptr+=16;if(2>l.getInt32(0,!0))throw"unsupported Huffman version";var h=l.getInt32(4,!0),p=l.getInt32(8,!0),a=l.getInt32(12,!0);if(p>=a)return!1;var b=new Uint32Array(a-p);f.decodeBits(m,e,b);for(var g=[],r,t,l=p;l<a;l++)r=l-(l<h?0:h),g[r]={first:b[l-p],second:null};l=m.byteLength-e.ptr;
b=new ArrayBuffer(4*Math.ceil(l/4));(new Uint8Array(b)).set(new Uint8Array(m,e.ptr,l));m=new Uint32Array(b);var b=0,u,v=0;u=m[0];for(l=p;l<a;l++)r=l-(l<h?0:h),t=g[r].first,0<t&&(g[r].second=u<<b>>>32-t,32-b>=t?(b+=t,32===b&&(b=0,v++,u=m[v])):(b+=t-32,v++,u=m[v],g[r].second|=u>>>32-b));for(var q=0===e.headerInfo.imageType?128:0,A=e.headerInfo.height,y=e.headerInfo.width,w=0,B=0,x=new k,l=0;l<g.length;l++)void 0!==g[l]&&(w=Math.max(w,g[l].first));B=w>=c?c:w;30<=w&&console.log("WARning, large NUM LUT BITS IS "+
w);for(var c=[],F,l=p;l<a;l++)if(r=l-(l<h?0:h),t=g[r].first,0<t)if(u=[t,r],t<=B)for(r=g[r].second<<B-t,F=1<<B-t,p=0;p<F;p++)c[r|p]=u;else for(r=g[r].second,F=x,p=t-1;0<=p;p--)(t=r>>>p&1)?(F.right||(F.right=new k),F=F.right):(F.left||(F.left=new k),F=F.left),0!==p||F.val||(F.val=u[1]);var h=e.pixels.resultMask,E,g=a=0;0<b&&(v++,b=0);u=m[v];n=new n(d);if(e.headerInfo.numValidPixel===y*A)for(l=p=0;l<A;l++)for(r=0;r<y;r++,p++){d=0;g=E=u<<b>>>32-B;32-b<B&&(g=E|=m[v+1]>>>64-b-B);if(c[g])d=c[g][1],b+=c[g][0];
else for(g=E=u<<b>>>32-w,32-b<w&&(g=E|=m[v+1]>>>64-b-w),F=x,g=0;g<w;g++)if(F=(t=E>>>w-g-1&1)?F.right:F.left,!F.left&&!F.right){d=F.val;b=b+g+1;break}32<=b&&(b-=32,v++,u=m[v]);d-=q;d=0<r?d+a:0<l?d+n[p-y]:d+a;d&=255;a=n[p]=d}else for(l=p=0;l<A;l++)for(r=0;r<y;r++,p++)if(h[p]){d=0;g=E=u<<b>>>32-B;32-b<B&&(g=E|=m[v+1]>>>64-b-B);if(c[g])d=c[g][1],b+=c[g][0];else for(g=E=u<<b>>>32-w,32-b<w&&(g=E|=m[v+1]>>>64-b-w),F=x,g=0;g<w;g++)if(F=(t=E>>>w-g-1&1)?F.right:F.left,!F.left&&!F.right){d=F.val;b=b+g+1;break}32<=
b&&(b-=32,v++,u=m[v]);d-=q;d=0<r&&h[p-1]?d+a:0<l&&h[p-y]?d+n[p-y]:d+a;d&=255;a=n[p]=d}e.pixels.resultPixels=n;e.ptr=e.ptr+4*(v+1)+(0<b?4:0)},decodeBits:function(f,e,n,l){var d=e.headerInfo.fileVersion,c=0,h=new DataView(f,e.ptr,5),p=h.getUint8(0);c++;var a=p>>6,b=0===a?4:3-a,g=0<(p&32)?!0:!1,a=p&31,p=0;if(1===b)p=h.getUint8(c),c++;else if(2===b)p=h.getUint16(c,!0),c+=2;else if(4===b)p=h.getUint32(c,!0),c+=4;else throw"Invalid valid pixel count type";var b=2*e.headerInfo.maxZError,r,t,u;if(g){e.counter.lut++;
u=h.getUint8(c);c++;g=Math.ceil((u-1)*a/8);r=Math.ceil(g/4);r=new ArrayBuffer(4*r);t=new Uint8Array(r);e.ptr+=c;t.set(new Uint8Array(f,e.ptr,g));c=new Uint32Array(r);e.ptr+=g;for(h=0;u-1>>>h;)h++;g=Math.ceil(p*h/8);r=Math.ceil(g/4);r=new ArrayBuffer(4*r);t=new Uint8Array(r);t.set(new Uint8Array(f,e.ptr,g));f=new Uint32Array(r);e.ptr+=g;e=3<=d?q.unstuffLUT2(c,a,u-1,l,b,e.headerInfo.zMax):q.unstuffLUT(c,a,u-1,l,b,e.headerInfo.zMax);3<=d?q.unstuff2(f,n,h,p,e):q.unstuff(f,n,h,p,e)}else e.counter.bitstuffer++,
h=a,e.ptr+=c,0<h&&(g=Math.ceil(p*h/8),r=Math.ceil(g/4),r=new ArrayBuffer(4*r),t=new Uint8Array(r),t.set(new Uint8Array(f,e.ptr,g)),f=new Uint32Array(r),e.ptr+=g,3<=d?null==l?q.originalUnstuff2(f,n,h,p):q.unstuff2(f,n,h,p,!1,l,b,e.headerInfo.zMax):null==l?q.originalUnstuff(f,n,h,p):q.unstuff(f,n,h,p,!1,l,b,e.headerInfo.zMax))},readTiles:function(m,e,n){var l=e.headerInfo,d=l.width,c=l.height,h=l.microBlockSize,l=l.imageType,p=Math.ceil(d/h),a=Math.ceil(c/h);e.pixels.numBlocksY=a;e.pixels.numBlocksX=
p;for(var b=e.pixels.ptr=0,g=0,r=0,t=0,u=0,k=0,q=0,A=0,y=b=0,w=0,B=0,q=q=b=q=0,x,F=new n(h*h),c=c%h||h,E=d%h||h,r=0;r<a;r++)for(u=r!==a-1?h:c,t=0;t<p;t++){k=t!==p-1?h:E;w=r*d*h+t*h;B=d-k;q=m.byteLength-e.ptr;g=new DataView(m,e.ptr,Math.min(10,q));x={};q=0;A=g.getUint8(0);q++;b=A>>6&255;y=A>>2&15;if(y!==(t*h>>3&15))throw"integrity issue";A&=3;if(3<A)throw e.ptr+=q,"Invalid block encoding ("+A+")";if(2===A)e.counter.constant++,e.ptr+=q;else if(0===A){e.counter.uncompressed++;e.ptr+=q;q=u*k*f.getDateTypeSize(l);
b=m.byteLength-e.ptr;q=q<b?q:b;b=new ArrayBuffer(q);g=new Uint8Array(b);g.set(new Uint8Array(m,e.ptr,q));x=new n(b);q=0;if(e.pixels.resultMask)for(b=0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultMask[w]&&(e.pixels.resultPixels[w]=x[q++]),w++;w+=B}else for(b=0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultPixels[w++]=x[q++];w+=B}e.ptr+=q*f.getDateTypeSize(l)}else if(b=f.getDataTypeUsed(l,b),x=f.getOnePixel(x,q,b,g),q+=f.getDateTypeSize(b),3===A)if(e.ptr+=q,e.counter.constantoffset++,e.pixels.resultMask)for(b=
0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultMask[w]&&(e.pixels.resultPixels[w]=x),w++;w+=B}else for(b=0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultPixels[w++]=x;w+=B}else if(e.ptr+=q,f.decodeBits(m,e,F,x),q=0,e.pixels.resultMask)for(b=0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultMask[w]&&(e.pixels.resultPixels[w]=F[q++]),w++;w+=B}else for(b=0;b<u;b++){for(g=0;g<k;g++)e.pixels.resultPixels[w++]=F[q++];w+=B}}},formatFileInfo:function(m){return{fileIdentifierString:m.headerInfo.fileIdentifierString,fileVersion:m.headerInfo.fileVersion,
imageType:m.headerInfo.imageType,height:m.headerInfo.height,width:m.headerInfo.width,numValidPixel:m.headerInfo.numValidPixel,microBlockSize:m.headerInfo.microBlockSize,blobSize:m.headerInfo.blobSize,maxZError:m.headerInfo.maxZError,pixelType:f.getPixelType(m.headerInfo.imageType),eofOffset:m.eofOffset,mask:m.mask?{numBytes:m.mask.numBytes}:null,pixels:{numBlocksX:m.pixels.numBlocksX,numBlocksY:m.pixels.numBlocksY,maxValue:m.headerInfo.zMax,minValue:m.headerInfo.zMin,noDataValue:m.noDataValue}}},
constructConstantSurface:function(f){var e=f.headerInfo.zMax,n=f.headerInfo.height*f.headerInfo.width,l=0;if(f.pixels.resultMask)for(l=0;l<n;l++)f.pixels.resultMask[l]&&(f.pixels.resultPixels[l]=e);else for(l=0;l<n;l++)f.pixels.resultPixels[l]=e},getDataTypeArray:function(f){switch(f){case 0:f=Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=
Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,e){if(null===e||void 0===e)return!1;var n;switch(f){case 0:n=-128<=e&&127>=e;break;case 1:n=0<=e&&255>=e;break;case 2:n=-32768<=e&&32767>=e;break;case 3:n=0<=e&&65536>=e;break;case 4:n=-2147483648<=e&&2147483647>=e;break;case 5:n=
0<=e&&4294967296>=e;break;case 6:n=-3.4027999387901484E38<=e&&3.4027999387901484E38>=e;break;case 7:n=4.9E-324<=e&&1.7976931348623157E308>=e;break;default:n=!1}return n},getDateTypeSize:function(f){var e=0;switch(f){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=f}return e},getDataTypeUsed:function(f,e){var n=f;switch(f){case 2:case 4:n=f-e;break;case 3:case 5:n=f-2*e;break;case 6:n=0===e?f:1===e?2:1;break;case 7:n=0===e?f:f-2*e+1;break;default:n=
f}return n},getOnePixel:function(f,e,n,l){f=0;switch(n){case 0:f=l.getInt8(e);break;case 1:f=l.getUint8(e);break;case 2:f=l.getInt16(e,!0);break;case 3:f=l.getUint16(e,!0);break;case 4:f=l.getInt32(e,!0);break;case 5:f=l.getUInt32(e,!0);break;case 6:f=l.getFloat32(e,!0);break;case 7:f=l.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},k=function(f,e,n){this.val=f;this.left=e;this.right=n};return{decode:function(m,e){e=e||{};var n=e.maskData||null===
e.maskData,l=e.noDataValue,d=0,c={};c.ptr=e.inputOffset||0;c.pixels={};if(f.readHeaderInfo(m,c)){var d=c.headerInfo,h=f.getDataTypeArray(d.imageType);if(n)c.pixels.resultMask=e.maskData,c.ptr+=4;else if(!f.readMask(m,c))return;n=d.width*d.height;c.pixels.resultPixels=new h(n);c.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==d.numValidPixel)if(d.zMax===d.zMin)f.constructConstantSurface(c);else{var p=new DataView(m,c.ptr,2),a=p.getUint8(0,!0);c.ptr++;a?f.readDataOneSweep(m,
c,h):1<d.fileVersion&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)?(p=p.getUint8(1,!0),c.ptr++,p?f.readHuffman(m,c,h):f.readTiles(m,c,h)):f.readTiles(m,c,h)}c.eofOffset=c.ptr;e.inputOffset?(h=c.headerInfo.blobSize+e.inputOffset-c.ptr,1<=Math.abs(h)&&(c.eofOffset=e.inputOffset+c.headerInfo.blobSize)):(h=c.headerInfo.blobSize-c.ptr,1<=Math.abs(h)&&(c.eofOffset=c.headerInfo.blobSize));h={width:d.width,height:d.height,pixelData:c.pixels.resultPixels,minValue:d.zMin,maxValue:d.zMax,maskData:c.pixels.resultMask};
if(c.pixels.resultMask&&f.isValidPixelValue(d.imageType,l)){p=c.pixels.resultMask;for(d=0;d<n;d++)p[d]||(h.pixelData[d]=l);h.noDataValue=l}c.noDataValue=l;e.returnFileInfo&&(h.fileInfo=f.formatFileInfo(c));return h}},getBandCount:function(m){for(var e=0,n=0,l={ptr:0,pixels:{}};n<m.byteLength-58;)f.readHeaderInfo(m,l),n+=l.headerInfo.blobSize,e++,l.ptr=n;return e}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(q,f,k,m,e,n){q=q(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(e){f.mixin(this,e);this.isDataUV=e&&e.isDataUV?e.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(e,d){this.inputUnit=e;this.outputUnit=d;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var e=n.indexOf(this.speedUnits,this.inputUnit),d=n.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=e&&0<=d){var c=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=c[e]/c[d]}},computeMagnitudeAndDirection:function(f){if(!e.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var d=f.pixelBlock;if(!e.isDefined(d)||2!==d.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var c=f.extent,h=(c.xmax-c.xmin)/d.width,p=(c.ymax-c.ymin)/d.height,a=c.xmin+h/2,c=c.ymax-p/2;d.statistics[0].minValue=0;d.statistics[0].maxValue=0;var b=180/Math.PI,g=[],r=0,t=0,u=0,l=!e.isDefined(d.mask),n,m,k,q,B,x,F,E;B=F=Infinity;x=E=-Infinity;for(r=0;r<d.height;r++)for(t=0;t<d.width;t++,u++)if(g.push([a+h*t,c-p*r]),l||d.mask[u])k=n=d.pixels[0][u]*this.unitConversionFactor,q=m=d.pixels[1][u],this.isDataUV&&(k=Math.sqrt(n*n+m*m),q=90-b*Math.atan2(m,n),d.pixels[0][u]=k*this.unitConversionFactor,
d.pixels[1][u]=q),k>x&&(x=k),k<B&&(B=k),q>E&&(E=q),q<F&&(F=q);d.statistics[0].maxValue=x;d.statistics[0].minValue=B;d.statistics[1].maxValue=E;d.statistics[1].minValue=F;f.locations=g;return f}});k("extend-esri")&&f.setObject("layers.pixelFilters.VectorFieldPixelFilter",q,m);return q})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(q,f,k,m){var e;return f(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},
decode:function(e,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";var d=new k,c,h=new Uint8Array(e),p=this._getFormat(e);if("error"===p)throw"invalid format";"jpeg"===p&&(c=this._getMask(h,f));var a="",b,g;for(b=0;b<h.length;b+=65535)g=h.subarray(b,b+65535>h.length-1?h.length-1:b+65535),a+=String.fromCharCode.apply(null,g);var h="data:image/"+p+";base64,"+window.btoa(a),r=new Image,t;r.src=h;var u=this;r.onload=function(){u.ctx.clearRect(0,0,f.width,f.height);
u.ctx.drawImage(r,0,0);var a=u.ctx.getImageData(0,0,r.width,r.height);t=a.data;if(c)for(b=0;b<c.length;b++)t[4*b+3]=c[b]?255:0;u.ctx.putImageData(a,0,0);d.resolve(null)};r.onerror=function(){d.reject("cannot load image")};return d},_getFormat:function(e){e=new Uint8Array(e,0,10);var f="error";255===e[0]&&216===e[1]?f="jpeg":137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&(f="png");return f},_getMask:function(f,l){var d;try{if(!e)throw"The zlib decoder module is not loaded.";var c=0,h=0,p=Math.round(f.length/
2);1===p%2&&(p+=1);for(var a=f.length-2,c=p;c<a&&(255!==f[c]||217!==f[c+1]);c++);p=c+=2;if(p<f.length-1){var b=(new e(f.subarray(p))).getBytes();d=new Uint8Array(l.width*l.height);for(c=p=0;c<b.length;c++)for(h=7;0<=h;h--)d[p++]=b[c]>>h&1}}catch(g){}return d},_loadRasterFormatModule:function(){10>m("ie")||q(["./Zlib"],function(f){e=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(q,f,k,m,e,n,l,d){q=q(l,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(c){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,h,e,a,b){try{var g=new d(c);this._successHandler([g],"onComplete",e,b)}catch(r){this._errorHandler(r,a,b)}},execute:function(c,d,p,a){var b=a.assembly;c=this._encode(f.mixin({},this._url.query,{f:"json"},c.toJson(b&&b[0])));var g=this._handler,
h=this._errorHandler;return e({url:this._url.path,content:c,callbackParamName:"callback",load:function(b,c){g(b,c,d,p,a.dfd)},error:function(b){h(b,p,a.dfd)}})},onComplete:function(){}});n._createWrappers(q);k("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",q,m);return q})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(q,f,k,m,e,n){q=q(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",
constructor:function(f){f.catalogItems&&(this.catalogItems=new n(f.catalogItems));f.location&&(this.location=e.fromJson(f.location));this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}});k("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",q,m);return q})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(q,f,k,m,e,n,l,d){q=q(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(c){var h=c&&c.geometry||this.geometry;c={geometry:h,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?k.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?
k.toJson(this.renderingRule.toJson()):null};h&&(c.geometryType=d.getJsonType(h));h=this.timeExtent;c.time=h?h.toJson().join(","):null;l.isDefined(this.pixelSizeX)&&l.isDefined(this.pixelSizeY)?c.pixelSize=k.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?k.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(c.renderingRules=k.toJson(m.map(this.renderingRules,function(c){return c.toJson()})));return c}});e("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",
q,n);return q})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(q,f,k){var m;return q(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(e){this.stretchType=e.stretchType||e.StretchType||this.stretchType;this.min=e.min||e.Min||this.min;this.max=e.max||
e.Max||this.max;this.numberOfStandardDeviations=e.numberOfStandardDeviations||e.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=e.statistics||e.Statistics||this.statistics;this.dra=e.dra||e.DRA||e.dRA||this.dra;this.minPercent=e.minPercent||e.MinPercent||this.minPercent;this.maxPercent=e.maxPercent||e.MaxPercent||this.maxPercent;this.useGamma=e.useGamma||e.UseGamma||this.useGamma;this.gamma=e.gamma||e.Gamma||this.gamma;this.computeGamma=e.computeGamma||e.ComputeGamma||
this.computeGamma;this.raster=e.raster||e.Raster||this.raster;this.outputPixelType=e.outputPixelType||e.OutputPixelType||this.outputPixelType;this.raster=e.raster||e.Raster||this.raster;m=this},filter:function(e){if(null!==e&&null!==e.pixelBlock&&null!==e.pixelBlock.pixels){var f=e.pixelBlock,l=f.pixels,d=f.width*f.height,c=l.length,h;(h=6===m.stretchType||3===m.stretchType&&m.dra)&&m._calculateStatisticsHistograms(e);if(m.dra)if(h)m._statistics=f.statistics,m._histograms=f.histograms;else{var p=
f.statistics;m._statistics=[];for(h=0;h<c;h++)m._statistics[h]=[p[h].minValue,p[h].maxValue,0,0]}else m._statistics=m.statistics,m._histograms=m.histograms;m.computeGamma&&(m.gamma=m._computeGammaValues(f.pixelType),m.useGamma=!0);m._createLUT(e);if(void 0===m.LUT||null===m.LUT)return m._filterNoLUT(e);var p=m.LUT,a=m.LUTOffset,b,g;for(h=0;h<c;h++)for(g=p[h],f=0;f<d;f++)b=l[h][f],l[h][f]=g[b-a];e.pixelBlock.pixelType="U8";return e}},_calculateStatisticsHistograms:function(e){e=e.pixelBlock;var n=
e.pixelType,l=e.pixels,d=e.mask,c=l.length,h,p,a,b,g=function(a){this.min=-.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},r=[],t,u,m,k,q,y;for(a=0;a<c;a++){t=new g;u=t.counts;k=l[a];if("U8"===n)if(d)for(b=0;b<e.width*e.height;b++)d[b]&&u[k[b]]++;else for(b=0;b<e.width*e.height;b++)u[k[b]]++;else{h=e.statistics[a].minValue;p=e.statistics[a].maxValue;t.min=h;t.max=p;p=(p-h)/256;m=new Uint32Array(257);if(d)for(b=0;b<e.width*e.height;b++)d[b]&&m[Math.floor((k[b]-
h)/p)]++;else for(b=0;b<e.width*e.height;b++)m[Math.floor((k[b]-h)/p)]++;for(b=0;255>b;b++)u[b]=m[b];u[255]=m[255]+m[256]}r.push(t);k=[];h=e.statistics[a].minValue;p=e.statistics[a].maxValue;for(b=y=q=m=0;b<t.size;b++)m+=u[b],q+=b*u[b];q/=m;for(b=0;b<t.size;b++)y+=u[b]*Math.pow(b-q,2);u=Math.sqrt(y/(m-1));b=(q+.5)*(t.max-t.min)/t.size+t.min;t=u*(t.max-t.min)/t.size;k.push(h);k.push(p);k.push(b);k.push(t);e.statistics[a]=k}e.histograms=r},_getCutOffPoints:function(e){e=e.pixelBlock.pixels.length;var f=
[],l=[],d,c,h,p,a,b;switch(m.stretchType){case 5:for(a=0;a<e;a++)f[a]=m._statistics[a][0],l[a]=m._statistics[a][1];break;case 3:for(a=0;a<e;a++)f[a]=m._statistics[a][2]-m.numberOfStandardDeviations*m._statistics[a][3],l[a]=m._statistics[a][2]+m.numberOfStandardDeviations*m._statistics[a][3],f[a]<m._statistics[a][0]&&(f[a]=m._statistics[a][0]),l[a]>m._statistics[a][1]&&(l[a]=m._statistics[a][1]);break;case 6:for(a=0;a<e;a++){d=m._histograms[a];p=new Uint32Array(d.size);h=d.counts;for(b=c=0;b<d.size;b++)c+=
h[b],p[b]=c;h=m.minPercent*c/100;for(b=1;b<d.size;b++)if(p[b]>h){f[a]=d.min+(d.max-d.min)/d.size*(b-.5);break}h=(1-m.maxPercent/100)*c;for(b=d.size-2;0<=b;b--)if(p[b]<h){l[a]=d.min+(d.max-d.min)/d.size*(b+.5);break}}break;default:for(a=0;a<e;a++)f[a]=0,l[a]=255}return{minCutOff:f,maxCutOff:l}},_createLUT:function(e){var f=e.pixelBlock,l=f.pixelType;if("U8"===l||"U16"===l||"S8"===l||"S16"===l){if(m._LUTSignature&&(l=m._computeLutSignature(),l.length===m._LUTSignature.length&&!l.some(function(a,b){return a!==
m._LUTSignature[b]})))return;var l=f.pixels.length,d=[],c=[],h=[],p,a,b,g=m.max,r=m.min,t=m.gamma,u=g-r,k=m._getCutOffPoints(e);e=k.minCutOff;var k=k.maxCutOff,q=0,A=256,y;"S8"===f.pixelType?q=-127:"S16"===f.pixelType&&(q=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)A=65536;for(f=0;f<l;f++)d[f]=k[f]-e[f];if(m.useGamma&&null!==t&&t.length===l)for(f=0;f<l;f++)h[f]=1<t[f]?2<t[f]?6.5+Math.pow(t[f]-2,2.5):6.5+100*Math.pow(2-t[f],4):1;if(m.useGamma)for(var w,f=0;f<l;f++){y=[];for(p=0;p<A;p++)a=p+
q,w=(a-e[f])/d[f],b=1,1<t[f]&&(b-=Math.pow(1/u,w*h[f])),a<k[f]&&a>e[f]?y[p]=Math.floor(b*u*Math.pow(w,1/t[f]))+r:a>k[f]?y[p]=g:a<e[f]&&(y[p]=r);c[f]=y}else for(f=0;f<l;f++){y=[];for(p=0;p<A;p++)a=p+q,y[p]=a<e[f]?r:a>k[f]?g:Math.floor((a-e[f])/d[f]*u)+r;c[f]=y}m.LUT=c;m.LUTOffset=q;m._LUTSignature=m._computeLutSignature()}},_computeLutSignature:function(){var e=[],f,l;e.push(m.stretchType);e.push(m.min);e.push(m.max);e.push(m.numberOfStandardDeviations);if(m._statistics)for(f=0;f<m._statistics.length;f++)for(l=
0;l<m._statistics[f].length;l++)e.push(m._statistics[f][l]);e.push(m.dra?1:0);e.push(m.minPercent);e.push(m.maxPercent);if(m.gamma)for(f=0;f<m._statistics.length;f++)e.push(m.gamma[f]);e.push(m.useGamma?1:0);return e},_filterNoLUT:function(e){if(null!==e&&null!==e.pixelBlock&&null!==e.pixelBlock.pixels){var f=e.pixelBlock,l=f.pixels,d=f.mask,f=f.width*f.height,c=l.length,h=[],p=[],a,b,g,r,t,u=m.max,k=m.min,q=m.gamma,A=u-k;a=m._getCutOffPoints(e);var y=a.minCutOff,w=a.maxCutOff;for(a=0;a<c;a++)h[a]=
w[a]-y[a];if(m.useGamma&&null!==q&&q.length===c)for(a=0;a<c;a++)p[a]=1<q[a]?2<q[a]?6.5+Math.pow(q[a]-2,2.5):6.5+100*Math.pow(2-q[a],4):1;if(m.useGamma)if(void 0!==d&&null!==d)for(b=0;b<f;b++){if(d[b])for(a=0;a<c;a++)g=l[a][b],t=(g-y[a])/h[a],r=1,1<q[a]&&(r-=Math.pow(1/A,t*p[a])),g<w[a]&&g>y[a]?l[a][b]=Math.floor(r*A*Math.pow(t,1/q[a]))+k:g>w[a]?l[a][b]=u:g<y[a]&&(l[a][b]=k)}else for(b=0;b<f;b++)for(a=0;a<c;a++)g=l[a][b],t=(g-y[a])/h[a],r=1,1<q[a]&&(r-=Math.pow(1/A,t*p[a])),g<w[a]&&g>y[a]?l[a][b]=
Math.floor(r*A*Math.pow(t,1/q[a]))+k:g>w[a]?l[a][b]=u:g<y[a]&&(l[a][b]=k);else if(void 0!==d&&null!==d)for(b=0;b<f;b++){if(d[b])for(a=0;a<c;a++)g=l[a][b],g<w[a]&&g>y[a]?l[a][b]=Math.floor((g-y[a])/h[a]*A)+k:g>w[a]?l[a][b]=u:g<y[a]&&(l[a][b]=k)}else for(b=0;b<f;b++)for(a=0;a<c;a++)g=l[a][b],g<w[a]&&g>y[a]?l[a][b]=Math.floor((g-y[a])/h[a]*A)+k:g>w[a]?l[a][b]=u:g<y[a]&&(l[a][b]=k);e.pixelBlock.pixelType="U8";return e}},_computeGammaValues:function(e){var f=this._statistics.length,l,d=[],c;for(l=0;l<
f;l++)c=this._statistics[l][2],"U8"!==e&&(c=255*(c-this._statistics[l][0])/(this._statistics[l][1]-this._statistics[l][0])),d.push(this._computeGammaValue(c));return d},_computeGammaValue:function(e){if(0!==e&&!(255<e||0>e)){var f=0;0<e&&150!=e&&255>e&&(f=150>=e?45*Math.cos(.01047*e):17*Math.sin(.021*e));f=Math.log((e+f)/255);if(0!==f&&(e=Math.log(e/255)/f,!isNaN(e)))return Math.min(9.9,Math.max(.01,e))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w){q=q([g],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(b,c){c=c||{};c.mode&&c.mode!==g.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=g.MODE_STREAM,this._mode=new r(this));this.purgeOptions=new w(this,c.purgeOptions||{});this.purgeInterval=c.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=e.hitch(this,this._attemptReconnect);this._purge=e.hitch(this,this._purge);this._processServiceJson=e.hitch(this,this._processServiceJson);if(e.isObject(b)&&b.layerDefinition)this._initFeatureLayer(b,c);else{var d=this;a({url:b,content:e.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){d._processServiceJson(a,c)},function(a){d._errorHandler(a)})}},_processServiceJson:function(b,
c){var d=this;b.relatedFeatures&&b.relatedFeatures.featuresUrl&&b.relatedFeatures.joinField?(this._relatedUrl=b.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=b.relatedFeatures.joinField,a({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(a){a=a.fields||[];var g=k.map(b.fields,function(a){return a.name.toLowerCase()});k.forEach(a,function(a){-1===k.indexOf(g,a.name.toLowerCase())&&b.fields.push(a)});c.resourceInfo=b;d._initFeatureLayer(d._url,c)},
function(a){d.onError({error:a})})):(c.resourceInfo=b,this._initFeatureLayer(this._url,c))},_initLayer:function(a,b){this.inherited(arguments);if(a){var c;if(a.layerDefinition)this.purgeOptions=new w(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var d=this._getWebsocketConnectionInfo(a),g=d.urls;g&&g.length?(this._socketUrls=g,this.socketUrl=g[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=d.token,g.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=g.length)):(this.socketUrl=void 0,d="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(d+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(d)))}if(this._params.filter)try{this._filter=
c=this._makeFilter(this._params.filter)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_setMap:function(a){var b=this.inherited(arguments),c=this._getRenderer();this.timeInfo&&(this._trackIdField||c&&(c.latestObservationRenderer||c.trackRenderer))&&(this._trackManager=new t(this),this._trackManager.initialize(a));this.socketUrl&&!this._connected&&this._map&&this.connect();return b},_unsetMap:function(a,b){k.forEach(this._connects,f.disconnect);
(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&this._mode._clearFeatureMap(),this._trackManager&&
this._trackManager.clearTracks()}catch(B){}this.inherited(arguments)},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},
getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=new n,c={},g=this._filter,h,e,f=this.socketUrl,r;try{this._connected||this._connecting?b.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&(c.token=this._websocketToken);this._map&&this._map.spatialReference&&
this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(g)for(e in g)null!==g[e]&&(h="geometry"===e?JSON.stringify(g[e]):g[e],c[e]=h);f+="?"+d.objectToQuery(c);r=this._createConnection(f,a);b.resolve(r)}.bind(this)).otherwise(function(a){b.reject(a)}))}catch(I){a&&(a(I,!1),b.reject(I)),this.onConnectionError({error:I})}return b.promise},disconnect:function(a){var b=this._refreshing?"Disconnecting as part of layer refresh cycle":
"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:c,message:b});a&&a(null,!0)},setFilter:function(a){var b,d;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==a.outFields)return d=Error("Outfields property cannot be changed after layer is created"),
this.onFilterChange({filter:this.getFilter(),error:d}),!1;b=this._makeFilter(a)}catch(E){return d=Error(E),this.onFilterChange({filter:this.getFilter(),error:d}),!1}if(this.socket)a={filter:b},this.socket.send(JSON.stringify(a));else c.once(this,"connect",function(a){this.setFilter(b)});return!0},getFilter:function(){var a=this._filter,b={},c=["geometry","outFields","where"];a&&k.forEach(c,function(c){var d=a[c];d&&("geometry"===c?d=u.fromJson(d):"outFields"===c&&(d=d.split(",")),b[c]=d)});return b},
setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,c={},d=[];b=this._getField(a,!0);if(!b)return d;a=b.name;k.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0===b||c[b]||(c[b]=1,d.push(b))});d.sort(function(a,b){return a<b?-1:a>b?1:0});return d},getLatestObservations:function(){var a=[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=
this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){b.updating||b.suspended||(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},
onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,b){var c=this,d=new WebSocket(a);d.onopen=function(){c.socket=d;c._connected=!0;c._connecting=!1;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();b&&b(null,!0)};d.onclose=function(a){var b,d=!0,g=c._connected,h=null;if(c._connected||c._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=
a.reason||"Service is going away.",d=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",d=!1;else if(4404===a.code)b+="Service not found",d=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",d=!1;d&&(c._reconnectAttempts+=1,c._reconnectAttempts>c.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",d=!1,g=!0));c._connected=!1;g&&(b&&(h=Error(b)),c.onDisconnect({error:h,willReconnect:d}));d?c._attemptReconnect():c.socket=null}else c.socket||
(h=Error("Could not make connection to service"),c.onConnectionError({error:h})),c.socket=null,c._connected=!1};d.onerror=function(a){console.log("Socket error")};return d},_getKeepLatestFeatures:function(){var a=new n;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?(Date.now(),this._mode._fetchArchive(this._keepLatestUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._keepLatestQueried=!0}.bind(this))):a.resolve();
return a.promise},_getRelatedFeatures:function(){var a=new n;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?(Date.now(),this._mode._fetchArchive(this._relatedUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._relatedQueried=!0}.bind(this))):a.resolve();return a.promise},_purge:function(){var a,b=[],c;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-
this.purgeOptions.displayCount;a++)c=this.graphics[a],b.push(c);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var c={create:function(a){b._create(a)},update:function(a){b._update(a)},"delete":function(a){b._delete(a)}};if(a.type)c[a.type](a.feature);else a.hasOwnProperty("filter")?b._handleFilterMessage(a):
this._create(a)},_create:function(a){function c(a){if(!d._featureHasOID(a,g)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[g]=d._nextId++}a=a.declaredClass?a:new b(a);d._mode.drawFeature(a)}var d=this,g=d.objectIdField;a.length?a.forEach(function(a){a&&c(a)}):a&&c(a)},_delete:function(a){var b=this,c=a[b.objectIdField]||a.attributes[b.objectIdField],d=!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==c&&(d=a)});d&&this.remove(d)},_update:function(a){var b=this,
c=!1;this.graphics.forEach(function(d){d.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(c=d)});c&&(a.attributes&&c.setAttributes(a.attributes),a.geometry&&c.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var b,c=null;a=a||{};if(void 0!==a.geometry)if(c=c||{},null===a.geometry)c.geometry=null;else{b="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";
"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";c.spatialRel="esriSpatialRelIntersects";c.geometryType="esriGeometryEnvelope";c.geometry=b.toJson()}void 0!==a.where&&(c=c||{},c.where=a.where);if(void 0!==a.outFields&&(c=c||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");c.outFields=a.fields?a.fields.join(","):null}return c},_makeOutFields:function(a){var b=this,c=[],d=[],g={fields:null};if(!a||0===a.length)return g;k.forEach(a,function(a){if("*"===a)return g;var h=b._getField(a,!0);h?c.push(h.name):d.push("Field named "+a+" not found in schema.")});a=b._getOutFields();k.forEach(a,function(a){b._getField(a)&&-1===k.indexOf(c,a)&&c.push(a)});g.fields=c;g.errors=d;return g},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},c,d=[],g=[],h,e,f;a.streamUrls&&k.forEach(a.streamUrls,function(a){"ws"===a.transport&&(c=a.urls,b.token=a.token)});if(!c)return b;k.forEach(c,function(a){0===a.lastIndexOf("wss",0)?g.push(a):d.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?g:0===d.length?g:d;if(1<a.length)for(h=0;h<a.length-1;h++)e=h+Math.floor(Math.random()*(a.length-h)),f=a[e],a[e]=a[h],a[h]=f;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(b){var c=this,d=c._url.path;b="function"===typeof b?b:
null;a({url:d,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(a){a=c._getWebsocketConnectionInfo(a);c._websocketToken=a.token;b&&b()},function(a){c.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new m([5,112,176,.8]),c=new m([255,255,255]),c=new z(z.STYLE_SOLID,c,1),d;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)d=new A(A.STYLE_CIRCLE,10,c,b);else if("esriGeometryPolyline"===a)d=new z(z.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)b=new m([5,112,176,.2]),c=new m([5,112,176,.8]),c=new z(z.STYLE_SOLID,c,1),d=new v(v.STYLE_SOLID,c,b);d&&this.setRenderer(new y(d))},_makeObjectIdField:function(){var a=1,b,c,d=[];if(!this.objectIdField){b=this.fields.length;for(c=0;c<b;c++)d.push(this.fields[c].name.toLowerCase());for(;-1!==k.indexOf(d,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});l("extend-esri")&&e.setObject("layers.StreamLayer",q,p);return q})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./TrackManager".split(" "),function(q,f,k,m,e,n,l,d){q=q([d],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(c){this.inherited(arguments)},
initialize:function(c){this.inherited(arguments)},addFeatures:function(c,d){function h(b,c){var d,g,h,f;a[b]||(a[b]=[]);d=a[b];0<e&&(c.length>e&&c.splice(0,c.length-e),h=c.length+d.length,h>e&&(g=d.splice(0,h-e)));h=c.length;for(f=0;f<h;f+=1)d.push(c[f]);return{deletes:g,adds:c}}var a,b,g,e,f={},u={},l;if(d)return this.inherited(arguments),f;a=this.trackMap;b=this.layer;g=b._trackIdField;e=b.maximumTrackPoints||0;k.forEach(c,function(a){var b=a.attributes[g];a.visible&&(u[b]||(u[b]=[]),u[b].push(a))});
for(l in u)u.hasOwnProperty(l)&&(b=h(l,u[l]),f[l]=b);return f},removeFeatures:function(c){var d=[],e=this.layer.objectIdField,a=this.layer._trackIdField;c&&(k.forEach(c,function(b){var c,h,f,p;h=b.attributes[a];c=b.attributes[e];if(f=this.trackMap[h])for(b=0;b<f.length;b+=1)if(p=f[b],p.attributes[e]===c){this.trackMap[h].splice(b,1);-1===k.indexOf(h)&&d.push(h);break}},this),0<c.length&&this.refreshTracks(d))},drawTracks:function(c){function d(c){var d=b[c],h=d&&1<d.length,r,p,t;(t=e.trackLineMap[c])&&
!h&&(a.remove(t),delete e.trackLineMap[c],t=null);if(!h)return!1;h=[];for(r=d.length-1;0<=r;--r)(p=d[r].geometry)&&h.push([p.x,p.y]);d={};d[f]=c;1<h.length&&(t?(c=t.geometry,c.removePath(0),c.addPath(h),t.setGeometry(c)):(t=new n(new l({paths:[h],spatialReference:g}),null,d),a.add(t),e.trackLineMap[c]=t))}var e=this,a=this.container,b,g,f,t;if(a)if(b=this.trackMap,g=this.map.spatialReference,f=this.layer._trackIdField,c)k.forEach(c,function(a){d(a)});else for(t in b)b.hasOwnProperty(t)&&d(t)},refreshTracks:function(c){function d(b){var c,
d;b=e[b]||[];c=b.length;for(d=0;d<c;d++)a._repaint(b[d],null,!0)}var e=this.trackMap,a=this.layer;a._getRenderer();var b;this.drawTracks(c);if(c)k.forEach(c,function(a){d(a)});else for(b in e)e.hasOwnProperty(b)&&d(b)},getLatestObservations:function(){var c,d,e=this.trackMap,a=[];for(c in e)e.hasOwnProperty(c)&&(d=e[c],a.push(d[d.length-1]));return a},destroy:function(){this.inherited(arguments);this.trackLineMap=null}});m("extend-esri")&&f.setObject("layers._StreamTrackManager",q,e);return q})},
"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(q,f,k,m,e){q=q([k],{declaredClass:"esri.layers.PurgeOptions",constructor:function(e,f){this.parent=e;for(var d in f)this[d]=f[d]},_displayCountSetter:function(e){this.displayCount=e;this.parent.refresh()}});m("extend-esri")&&f.setObject("layers.PurgeOptions",q,e);return q})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(q,f,k,m,e,n,l){q=q([n,l],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(d,c){this._initialize(d,c);this.useMapImage=c&&c.useMapImage||!1},refresh:function(d){if(d)this.inherited(arguments);else{var c=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=c}},setRenderer:function(d,c){this.renderer=d;this.onRendererChange();c||this.refresh(!0)},exportMapImage:function(d,c){var h=e.defaults.map,h=f.mixin({size:h.width+
","+h.height},this._params,d?d.toJson(this.normalization):{},{f:"json"});delete h._ts;this._exportMapImage(this._url.path+"/exportImage",h,c)}});k("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",q,m);return q})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){q=q([d,c],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,b){this.symbolTileSize=b&&b.symbolTileSize?b.symbolTileSize:50;this._maxMag=this._minMag=null;var c=f.clone(this._params);delete c.imageServiceParameters;delete c.pixelFilter;delete c.rendererStyle;delete c.symbolTileSize;this._initialize(a,b);this.renderer||this.setVectorRendererStyle(b&&b.rendererStyle?b.rendererStyle:h.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";f.mixin(this._params,c)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(a){if(10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(!1===this.hasMultidimensions)this.onError(Error("Unable to refresh. This layer does not have multi-dimensional info."));else{this.setImageFormat("LERC",!0);a=this.fullExtent&&this.fullExtent.xmin;var b=this.fullExtent&&this.fullExtent.ymax,c=f.clone(this._map.extent),d=1/this.symbolTileSize*this._map.width,d=d?Math.ceil(d):50,g=1/this.symbolTileSize*this._map.height,
g=g?Math.ceil(g):Math.ceil((c.ymax-c.ymin)/(c.xmax-c.xmin)*d),h=(c.xmax-c.xmin)/d,r=(c.ymax-c.ymin)/g;c.xmin=a+Math.floor((c.xmin-a)/h)*h;c.xmax=a+Math.ceil((c.xmax-a)/h)*h;c.ymin=b+Math.floor((c.ymin-b)/r)*r;c.ymax=b+Math.ceil((c.ymax-b)/r)*r;this._requestData(c,d,g)}},_drawPixelData:function(){this.clear();if(this.pixelData){var c=this.pixelData.pixelBlock,d=this.pixelData.extent,h=this.pixelData.locations,e=l.isDefined(c.mask)&&0<c.mask.length;if(c&&d&&h){if(this.useDefaultRenderer&&this.renderer&&
(!l.isDefined(this._minMag)||!l.isDefined(this._maxMag))){var f=this._getServiceMinMaxStats();f?(this._minMag=f.min,this._maxMag=f.max):(this._minMag=c.statistics[0].minValue,this._maxMag=c.statistics[0].maxValue);var f={type:"sizeInfo",minSize:g.px2pt(.2*this.symbolTileSize),maxSize:g.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},n=[];n.push(f);n.push({type:"colorInfo"});this.renderer.setVisualVariables(n)}for(var k=n=f=0,q,B=d.spatialReference?d.spatialReference._getInfo():
null,f=0;f<c.height;f++)for(n=0;n<c.width;n++,k++)if(q=h[k],(!e||c.mask[k])&&q&&2===q.length){q=new p(q[0],q[1],d.spatialReference);B&&(q.x=a.prototype._normalizeX(q.x,B).x);var x={Magnitude:c.pixels[0][k],Direction:c.pixels[1][k],Location:m.toJson(q.toJson())};q=new b(q,null,x);this.add(q)}}}},_getServiceMinMaxStats:function(){if(!l.isDefined(this.minValues)||!l.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],b=this.maxValues[0],c=this.minValues[1],
d=this.maxValues[1];if(this.pixelFilter&&a&&b&&c&&d){var g=[];g.push([a,b]);g.push([c,d]);c=this._createPixelData(g);this.pixelFilter(c);c&&c.pixelBlock&&c.pixelBlock.pixels&&0<c.pixelBlock.pixels.length&&(a=c.pixelBlock.pixels[0][0],b=c.pixelBlock.pixels[0][1])}return a&&b?{min:a,max:b}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:g.px2pt(.2*this.symbolTileSize),maxSize:g.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},b=[];b.push(a);
a=new h({style:this.rendererStyle,visualVariables:b,flowRepresentation:this._vectorFlowRepresentation});this.setRenderer(a)},_getField:function(a,b){if(l.isDefined(a))return b&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&this.renderer&&l.isDefined(a.FlowDirection)&&(this._vectorFlowRepresentation=
"oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});e("extend-esri")&&f.setObject("layers.ArcGISImageServiceVectorLayer",q,n);return q})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(q,f){return q(f,{constructor:function(f,m){this.isTiled=!0},getExtent:function(){},_initVisible:function(){},_setTopLayerVisible:function(f){},
setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(q,f,k,m,e,n,l,d){return q(n,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=
[];this.isTable=!0;this._layerObjectFacory=new l(this)},init:function(){},_getLayerObject:function(){var c=new m;this._layerObjectFacory.getLayerObject().then(f.hitch(this,function(d){this.layerObject.empty&&d&&(this.layerObject=d,this._bindEventAfterLayerObjectLoaded());c.resolve(d)}));return c},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var c=this.getPopupInfo();c||!this.layerObject||this.layerObject.empty||(c=this._getDefaultPopupInfo(this.layerObject));
return c},loadPopupInfo:function(){var c=new m,d=this.getPopupInfo();d?c.resolve(d):this.getLayerObject().then(f.hitch(this,function(){d=this._getDefaultPopupInfo(this.layerObject);c.resolve(d)}));return c},getLayerType:function(){var c=new m;c.resolve("Table");return c},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return k.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo=
{enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new d(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var c=e.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(c)},getFilter:function(){var c;this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?(c=this.layerObject.getDefinitionExpression(),void 0===c&&(c=this.getFilterOfWebmap())):
c=this.getFilterOfWebmap();return c}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),function(q,f,k,m,e,n,l,d,c){return q(c,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&
"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(c){10.2<=this.layerObject.version?this._legendRequestServer().then(m.hitch(this,function(d){f.empty(c);k.forEach(d.layers,function(a){k.forEach(a.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=f.create("div",{"class":"legend-div"},c),d=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},
b),h=null,h=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:h},d);f.create("div",{"class":"legend-label jimu-float-leading",innerHTML:a.label||" "},b)}},this)},this)}),m.hitch(this,function(){f.empty(c)})):f.empty(c)},_legendRequestServer:function(){var c=this.layerObject.url+"/legend",e={f:"json"};this.layerObject._params.bandIds&&(e.bandIds=this.layerObject._params.bandIds);
this.layerObject._params.renderingRule&&(e.renderingRule=this.layerObject._params.renderingRule);return d({url:c,content:e,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var c=new e,d={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},a=this.getLayerType(),b=this.getLayerObject();n({type:a,layerObject:b}).then(m.hitch(this,function(a){var b=a.type;a=a.layerObject;d.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(d.isSupportedLayer=!0);a.capabilities&&
0<=a.capabilities.indexOf("Catalog")?d.isSupportQuery=!0:d.isSupportedLayer=!1;c.resolve(d)}),function(){c.resolve(d)});return c},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=l.after(this.layerObject,"setRenderingRule",m.hitch(this,this._onRendererChanged)),this._eventHandles.push(c))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(q,f,k,m,e){return q(e,{getSupportTableInfo:function(){var e=new k,l={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},d=this.getLayerType(),c=this.getLayerObject();m({type:d,layerObject:c}).then(f.hitch(this,function(c){var d=c.type;c=c.layerObject;l.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(l.isSupportedLayer=!0);(d=c.getLatestObservations())&&0<d.length&&
(l.otherReasonCanNotSupport=!1);e.resolve(l)}),function(){e.resolve(l)});return e}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct","./LayerInfoForDefault"],function(q,f,k,m){return q(m,{constructor:function(e,f){this.layerObject=e.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var e=this.originOperLayer.kml,f=e.layerInfo.originOperLayer.visibleFolders;e.layerInfo.isRootLayer()&&
f?-1<f.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(e){var f=this.originOperLayer.kml.currentFolder;this._visible=e;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(f,e)},obtainNewSubLayers:function(){var e=[],m=this.originOperLayer.kml;m.currentFolder&&f.forEach(m.layerInfo._getOperLayerByParentFolderId(m.currentFolder.id,this),function(f){f=this._layerInfoFactory.create(f);e.push(f);
f.init()},this);return e},getOpacity:function(){},setOpacity:function(e){},drawLegends:function(e){k.empty(e)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),function(q,f,k,m,e,n,l,
d,c,h){var p=q(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(a){this.sdf=l.getInstance();this.url=a.url;this.query=a.query;this.pageSizeOption=a.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<a.pageSize?a.pageSize:1E3;this.getFeatureCount()},getFeatureCount:function(){return this._getQueryType().then(f.hitch(this,
function(a){return 1===a?this._getCountForQueryType1():2===a?this._getCountForQueryType2():this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(f.hitch(this,function(a){return 0===a?0:3===this.queryType?1:Math.ceil(a/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(f.hitch(this,function(a){if(0<a){for(var b=[],c=1;c<=a;c++)b.push(this.queryByPage(c));return m(b).then(f.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++)a[c].features&&
0<a[c].features.length&&(b=b.concat(a[c].features));a=a[0];a.features=b;return a}))}return this._getEmptyFeatureSet()}))},_getEmptyFeatureSet:function(){var a=new h;a.features=[];a.geometryType=this.layerDefinition.geometryType;a.fields=[];var b=f.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?a.fields=b:a.fields=k.filter(b,f.hitch(this,function(a){return 0<=this.query.outFields.indexOf(a.name)}));return a},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var a=
this.nextPageIndex;this.nextPageIndex++;return this.queryByPage(a)},queryByPage:function(a){var b=null,c=this._getEmptyFeatureSet();0>=a?(b=new e,b.resolve(c)):b=this.getPageCount().then(f.hitch(this,function(b){return a>b?c:1===this.queryType?this._queryPageForType1(a):2===this.queryType?this._queryPageForType2(a):this._queryPageForType3(a)}));return b},_getQueryType:function(){var a=new e;if(0<this.queryType)a.resolve(this.queryType);else return this._getLayerDefinition().then(f.hitch(this,function(a){return this.queryType=
p.getQueryType(a)}));return a},_getDefStatus:function(a){return a?a.isFulfilled()?a.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(f.hitch(this,function(a){this.layerDefinition=a;var b=a.maxRecordCount;0<b&&(!(0<this.pageSizeOption)||this.pageSize>a.maxRecordCount)&&(this.pageSize=b);return this.layerDefinition})));return this.layerDefinitionDef},_getCountForQueryType1:function(){0>=
this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(a){return a.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(f.hitch(this,function(a){return(a.features||
[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(a){return this._queryWithPaginationAndOrder((a-1)*this.pageSize)},_queryPageForType2:function(a){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(b){var c=(a-1)*this.pageSize;b=b.slice(c,c+this.pageSize);return this._queryByObjectIds(b)}))},_queryPageForType3:function(a){return this._doQueryForQueryType3().then(f.hitch(this,
function(b){var c=f.mixin({},b);c.features=[];var d=(a-1)*this.pageSize;c.features=(b.features||[]).slice(d,d+this.pageSize);return c}))},_tryLocaleNumber:function(a){var b=n.localizeNumber(a);if(null===b||void 0===b)b=a;return b},_tryLocaleDate:function(a){var b=n.localizeDate(a);b||(b=a.toLocaleDateString());return b},_getLayerIndexByLayerUrl:function(a){var b=a.lastIndexOf("/");a=a.slice(b+1,a.length);return parseInt(a,10)},_getServiceUrlByLayerUrl:function(a){var b=a.lastIndexOf("/");return a.slice(0,
b)},_isImageServiceLayer:function(a){return-1<a.indexOf("/ImageServer")},_isTable:function(a){return"Table"===a.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(a){var b=new d;b.where=a||this.query.where;b.geometry=this.query.geometry;b.outSpatialReference=this.map.spatialReference;b.returnGeometry=this.query.returnGeometry;b.spatialRelationship=this.query.spatialRelationship;b.outFields=this.query.outFields;return(new c(this.url)).execute(b)},_queryIds:function(){var a=
new d;a.where=this.query.where;a.geometry=this.query.geometry;a.returnGeometry=!1;a.spatialRelationship=this.query.spatialRelationship;a.outSpatialReference=this.query.outSpatialReference;return(new c(this.url)).executeForIds(a).then(f.hitch(this,function(a){a||(a=[]);return a}))},_queryByObjectIds:function(a){var b=new e,g=new d;g.returnGeometry=this.query.returnGeometry;g.outSpatialReference=this.query.outSpatialReference;g.spatialRelationship=this.query.spatialRelationship;g.outFields=this.query.outFields;
g.objectIds=a;(new c(this.url)).execute(g).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(c){if(400===c.code){var d=this._getObjectIdField(),g="",h=a.length;k.forEach(a,f.hitch(this,function(a,b){g+=d+" \x3d "+a;b!==h-1&&(g+=" OR ")}));this._query(g).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){b.reject(a)}))}else b.reject(c)}));return b},_queryCount:function(){var a=new d;a.where=this.query.where;a.geometry=this.query.geometry;a.outSpatialReference=this.query.outSpatialReference;
a.spatialRelationship=this.query.spatialRelationship;a.returnGeometry=!1;return(new c(this.url)).executeForCount(a)},_queryWithPaginationAndOrder:function(a){var b=new d;b.where=this.query.where;b.geometry=this.query.geometry;b.outSpatialReference=this.query.outSpatialReference;b.returnGeometry=this.query.returnGeometry;b.spatialRelationship=this.query.spatialRelationship;b.outFields=this.query.outFields;b.start=a;b.num=this.pageSize;(a=this.query.orderByFields)&&0<a.length&&(b.orderByFields=a,a=
k.map(a,f.hitch(this,function(a){return a.split(" ")[0]})),k.forEach(a,f.hitch(this,function(a){0>b.outFields.indexOf(a)&&b.outFields.push(a)})));return(new c(this.url)).execute(b)}});p._isServiceSupportsOrderBy=function(a){var b=!1;a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsOrderBy&&(b=!0);return b};p._isServiceSupportsPagination=function(a){var b=!1;a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsPagination&&(b=!0);return b};p._isSupportObjectIds=function(a){var b=
0;a.currentVersion&&(b=parseFloat(a.currentVersion));return 10<=b||a.hasOwnProperty("typeIdField")};p.getQueryType=function(a){var b=-1;return b=p._isServiceSupportsOrderBy(a)&&p._isServiceSupportsPagination(a)?1:p._isSupportObjectIds(a)?2:3};return p})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(q,f){function k(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(f){return f},compatible:!0},{version:"1.1",
description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(f){f.widgetOnScreen&&f.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===f.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return f},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(f){var e=0;if(f.widgetOnScreen&&f.widgetOnScreen.widgets){for(var n=
!1,e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Splash/Widget"===f.widgetOnScreen.widgets[e].uri&&(n=!0);n||f.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});n=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/TimeSlider/Widget"===f.widgetOnScreen.widgets[e].uri&&(n=!0);n||f.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});n=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Swipe/Widget"===
f.widgetOnScreen.widgets[e].uri&&(n=!0);n||f.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return f},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(m){(function(e){f.visitElement(e,function(e){e.positionRelativeTo&&(e.position?e.position.relativeTo=e.positionRelativeTo:e.position={relativeTo:e.positionRelativeTo},e.panel&&(e.panel.position?e.panel.position.relativeTo=e.panel.positionRelativeTo:
e.panel.position={relativeTo:e.panel.positionRelativeTo}))});var n=e.widgetOnScreen;n&&n.panel&&n.panel.positionRelativeTo&&(n.panel.position?n.panel.position.relativeTo=n.panel.positionRelativeTo:n.panel.position={relativeTo:n.panel.positionRelativeTo});(n=e.widgetPool)&&n.panel&&n.panel.positionRelativeTo&&(n.panel.position?n.panel.position.relativeTo=n.panel.positionRelativeTo:n.panel.position={relativeTo:n.panel.positionRelativeTo})})(m);m.widgetOnScreen&&m.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===
m.widgetOnScreen.panel.uri&&(m.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(e){if(e.widgetOnScreen&&e.widgetOnScreen.widgets&&e.theme&&"FoldableTheme"===e.theme.name){var f=null,l=null;if(f=e.widgetOnScreen.widgets[4])void 0!==f.position.top?(f={position:{left:205,top:45}},l={position:{left:255,top:45}}):(f={position:{left:205,bottom:55}},l={position:{left:255,bottom:55}}),e.widgetOnScreen.widgets.splice(7,0,f,l)}})(m);(function(){for(var e=0,f=0,l=!1,e=0;e<m.widgetOnScreen.widgets.length;e++)if("widgets/Geocoder/Widget"===
m.widgetOnScreen.widgets[e].uri){l=!0;break}for(var d=!1,f=0;f<m.widgetOnScreen.widgets.length;f++)if("widgets/Search/Widget"===m.widgetOnScreen.widgets[f].uri){d=!0;break}!d&&l&&(e=m.widgetOnScreen.widgets[e],e.uri="widgets/Search/Widget",e.name="Search")})(m);(function(e){for(var f=0,f=e.widgetOnScreen.widgets.length-1;0<=f;f--){var l=e.widgetOnScreen.widgets[f];if("widgets/Swipe/Widget"===l.uri&&!l.closeable&&(e.widgetOnScreen.widgets.splice(f,1),!1!==l.visible)){l.closeable=!0;var d;a:{for(d=
d=0;d<e.widgetOnScreen.widgets.length;d++)if(!e.widgetOnScreen.widgets[d].uri)break a;d=-1}0<=d&&(l.position=e.widgetOnScreen.widgets[d].position,e.widgetOnScreen.widgets[d]=l)}"widgets/TimeSlider/Widget"===l.uri&&(!1===l.visible?e.widgetOnScreen.widgets.splice(f,1):l.closeable=!0)}})(m);m.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});m.loadingPage||(m.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,
uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return m},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(f){if(f.theme){var e=f.theme.name;if(("FoldableTheme"===e||"JewelryBoxTheme"===e)&&f.widgetOnScreen){var m=f.widgetOnScreen.widgets;if(m&&0<m.length)for(var e="themes/"+e+"/widgets/HeaderController/Widget",l=null,d=0;d<m.length;d++)(l=m[d])&&l.uri===e&&l.position&&310===l.position.paddingRight&&(l.position.paddingRight=
275)}}return f},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){f.keepAppState=!0;return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},{version:"2.2",
description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(f){function e(d,c){if(!d||!c)return!1;for(var h in c)if(c.hasOwnProperty(h))if("object"===typeof c[h]){if(!e(d[h],c[h]))return!1}else if(d[h]!==c[h])return!1;return!0}function m(d){function c(){var a=e(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),b=e(d[12],{position:{top:10,right:195}});return a&&b}function h(){var a=
e(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),b=e(d[12],{position:{left:15,top:233}});return a&&b}function f(){var a=e(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),b=e(d[12],{position:{right:15,top:195}});return a&&b}(function(){var a=e(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),b=e(d[12],{position:{left:240,top:53}});return a&&b})()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):
c()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):h()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):f()&&d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function l(d){function c(){var c=e(d[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),a=e(d[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),b=e(d[4],{position:{left:7,
bottom:70}});return c&&a&&b}function h(){var c=e(d[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),a=e(d[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),b=e(d[4],{position:{left:7,bottom:70}});return c&&a&&b}(function(){var c=e(d[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),a=e(d[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),b=e(d[4],{position:{left:55,top:45}});return c&&a&&b}()||c()||h())&&d.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:148,left:7},version:"2.3"})}(function(d,c,h){d=d.theme&&d.theme.name;if("FoldableTheme"===d)if(e(c[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(e(c[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),h&&h.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{right:12,top:211},version:"2.3"});else{if(e(c[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(d=0;d<c.length;d++){var f=c[d];e(f,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(f.position.left=288);e(f,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(f.position.left=463)}h&&h.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===d)m(c);else if("BoxTheme"===d)c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===d)l(c);else if("LaunchpadTheme"===d){if(e(c[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||e(c[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),
h&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===d?(e(c[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),e(c[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===d&&e(c[11],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}})&&c.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(f,f.widgetOnScreen.widgets,f.mobileLayout&&f.mobileLayout.widgetOnScreen&&f.mobileLayout.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(f){return f},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(f){function e(f,l){if(!f||!l)return!1;for(var d in l)if(l.hasOwnProperty(d))if("object"===
typeof l[d]){if(!e(f[d],l[d]))return!1}else if(f[d]!==l[d])return!1;return!0}(function(f,l){var d=f.theme&&f.theme.name;if("BillboardTheme"===d){var d=e(l[8],{position:{left:60,top:53}}),c=e(l[8],{position:{left:15,top:53}});d||c?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===d){a:{d=0;for(c=l.length;d<c;d++){var h=l[d];if(h&&h.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===
h.uri){d=h;break a}}d=null}e(d,{position:{right:0,bottom:0}})?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===d?l.push({uri:"widgets/FullScreen/Widget",
visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===d&&(e(l[7],{position:{left:45,top:45}})?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,
top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(f,f.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(f){return f},compatible:!0}];this.isCompatible=function(f,e){for(var m=this.getVersionIndex(f),l=this.getVersionIndex(e),m=m+1;m<=l;m++)if(!1===this.versions[m].compatible)return!1;return!0}}k.prototype=new q;return k.prototype.constructor=k})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(q,f,k){f=this.getVersionIndex(f);k=this.getVersionIndex(k);if(f>k)throw Error("New version should higher than old version.");for(f+=1;f<=k;f++)this.versions[f].upgrader&&(q=this.versions[f].upgrader(q));return q};this.getVersionIndex=function(q){q=this.fixVersion(q);var f,k;for(k=0;k<this.versions.length;k++)this.versions[k].version===q&&(f=k);null===q&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(q){return q?q:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y){var w=null,B;B=q(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=p.getInstance();f.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(a){var c=this.checkConfig(a);if(c)throw Error(c);this.rawAppConfig=f.clone(a);u.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(a){return this.insertAppIdtoResourceUrlofAppConfig(a,this.urlParams.id)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}));b.setPortalUrl(a.portalUrl);y.arcgisUrl=t.getBaseItemUrl(a.portalUrl);
return this._proesssWebTierAndSignin(a).then(f.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(f.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(b){b.appData.appConfig&&
(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))})):this._processNotInPortalAppProtocol(a)})).then(f.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?g.getDefaultWebScene(a.portalUrl):g.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(f.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(f.hitch(this,function(a){return a._appData?a._appData.values&&
a._appData.values.webmap?g.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(f.hitch(this,function(b){return h.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):h.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(f.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(a,a.appItemId):a})).then(f.hitch(this,function(a){this.appConfig=a;this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),f.hitch(this,function(a){this.showError(a);var b=new l;b.reject(a);return b}))},processResourceInAppConfigForConfigLoader:function(a,b){var c=a.portalUrl,d=a.appItemId,h=b.appid,e=new l,p=f.clone(a);this.insertAppIdtoResourceUrlofAppConfig(p,h).then(function(){if("config"===b.mode){var f=
this.getResourceUrlsOfAppConfig(a).result;0!==f.length?g.getItemResources(c,h).then(function(a){if(0===a.length)return f=f.map(function(a){return{resUrl:a}}),r.AddResourcesToItemForAppSave(c,f,d,h).then(function(){e.resolve(p)},function(a){console.warn("Add resource to template based app error:"+a.message||a);e.resolve(p)});e.resolve(p)},function(a){console.warn("Get resource of template based item error:"+a.message||a);e.resolve(p)}):e.resolve(p)}else e.resolve(p)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+
a.message||a);e.resolve(p)});return e},getResourceUrlsOfAppConfig:function(a){var b={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)},func:f.hitch(this,function(a){return a.value})};return h.processItemResourceOfAppConfig(a,b)},insertAppIdtoResourceUrlofAppConfig:function(a,b){function c(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)}function d(a,b){var c=r.processItemIdAndTokenOfResources(b.value,a),d=b.obj,g=b.key;"number"===typeof b.i?d[g][b.i]=
c:d[g]=c;return!0}var e=a.portalUrl,r=this;return g.getPortal(e).getItemById(b).then(f.hitch(this,function(g){g={test:c,func:f.hitch(this,d,{appId:b,isPublic:"public"===g.access,portalUrl:e})};return h.processItemResourceOfAppConfig(a,g).appConfig}))},processItemIdAndTokenOfResources:function(a,c){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));if(!c.isPublic){var d=b.getPortalCredential(c.portalUrl);d&&(a+="?token\x3d"+d.token)}return a},
_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=h.stripHTML(a.title))},getAppConfig:function(){var a=f.clone(this.appConfig);a.getConfigElementById=function(a){return h.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return h.getConfigElementsByName(this,a)};a.visitElement=function(a){h.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,c){a&&a.authorizedCrossOriginDomains&&
b.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&b.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(a){z.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;z.defaults.io.proxyUrl="";z.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(z.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&
k.forEach(a.httpProxy.rules,function(a){A.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._fixRepeatedId(a)},showError:function(a){a&&a.message&&m.create("div",{"class":"app-error",innerHTML:h.sanitizeHTML(a.message)},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=
this.urlParams.config,c(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(a){b.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?b.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=t.getPortalUrlFromLocation(),d=new l;b.setPortalUrl(a);window.portalUrl=a;y.arcgisUrl=t.getBaseItemUrl(a);var h;this.urlParams.token?h=b.registerToken(this.urlParams.token):
(h=new l,h.resolve());h.then(f.hitch(this,function(){g.getPortal(a).loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=b;b.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),d.reject()):this._processSignIn(a).then(f.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){d.resolve(a)},
function(a){d.reject(a)})}))}))}),f.hitch(this,function(a){this.showError(a)}));return d}this.configFile="config.json";return c(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(a){b.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?b.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var b=window.wabVersion,c=a.wabVersion;a.configWabVersion=a.wabVersion;if(b===c)return a;var d=this.versionManager.getVersionIndex(c),
g=this.versionManager.getVersionIndex(b);if(d>g)throw Error("Bad version number, "+c);a=this.versionManager.upgrade(a,c,b);a.wabVersion=b;return a},loadAndUpgradeAllWidgetsConfig:function(b){var c=new l,g=[];a.visitElement(b,f.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),g.push(a))}));d(g).then(f.hitch(this,function(){c.resolve(b)}),function(a){c.reject(a)});return c},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);
this.addNeedValues(a);this.processProxy(a);v.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},
a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):
(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var b=t.getPortalUrlFromLocation(),b=t.getStandardPortalUrl(b);t.isOnline(b)&&(b=t.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&t.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&
(a.httpProxy.url=t.getPortalProxyUrl(b)))}},_processWidgetJsons:function(b){a.visitElement(b,function(a,b){b.isWidget&&a.uri&&h.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(b){var c=0;a.visitElement(b,function(a,b){b.isWidget&&!a.uri&&(c++,a.placeholderIndex=c)})},_processEmptyGroups:function(a){var b=0;a.widgetOnScreen.groups&&k.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)b++,a.placeholderIndex=b})},_addElementId:function(b){var c=
0,d;a.visitElement(b,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var b=a.id.lastIndexOf("_");-1<b&&(d=a.id.substr(b+1),c=Math.max(c,d))}});a.visitElement(b,function(a){a.id||(c++,a.id=a.itemId?a.itemId+"_"+c:a.uri?a.uri.replace(/\//g,"_")+"_"+c:"_"+c)})},_setPortalUrl:function(a){if(a.portalUrl){var b=t.getPortalUrlFromLocation(),c=t.isOnline(b);t.isSamePortalUrl(a.portalUrl,b)||c||(window.appInfo.isRunInPortal=!1)}else window.isXT&&n("wab_portalurl")?a.portalUrl=n("wab_portalurl"):(window.appInfo.isRunInPortal=
!0,a.portalUrl=t.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=t.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=t.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=t.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&k.forEach(a.httpProxy.rules,f.hitch(this,function(a){a.proxyUrl=t.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new l,c=g.getPortal(a.portalUrl),d=f.hitch(this,function(c){if("https:"===
window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(c){console.log("redirect from http to https");window.location.href=t.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});c.loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=b;"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),d(b)):d(b.allSSL)}),f.hitch(this,function(a){b.reject(a)}));return b},_processNotInPortalAppProtocol:function(a){var c=
new l;a.portalUrl?g.getPortal(a.portalUrl).loadSelfInfo().then(f.hitch(this,function(d){this.portalSelf=d;var g="https:"===window.location.protocol;(d.allSSL||g)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||g||b.isInConfigOrPreviewWindow()?c.resolve(a):(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),c.reject())}),f.hitch(this,function(a){c.reject(a)})):c.resolve(a);return c},_proesssWebTierAndSignin:function(a){var b=
new l,c=!1,d=a.portalUrl;this._processWebTier(a).then(f.hitch(this,function(a){c=a;return g.getPortal(d).loadSelfInfo()})).then(f.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(d,c)})).then(f.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var c=new l,d=a.portalUrl;a.isWebTier?(b.addAuthorizedCrossOriginDomains([d]),b.isWebTierPortal(d).then(f.hitch(this,function(){var g=b.getPortalCredential(d);g&&g.ssl&&"http:"===window.location.protocol&&
!b.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href)):c.resolve(a.isWebTier)}),f.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(a,c){var d=new l,h=g.getPortal(a),e=t.getSharingUrl(a);window.appInfo.isRunInPortal?(e=v.checkSignInStatus(e),e.promise.always(f.hitch(this,function(){d.resolve()}))):(!b.isInBuilderWindow()&&!b.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&
this.rawAppConfig&&this.rawAppConfig.appId&&!c&&b.registerOAuthInfo(a,this.rawAppConfig.appId),e=v.checkSignInStatus(e),e.promise.always(f.hitch(this,function(){b.xtGetCredentialFromCookie(a);h.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;this._checkLocale();d.resolve()}))})));return d},_checkLocale:function(){if(!b.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||e.locale,a=a.toLowerCase();!this.urlParams.locale&&h.isLocaleChanged(e.locale,
a)&&(n("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,b){var c=g.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,b).then(f.hitch(this,function(b){var g=b.appId,h=b.appData;return d([this._getAppConfigFromAppId(a,g),c.getItemData(h.source)]).then(f.hitch(this,function(a){var b;h.appConfig?(b=h.appConfig,delete h.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=h;b._wabAppId=g;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},
_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var c=g.getPortal(a);return c.getItemData(b).then(function(a){return c.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var c=new l,d=g.getPortal(a);d.getItemData(b).then(f.hitch(this,function(a){d.getItemById(a.source).then(f.hitch(this,function(b){b=A.urlToObject(b.url);c.resolve({appId:b.query.id,appData:a})}))}),function(a){c.reject(a)});return c},_getAppConfigFromAppId:function(a,
b){return g.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(b){function c(a,c,d){function f(c){return a.loadWidgetManifest(c).then(function(a){return a},function(a){console.log("Widget failed to load, it is removed.",c.name);a.stack?console.error(a.stack):console.log(a);e(b,c)})}return c.itemId?g.getPortal(d).getItemById(c.itemId).then(function(a){c.uri=h.widgetJson.getUriFromItem(a);return f(c)},function(a){console.log("Widget is not loaded, it is removed.",
c.name,a);e(b,c)}):f(c)}function e(a,b){function c(c){a[c]&&a[c].widgets&&(a[c].widgets=a[c].widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[c]&&a[c].groups&&a[c].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}
c("widgetOnScreen");c("widgetPool")}var r=[],p=new l;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,function(g){a.visitElement(b,f.hitch(this,function(a){a.widgets||!a.uri&&!a.itemId||(a.uri&&g[a.uri]?(this._addNeedValuesForManifest(g[a.uri],a.uri),h.widgetJson.addManifest2WidgetJson(a,g[a.uri])):r.push(c(this.widgetManager,a,b.portalUrl)))}));d(r).then(function(){p.resolve(b)})})):(a.visitElement(b,f.hitch(this,function(a){a.widgets||!a.uri&&
!a.itemId||r.push(c(this.widgetManager,a,b.portalUrl))})),d(r).then(function(){p.resolve(b)}));setTimeout(function(){p.isResolved()||(e(b),p.resolve(b))},6E4);return p},_addNeedValuesForManifest:function(a,b){f.mixin(a,h.getUriInfo(b));h.manifest.addManifestProperies(a);h.manifest.processManifestLabel(a,e.locale)},_loadMergedWidgetManifests:function(){return c(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(b){var c=[];a.visitElement(b,function(a){0<=
c.indexOf(a.id)&&(a.id+="_");c.push(a.id)})},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&h.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});B.getInstance=
function(a,b){null===w?w=new B(a,b):(w.urlParams=a,w.options=b);return w};return B})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(q,f,k,m){return{AddResourcesToItemForAppSave:function(e,n,l,d){n=n||[];if(0===n.length){var c=new q;c.resolve(n);return c}n=n.map(function(c){var d=c.resUrl.split("resources/")[1],a=new q;c.b64?(c=m.b64toBlob(c.b64),a.resolve({blob:c,fileName:d.split("/")[1],prefixName:d.split("/")[0]})):
(c=c.resUrl,0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",l)),m.resourcesUrlToBlob(c).then(function(b){a.resolve({blob:b,fileName:d.split("/")[1],prefixName:d.split("/")[0]},function(b){console.error(b.message||b);a.reject(b)})}));return a});return f(n).then(function(c){if(c instanceof Array&&0<c.length)return c=c.map(function(c){var a=l;d&&(a=d);return k.addResource(e,a,c.blob,c.fileName,c.prefixName)}.bind(this)),f(c).then(function(c){return c})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),
function(q,f,k,m,e,n,l,d,c){var h=null,p=q(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var a=m.stringify(this.rawAppConfig.map);this.mapMd5=d(a)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new k,b={};if(c.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(b),a;var d=this._getAppStateKey(),h=l.get(d);h&&h.appStateMd5===this._getAppStateMd5()?(d=h.map&&h.map.extent,h=h.map&&h.map.layers,d&&(b.extent=new e(d.xmin,d.ymin,d.xmax,d.ymax,new n(d.spatialReference))),h&&(b.layers=h)):l.remove(d);a.resolve(b);return a},saveWabAppState:function(a,b){if(a&&!c.isInConfigOrPreviewWindow()){var d=this._getAppStateKey(),h={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,
spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};b&&b.traversal&&b.traversal(f.hitch(this,function(a){h.layers[a.id]={visible:a.isVisible()}}));l.set(d,{map:h,appStateMd5:this._getAppStateMd5()})}}});p.getInstance=function(a){null===h&&(h=new p);h.urlParams=a;return h};return p})},"jimu/dijit/AGOLLoading":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AGOLLoading.html","dojo/_base/html"],
function(q,f,k,m,e){return q([f,k],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:m,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&e.setStyle(this.domNode,"display","none");e.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||e.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),e.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(e.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b){var g=null,r;r=q([m],{constructor:function(a,c){this.own(e.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)));this.own(e.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this.own(e.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)));this.own(e.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));this.own(e.subscribe("beforeMapDestory",f.hitch(this,this._onBeforeMapDestory)));this.own(e.subscribe("preloadModulesLoaded",
f.hitch(this,this._onPreloadModulesLoaded)));this.own(e.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.own(e.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered)));b.isMobileUa()||this.own(n(window,"resize",h(f.hitch(this,this.resize),200)));this.id=c;this.preloadModulesLoadDef=new d},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=f.clone(a);this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(f.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId);this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";
var b=new d;p([a],f.hitch(this,function(a){a=a.getInstance();this.map&&a.setMap(this.map);b.resolve(a)}));return b},_loadMap:function(b){this.mapManager=a.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},b);this.mapManager.showMap()},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var b=new d;p(["themes/"+a.name+"/main"],
f.hitch(this,function(){c([this._loadThemeCommonStyle(a),this._loadThemeCurrentStyle(a)]).then(f.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();b.resolve()}))}));return b},_loadThemeCommonStyle:function(a){k.addClass(this.domNode,a.name);return b.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){k.addClass(this.domNode,a.styles[0]);return b.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+
"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var b=f.getObject("customStyles",!1,a);if(b){var c=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(c+=a);c=f.replace(c,b,/\$\{([^\}]+)\}/g);b=k.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(c))}catch(z){b.styleSheet.cssText=c}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var b=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";
"PlateauTheme"===a.name?b+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":"BoxTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate{background-color: ${mainBackgroundColor} !important;}":
"TabTheme"===a.name?b+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===a.name&&(b+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}");return b},_onAppConfigChanged:function(a,b,c){a=f.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,
c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,c);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,c);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,c);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,c)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},
_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();c([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(f.hitch(this,function(b){b=b[0];this.layoutManager.name!==b.name&&(this.layoutManager.onLeave(),b.onEnter(a,this.mapId),this.layoutManager=b);this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var b=this.appConfig;
e.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._loadLayoutManager(a).then(f.hitch(this,function(a){this.layoutManager=a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){if("backgroundColor"in b)k.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor);else if("backgroundImage"in b){var c=a.loadingPage.backgroundImage;
c.visible&&c.uri?(k.setStyle(jimuConfig.loadingImageId,"background-image","url('"+c.uri+"')"),k.setStyle(jimuConfig.loadingImageId,"width",c.width+"px"),k.setStyle(jimuConfig.loadingImageId,"height",c.height+"px")):(k.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),k.setStyle(jimuConfig.loadingImageId,"width","0px"),k.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in b&&(c=a.loadingPage.loadingGif,c.visible&&c.uri?(k.setStyle(jimuConfig.loadingGifId,"background-image",
"url('"+c.uri+"')"),k.setStyle(jimuConfig.loadingGifId,"width",c.width+"px"),k.setStyle(jimuConfig.loadingGifId,"height",c.height+"px")):(k.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),k.setStyle(jimuConfig.loadingGifId,"width","0px"),k.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},
_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_removeThemeCommonStyle:function(a){k.removeClass(this.domNode,
a.name);k.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){k.removeClass(this.domNode,a.styles[0]);k.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){l('style[source\x3d"custom"]',document.head).forEach(function(a){k.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){p(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
r.getInstance=function(a,b){null===g&&(g=new r(a,b),window._layoutManager=g);return g};return r})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E,D){var G=null,H=q(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=F.getInstance(this.urlParams);this.popupManager=E.getInstance(this);this.filterManager=D.getInstance();this.nls=window.jimuNls;n.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));n.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));l(window,"resize",f.hitch(this,this.onWindowResize));l(window,"beforeunload",f.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appConfig.keepAppState&&
this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),e("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){m.destroy(a)}),e("div.esriMobileNavigationBar").forEach(function(a){m.destroy(a)})),
this._mapMobileInfoWindow=new b(null,m.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);A.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!A.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(a){this.map&&(a=new u(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,
b){k.forEach(a.map.basemaps,function(a,c){a.isOperationalLayer=!1;b(a,c)},this);k.forEach(a.map.operationallayers,function(a,c){a.isOperationalLayer=!0;b(a,c)},this)},_show3DLayersMap:function(a){z(["esri3d/Map"],f.hitch(this,function(b){var c;c=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,f.hitch(this,function(a){this.createLayer(c,"3D",a)}));c.usePlugin=b.usePlugin;this._publishMapEvent(c)}))},_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(f.hitch(this,
function(b){z(["esri3d/Map"],f.hitch(this,function(c){var d=new c(this.mapDivId,a.map.mapOptions);k.forEach(b.itemData.operationalLayers,function(a){this.createLayer(d,"3D",a)},this);k.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(d,"3D",a)},this);k.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(d,"3D",a)},this);d.toc=b.itemData.toc;d.bookmarks=b.itemData.bookmarks;d.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=
a;x.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),n.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=a,this.resetInfoWindow(!0),n.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(a){return r({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var b=this._processMapOptions(a.map.mapOptions)||
{};b.isZoomSlider=!1;var d=a.map.portalUrl,g=a.map.itemId,b={mapOptions:b,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var h=[];k.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&h.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<h.length&&(b.layerMixins=h)}this._createWebMapRaw(d,g,this.mapDivId,b).then(f.hitch(this,function(b){var d=b.map;d.hideZoomSlider();d.infoWindow.resize(270,316);
d.itemId=a.map.itemId;d.itemInfo=b.itemInfo;d.webMapResponse=b;d.enableSnapping({snapKey:c.copyKey});m.setStyle(d.root,"zIndex",0);d._initialExtent=d.extent;this.layerInfosObj=y.getInstanceSyncForInit(d,d.itemInfo);this.layerInfosObj.traversalLayerInfosOfWebmap(f.hitch(this,function(a){a.getLayerObject().then(f.hitch(this,function(a){f.setObject("_wabProperties.originalRefreshinterval",a.refreshInterval,a)}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))}));a.map.mapRefreshInterval&&
!a.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(a.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(d);setTimeout(f.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(d)}),f.hitch(this,function(a){console.error(a);this._showError(a);n.publish("mapCreatedFailed")}))},_handleRefreshLayer:function(a){var b=a._mode._drawFeatures,c=a._mode._clearIIf,g=null;a._mode._drawFeatures=function(c,d){d&&"number"===typeof d.row&&
"number"===typeof d.col&&a._mode._removeCell(d.row,d.col);b.apply(a._mode,arguments)};d.before(a,"refresh",function(){g=a._mode._cellMap;a._mode._clearIIf=function(){}});d.after(a,"refresh",function(){a._mode._cellMap=g;a._mode._clearIIf=c});l(a,"update-start",function(){a.isUpdating=!0});l(a,"update-end",function(){a.isUpdating=!1})},_showError:function(a){a&&a.message&&m.create("div",{"class":"app-error",innerHTML:a.message},document.body)},_createWebMapRaw:function(a,b,c,d){return A.createWebMap(a,
b,c,d).then(f.hitch(this,function(a){return a}),f.hitch(this,function(g){console.error(g);if(g&&g instanceof Error&&g.message){var e=f.getObject("arcgis.utils.baseLayerError",!1,h.cache["esri/nls/jsapi/"+p.locale]);if(e&&0<=g.message.indexOf(e))return new w({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),t.getItem(b).then(f.hitch(this,function(b){b.itemData.spatialReference={wkid:102100,latestWkid:3857};b.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return A.createWebMap(a,b,c,d)}))}throw g;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),b="",c=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";c&&a&&0<a.length&&(k.forEach(a,f.hitch(this,function(a){b=b+a+", "})),new w({message:c.replace("${layers}",b)}))},_addDataLoadingOnMapUpdate:function(a){var b=
m.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');m.place(b,a.root);a.updating&&m.addClass(b,"loading");l(a,"update-start",f.hitch(this,function(){m.addClass(b,"loading")}));l(a,"update-end",f.hitch(this,function(){m.removeClass(b,"loading")}));l(a,"unload",f.hitch(this,function(){m.destroy(b);b=null}))},_checkAppState:function(){var a="extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&k.forEach(a,function(a){a in this.urlParams&&(b=!1)},this);
b&&this.appStateManager.getWabAppState().then(f.hitch(this,function(a){if(a.extent||a.layers){var b=new B({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});b.placeAt("main-page");l(b,"applyAppState",f.hitch(this,function(){this._applyAppState(a,this.map)}));b.startup();b.show()}}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||null});a.extent&&b.setExtent(a.extent)},_processMapOptions:function(b){if(b)return b.lods||delete b.lods,
b.lods&&0===b.lods.length&&delete b.lods,b=f.clone(b),b.extent&&(b.extent=new u(b.extent)),b.center&&!f.isArrayLike(b.center)&&(b.center=new v(b.center)),b.infoWindow&&(b.infoWindow=new a(b.infoWindow,m.create("div",{},this.mapDivId))),b},createLayer:function(a,b,c){z([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer",
"2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+"_"+c.type]],f.hitch(this,function(b){var h,e={};h="label url type icon infoTemplate isOperationalLayer".split(" ");
for(var r in c)0>h.indexOf(r)&&(e[r]=c[r]);c.infoTemplate?(h=new g(c.infoTemplate.title,c.infoTemplate.content),e.infoTemplate=h,b=new b(c.url,e),c.infoTemplate.width&&c.infoTemplate.height&&d.after(b,"onClick",f.hitch(this,function(){a.infoWindow.resize(c.infoTemplate.width,c.infoTemplate.height)}),!0)):b=new b(c.url,e);b.isOperationalLayer=c.isOperationalLayer;b.label=c.label;b.icon=c.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):
"mapOptionsChange"===b?c.lods&&this._recreateMap(a):"mapRefreshIntervalChange"===b&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(c)},_updateRefreshInterval:function(a){var b=-1,b=a.useWebMapRefreshInterval?-1:a.minutes;this.layerInfosObj.traversalLayerInfosOfWebmap(f.hitch(this,function(a){a.getLayerObject().then(f.hitch(this,function(a){var c=f.getObject("_wabProperties.originalRefreshinterval",!1,a);0<c&&"function"===typeof a.setRefreshInterval&&(0>b?a.setRefreshInterval(c):
a.setRefreshInterval(b))}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))}))},_recreateMap:function(a){this.map&&(n.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});H.getInstance=function(a,b){null===G&&(G=new H(a,b));return G};return H})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z){var A=q([v,a,b,g,u],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:z,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);h.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[A.ANCHOR_UPPERRIGHT,A.ANCHOR_LOWERRIGHT,A.ANCHOR_LOWERLEFT,A.ANCHOR_UPPERLEFT];
if(7>n("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+p.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",b=h.create("div",null,m.body());p.set(b,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var c=setTimeout(function(){h.destroy(b);clearTimeout(c);c=b=null},100);e.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=
a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var c=p.set;c(this._topleft,{height:b+"px",marginLeft:a+"px"});c(this._topright,{width:a+"px",height:b+"px"});c(this._user,"width",a-8+"px");c(this._hide,"marginLeft",a-22+"px");c(this._title,"width",a-25+
"px");c(this._content,"height",b-37+"px");c(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});c(this._bottomright,{width:a-5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var c=p.set;c(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===A.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===A.ANCHOR_UPPERRIGHT?
c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===A.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",right:null,top:"43px",bottom:null}):b===A.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,d){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=
null,this.coords=a);var g=this.map._getFrameWidth();if(-1!==g&&(a.x%=g,0>a.x&&(a.x+=g),this.map.width>g))for(var h=(this.map.width-g)/2;a.x<h;)a.x+=g;b&&-1!==k.indexOf(this._ANCHORS,b)||(b=this._getAnchor(a));c.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);c.add(this._pointer,b);t.show(this.domNode);this.isShowing=!0;if(!d)this.onShow()}},hide:function(a,b){t.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){t.show(this._titlebar);
t.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){t.hide(this._titlebar);t.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){t.show(this._content);t.show(this._border);this.isContentShowing=!0},hideContent:function(){t.hide(this._content);t.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));p.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+
"px"})},setFixedAnchor:function(a){a&&-1===k.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});f.mixin(A,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});n("extend-esri")&&f.setObject("dijit.InfoWindow",A,r);return A})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w){q=f([t,u],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:q.toUrl("./images/whitex.png"),dArrowIcon:q.toUrl("./images/whitedown.png"),lArrowIcon:q.toUrl("./images/whitel.png"),rArrowIcon:q.toUrl("./images/whiter.png"),constructor:function(b,c){this.initialize();k.mixin(this,b);this.domNode=h.byId(c);this._nls=k.mixin({},
w.widgets.popup);var d=this.domNode;a.add(d,"esriPopupMobile");p.set(d,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var g=l.query(".titlePane",d)[0];this._arrowButton=l.query(".arrow",g)[0];this._pointerTop=l.query(".top",d)[0];this._pointerBottom=l.query(".bottom",d)[0];this._title=l.query(".title",g)[0];this._footer=l.query(".footer",g)[0];this._prev=l.query(".prev",g)[0];this._next=l.query(".next",g)[0];this._spinner=l.query(".spinner",g)[0];this._eventConnections=[m.connect(l.query(".close",g)[0],"onclick",this,this.hide),m.connect(this._arrowButton,"onclick",this,this._toggleView),m.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),m.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();y.hide(d);this.isShowing=!1},setMap:function(a){this.inherited(arguments);b.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(y.show(this.domNode),this.isShowing=!0,this.onShow())}else y.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(y.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);e.forEach(this._eventConnections,m.disconnect);b.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");a.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[m.connect(a,"onPanStart",this,this._onPanStart),m.connect(a,"onPan",this,this._onPan),m.connect(a,"onZoomStart",this,this._onZoomStart),m.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(e.forEach(a,m.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,b){var c=this._panOrigin,d=b.x,g=b.y,h=c.left,e=c.top,f=c.right,c=c.bottom;h&&(h=parseFloat(h)+d+"px");e&&(e=parseFloat(e)+g+"px");f&&(f=parseFloat(f)-d+"px");c&&(c=parseFloat(c)-g+"px");r.set(this.domNode,{left:h,top:e,right:f,bottom:c})},_onZoomStart:function(){y.hide(this.domNode)},_onExtentChange:function(a,b,c){c&&(y.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(b){var c=b.x;b=b.y;var d=
g.getContentBox(this.map.container),h=d.w,d=d.h,e=0,f=b+10,p=118,t=h-18;18<c&&c<t?(e=c-130,0>e?e=0:e>h-260&&(e=h-260)):18>=c?e=c-18:c>=t&&(e=h-260+(c-t));118<c&&c<h-130?p=118:118>=c?18<c?p=c-12:18>=c&&(p=6):c>=h-130&&(c<t?p=118+c-(h-130):c>=t&&(p=118+t-(h-130)));b<=d/2?(r.set(this.domNode,{left:e+"px",top:f+"px",bottom:null}),r.set(this._pointerTop,{left:p+"px"}),a.add(this._pointerBottom,"hidden"),a.remove(this._pointerTop,"hidden")):(r.set(this.domNode,{left:e+"px",top:f-64+"px",bottom:null}),r.set(this._pointerBottom,
{left:p+"px"}),a.add(this._pointerTop,"hidden"),a.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){e.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?l.query(".pointer."+b,this.domNode).removeClass("hidden"):l.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();y.show(this.popupNavigationBar.container);y.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":y.hide(this.popupNavigationBar.container);y.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":y.hide(this.popupNavigationBar.container);y.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new z(a,b.create("div",{},n.body()));m.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});m.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);m.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();y.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},b.create("div",{},n.body()));a.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();m.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});m.connect(this.popupInfoView,"onSwipeLeft",this,function(){});m.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var b="\x26nbsp;",c="\x26nbsp;",d=this.selectedIndex,g=this.features,h=this.deferreds,e=this._prevFeatureButton.parentNode,f=this._nextFeatureButton.parentNode,p=this._spinner,r=this._nls;g&&1<=g.length?(b=g[d].getTitle(),c=d+1+" of "+g.length,a.remove(this._arrowButton,"hidden"),0===d?(a.add(e,"hidden"),a.add(this._prev,"hidden")):(a.remove(e,"hidden"),a.remove(this._prev,"hidden")),d===g.length-1?(a.add(f,"hidden"),
a.add(this._next,"hidden")):(a.remove(f,"hidden"),a.remove(this._next,"hidden"))):(a.add(this._arrowButton,"hidden"),a.add(e,"hidden"),a.add(f,"hidden"),a.add(this._prev,"hidden"),a.add(this._next,"hidden"));this.setTitle(b,c);this.popupNavigationBar.getItems()[1]._node.innerHTML=c;h&&h.length?(a.remove(p,"hidden"),this.setTitle(r.NLS_searching+"...","\x26nbsp;")):(a.add(p,"hidden"),g&&g.length||this.setTitle("No Information","\x26nbsp;"))}});d("extend-esri")&&k.setObject("dijit.PopupMobile",q,A);
return q})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b){q=q(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(a,e){var g;this.container=d.byId(e);this._touchBase=b(this.container,null);this._slideDiv=
h.create("div",null,this.container,"first");this.events=[];this._items=a.items;a.sections&&(this._sections=a.sections);c.add(this.container,"esriMobileInfoView");if(0===this._sections.length)h.create("div",{},this._slideDiv);else for(g=0;g<this._sections.length;g++){var f=h.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);h.create("div",{innerHTML:this._sections[g].title},f)}for(g=0;g<this._items.length;g++){var p,f=0;this._items[g].section&&(f=this._items[g].section);switch(this._items[g].type){case "div":p=
h.create("div",{"class":"esriMobileInfoViewItem",style:this._items[g].style},this._slideDiv.childNodes[f]),p=h.create("div",{innerHTML:this._items[g].text},p)}this._items[g].className&&c.add(p,this._items[g].className);p._index=g;p._item=this._items[g];this._items[g]._node=p}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){k.forEach(this.events,m.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(a){a._index=null;
a._item=null;h.destroy(a);a=null});this._items=null;h.destroy(this._slideDiv);h.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(m.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(m.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(m.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){m.disconnect(this.events.pop());m.disconnect(this.events.pop());m.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(this._moveDirection=Math.abs(a.curY)>Math.abs(a.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=p.getContentBox(this.container);var c=0>this._velocity?.001:-.001;b=-(this._velocity*this._velocity)/(2*c);var d=-this._velocity/c,c=3*.6-0,h=1-c,e=0,f=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,f=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(d/20);a<b;a++)if(e=(20*h*a^3)+(20*c*a^2)+0*a+0,e=0>this._velocity?-e:e,0<this.contentOffsetY+e){f=20*a;break}0===f&&(f=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
b)+a.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=a.h-this._slideDiv.scrollHeight,a=0,b=Math.floor(d/20);a<b;a++){if(e=(20*h*a^3)+(20*c*a^2)+0*a+0,e=0>this._velocity?-e:e,Math.abs(this.contentOffsetY+e)>this._slideDiv.scrollHeight){f=20*a;break}}else f=d,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+f+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=p.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),
a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}});n("extend-esri")&&f.setObject("dijit.InfoView",q,a);return q})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(q,f,k,m,e,n){q=q(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(e,d){this.domNode=m.byId(e);this.events=[k.connect(this.domNode,"touchstart",this,this._touchStartHandler),k.connect(this.domNode,"touchmove",this,this._touchMoveHandler),k.connect(this.domNode,"touchend",this,this._touchEndHandler),k.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(e){this._preventDefault=e},disableOnClick:function(){k.disconnect(this.events.pop())},
_clickHandler:function(e){if(this._moved)e.preventDefault();else this.onclick(e)},_touchStartHandler:function(e){this._moved=!1;this.client_x=e.targetTouches[0].clientX;this.client_y=e.targetTouches[0].clientY;this.down_x=e.targetTouches[0].pageX;this.down_y=e.targetTouches[0].pageY;e.downX=this.down_x;e.downY=this.down_y;this.onTouchStart(e)},_touchMoveHandler:function(e){this._preventDefault&&e.preventDefault();this._moved=!0;this.up_x=e.targetTouches[0].pageX;this.cur_x=e.targetTouches[0].pageX-
this.down_x;this.cur_y=e.targetTouches[0].pageY-this.down_y;e.curX=this.cur_x;e.curY=this.cur_y;this.onTouchMove(e)},_touchEndHandler:function(e){this._moved?(e.curX=this.cur_x,e.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?e.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(e.swipeDirection="right")):(e.clientX=this.client_x,e.clientY=this.client_y);this.onTouchEnd(e)},onTouchStart:function(e){},onTouchMove:function(e){},onTouchEnd:function(e){},onclick:function(e){}});
e("extend-esri")&&f.setObject("dijit._TouchBase",q,n);return q})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a){q=q(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(a,g){var b;this.container=d.byId(g);this._touchBase=p(this.container,null);this._slideDiv=
h.create("div",{},this.container,"first");this.events=[k.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=a.items;c.add(this.container,"esriMobileNavigationBar");var e=h.create("div",{},this._slideDiv);for(b=0;b<this._items.length;b++){var f,l;switch(this._items[b].type){case "img":l=h.create("div",{"class":"esriMobileNavigationItem"},e);f=h.create("img",{src:this._items[b].src.toString(),style:{width:"100%",height:"100%"}},l);break;case "span":l=h.create("div",{"class":"esriMobileNavigationItem"},
e);f=h.create("span",{innerHTML:this._items[b].text},l);break;case "div":l=h.create("div",{"class":"esriMobileNavigationInfoPanel"},e),f=h.create("div",{innerHTML:this._items[b].text},l)}c.add(l,this._items[b].position);this._items[b].className&&c.add(f,this._items[b].className);f._index=b;f._item=this._items[b];this._items[b]._node=f}},startup:function(){this.onCreate(this._items)},destroy:function(){m.forEach(this.events,k.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(a){a._index=
null;a._item=null;h.destroy(a);a=null});this._items=null;h.destroy(this._slideDiv);h.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var b=a.target,c=b._item;e.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===c.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(b,c)}},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))},_markSelected:function(a,c){c.toggleState="ON";c.srcAlt&&(a.src=c.srcAlt);this.onSelect(c)},_markUnSelected:function(a,c){"ON"===c.toggleState&&(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c))}});n("extend-esri")&&f.setObject("dijit.NavigationBar",q,a);
return q})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),function(q,f,k,m,e,n,l,d){var c=1E3,h=1E4;return q([f,d],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(d){this.inherited(arguments);"animationDuration"in d&&(c=d.animationDuration);"autoCloseInterval"in d&&(h=d.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&m.addClass(this.domNode,"mobile");var c=m.create("div",{"class":"appstate-header"});m.create("div",{"class":"appstate-title",innerHTML:this.nls.title},c);var a=m.create("div",{"class":"appstate-close"},c);m.place(c,this.domNode);c=m.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});m.place(c,this.domNode);this.own(e(c,"click",k.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(e(a,"click",k.hitch(this,
function(){this.hide()})));this.own(e(this.domNode,n.enter,k.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(e(this.domNode,n.leave,k.hitch(this,function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(k.hitch(this,this.hide),h))})))},show:function(){l.animateProperty({node:this.domNode,duration:c,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:k.hitch(this,
function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(k.hitch(this,this.hide),h)},hide:function(){0!==this.currentState&&l.animateProperty({node:this.domNode,duration:c,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:k.hitch(this,function(){this.currentState=0;m.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A){function y(a,b){var d=a.center.split(";");1===d.length&&(d=a.center.split(","));if(2===d.length||3===d.length){var g=parseFloat(d[0]),e=parseFloat(d[1]);if(isNaN(g)||isNaN(e))g=parseFloat(d[0]),e=parseFloat(d[1]);if(!isNaN(g)&&!isNaN(e)){var h=4326;3!==d.length||isNaN(d[2])||(h=parseInt(d[2],10));d=new n(g,e,new c(h));N(d.spatialReference,b.spatialReference)?b.centerAt(d):I(d,b.spatialReference,function(a){b.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function w(a,b){var d=a.extent.split("wkt\x3d"),g=null;2===d.length?(g=d[1],d=d[0],d=d.split(",")):(d=a.extent.split(";"),1===d.length&&(d=a.extent.split(",")));if(4===d.length||5===d.length){var e=parseFloat(d[0]),h=parseFloat(d[1]),f=parseFloat(d[2]),p=parseFloat(d[3]);if(isNaN(e)||isNaN(e)||isNaN(e)||isNaN(e))e=parseFloat(d[0]),h=parseFloat(d[1]),f=parseFloat(d[2]),p=parseFloat(d[3]);if(isNaN(e)||isNaN(h)||isNaN(f)||isNaN(p))console.error("Wrong extent parameters.");else{var r=4326;5!==d.length||
isNaN(d[4])||(r=parseInt(d[4],10));d=null;d=g?new l(e,h,f,p,new c({wkt:g})):new l(e,h,f,p,new c({wkid:r}));N(b.spatialReference,d.spatialReference)?b.setExtent(d):I(d,b.spatialReference,function(a){b.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function B(a,d){var g=null;if(a.markertemplate){g={title:"",content:"",isIncludeShareUrl:!1};try{var e=JSON.parse(decodeURIComponent(a.markertemplate));q.mixin(g,e)}catch(T){console.error("urlParams: \x26markertemplate JSON.parse error."+
T.stack)}}e=a.marker.split(";");1===e.length&&(e=a.marker.split(","));if(2<=e.length&&6>=e.length&&e[0].length&&!isNaN(e[0])&&e[1].length&&!isNaN(e[1])){var h=parseFloat(e[0]),f=parseFloat(e[1]),p=4326;3<=e.length&&e[2].length&&!isNaN(e[2])&&(p=parseInt(e[2],10));var r="";4<=e.length&&(r=e[3]);var t=null;5<=e.length&&0===e[4].indexOf("http")&&(t=e[4]);var u=null;6===e.length&&(u=e[5]);var l=b.fromJson({type:"esriPMS",url:t,contentType:"image/png"}),m=null;u&&(m=b.fromJson({color:[0,0,0,255],type:"esriTS",
verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:u}));F(l).then(function(){var a=new n(h,f,new c({wkid:p}));N(a.spatialReference,d.spatialReference)?x(a,l,m,r,g,d):I(a,d.spatialReference,function(a){x(a[0],l,m,r,g,d)},function(){console.error("Project center point error.")})})}}function x(a,b,c,d,e,h){d=new t("",d);if(e){var f=A.getXyContent(e);e.isIncludeShareUrl&&(e=A.getShareUrl(h,
e,!0),e=A.getShareUrlContent(e),f+=e);d.setContent(f)}f=new r({id:"marker-feature-action-layer"});h.addLayer(f);d=new g(a,b,null,d);f.add(d);c&&(c.xoffset=b.width/2,c.yoffset=b.height/2+b.yoffset,b=new g(new n(a.toJson()),c),f.add(b),d._textSymbol=b);h.centerAt(a)}function F(a){var b=new k;a.url?v.getImagesSize(a.url).then(function(c){a.width=c[0];a.height=c[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):
(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function E(a,b){var c=a.query.split(";");1===c.length&&(c=a.query.split(","));if(2!==c.length&&3!==c.length)console.error("query URL parameter is not correct.");else{var d=c[0];K("name",d,b).then(function(a){null===a?K("id",d,b).then(function(a){null===a?console.error("Invalid layer name or id."):D(b,a,c)}):D(b,a,c)})}}function D(a,b,c){var g=new u,e="";g.outSpatialReference=
a.spatialReference;if(2===c.length)g.where=c[1];else if(3===c.length&&(b.layerObject.url&&v.isHostedService(b.layerObject.url)&&v.containsNonLatinCharacter(c[2])&&(e="N"),f.forEach(b.layerObject.fields,function(a){if(a.alias.toLowerCase()===c[1].toLowerCase()||a.name.toLowerCase()===c[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?g.where=a.name+"\x3d"+c[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&
(g.where=c[1]+"\x3d"+e+"'"+c[2].replace(/\'/g,"''")+"'")},this),!g.where)){console.error("Invalid field name or type in query URL parameter.");return}g.maxAllowableOffset=1E-5;b.layerObject.queryFeatures(g).then(function(c){c=c.features;if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===b.layerObject.geometryType&&1===c.length)a.setExtent(d.getExtentForScale(a,1E3)),a.centerAt(c[0].geometry);else{var g=v.graphicsExtent(c);a.setExtent(g)}G(a,b,c)}},function(a){console.error(a)})}
function G(a,b,c){function d(a){f.forEach(c,function(b){b.setInfoTemplate(a)})}function g(){a.infoWindow.setFeatures(c);a.infoWindow.show(H(c[0]))}if(a.getLayer(b.layerInfo.id))g();else{var e=b.layerInfo.getInfoTemplate();e?(d(e),g()):b.layerInfo.loadInfoTemplate().then(function(a){d(a);g()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===
a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function K(a,b,c){var d=new k,g=[];z.getInstance(c,c.itemInfo).then(function(c){c.traversal(function(c){if(d.isResolved())return!0;("id"===a&&c.id.toLowerCase()===b.toLowerCase()||"name"===a&&c.title.toLowerCase()===b.toLowerCase())&&g.push(e({layerType:c.getLayerType(),layerObject:c.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&d.resolve({layerInfo:c,layerObject:a.layerObject})},
function(a){console.error("Find layer error from query URL parameter",a);d.resolve(null)}))});e(g).then(function(){d.isResolved()||d.resolve(null)})});return d}function I(b,c,d,g){var e=[102113,102100,3857],f;4326===b.spatialReference.wkid&&L(e,c.wkid)?(b.ymin=Math.max(b.ymin,-89.99),b.ymax=Math.min(b.ymax,89.99),b=a.geographicToWebMercator(b),(g=b.spatialReference._getInfo())&&b.xmin>b.xmax&&(e=g.valid[1]-b.xmin,f=b.xmax-g.valid[0],e>f?b.xmax=g.valid[1]+f:b.xmin=g.valid[0]-e),b.spatialReference.wkid=
c.wkid,d([b],null)):L(e,b.spatialReference.wkid)&&4326===c.wkid?(b=a.webMercatorToGeographic(b),(g=b.spatialReference._getInfo())&&b.xmin>b.xmax&&(e=g.valid[1]-b.xmin,f=b.xmax-g.valid[0],e>f?b.xmax=g.valid[1]+f:b.xmin=g.valid[0]-e),d([b],null)):(e=new h,e.geometries=[b],e.outSR=c,p.defaults.geometryService.project(e,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&
!isNaN(a[0].y)&&d(a,null):d(a,null)},g))}function N(a,b){var c=[102113,102100,3857];return a&&b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&L(c,a.wkid)&&L(c,b.wkid)?!0:!1}function L(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return{postProcessUrlParams:function(a,b){if("extent"in a)return w(a,b);if("center"in a)return y(a,b);if("marker"in a)return B(a,b);
if("find"in a)m.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return E(a,b)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(q,f,k,m,e,n,l,d,c,h){var p={getBaseHrefUrl:function(a){var b="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",d="";window.isXT?d=window.location.protocol+
"//"+window.location.host+window.appInfo.appPath:(d=c.urlToObject(window.location.href).query||{},d=d.appid?a+"apps/"+b+"/index.html?appid\x3d"+d.appid:d.id?a+"apps/"+b+"/index.html?id\x3d"+d.id:c.getAppHref());return d},addQueryParamToUrl:function(a,b,c,d){a=h.urlToObject(a);a.query||(a.query={});a.query[b]=c;b=a.path;for(var g in a.query)c=a.query[g],!0===d&&(c=encodeURIComponent(c)),b=b===a.path?b+"?"+g+"\x3d"+c:b+"\x26"+g+"\x3d"+c;return b},removeQueryParamFromUrl:function(a,b,c){a=h.urlToObject(a);
a.query&&delete a.query[b];b=a.path;for(var d in a.query){var g=a.query[d];!0===c&&(g=encodeURIComponent(g));b=b===a.path?b+"?"+d+"\x3d"+g:b+"\x26"+d+"\x3d"+g}return b},getShareUrlContent:function(a){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+a+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},
getShareUrl:function(a,b,c){var d=p.getBaseHrefUrl(window.portalUrl),g="",e,h,f,l,m;b&&(b.longitude&&b.latitude?(e=b.longitude,h=b.latitude,g=b.longitude+","+b.latitude+","):b.x&&b.y&&b.spatialReference&&b.spatialReference.wkid&&(f=b.x,l=b.y,m=b.spatialReference.wkid,g=b.x+","+b.y+","+b.spatialReference.wkid));d=p.addQueryParamToUrl(d,"marker",g,!0);d=p.addQueryParamToUrl(d+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:b.title,x:f,y:l,wkid:m,longitude:e,latitude:h,isIncludeShareUrl:c})));
b=a.getLevel();return d="number"===typeof b&&-1!==b?p.addQueryParamToUrl(d,"level",a.getLevel(),!0):p.addQueryParamToUrl(d,"scale",a.getScale(),!0)},getXyContent:function(a){var b="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";a.longitude&&a.latitude?b+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+c.localizeNumber(parseFloat(a.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+c.localizeNumber(parseFloat(a.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":a.x&&a.y&&(b+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+c.localizeNumber(parseFloat(a.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+c.localizeNumber(parseFloat(a.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");
return b+"\x3c/div\x3e"},_isUserOwnTheApp:function(a){return a&&a.username&&a.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(a,b,c,d){var g=new e;d=m.getStandardPortalUrl(d);d=d+"/sharing/rest/content/users/"+(b?b.username?b.username:b.email:c.email);if(n.isDefined(a.folderId)&&"/"!==a.folderId||n.isDefined(a.ownerFolder)&&"/"!==a.ownerFolder)d+="/"+(a.folderId||a.ownerFolder);d+="/items/"+a.id;f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,
function(a){g.resolve(a)}),q.hitch(this,function(a){console.error(a);g.reject(a)}));return g},_getProfile:function(a,b){var c=new e,d=m.getUserUrl(b,a.owner);f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_unshareItemById:function(a,b,c){var d=new e;c=m.getStandardPortalUrl(c);c+="/sharing/rest/content/items/"+b+"/unshare";b={f:"json"};b=q.mixin(b,a);f({url:c,
handleAs:"json",content:b,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){d.resolve(a)}),q.hitch(this,function(a){console.error(a);d.reject(a)}));return d},canSharePublic:function(a){return!a.selfUrl||!0!==a.canSharePublic&&!1!==a.canSharePublic?!0:a.canSharePublic},unshareItemsByUser:function(a,b,c){var d=new e;c=m.getStandardPortalUrl(c);c+="/sharing/rest/content/users/"+a+"/unshareItems";a={f:"json"};a=q.mixin(a,b);f({url:c,handleAs:"json",content:a,callbackParamName:"callback"},
{usePost:!0}).then(q.hitch(this,function(a){d.resolve(a)}),q.hitch(this,function(a){console.error(a);d.reject(a)}));return d},unshareItems:function(a,b,c){var d=new e;c=m.getStandardPortalUrl(c);c+="/sharing/rest/content/users/"+(b.owner||a.email)+"/unshareItems";a={f:"json"};a=q.mixin(a,b);f({url:c,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){d.resolve(a)}),q.hitch(this,function(a){console.error(a);d.reject(a)}));return d},shareItemsByUser:function(a,
b,c){var d=new e;c=m.getStandardPortalUrl(c);c+="/sharing/rest/content/users/"+a+"/shareItems";a={f:"json"};a=q.mixin(a,b);f({url:c,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){d.resolve(a)}),q.hitch(this,function(a){console.error(a);d.reject(a)}));return d},shareItems:function(a,b,c){var d=new e;c=m.getStandardPortalUrl(c);c+="/sharing/rest/content/users/"+(b.owner||a.email)+"/shareItems";a={f:"json"};a=q.mixin(a,b);f({url:c,handleAs:"json",
content:a,callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){d.resolve(a)}),q.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getItemsGroups:function(a,b){var c=new e,d=m.getStandardPortalUrl(b),d=d+("/sharing/rest/content/items/"+a.id+"/groups");f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){console.error(a);c.reject(a)}));return c},isSharedToPublic:function(a){return window.isXT?
!1:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"public"===a.item.access?!0:!1},isShowSocialMediaLinks:function(a){return window.isXT?!0:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"private"===a.item.access?!1:!0},getItemShareInfo:function(a){var b=new e,d="";if(window.isXT)return b.resolve(null);d=c.urlToObject(c.getAppHref()).query||{};d=d.id||d.appid;if("undefined"===typeof d||""===
d)return b.resolve(null);l.getPortal(a).getItemById(d).then(q.hitch(this,function(a){var c={};c.item=a;c.item&&"undefined"===typeof c.item.sharing&&c.item.access&&(c.item.sharing={access:c.item.access});b.resolve(c)}),q.hitch(this,function(a){console.log(a);b.resolve(null)}));return b},getShareInfo:function(a){var b=l.getPortal(a),d=new e,h="";if(window.isXT)return d.resolve(null);h=c.urlToObject(c.getAppHref()).query||{};h=h.id||h.appid;if("undefined"===typeof h||""===h)return d.resolve(null);k({getUser:b.getUser(),
loadSelfInfo:b.loadSelfInfo(),getItem:b.getItemById(h)}).then(q.hitch(this,function(b){var c={};c.item=b.getItem;c.item&&c.item.ownerFolder&&c.item.ownerFolder.length&&"/"!==c.item.ownerFolder&&(c.item.folderId=c.item.ownerFolder);"undefined"===typeof c.item.sharing&&c.item.access&&(c.item.sharing={access:c.item.access});c.user=b.getUser;p._setUserRole(b.loadSelfInfo,c);c.currentUser=c.user;c.isAdmin=!1;c.userRole&&(c.userRole.isAdmin()||c.userRole.isCustom()&&c.userRole.canUpdateOrgItems())?(c.isAdmin=
!0,c.item.owner!==c.currentUser.name?p._getProfile(c.item,a).then(q.hitch(this,function(a){c.itemUser=a;c.itemUser.orgId!==c.currentUser.orgId&&(c.isAdmin=!1);d.resolve(c)})):(c.itemUser=c.currentUser,d.resolve(c))):(c.currentUser&&(c.itemUser=c.currentUser),d.resolve(c))}),q.hitch(this,function(a){console.log(a);d.resolve(null)}));return d},_setUserRole:function(a,b){b.userPortalUrl=a.urlKey?a.urlKey+"."+a.customBaseUrl:this.portalUrl;!a||a.code||a.message||(b.organization=a);if(a&&a.user)b.userRole=
new d({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role}),b._isCustomRole=b.userRole.isCustom(),b._roleCanShareToGroup=b._isCustomRole&&b.userRole.canShareItemToGroup(),b._roleCanShareToOrg=b._isCustomRole&&b.userRole.canShareItemToOrg(),b._roleCanSharePublic=b._isCustomRole&&b.userRole.canShareItemToPublic(),b._roleCanShare=b._roleCanShareToGroup||b._roleCanShareToOrg||b._roleCanShareToPublic,b._roleCanUpdateItems=b._isCustomRole&&b.userRole.canUpdateOrgItems(),b._roleCanShareOthersItemsToGroup=
b._isCustomRole&&b.userRole.canShareOthersItemsToGroup(),b._roleCanShareOthersItemsToOrg=b._isCustomRole&&b.userRole.canShareOthersItemsToOrg(),b._roleCanShareOthersItemsToPublic=b._isCustomRole&&b.userRole.canShareOthersItemsToPublic(),b._roleCanShareOthersItems=b._isCustomRole&&(b.userRole.canShareOthersItemsToGroup()||b.userRole.canShareOthersItemsToOrg()||b._roleCanShareOthersItemsToPublic),b._orgUserCanSharePublicOrOverride=b.organization&&(!0===b.organization.canSharePublic&&(!b._isCustomRole||
b._roleCanSharePublic||b._roleCanShareOthersItemsToPublic)||b.userRole.isAdmin());else return!1},getItemById:function(a,b){var c=new e,d=m.getStandardPortalUrl(b),d=d+("/sharing/rest/content/items/"+a.id);f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){console.error(a);c.reject(a)}));return c}};return p})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector".split(" "),
function(q,f,k,m,e,n,l,d,c,h){var p=null,a=q(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){f.mixin(this,a);this.popupMenu=c.getInstance();this.isInited=!1;this.featureActionManager=l.getInstance();m.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));m.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));m.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));m.subscribe("widgetsActionsRegistered",f.hitch(this,
this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&k.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&k.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=
k.create("span",{"class":"popup-menu-button"},n(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=n("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=k.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=k.create("span",{"class":"popup-menu-button"},a);e(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));e(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=
k.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){e(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));e(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),a=this.selectedFeature.getLayer(),(this.selectedFeature.infoTemplate||a&&a.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):
this._disablePopupMenu()},_disablePopupMenu:function(){k.addClass(this.popupMenuButtonDesktop,"disabled");k.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){k.removeClass(this.popupMenuButtonDesktop,"disabled");k.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(a){if(a){var b=d.toFeatureSet(a);this.featureActionManager.getSupportedActions(b).then(f.hitch(this,function(a){var c="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent".split(" ");
a=a.filter(f.hitch(this,function(a){return 0>c.indexOf(a.name)}));0===a.length?this._disablePopupMenu():this._enablePopupMenu();a=a.map(f.hitch(this,function(a){a.data=b;return a}));this.popupMenu.setActions(a)}))}else this._disablePopupMenu(),this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),
this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new h({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(g){console.warn(g.message)}}});
a.getInstance=function(b){null===p&&(p=new a({mapManager:b}));return p};return a})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(q,f,k,m,e,n,l,d){var c=null,h=q(null,{constructor:function(){this._actions=[];window.isBuilder?(m.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",
f.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(m.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(m.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),m.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(c){c=
this._getFeatureSet(c);var a=[];k.forEach(this._actions,function(b){var d=this.testActionSupportFeature(b,c);d.action=b;a.push(d)},this);return n(a).then(f.hitch(this,function(a){return a.map(f.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},testActionSupportFeature:function(c,a){a=this._getFeatureSet(a);var b;a.features&&0<a.features.length&&(b=a.features[0].getLayer());b=c.isFeatureSupported(a,b);var d=
new e;b&&"function"===typeof b.then?b.then(function(a){d.resolve(a)},function(a){console.error(a);d.resolve(!1)}):d.resolve(b);return d},registerAction:function(c){var a=new e;require([c.uri],f.hitch(this,function(b){var d=new b({map:this.map,appConfig:this.appConfig,label:c.label,name:c.name,widgetId:c.widgetId});k.some(this._actions,function(a){return d.name===a.name&&d.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",d.name),a.reject("Feature/FeatureSet action has been registered.",
d.name)):(this._actions.push(d),a.resolve(d))}));return a},removeActionsByWidgetId:function(c){this._actions=k.filter(this._actions,function(a){return a.widgetId!==c},this)},getActionsByWidgetId:function(c){return k.filter(this._actions,function(a){return a.widgetId===c},this)},getActionsByActionName:function(c){return k.filter(this._actions,function(a){return a.name===c},this)},registerWidgetFeatureActions:function(c){var a=new e;if(!c.featureActions||!c.uri)return a.resolve(),a;var b=[];k.forEach(c.featureActions,
function(a){b.push(this.registerAction({uri:c.isRemote?c.amdFolder+a.uri+".js":c.amdFolder+a.uri,widgetId:c.id,name:a.name,label:c.manifest["i18nLabels_featureAction_"+a.name][window.dojoConfig.locale]||c.manifest["i18nLabels_featureAction_"+a.name].defaultLabel}))},this);return n(b)},registerAllWidgetFeatureActions:function(c){var a=[];c.visitElement(f.hitch(this,function(b){b.uri&&b.visible&&a.push(this.registerWidgetFeatureActions(b))}));return n(a).then(function(){m.publish("widgetsActionsRegistered")})},
_reRegisterWidgetActions:function(c){var a=[];k.forEach(this.getAllActions(),function(a){var b=c.getConfigElementById(a.widgetId);"framework"===a.widgetId||b&&b.uri&&!1!==b.visible||this.removeActionsByWidgetId(a.widgetId)},this);c.visitElement(f.hitch(this,function(b){b.uri&&b.visible&&0===this.getActionsByWidgetId(b.id).length&&a.push(this.registerWidgetFeatureActions(b))}));0<a.length&&n(a).then(function(){m.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){k.forEach(l,
function(c){this.registerAction({uri:c.uri,widgetId:"framework",label:window.jimuNls.featureActions[c.name],name:c.name})},this)},_getFeatureSet:function(c){return"[object Object]"===Object.prototype.toString.call(c)?c.features?c:d.toFeatureSet([c]):d.toFeatureSet(c)},_onAppConfigLoaded:function(c){this.appConfig=c=f.clone(c);this._setActionsAppConfig(c);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(c){this.appConfig=c=f.clone(c);this._reRegisterWidgetActions(this.appConfig);
this._setActionsAppConfig(c)},_onMapLoaded:function(c){this.map=c;this._setActionsMap(c)},_onMapChanged:function(c){this.map=c;this._setActionsMap(c)},_setActionsMap:function(c){k.forEach(this._actions,function(a){a.setMap(c)},this)},_setActionsAppConfig:function(c){k.forEach(this._actions,function(a){a.setAppConfig(c)},this)}});h.getInstance=function(){null===c&&(c=new h,window._featureActionManager=c);return c};return h})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(q,f,k){return q(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){k.featureAction.zoomTo(this.map,
f.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(q,f){return q(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(k){f.mixin(this,k)},isFeatureSupported:function(f,m){return!0},onExecute:function(f,m){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+
this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(q,f,k){return q(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(f){return 0<f.features.length&&f.geometryType},onExecute:function(f){k.featureAction.panTo(this.map,f.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(q,f,k,m){return q([k],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(e,m){if(1>e.features.length||!m)return!1;var l=e.features[0],d=f.getObject("renderer.symbol",!1,m);return l&&l.geometry&&(l.symbol||d)&&this.map.getLayer(m.id)},onExecute:function(e,f){m.featureAction.flash(e&&e.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(q,
f,k){return q([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(f,e){return f&&f.features&&1===f.features.length&&e&&e.infoTemplate},onExecute:function(f){k.featureAction.showPopup(this.map,f.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,k){return q(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length},onExecute:function(f){f=
k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(k.FORMAT_CSV);f.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./GeojsonConverters".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,
r,t){function u(a,b){var c="",d=b.length,e=a.length,g="",h="",f;try{k.forEach(a,function(a){c="string"===typeof a?c+g+a:c+g+(a.alias||a.name);g=","});for(var c=c+"\r\n",p=0;p<d;p++){g="";f=b[p];for(var t=0;t<e;t++){var u=a[t];(h=f["string"===typeof u?u:u.name])||"number"===typeof h||(h="");h&&("esriFieldTypeDate"===u.type?h=r.localizeDateByFieldInfo(h,u.fieldInfo):!u.fieldInfo||"esriFieldTypeDouble"!==u.type&&"esriFieldTypeSingle"!==u.type&&"esriFieldTypeInteger"!==u.type&&"esriFieldTypeSmallInteger"!==
u.type||(h=r.localizeNumberByFieldInfo(h,u.fieldInfo)));h&&/[",\r\n]/g.test(h)&&(h='"'+h.replace(/(")/g,'""')+'"');c=c+g+h;g=","}c+="\r\n"}return c}catch(L){return""}}var v={createDataSource:function(a){return a.type===v.TYPE_TABLE?new y(a):a.type===v.TYPE_FEATURESET?new A(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},z=q(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,constructor:function(){this.nls=
window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(f.hitch(this,function(a){var b=this.filename+this.suffix;10>dojo.isIE?saveTextAs(a,b,"utf-8"):(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,b))}))},exportToPortal:function(a,b){}}),A=q(z,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;this.url=a.url;this.filename=a.filename},
getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===v.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===v.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV},{value:v.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},{value:v.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},
_getFeatureSet:function(){var a=new e;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var b=new n;b.returnGeometry=!0;b.outFields=["*"];this.queryTask=new l(this.url);this.queryTask.execute(b,f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var b;k.some(a.features,function(a){if(a.geometry&&a.geometry.spatialReference)return b=a.geometry.spatialReference,
!0});return b},_projectToWGS84:function(g){var f=new e,t=this._getSpatialReference(g);if(t)if(4326===parseInt(t.wkid,10))f.resolve(g);else if(t.isWebMercator()){var t=new d,u=[];k.forEach(g.features,function(a){var d=new c;d.attributes=a.attributes;d.geometry=b.webMercatorToGeographic(a.geometry);u.push(d)});t.features=u;f.resolve(t)}else{t=new p;t.geometries=k.map(g.features,function(a){return a.geometry});t.outSR=new h(4326);var l=a&&a.defaults&&a.defaults.geometryService;l&&"esri.tasks.GeometryService"===
l.declaredClass||(l=r.getArcGISDefaultGeometryService());l.project(t).then(function(a){var b=new d,e=[];k.forEach(g.features,function(b,d){var g=new c;g.attributes=b.attributes;g.geometry=a[d];e.push(g)});b.features=e;f.resolve(b)},function(a){console.error(a);f.resolve([])})}else f.resolve([]);return f},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(a=a.toJson())&&(b=m.stringify(a));return b}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,
function(a){return this._projectToWGS84(a)})).then(f.hitch(this,function(a){var b="";if(a&&a.features&&0<a.features.length){var c={type:"FeatureCollection",features:[]};k.forEach(a.features,function(a){c.features.push(t.arcgisToGeoJSON(a))});b=m.stringify(c)}return b}))},_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(b=this._createCSVFromFeatureSet(a));return b}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a),c=k.map(a.features,
function(b){var c=b.attributes;"esriGeometryPoint"!==a.geometryType&&"point"!==a.geometryType||!b.geometry||(c.x=b.geometry.x,c.y=b.geometry.y,b.geometry.spatialReference&&b.geometry.spatialReference.wkid&&(c.wkid=b.geometry.spatialReference.wkid));return c});return u(b,c)},_generateFields:function(a){var b=a.features[0],c,d,e;b._layer&&(c=b._layer.fields,e=b._layer.id);c=c||a.fields;if(e=g.getInstanceSync().getLayerInfoById(e)){var h=e.getPopupInfo();k.forEach(c,f.hitch(this,function(a){a.fieldInfo=
this._findFieldInfo(h,a.name)}))}if(!c||0===c.length)for(d in c=[],b=b.attributes,b)b.hasOwnProperty(d)&&c.push({name:d});a.fieldAliases&&k.forEach(c,function(b){a.fieldAliases[b.name]&&(b.alias=a.fieldAliases[b.name])});if("esriGeometryPoint"===a.geometryType||"point"===a.geometryType)c.push({name:"x",type:"esriFieldTypeDouble",alias:"x"}),c.push({name:"y",type:"esriFieldTypeDouble",alias:"y"}),c.push({name:"wkid",type:"esriFieldTypeInteger",alias:"wkid"});return c},_findFieldInfo:function(a,b){if(!a)return null;
var c;k.some(a.fieldInfos,function(a){if(a.fieldName===b)return c=a,!0});return c}}),y=q(z,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new e;if(this.table)a.resolve(this.table);
else if(this.url){var b=new n;b.outFields=["*"];this.queryTask=new l(this.url);this.queryTask.execute(b,f.hitch(this,function(b){var c={};c.fields=b.fields;c.datas=k.map(b.features,function(a){return a.attributes});a.resolve(c)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,function(a){var b="";a&&(b="\ufeff"+u(a.fields,a.datas));return b}))}});return v})},"jimu/GeojsonConverters":function(){define([],
function(){function q(e){var d;a:{d=e[0];for(var c=0;c<d.length;c++)if(d[c]!==e[e.length-1][c]){d=!1;break a}d=!0}d||e.push(e[0]);return e}function f(e){var d=0,c=0,h=e.length,f=e[c],a;for(c;c<h-1;c++)a=e[c+1],d+=(a[0]-f[0])*(a[1]+f[1]),f=a;return 0<=d}function k(e,d){for(var c=0;c<e.length-1;c++)for(var h=0;h<d.length-1;h++){var f;a:{var a=e[c],b=e[c+1],g=d[h],r=d[h+1],t=(r[0]-g[0])*(a[1]-g[1])-(r[1]-g[1])*(a[0]-g[0]);f=(b[0]-a[0])*(a[1]-g[1])-(b[1]-a[1])*(a[0]-g[0]);a=(r[1]-g[1])*(b[0]-a[0])-(r[0]-
g[0])*(b[1]-a[1]);if(0!==a&&(t/=a,f/=a,0<=t&&1>=t&&0<=f&&1>=f)){f=!0;break a}f=!1}if(f)return!0}return!1}function m(e){var d=[];e=e.slice(0);var c=q(e.shift().slice(0));if(4<=c.length)for(f(c)||c.reverse(),d.push(c),c=0;c<e.length;c++){var h=q(e[c].slice(0));4<=h.length&&(f(h)&&h.reverse(),d.push(h))}return d}function e(e){var d={},c;for(c in e)e.hasOwnProperty(c)&&(d[c]=e[c]);return d}var n={arcgisToGeoJSON:function(l,d){var c={};"number"===typeof l.x&&"number"===typeof l.y&&(c.type="Point",c.coordinates=
[l.x,l.y]);l.points&&(c.type="MultiPoint",c.coordinates=l.points.slice(0));l.paths&&(1===l.paths.length?(c.type="LineString",c.coordinates=l.paths[0].slice(0)):(c.type="MultiLineString",c.coordinates=l.paths.slice(0)));if(l.rings){var h=l.rings.slice(0),c=[],p=[],a,b;for(b=0;b<h.length;b++){var g=q(h[b].slice(0));4>g.length||(f(g)?c.push([g]):p.push(g))}for(g=[];p.length;){b=p.pop();for(var r=!1,h=c.length-1;0<=h;h--){var t=a=c[h][0],u=b;a=k(t,u);for(var u=u[0],m=!1,z=-1,A=t.length,y=A-1;++z<A;y=
z)(t[z][1]<=u[1]&&u[1]<t[y][1]||t[y][1]<=u[1]&&u[1]<t[z][1])&&u[0]<(t[y][0]-t[z][0])*(u[1]-t[z][1])/(t[y][1]-t[z][1])+t[z][0]&&(m=!m);t=m;if(!a&&t){c[h].push(b);r=!0;break}}r||g.push(b)}for(;g.length;){b=g.pop();p=!1;for(h=c.length-1;0<=h;h--)if(a=c[h][0],k(a,b)){c[h].push(b);p=!0;break}p||c.push([b.reverse()])}c=1===c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}if(l.geometry||l.attributes)c.type="Feature",c.geometry=l.geometry?n.arcgisToGeoJSON(l.geometry):null,c.properties=
l.attributes?e(l.attributes):null,l.attributes&&(c.id=l.attributes[d]||l.attributes.OBJECTID||l.attributes.FID);return c},geojsonToArcGIS:function(f,d){d=d||"OBJECTID";var c={wkid:4326},h={};switch(f.type){case "Point":h.x=f.coordinates[0];h.y=f.coordinates[1];h.spatialReference=c;break;case "MultiPoint":h.points=f.coordinates.slice(0);h.spatialReference=c;break;case "LineString":h.paths=[f.coordinates.slice(0)];h.spatialReference=c;break;case "MultiLineString":h.paths=f.coordinates.slice(0);h.spatialReference=
c;break;case "Polygon":h.rings=m(f.coordinates.slice(0));h.spatialReference=c;break;case "MultiPolygon":for(var p=h,a=f.coordinates.slice(0),b=[],g=0;g<a.length;g++)for(var r=m(a[g]),t=r.length-1;0<=t;t--){var u=r[t].slice(0);b.push(u)}p.rings=b;h.spatialReference=c;break;case "Feature":f.geometry&&(h.geometry=n.geojsonToArcGIS(f.geometry,d));h.attributes=f.properties?e(f.properties):{};f.id&&(h.attributes[d]=f.id);break;case "FeatureCollection":h=[];for(c=0;c<f.features.length;c++)h.push(n.geojsonToArcGIS(f.features[c],
d));break;case "GeometryCollection":for(h=[],c=0;c<f.geometries.length;c++)h.push(n.geojsonToArcGIS(f.geometries[c],d))}return h}};return n})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,k){return q(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=k.createDataSource({type:k.TYPE_FEATURESET,
filename:"features",data:f});f.setFormat(k.FORMAT_FEATURESET);f.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(q,f,k){return q(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(k.FORMAT_GEOJSON);f.download()}})})},
"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(q,f,k){return q(f,{iconClass:"icon-statistics",isFeatureSupported:function(f,e){return 1<f.features.length&&e&&"esri.layers.GraphicsLayer"!==e.declaredClass&&0<this.getNumbericFields(e).length},onExecute:function(f,e){var n=new k,l={featureSet:f,layer:e,fieldNames:this.getNumbericFields(e).map(function(d){return d.name})};n.showContentAsPopup(l)},getNumbericFields:function(f){return f.fields.filter(function(e){return-1<
["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r){return q([f],{statInfo:null,postMixInProperties:function(){this.nls=
window.jimuNls.fieldStatistics;k.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=m.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(b){this.statInfo=b;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();
this._statisticsPopup=null;this._statisticsPopup=new a({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(b)},_showOneFieldStatContent:function(a,c){var d;r.isStatFromServer(this.statInfo)&&(d=new b,d.placeAt(c),d.show());r.getStatisticsResult(this.statInfo).then(k.hitch(this,function(a){d&&d.destroy();l(".esriAGOTableStatistics",c).remove();a=this._createStatContent(a);m.place(a,c)}))},_getFieldAliaseFromStatInfo:function(a){if(this.statInfo.layer){var b=
e.filter(this.statInfo.layer.fields,function(b){return b.name===a});return b[0]?b[0].alias:""}return this.statInfo.featureSet.fieldAliases?this.statInfo.featureSet.fieldAliases[a]:a},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=m.create("div",{className:"header"},a);m.create("span",{innerHTML:this.nls.field+": "},b);var c=new h({options:this.statInfo.fieldNames.map(k.hitch(this,function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"}});
this.own(n(c,"change",k.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));c.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=m.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return b},_createStatContent:function(a){var b={},c="count sum min max ave stddev".split(" "),d,g,h,
f,p,r,t,l;d=m.create("div",{className:"esriAGOTableStatistics",innerHTML:""});m.create("div",{className:"hzLine",innerHTML:""},d);g=m.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},d);for(p in a)a.hasOwnProperty(p)&&(b[p.toLowerCase()]=a[p]);p=b.countfield;l=b.sumfield||"";t=b.minfield||"";r=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";h=m.create("tbody",{},g);var n=this;e.forEach([p,l,t,r,a,b],function(a,b){""!==a&&(f=m.create("tr",{valign:"top"},h),
m.create("td",{"class":"attrName",innerHTML:n.nls[c[b]]},f),m.create("td",{"class":"attrValue",innerHTML:a},f))});m.create("div",{className:"break",innerHTML:""},d);return d}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(q,f,k,m,e){function n(c){for(;c.childNodes[0]&&1==c.childNodes[0].nodeType;)c=c.childNodes[0];return c}function l(c,d){"string"==typeof c?(c=m.toDom(c,d&&d.ownerDocument),11==c.nodeType&&
(c=c.childNodes[0])):1==c.nodeType&&c.parentNode&&(c=c.cloneNode(!1));return c}var d=q.NodeList;f.extend(d,{_placeMultiple:function(c,d){for(var e="string"==typeof c||c.nodeType?q(c):c,a=[],b=0;b<e.length;b++)for(var g=e[b],h=this.length,f=h-1,u;u=this[f];f--)0<b&&(u=this._cloneNode(u),a.unshift(u)),f==h-1?m.place(u,g,d):g.parentNode.insertBefore(u,g),g=u;a.length&&(a.unshift(0),a.unshift(this.length-1),Array.prototype.splice.apply(this,a));return this},innerHTML:function(c){return arguments.length?
this.addContent(c,"only"):this[0].innerHTML},text:function(c){if(arguments.length){for(var d=0,f;f=this[d];d++)1==f.nodeType&&e.set(f,"textContent",c);return this}for(var a="",d=0;f=this[d];d++)a+=e.get(f,"textContent");return a},val:function(c){if(arguments.length){for(var d=f.isArray(c),e=0,a;a=this[e];e++){var b=a.nodeName.toUpperCase(),g=a.type,r=d?c[e]:c;if("SELECT"==b)for(b=a.options,g=0;g<b.length;g++){var t=b[g];t.selected=a.multiple?-1!=k.indexOf(c,t.value):t.value==r}else"checkbox"==g||
"radio"==g?a.checked=a.value==r:a.value=r}return this}if((a=this[0])&&1==a.nodeType){c=a.value||"";if("SELECT"==a.nodeName.toUpperCase()&&a.multiple){c=[];b=a.options;for(g=0;g<b.length;g++)t=b[g],t.selected&&c.push(t.value);c.length||(c=null)}return c}},append:function(c){return this.addContent(c,"last")},appendTo:function(c){return this._placeMultiple(c,"last")},prepend:function(c){return this.addContent(c,"first")},prependTo:function(c){return this._placeMultiple(c,"first")},after:function(c){return this.addContent(c,
"after")},insertAfter:function(c){return this._placeMultiple(c,"after")},before:function(c){return this.addContent(c,"before")},insertBefore:function(c){return this._placeMultiple(c,"before")},remove:d.prototype.orphan,wrap:function(c){if(this[0]){c=l(c,this[0]);for(var d=0,e;e=this[d];d++){var a=this._cloneNode(c);e.parentNode&&e.parentNode.replaceChild(a,e);n(a).appendChild(e)}}return this},wrapAll:function(c){if(this[0]){c=l(c,this[0]);this[0].parentNode.replaceChild(c,this[0]);c=n(c);for(var d=
0,e;e=this[d];d++)c.appendChild(e)}return this},wrapInner:function(c){if(this[0]){c=l(c,this[0]);for(var d=0;d<this.length;d++){var e=this._cloneNode(c);this._wrap(f._toArray(this[d].childNodes),null,this._NodeListCtor).wrapAll(e)}}return this},replaceWith:function(c){c=this._normalize(c,this[0]);for(var d=0,e;e=this[d];d++)this._place(c,e,"before",0<d),e.parentNode.removeChild(e);return this},replaceAll:function(c){c=q(c);for(var d=this._normalize(this,this[0]),e=0,a;a=c[e];e++)this._place(d,a,"before",
0<e),a.parentNode.removeChild(a);return this},clone:function(){for(var c=[],d=0;d<this.length;d++)c.push(this._cloneNode(this[d]));return this._wrap(c,this,this._NodeListCtor)}});d.prototype.html||(d.prototype.html=d.prototype.innerHTML);return d})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z){function A(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(d.hitch(this,a,b))}}var y=f("dijit.form._SelectMenu",b,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
d.isArray(b)&&(b=b[b.length-1]);b&&q.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,this.focusChild(c,!1))},this);a||this.inherited(arguments)}});e=f("dijit.form.Select"+(h("dojo-bidi")?"_NoBidi":""),[p,a,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:z,_buttonInputDisabled:h("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new y({id:this.id+"_menu",parentWidget:this});m.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=d.hitch(this,"_setValueAttr",a);a=new g({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,
onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a}return new r({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(w){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{q.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var b=new g({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);k.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?t.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=n.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[l.LEFT_ARROW];delete a[l.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
m.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
h("dojo-bidi")&&(e=f("dijit.form.Select",e,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));e._Menu=y;e.prototype._onContainerKeydown=A("_onContainerKeydown");e.prototype._onContainerKeypress=A("_onContainerKeypress");return e})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b){return e("dijit.form._FormSelectWidget",b,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(c.isArrayLike(a))return q.map(a,"return this.getOptions(item);",this);c.isString(a)&&(a={value:a});c.isObject(a)&&(q.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){q.forEach(c.isArrayLike(a)?a:[a],function(a){a&&c.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(c.isArrayLike(a)?
a:[a]);q.forEach(a,function(a){a&&(this.options=q.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){q.forEach(c.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){d.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(b,d,e){var h=this.store;e=e||{};if(h!==b){for(var g;g=this._notifyConnections.pop();)g.remove();b.get||(c.mixin(b,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(b,d){var e=new f(function(){h.abort&&h.abort()});e.total=new f;var h=this.fetch(c.mixin({query:b,onBegin:function(a){e.total.resolve(a)},
onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},d));return new a(e)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[k.after(b,"onNew",c.hitch(this,"_onNewItem"),!0),k.after(b,"onDelete",c.hitch(this,"_onDeleteItem"),!0),k.after(b,"onSet",c.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);e.query&&this._set("query",e.query);e.queryOptions&&this._set("queryOptions",e.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=b.query(this.query,this.queryOptions),p(this._queryRes,c.hitch(this,function(a){if(this.sortByLabel&&!e.sort&&a.length)if(b.getValue)a.sort(m.createSortFunction([{attribute:b.getLabelAttributes(a[0])[0]}],b));else{var h=this.labelAttr;a.sort(function(a,b){return a[h]>b[h]?1:b[h]>
a[h]?-1:0})}e.onFetch&&(a=e.onFetch.call(this,a,e));q.forEach(a,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(c.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(a):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),c.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return h},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=c.isArrayLike(a)?q.map(a,function(a){return c.isObject(a)?a:{value:a}}):c.isObject(a)?[a]:[{value:a}];a=q.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!d.length||(a[0]=
d[0]);q.forEach(d,function(b){b.selected=q.some(a,function(a){return a.value===b.value})});d=q.map(a,function(a){return a.value});if("undefined"!=typeof d&&"undefined"!=typeof d[0]){var e=q.map(a,function(a){return a.label});this._setDisplay(this.multiple?e:e[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=q.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(q.forEach(this._getChildren(),function(a){a.destroyRecursive()}),q.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;q.forEach(this._getChildren(),function(c){var d=q.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);l.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=q.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?q.map(q.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);n.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?h("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+d._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);k.after(this,"onChange",c.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(q){var f={};q.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,m){var e=-1;null===f&&(f=void 0);null===m&&(m=void 0);if(f==m)e=0;else if(f>m||null==f)e=1;return e};f.createSortFunction=function(k,m){function e(a,c,d,e){return function(b,h){var g=e.getValue(b,a),f=e.getValue(h,
a);return c*d(g,f)}}for(var n=[],l,d=m.comparatorMap,c=f.basicComparator,h=0;h<k.length;h++){l=k[h];var p=l.attribute;if(p){l=l.descending?-1:1;var a=c;d&&("string"!==typeof p&&"toString"in p&&(p=p.toString()),a=d[p]||c);n.push(e(p,l,a,m))}}return function(a,c){for(var b=0;b<n.length;){var d=n[b++](a,c);if(0!==d)return d}return 0}};return f})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(q,f,k,m){return q("dijit.DropDownMenu",
m,{templateString:k,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else e.stopPropagation(),e.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r){return f("dijit._MenuBase",[a,r,g,b],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){e.toggle(this.domNode,"dijitMenuActive",a);e.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=p.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:n.hitch(this,"childSelector");this.own(d(this.containerNode,d.selector(b,l.enter),function(){a.onItemHover(p.byNode(this))}),d(this.containerNode,d.selector(b,l.leave),function(){a.onItemUnhover(p.byNode(this))}),d(this.containerNode,d.selector(b,h),function(b){a.onItemClick(p.byNode(this),b);b.stopPropagation()}),
d(this.containerNode,d.selector(b,"focusin"),function(){a._onItemFocus(p.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=d.once(c.domNode,"mouseover",n.hitch(this,"_onPopupHover")));var e=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
e.focusChild(a);e._cleanUp()},onExecute:n.hitch(this,"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(m.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(q,f,k,m,e,n,l,d,c,h){return f("dijit._KeyNavContainer",[c,h,d],{connectKeyNavHandlers:function(c,a){var b=this._keyNavCodes={},d=n.hitch(this,"focusPrev"),h=n.hitch(this,"focusNext");q.forEach(c,function(a){b[a]=d});q.forEach(a,function(a){b[a]=h});b[e.HOME]=n.hitch(this,"focusFirstChild");b[e.END]=n.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){m.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);q.forEach(this.getChildren(),
n.hitch(this,"_startupChild"))},addChild:function(c,a){this.inherited(arguments);this._startupChild(c)},_startupChild:function(c){c.set("tabIndex","-1")},_getFirst:function(){var c=this.getChildren();return c.length?c[0]:null},_getLast:function(){var c=this.getChildren();return c.length?c[c.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(c){return(c=
l.byNode(c))&&c.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(q,f,k,m,e,n,l,d){return f("dijit._KeyNavMixin",d,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);k.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var c=this._keyNavCodes={};c[m.HOME]=e.hitch(this,"focusFirstChild");c[m.END]=e.hitch(this,
"focusLastChild");c[this.isLeftToRight()?m.LEFT_ARROW:m.RIGHT_ARROW]=e.hitch(this,"_onLeftArrow");c[this.isLeftToRight()?m.RIGHT_ARROW:m.LEFT_ARROW]=e.hitch(this,"_onRightArrow");c[m.UP_ARROW]=e.hitch(this,"_onUpArrow");c[m.DOWN_ARROW]=e.hitch(this,"_onDownArrow")}var d=this,c="string"==typeof this.childSelector?this.childSelector:e.hitch(this,"childSelector");this.own(n(this.domNode,"keypress",e.hitch(this,"_onContainerKeypress")),n(this.domNode,"keydown",e.hitch(this,"_onContainerKeydown")),n(this.domNode,
"focus",e.hitch(this,"_onContainerFocus")),n(this.containerNode,n.selector(c,"focusin"),function(c){d._onChildFocus(l.getEnclosingWidget(this),c)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(c,d){c&&(this.focusedChild&&c!==this.focusedChild&&this._onChildBlur(this.focusedChild),c.set("tabIndex",this.tabIndex),c.focus(d?"end":"start"))},_onContainerFocus:function(c){c.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){k.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(c){k.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(c){c&&c!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),c.set("tabIndex",this.tabIndex),this.lastFocused=c,this._set("focusedChild",c))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(c,d,e,a){c&&this.focusChild(c)},_keyboardSearchCompare:function(c,d){var e=c.domNode,e=(c.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&e==d?-1:0},_isFormElement:function(c){return"INPUT"===c.tagName||"TEXTAREA"===c.tagName||"SELECT"===c.tagName||"BUTTON"===c.tagName},_onContainerKeydown:function(c){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[c.keyCode];d?(d(c,this.focusedChild),c.stopPropagation(),c.preventDefault(),this._searchString=""):c.keyCode!=m.SPACE||!this._searchTimer||
c.ctrlKey||c.altKey||c.metaKey||(c.stopImmediatePropagation(),c.preventDefault(),this._keyboardSearch(c," "))}},_onContainerKeypress:function(c){this._isFormElement(document.activeElement)||c.charCode<=m.SPACE||c.ctrlKey||c.altKey||c.metaKey||(c.preventDefault(),c.stopPropagation(),this._keyboardSearch(c,String.fromCharCode(c.charCode).toLowerCase()))},_keyboardSearch:function(c,d){var h=null,a,b=0;e.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;var c=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;a=this._searchString.substr(0,c);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==c||!e)if(e=this._getNextFocusableChild(e,1),!e)return;c=e;do{var f=this._keyboardSearchCompare(e,a);f&&0==b++&&(h=e);if(-1==f){b=-1;break}e=this._getNextFocusableChild(e,1)}while(e&&e!=c)})();this.onKeyboardSearch(h,c,a,b)},_onChildBlur:function(){},_getNextFocusableChild:function(c,d){var e=
c;do{if(c)c=this._getNext(c,d);else if(c=this[0<d?"_getFirst":"_getLast"](),!c)break;if(null!=c&&c!=e&&c.isFocusable())return c}while(c!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(c,d){if(c)for(c=c.domNode;c;)if((c=c[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in c){var e=l.byNode(c);if(e)return e}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a){l=q("dijit.MenuItem"+(n("dojo-bidi")?"_NoBidi":""),[d,c,h,p],{templateString:a,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);k.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&k.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==n("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(b){}},_setSelected:function(a){m.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){e.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){e.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,k.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});n("dojo-bidi")&&(l=q("dijit.MenuItem",l,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return l})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(q,f){return q("dijit._Contained",null,{_getSibling:function(f){var m=this.getParent();return m&&m._getSiblingOfChild&&m._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(q,f,k,m,e,n){return q("dijit.MenuSeparator",[k,m,e],{templateString:n,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(q,f,k,m){return q(f,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&k.set(this.domNode,{display:"none"});k.set(this.domNode,
{width:"100%",height:"100%"});m.place('\x3cdiv class\x3d"jimu-loading"\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&k.set(this.domNode,"display","block")},hide:function(){this.domNode&&k.set(this.domNode,"display","none")}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(q,f,k,m,e,n,l,d,c){function h(b){var c;c=
new e;c.outFields=[b.fieldName];c.outStatistics=[];c.geometry=b.geometry;var d=a(b);q.forEach(d,function(a){var d=new k;d.statisticType=a;d.displayFeildName=b.fieldName;d.onStatisticField=b.fieldName;d.outStatisticFieldName=u[a];c.outStatistics.push(d)});c.where=b.filterExpression?b.filterExpression:b.layer.getDefinitionExpression()?b.layer.getDefinitionExpression():"1\x3d1";b.geometry&&(c.geometry=b.geometry);return(new m(b.layer.url)).execute(c).then(function(a){return a&&a.features&&0<a.features.length?
(a=a.features[0].attributes,r(b,a),a):[]})}function p(c){var d={countField:0,sumField:0},e=a(c),h=0,g=0;c.featureSet.features.forEach(function(a){var b=a.attributes[c.fieldName];null!==b&&"undefined"!==typeof b&&e.forEach(function(a){switch(a){case "count":d.countField++;break;case "sum":d.sumField+=b;break;case "min":d.minField="undefined"===typeof d.minField?b:Math.min(d.minField,b);break;case "max":d.maxField="undefined"===typeof d.maxField?b:Math.max(d.maxField,b);break;case "avg":h++,g+=b}})});
d.avgField=0===h?0:0===h?"":g/h;var f=c.featureSet.features.filter(function(a){a=a.attributes[c.fieldName];return null===a||"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[c.fieldName]});d.stddevField=b(f);r(c,d);return d}function a(a){return a.statisticTypes&&0<a.statisticTypes.length?t.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):t}function b(a){var b=a.length;if(1>=b)return 0;var c=0;a.forEach(function(a){c+=a});var d=c/b,e=0;a.forEach(function(a){e+=Math.pow(a-
d,2)});return Math.sqrt(1/(b-1)*e)}function g(a){var b=d.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):f({})}function r(a,b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var c in b)"countField"!==c&&n.isDefined(b[c])&&(b[c]=null===b[c]||"undefined"===typeof b[c]?"":l.localizeNumberByFieldInfo(b[c],a.fieldInfos[a.fieldName]))}var t="count sum min max avg stddev".split(" "),
u={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};c.getStatisticsResult=function(a){return g(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return f(p(a));if(a.layer){if(a.layer.url)return h(a);a.featureSet=l.toFeatureSet(a.layer.graphics);return f(p(a))}})};c.isStatFromServer=function(a){return a.layer&&a.layer.url};c.getStddevVal=b;c.getStatisticsResultFromClientSync=p})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b){return q(c,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a,b){return 1<a.features.length&&a.features[0].geometry&&b&&b.geometryType&&b.fields&&b.objectIdField},onExecute:function(a,b){var c,e;c={layerDefinition:{geometryType:b.geometryType,fields:f.clone(b.fields),objectIdField:b.objectIdField},featureSet:a.toJson()};c=new n(c);(e=b._json?m.parse(b._json):null)&&e.drawingInfo&&e.drawingInfo.renderer?(e=e.drawingInfo.renderer,e=l.fromJson(e)):
e=l.fromJson(b.renderer.toJson());c.setRenderer(e);(e=b.getSelectionSymbol())&&c.setSelectionSymbol(d.fromJson(e.toJson()));this._popupAddLayer(c)},_popupAddLayer:function(a){var c,d=k.create("div",{style:"padding: 0 10px 0 10px;"}),g=(new p({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(d);k.setStyle(g.searchBtn,"display","none");var l=new h({content:d,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,
function(){a.name=b.stripHTML(g.getValue());this._addLayerToMap(a);l.close();c&&c.remove&&c.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){l.close();c&&c.remove&&c.remove()})}]});g.inputSearch.focus();l.disableButton(0);c=e(g.inputSearch,"keyup",function(){g.getValue()?l.enableButton(0):l.disableButton(0)})},_addLayerToMap:function(b){var c=a.getInstanceSync(),d=e(c,"layerInfosChanged",f.hitch(this,function(a){b.id===a.id&&(a.enablePopup(),
d.remove())}));this.map.addLayer(b)}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(q,f,k,m,e){return q([m,e],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return k.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(e){this.doChange();13===(void 0!==e.keyCode?e.keyCode:e.which)&&this.doSearch();e.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(q,f,k,m,e,n,l){return q(f,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(d){this._getMarkerLayer();return this._isSupportType(d)&&0<d.features.length&&d.features[0]&&d.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(d)},onExecute:function(d,c){this._addMarker(d,c)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new m({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var d=this.map.snappingManager.layerInfos;d.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(d)}},_addMarker:function(d,
c){var h=d.features[0].geometry,f={},a=c.displayField||d.displayFieldName||c.objectIdField;f.title="";d.features[0].attributes&&a&&(f.title=d.features[0].attributes[a],f.title||(f.title=""));a={};if("point"===h.type)a=h;else if("polygon"===h.type||"polyline"===h.type||"multipoint"===h.type)a=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:h.getExtent().getCenter();a.getLongitude()&&a.getLatitude()?(f.longitude=a.getLongitude(),f.latitude=a.getLatitude()):a.x&&a.y&&
(f.x=a.x,f.y=a.y);var b="";h&&h.spatialReference&&h.spatialReference.wkid&&(b=h.spatialReference.wkid);f.spatialReference={wkid:b};h=l.getXyContent(f);f=l.getShareUrl(this.map,f,!0);f=l.getShareUrlContent(f);f=h+f;h=new e(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");h.width=26;h.height=26;h.setOffset(0,h.height/2);a=new k(a,h,null,null);a._markerFeatureactionGraphic=d.features[0];a.infoTemplate=this._setInfoTemplate(f);this._markerLayer.add(a);this._closePopupWindow()},_setInfoTemplate:function(d){var c=
new n;c.setContent(d);return c},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(d){return d.features[0]&&d.features[0]._graphicsLayer&&d.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===d.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(d){if(d&&d.geometryType){if(d.features&&d.features.length&&1<d.features.length)return!1;d=d.geometryType;return"point"===d||"polygon"===d||"polyline"===
d||"multipoint"===d}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(q,f,k){return q(f,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(f){this._getMarkerLayer();return 0<f.features.length&&f.geometryType&&f.features[0]&&f.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(f)},onExecute:function(f){this._removeMarker(f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new k({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var f=this.map.snappingManager.layerInfos;f.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(f)}},_removeMarker:function(f){f=f.features[0];f._textSymbol&&this._markerLayer.remove(f._textSymbol);this._markerLayer.remove(f);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(f){return f.features[0]&&
f.features[0]._graphicsLayer&&f.features[0]._graphicsLayer.id?"marker-feature-action-layer"===f.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b){return q(p,{name:"SaveToMyContent",iconClass:"icon-save",
isFeatureSupported:function(a){return 0>=a.features.length||!a.features[0].geometry?!1:this.checkPrivilege()},onExecute:function(c,d){var e=new b({appConfig:this.appConfig}),h=new a({content:e,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){e.showBusy();h.disableButton(0);e.validate().then(f.hitch(this,function(a){a.valid?this._addItem(c,d,e):(e.hideBusy(),h.enableButton(0))}))})},{label:window.jimuNls.common.cancel,
classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){h.close()})}]})},checkPrivilege:function(){var a=d.getStandardPortalUrl(this.appConfig.portalUrl);if((a=l.getPortal(a))&&a.haveSignIn())return this._hasPrivilege(a);a=new e;a.resolve(!1);return a},_hasPrivilege:function(a){return a.loadSelfInfo().then(f.hitch(this,function(a){if(a&&a.user){var b=new c({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&
b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(a,b,c){var d=c.getName(),e=c.getFolderId(),g=c.popup;b=b||{};var p={name:b.name,type:b.type||"Feature Layer",displayField:b.displayField,description:b.description,copyrightText:b.copyright,geometryType:b.geometryType||a.geometryType,fields:b.fields||a.fields,objectIdField:b.objectIdField};a.features[0].geometry&&(b=n.graphicsExtent(a.features),p.initialExtent=b,p.fullExtent=b);!p.objectIdField&&p.fields&&k.some(p.fields,function(a){if("esriFieldTypeOID"===
a.type)return p.objectIdField=a.name,!0});a={layers:[{layerDefinition:p,featureSet:a.toJson()}]};c.addItem({name:d,title:d,type:"Feature Collection",typeKeywords:"WAB_created",text:m.stringify(a)},e).then(f.hitch(this,function(a){!0===a.success?g.close():(c.hideBusy(),g.enableButton(0),new h({message:a.error?a.error.message:""}))}),function(a){c.hideBusy();g.enableButton(0);new h({message:a.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p){return q([e,n,l],{baseClass:"jimu-item-form",templateString:d,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var a=h.getStandardPortalUrl(this.appConfig.portalUrl);c.getPortal(a).getUser().then(f.hitch(this,function(a){this.portalUser=a;return a.getContent()})).then(f.hitch(this,function(a){this.folderStore=this._createFolderStore(a.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var a=new m;this.itemForm.validate()?a.resolve({valid:!0}):
a.resolve({valid:!1,message:"param requried"});return a},addItem:function(a,b){if(this.portalUser)return this.portalUser.addItem(a,b);var c=new m;c.resolve({error:{message:"portalUser is null"}});return c},_createFolderStore:function(a,b){var c=new p({data:{identifier:"id",label:"name",items:[]}});c.newItem({name:b,id:""});k.forEach(a,function(a){c.newItem({name:a.title,id:a.id})});return c}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),
function(q,f,k,m,e,n,l){return f("dojo.data.ItemFileWriteStore",n,{constructor:function(d){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(c){return l.toISOString(c,{zulu:!0})});d&&!1===d.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(d){if(!d)throw Error("assertion failed in ItemFileWriteStore");
},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(d,c){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof d&&"undefined"!=typeof d)throw Error("newItem() was passed something other than an object");var e=null,f=this._getIdentifierAttribute();if(f===Number)e=this._arrayOfAllItems.length;else{e=d[f];if("undefined"===typeof e)throw Error("newItem() was not passed an identity for the new item");if(q.isArray(e))throw Error("newItem() was not passed an single-valued identity");
}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[e]);this._assert("undefined"===typeof this._pending._newItems[e]);this._assert("undefined"===typeof this._pending._deletedItems[e]);var a={};a[this._storeRefPropName]=this;a[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[e]=a,a[f]=[e]);this._arrayOfAllItems.push(a);f=null;if(c&&c.parent&&c.attribute){var f={item:c.parent,attribute:c.attribute,oldValue:void 0},b=this.getValues(c.parent,
c.attribute);if(b&&0<b.length){var g=b.slice(0,b.length);f.oldValue=1===b.length?b[0]:b.slice(0,b.length);g.push(a);this._setValueOrValues(c.parent,c.attribute,g,!1);f.newValue=this.getValues(c.parent,c.attribute)}else this._setValueOrValues(c.parent,c.attribute,a,!1),f.newValue=a}else a[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(a);this._pending._newItems[e]=a;for(var r in d){if(r===this._storeRefPropName||r===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
e=d[r];q.isArray(e)||(e=[e]);a[r]=e;if(this.referenceIntegrity)for(b=0;b<e.length;b++)g=e[b],this.isItem(g)&&this._addReferenceToMap(g,a,r)}this.onNew(a,f);return a},_removeArrayElement:function(d,c){var e=k.indexOf(d,c);return-1!=e?(d.splice(e,1),!0):!1},deleteItem:function(d){this._assert(!this._saveInProgress);this._assertIsItem(d);var c=d[this._itemNumPropName],e=this.getIdentity(d);if(this.referenceIntegrity){var f=this.getAttributes(d);d[this._reverseRefMap]&&(d["backup_"+this._reverseRefMap]=
q.clone(d[this._reverseRefMap]));k.forEach(f,function(a){k.forEach(this.getValues(d,a),function(b){this.isItem(b)&&(d["backupRefs_"+this._reverseRefMap]||(d["backupRefs_"+this._reverseRefMap]=[]),d["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(b),attr:a}),this._removeReferenceFromMap(b,d,a))},this)},this);if(f=d[this._reverseRefMap])for(var a in f){var b=null;if(b=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a])for(var g in f[a]){var r=this.getValues(b,g)||[],
l=k.filter(r,function(a){return!(this.isItem(a)&&this.getIdentity(a)==e)},this);this._removeReferenceFromMap(d,b,g);l.length<r.length&&this._setValueOrValues(b,g,l,!0)}}}this._arrayOfAllItems[c]=null;d[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[e];this._pending._deletedItems[e]=d;d[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,d);this.onDelete(d);return!0},setValue:function(d,c,e){return this._setValueOrValues(d,c,e,!0)},setValues:function(d,
c,e){return this._setValueOrValues(d,c,e,!0)},unsetAttribute:function(d,c){return this._setValueOrValues(d,c,[],!0)},_setValueOrValues:function(d,c,e,f){this._assert(!this._saveInProgress);this._assertIsItem(d);this._assert(q.isString(c));this._assert("undefined"!==typeof e);var a=this._getIdentifierAttribute();if(c==a)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var a=this._getValueOrValues(d,c),b=this.getIdentity(d);if(!this._pending._modifiedItems[b]){var h=
{},p;for(p in d)h[p]=p===this._storeRefPropName||p===this._itemNumPropName||p===this._rootItemPropName?d[p]:p===this._reverseRefMap?q.clone(d[p]):d[p].slice(0,d[p].length);this._pending._modifiedItems[b]=h}b=!1;if(q.isArray(e)&&0===e.length){if(b=delete d[c],e=void 0,this.referenceIntegrity&&a){p=a;q.isArray(p)||(p=[p]);for(var l=0;l<p.length;l++)h=p[l],this.isItem(h)&&this._removeReferenceFromMap(h,d,c)}}else{b=q.isArray(e)?e.slice(0,e.length):[e];if(this.referenceIntegrity)if(a){p=a;q.isArray(p)||
(p=[p]);var u={};k.forEach(p,function(a){this.isItem(a)&&(a=this.getIdentity(a),u[a.toString()]=!0)},this);k.forEach(b,function(a){if(this.isItem(a)){var b=this.getIdentity(a);u[b.toString()]?delete u[b.toString()]:this._addReferenceToMap(a,d,c)}},this);for(l in u)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[l]:this._arrayOfAllItems[l],d,c)}else for(l=0;l<b.length;l++)h=b[l],this.isItem(h)&&this._addReferenceToMap(h,d,c);d[c]=b;b=!0}if(f)this.onSet(d,c,a,e);return b},_addReferenceToMap:function(d,
c,e){c=this.getIdentity(c);var h=d[this._reverseRefMap];h||(h=d[this._reverseRefMap]={});(d=h[c])||(d=h[c]={});d[e]=!0},_removeReferenceFromMap:function(d,c,e){c=this.getIdentity(c);var h=d[this._reverseRefMap],a;if(h){for(a in h)a==c&&(delete h[a][e],this._isEmpty(h[a])&&delete h[a]);this._isEmpty(h)&&delete d[this._reverseRefMap]}},_dumpReferenceMap:function(){var d;for(d=0;d<this._arrayOfAllItems.length;d++){var c=this._arrayOfAllItems[d];c&&c[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(c)+
"] is referenced by: "+m.toJson(c[this._reverseRefMap]))}},_getValueOrValues:function(d,c){var e=void 0;this.hasAttribute(d,c)&&(e=this.getValues(d,c),e=1==e.length?e[0]:e);return e},_flatten:function(d){if(this.isItem(d))return{_reference:this.getIdentity(d)};if("object"===typeof d)for(var c in this._datatypeMap){var e=this._datatypeMap[c];if(q.isObject(e)&&!q.isFunction(e)){if(d instanceof e.type){if(!e.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+c+"]");
return{_type:c,_value:e.serialize(d)}}}else if(d instanceof e)return{_type:c,_value:d.toString()}}return d},_getNewFileContentString:function(){var d={},c=this._getIdentifierAttribute();c!==Number&&(d.identifier=c);this._labelAttr&&(d.label=this._labelAttr);d.items=[];for(c=0;c<this._arrayOfAllItems.length;++c){var e=this._arrayOfAllItems[c];if(null!==e){var f={},a;for(a in e)if(a!==this._storeRefPropName&&a!==this._itemNumPropName&&a!==this._reverseRefMap&&a!==this._rootItemPropName){var b=this.getValues(e,
a);if(1==b.length)f[a]=this._flatten(b[0]);else for(var g=[],r=0;r<b.length;++r)g.push(this._flatten(b[r])),f[a]=g}d.items.push(f)}}return m.toJson(d,!0)},_isEmpty:function(d){var c=!0;if(q.isObject(d))for(var e in d){c=!1;break}else q.isArray(d)&&0<d.length&&(c=!1);return c},save:function(d){this._assert(!this._saveInProgress);this._saveInProgress=!0;var c=this,h=function(){c._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};c._saveInProgress=!1;d&&d.onComplete&&d.onComplete.call(d.scope||
e.global)},f=function(a){c._saveInProgress=!1;d&&d.onError&&d.onError.call(d.scope||e.global,a)};if(this._saveEverything){var a=this._getNewFileContentString();this._saveEverything(h,f,a)}this._saveCustom&&this._saveCustom(h,f);this._saveEverything||this._saveCustom||h()},revert:function(){this._assert(!this._saveInProgress);for(var d in this._pending._modifiedItems){var c=this._pending._modifiedItems[d],e=null,e=this._itemsByIdentity?this._itemsByIdentity[d]:this._arrayOfAllItems[d];c[this._storeRefPropName]=
this;for(var f in e)delete e[f];q.mixin(e,c)}var a;for(d in this._pending._deletedItems)a=this._pending._deletedItems[d],a[this._storeRefPropName]=this,c=a[this._itemNumPropName],a["backup_"+this._reverseRefMap]&&(a[this._reverseRefMap]=a["backup_"+this._reverseRefMap],delete a["backup_"+this._reverseRefMap]),this._arrayOfAllItems[c]=a,this._itemsByIdentity&&(this._itemsByIdentity[d]=a),a[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(a);for(d in this._pending._deletedItems)a=this._pending._deletedItems[d],
a["backupRefs_"+this._reverseRefMap]&&(k.forEach(a["backupRefs_"+this._reverseRefMap],function(b){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[b.id]:this._arrayOfAllItems[b.id],a,b.attr)},this),delete a["backupRefs_"+this._reverseRefMap]);for(d in this._pending._newItems)c=this._pending._newItems[d],c[this._storeRefPropName]=null,this._arrayOfAllItems[c[this._itemNumPropName]]=null,c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c),this._itemsByIdentity&&
delete this._itemsByIdentity[d];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(d){return d?(d=this.getIdentity(d),(new Boolean(this._pending._newItems[d]||this._pending._modifiedItems[d]||this._pending._deletedItems[d])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(d,c,e,f){},onNew:function(d,c){},onDelete:function(d){},close:function(d){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(q,f,k,m,e,n,l,d,c){k=k("dojo.data.ItemFileReadStore",[n],{constructor:function(d){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=d.url;this._jsonData=d.data;this.data=null;this._datatypeMap=d.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(d){return c.fromISOString(d)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==d.urlPreventCache&&(this.urlPreventCache=d.urlPreventCache?!0:!1);void 0!==d.hierarchical&&(this.hierarchical=d.hierarchical?
!0:!1);d.clearOnClose&&(this.clearOnClose=!0);"failOk"in d&&(this.failOk=d.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(c){if("string"!==typeof c)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(c,d,a){c=this.getValues(c,d);return 0<c.length?c[0]:a},getValues:function(c,
d){this._assertIsItem(c);this._assertIsAttribute(d);return(c[d]||[]).slice(0)},getAttributes:function(c){this._assertIsItem(c);var d=[],a;for(a in c)a!==this._storeRefPropName&&a!==this._itemNumPropName&&a!==this._rootItemPropName&&a!==this._reverseRefMap&&d.push(a);return d},hasAttribute:function(c,d){this._assertIsItem(c);this._assertIsAttribute(d);return d in c},containsValue:function(c,d,a){var b=void 0;"string"===typeof a&&(b=l.patternToRegExp(a,!1));return this._containsValue(c,d,a,b)},_containsValue:function(c,
d,a,b){return m.some(this.getValues(c,d),function(c){if(null!==c&&!f.isObject(c)&&b){if(c.toString().match(b))return!0}else if(a===c)return!0})},isItem:function(c){return c&&c[this._storeRefPropName]===this&&this._arrayOfAllItems[c[this._itemNumPropName]]===c?!0:!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){this._assertIsItem(c.item)},getFeatures:function(){return this._features},getLabel:function(c){if(this._labelAttr&&this.isItem(c))return this.getValue(c,this._labelAttr)},
getLabelAttributes:function(c){return this._labelAttr?[this._labelAttr]:null},filter:function(c,d,a){var b=[],e,h;if(c.query){var f;e=c.queryOptions?c.queryOptions.ignoreCase:!1;var p={};for(h in c.query)f=c.query[h],"string"===typeof f?p[h]=l.patternToRegExp(f,e):f instanceof RegExp&&(p[h]=f);for(e=0;e<d.length;++e){var n=!0,k=d[e];if(null===k)n=!1;else for(h in c.query)f=c.query[h],this._containsValue(k,h,f,p[h])||(n=!1);n&&b.push(k)}}else for(e=0;e<d.length;++e)h=d[e],null!==h&&b.push(h);a(b,c)},
_fetchItems:function(c,d,a){var b=this;if(this._loadFinished)this.filter(c,this._getItemsArray(c.queryOptions),d);else if(this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:c,
filter:f.hitch(b,"filter"),findCallback:f.hitch(b,d)});else{this._loadInProgress=!0;var h=e.get({url:b._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});h.addCallback(function(e){try{b._getItemsFromLoadedData(e),b._loadFinished=!0,b._loadInProgress=!1,b.filter(c,b._getItemsArray(c.queryOptions),d),b._handleQueuedFetches()}catch(u){b._loadFinished=!0,b._loadInProgress=!1,a(u,c)}});h.addErrback(function(d){b._loadInProgress=!1;a(d,c)});var p=null;c.abort&&
(p=c.abort);c.abort=function(){var a=h;a&&-1===a.fired&&(a.cancel(),a=null);p&&p.call(c)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,b.filter(c,this._getItemsArray(c.queryOptions),d)}catch(t){a(t,c)}else a(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),c)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var d=
this._queuedFetches[c],a=d.args,b=d.filter,d=d.findCallback;b?b(a,this._getItemsArray(a.queryOptions),d):this.fetchItemByIdentity(a)}this._queuedFetches=[]}},_getItemsArray:function(c){return c&&c.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(c){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(c){function d(a){return null!==a&&"object"===typeof a&&(!f.isArray(a)||b)&&!f.isFunction(a)&&(a.constructor==Object||f.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&e.hierarchical}function a(b){e._arrayOfAllItems.push(b);for(var c in b){var h=b[c];if(h)if(f.isArray(h))for(var g=
0;g<h.length;++g){var p=h[g];d(p)&&a(p)}else d(h)&&a(h)}}var b=!1,e=this;this._labelAttr=c.label;var h,l;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=c.items;for(h=0;h<this._arrayOfTopLevelItems.length;++h)l=this._arrayOfTopLevelItems[h],f.isArray(l)&&(b=!0),a(l),l[this._rootItemPropName]=!0;var u={},n;for(h=0;h<this._arrayOfAllItems.length;++h)for(n in l=this._arrayOfAllItems[h],l){if(n!==this._rootItemPropName){var k=l[n];null!==k?f.isArray(k)||(l[n]=[k]):l[n]=[null]}u[n]=n}for(;u[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;u[this._itemNumPropName];)this._itemNumPropName+="_";for(;u[this._reverseRefMap];)this._reverseRefMap+="_";if(u=c.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=u,h=0;h<this._arrayOfAllItems.length;++h)if(l=this._arrayOfAllItems[h],c=l[u],c=c[0],Object.hasOwnProperty.call(this._itemsByIdentity,c)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
u+"].  Value collided: ["+c+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+u+"].  Value collided: ["+c+"]");}else this._itemsByIdentity[c]=l;else this._features["dojo.data.api.Identity"]=Number;for(h=0;h<this._arrayOfAllItems.length;++h)l=this._arrayOfAllItems[h],l[this._storeRefPropName]=this,l[this._itemNumPropName]=h;for(h=0;h<this._arrayOfAllItems.length;++h)for(n in l=this._arrayOfAllItems[h],
l)for(c=l[n],u=0;u<c.length;++u)if(k=c[u],null!==k&&"object"==typeof k){if("_type"in k&&"_value"in k){var m=k._type,q=this._datatypeMap[m];if(q)if(f.isFunction(q))c[u]=new q(k._value);else if(f.isFunction(q.deserialize))c[u]=q.deserialize(k._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
m+"'");}if(k._reference){k=k._reference;if(f.isObject(k))for(m=0;m<this._arrayOfAllItems.length;++m){var q=this._arrayOfAllItems[m],w=!0,B;for(B in k)q[B]!=k[B]&&(w=!1);w&&(c[u]=q)}else c[u]=this._getItemByIdentity(k);this.referenceIntegrity&&(k=c[u],this.isItem(k)&&this._addReferenceToMap(k,l,n))}else this.isItem(k)&&this.referenceIntegrity&&this._addReferenceToMap(k,l,n)}},_addReferenceToMap:function(c,d,a){},getIdentity:function(c){var d=this._features["dojo.data.api.Identity"];return d===Number?
c[this._itemNumPropName]:(c=c[d])?c[0]:null},fetchItemByIdentity:function(c){var d,a;if(this._loadFinished)d=this._getItemByIdentity(c.identity),c.onItem&&(a=c.scope?c.scope:q.global,c.onItem.call(a,d));else{var b=this;this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:c}):(this._loadInProgress=!0,a=e.get({url:b._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),a.addCallback(function(a){var e=c.scope?c.scope:q.global;try{b._getItemsFromLoadedData(a),b._loadFinished=!0,b._loadInProgress=!1,d=b._getItemByIdentity(c.identity),c.onItem&&c.onItem.call(e,d),b._handleQueuedFetches()}catch(t){b._loadInProgress=
!1,c.onError&&c.onError.call(e,t)}}),a.addErrback(function(a){b._loadInProgress=!1;c.onError&&c.onError.call(c.scope?c.scope:q.global,a)})):this._jsonData&&(b._getItemsFromLoadedData(b._jsonData),b._jsonData=null,b._loadFinished=!0,d=b._getItemByIdentity(c.identity),c.onItem&&(a=c.scope?c.scope:q.global,c.onItem.call(a,d)))}},_getItemByIdentity:function(c){var d=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,c)&&(d=this._itemsByIdentity[c]):Object.hasOwnProperty.call(this._arrayOfAllItems,
c)&&(d=this._arrayOfAllItems[c]);void 0===d&&(d=null);return d},getIdentityAttributes:function(c){c=this._features["dojo.data.api.Identity"];return c===Number?null:[c]},_forceLoad:function(){var c=this;this._jsonFileUrl!==this._ccUrl?(q.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=e.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(a){try{if(!0!==c._loadInProgress&&!c._loadFinished)c._getItemsFromLoadedData(a),c._loadFinished=!0;else if(c._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(b){throw console.log(b),b;}});d.addErrback(function(a){throw a;
})}else this._jsonData&&(c._getItemsFromLoadedData(c._jsonData),c._jsonData=null,c._loadFinished=!0)}});f.extend(k,d);return k})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(q){var f={};q.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,m){for(var e="^",n=null,l=0;l<f.length;l++)switch(n=f.charAt(l),n){case "\\":e+=n;l++;e+=f.charAt(l);break;case "*":e+=".*";break;case "?":e+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":e+=
"\\";default:e+=n}e+="$";return m?new RegExp(e,"mi"):new RegExp(e,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(q,f,k){var m={};q.setObject("dojo.data.util.simpleFetch",m);m.errorHandler=function(e,n){n.onError&&n.onError.call(n.scope||f.global,e,n)};m.fetchHandler=function(e,n){var l=n.abort||null,d=!1,c=n.start?n.start:0,h=n.count&&Infinity!==n.count?c+n.count:e.length;n.abort=function(){d=!0;l&&l.call(n)};var p=n.scope||
f.global;n.store||(n.store=this);n.onBegin&&n.onBegin.call(p,e.length,n);n.sort&&e.sort(k.createSortFunction(n.sort,this));if(n.onItem)for(var a=c;a<e.length&&a<h;++a){var b=e[a];d||n.onItem.call(p,b,n)}n.onComplete&&!d&&(a=null,n.onItem||(a=e.slice(c,h)),n.onComplete.call(p,a,n))};m.fetch=function(e){e=e||{};e.store||(e.store=this);this._fetchItems(e,q.hitch(this,"fetchHandler"),q.hitch(this,"errorHandler"));return e};return m})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(q,f,k,m,e){return q("dijit.form.FilteringSelect",[m,e],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(e,f,d,c){f&&f[this.searchAttr]!==this._lastQuery||!f&&e.length&&this.store.getIdentity(e[0])!=this._lastQuery||
(e.length?this.set("item",e[0],c):this.set("value","",c||void 0===c&&!this.focused,this.textbox.value,null))},_openResultList:function(e,f,d){f[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(e,l,d,c){this._onChangeActive||(l=null);if(void 0===c){if(null===e||""===e)if(e="",!f.isString(d)){this._setDisplayedValueAttr(d||"",l);
return}var h=this;this._lastQuery=e;k(this.store.get(e),function(c){h._callbackSetLabel(c?[c]:[],void 0,void 0,l)})}else this.valueNode.value=e,this.inherited(arguments,[e,l,d,c])},_setItemAttr:function(e,f,d){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(e){return e.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(e,l){null==e&&(e="");if(!this._created){if(!("displayedValue"in this.params))return;l=!1}if(this.store){this.closeDropDown();
var d=f.clone(this.query),c=this._getDisplayQueryString(e),h;this.store._oldAPI?h=c:(h=this._patternToRegExp(c),h.toString=function(){return c});this._lastQuery=d[this.searchAttr]=h;this._lastDisplayedValue=this.textbox.value=e;this._set("displayedValue",e);var p=this,a={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};f.mixin(a,this.fetchProperties);this._fetchHandle=this.store.query(d,a);k(this._fetchHandle,function(b){p._fetchHandle=null;p._callbackSetLabel(b||[],d,a,l)},function(a){p._fetchHandle=
null;p._cancelingQuery||console.error("dijit.form.FilteringSelect: "+a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(q,f,k,m){return q("dijit.form.MappedTextBox",m,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(e){return e.toString?e.toString():
""},toString:function(){var e=this.filter(this.get("value"));return null!=e?"string"==typeof e?e:this.serialize(e,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=k.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(q,f,k,m,e,n,l,d,c){return q("dijit.form.ComboBoxMixin",[d,n],{dropDownClass:l,hasDownArrow:!0,templateString:c,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(c){this._set("hasDownArrow",
c);this._buttonNode.style.display=c?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(c){c.get||m.mixin(c,{_oldAPI:!0,get:function(c){var a=new f;this.fetchItemByIdentity({identity:c,onItem:function(b){a.resolve(b)},onError:function(b){a.reject(b)}});return a.promise},query:function(c,a){var b=new f(function(){d.abort&&d.abort()});b.total=new f;var d=this.fetch(m.mixin({query:c,onBegin:function(a){b.total.resolve(a)},onComplete:function(a){b.resolve(a)},
onError:function(a){b.reject(a)}},a));return e(b)}});this._set("store",c)},postMixInProperties:function(){var c=this.params.store||this.store;c&&this._setStoreAttr(c);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var d=this.declaredClass;m.mixin(this.store,{getValue:function(a,b){k.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[b]},getLabel:function(a){k.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly",
"","2.0");return a.name},fetch:function(a){k.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],m.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p){f=f("dijit.form._AutoCompleterMixin",p,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(d("ie")){var c=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();c.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",c),b=String(a.text).replace(/\r/g,"").length}catch(r){}}return b},
_setCaretPos:function(a,b){b=parseInt(b);h.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(b!=m.ALT&&b!=m.CTRL&&b!=m.META&&b!=m.SHIFT){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(d=c.getHighlightedOption()),b){case m.PAGE_DOWN:case m.DOWN_ARROW:case m.PAGE_UP:case m.UP_ARROW:this._opened&&
this._announceOption(d);a.stopPropagation();a.preventDefault();break;case m.ENTER:if(d){if(d==c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case m.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;
d&&this._selectOption(d);case m.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var b=this.focusNode;h.selectInputText(b,b.value.length);var c=this.ignoreCase?"toLowerCase":"substr";0==a[c](0).indexOf(this.focusNode.value[c](0))?(c=this.autoComplete?this._getCaretPos(b):b.value.length,c+1>b.value.length&&(b.value=a,h.selectInputText(b,c))):(b.value=a,h.selectInputText(b))},_openResultList:function(a,b,c){var d=this.dropDown.getHighlightedOption();
this.dropDown.clearResultList();a.length||0!=c.start?(this._nextSearch=this.dropDown.onPage=e.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,c,e.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),d&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||
this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;
!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?
this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",
k.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (e.isString(this.dropDownClass)?
e.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:e.hitch(this,this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new c({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,
b):a[b]}}},postCreate:function(){var a=n('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);q.after(this,"onSearch",e.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,
b){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");b=l.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},
reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});d("dojo-bidi")&&f.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(q,f,k,m,e,n){function l(d){return{id:d.value,value:d.value,name:k.trim(d.innerText||d.textContent||"")}}return q("dijit.form.DataList",e,{constructor:function(d,c){this.domNode=f.byId(c);k.mixin(this,d);this.id&&n.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:m("option",this.domNode).map(l)}])},destroy:function(){n.remove(this.id)},fetchSelectedItem:function(){var d=m("\x3e option[selected]",this.domNode)[0]||m("\x3e option",this.domNode)[0];return d&&l(d)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(q,f,k,m,e,n,l){return q("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(d){this._set("list",d)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(d){return new RegExp("^"+d.replace(/(\\.)|(\*)|(\?)|\W/g,function(c,d,e,a){return e?".*":
a?".":d?d:"\\"+c})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(d){if(!this.disabled&&
!this.readOnly){d=d.charOrCode;this._prev_key_backspace=!1;if(d==f.DELETE||d==f.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(d){this._abortQuery();var c=this,h=k.clone(this.query),f={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},a=e.substitute(this.queryExpr,
[d.replace(/([\\\*\?])/g,"\\$1")]),b,g=function(){var a=c._fetchHandle=c.store.query(h,f);c.disabled||c.readOnly||b!==c._lastQuery||n(a,function(d){c._fetchHandle=null;c.disabled||c.readOnly||b!==c._lastQuery||n(a.total,function(a){d.total=a;var b=c.pageSize;if(isNaN(b)||b>d.total)b=d.total;d.nextPage=function(a){f.direction=a=!1!==a;f.count=b;a?(f.start+=d.length,f.start>=d.total&&(f.count=0)):(f.start-=b,0>f.start&&(f.count=Math.max(b+f.start,0),f.start=0));0>=f.count?(d.length=0,c.onSearch(d,h,
f)):g()};c.onSearch(d,h,f)})},function(a){c._fetchHandle=null;c._cancelingQuery||console.error(c.declaredClass+" "+a.toString())})};k.mixin(f,this.fetchProperties);this.store._oldAPI?b=a:(b=this._patternToRegExp(a),b.toString=function(){return a});this._lastQuery=h[this.searchAttr]=b;this._queryDeferHandle=this.defer(g,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var d=this.list;d&&(this.store=l.byId(d))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(q,f,k,m,e,n,l,d){return q("dijit.form._ComboBoxMenu",[e,n,d,l],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var c=this.ownerDocument.createElement("div");c.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");c.setAttribute("role","option");return c},onHover:function(c){f.add(c,"dijitMenuItemHover")},onUnhover:function(c){f.remove(c,
"dijitMenuItemHover")},onSelect:function(c){f.add(c,"dijitMenuItemSelected")},onDeselect:function(c){f.remove(c,"dijitMenuItemSelected")},_page:function(c){var d=0,e=this.domNode.scrollTop,a=k.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();d<a;){var b=this.getHighlightedOption();if(c){if(!b.previousSibling||"none"==b.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!b.nextSibling||"none"==b.nextSibling.style.display)break;this.selectNextNode()}b=
this.domNode.scrollTop;d+=(b-e)*(c?-1:1);e=b}},handleKey:function(c){switch(c.keyCode){case m.DOWN_ARROW:return this.selectNextNode(),!1;case m.PAGE_DOWN:return this._page(!1),!1;case m.UP_ARROW:return this.selectPreviousNode(),!1;case m.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(q,f,k,m,e){var n=f("dijit.form._ComboBoxMenuMixin"+
(m("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=e.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(e){this._set("value",e);this.onChange(e)},onClick:function(e){if(e==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(e==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(e)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(e,d){var c=this._createMenuItem(),h=d(e);h.html?c.innerHTML=h.label:c.appendChild(c.ownerDocument.createTextNode(h.label));""==c.innerHTML&&(c.innerHTML="\x26#160;");return c},createOptions:function(e,d,c){this.items=e;this.previousButton.style.display=0==d.start?"none":"";k.set(this.previousButton,"id",this.id+
"_prev");q.forEach(e,function(d,a){var b=this._createOption(d,c);b.setAttribute("item",a);k.set(b,"id",this.id+a);this.nextButton.parentNode.insertBefore(b,this.nextButton)},this);var h=!1;e.total&&!e.total.then&&-1!=e.total?d.start+d.count<e.total?h=!0:d.start+d.count>e.total&&d.count==e.length&&(h=!0):d.count==e.length&&(h=!0);this.nextButton.style.display=h?"":"none";k.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var e=this.containerNode;2<e.childNodes.length;)e.removeChild(e.childNodes[e.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});m("dojo-bidi")&&(n=f("dijit.form._ComboBoxMenuMixin",
n,{_createOption:function(){var e=this.inherited(arguments);this.applyTextDir(e);return e}}));return n})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(q,f,k,m){return q("dijit.form._ListMouseMixin",m,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(e,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(e,f){this._isDragging=!1;var l=this.selected,d=this._hoveredNode;l&&f==l?this.defer(function(){this._onClick(e,
l)}):d&&this.defer(function(){this._onClick(e,d)})},_onMouseOut:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(e,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(q,f,k){return q("dijit.form._ListBase",null,{selected:null,_listConnect:function(k,e){var n=this;return n.own(f(n.containerNode,f.selector(function(e,d,c){return e.parentNode==c},k),function(f){n[e](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,e){if(this.selected!=f){var n=this.selected;if(n)this.onDeselect(n);
f&&(e&&k.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(q,f,k,m,e){return q([f,k],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:m,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},
postCreate:function(){this.inherited(arguments);this.hidden&&e.setStyle(this.domNode,"display","none");e.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||e.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),e.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(e.setStyle(this.domNode,
"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(q,f,k,m,e,n,l,d,c,h){var p=null,a=q([l,d],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(e(this.domNode,"click",k.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this.own(e(this.closeBtn,"click",k.hitch(this,this.hide)))},setActions:function(a){this.clearActions();m.forEach(a,k.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){a=
new h({action:a});f.place(a.domNode,this.menuContent);a.startup();this.menuItems.push(a);this.own(e(a,"click",k.hitch(this,this.hide)))},prepareActions:function(a,d){return c.getInstance().getSupportedActions(a).then(k.hitch(this,function(b){!1===d&&(b=m.filter(b,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));m.forEach(b,function(b){b.data=a},this);this.setActions(b)}))},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(a,c){if(0===this.menuItems.length)f.setStyle(this.domNode,
"display","none");else{"string"===typeof c&&""!==c?(this.labelNode.innerHTML=c,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var b,d=a.y+a.h,e;b=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display","");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});e=n.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?b+e.w>window.innerWidth?window.innerWidth-e.w:0>b?0:b:0>b-e.w?0:b>window.innerWidth?
window.innerWidth-e.w:b-e.w)+"px",top:(e.h>window.innerHeight?0:d+e.h>window.innerHeight?window.innerHeight-e.h:d+e.h+5<window.innerHeight?d+5:d)+"px"})}}});a.getInstance=function(){null===p&&(p=new a,f.place(p.domNode,document.body),p.startup());p.setActions([]);return p};return a})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(q,
f,k,m,e,n,l,d,c){return q([d,c,l],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?f.addClass(this.iconNode,this.action.iconClass):
f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(e(this.domNode,n.enter,k.hitch(this,this._useHoverIcon))),this.own(e(this.domNode,n.leave,k.hitch(this,this._useNormalIcon))));this.own(e(this.domNode,"click",k.hitch(this,this._clickHandler)))},_useNormalIcon:function(){this.action.iconClass?f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?
f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(c){m.stop(c);if(this.action){var d;this.action.data.features&&0<this.action.data.features.length&&(d=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,d)}this.emit("click")}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A){var y=q([d,c],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new h;this.layerInfosObj=A.getInstanceSync();var a=f.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(a);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?m.addClass(this.previouBtn,"icon-arrow-forward"):m.addClass(this.previouBtn,
"icon-arrow-back");a=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new y.PopupUIController(this):new y.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;
var b=new l;a.getRelatedTableInfoArray().then(f.hitch(this,function(a){b.resolve(a)}));return b},_getOriRelationshipByDestLayer:function(a){var b=null;k.some(a.oriJimuLayerInfo.layerObject.relationships,function(c){if(c.relatedTableId===a.destJimuLayerInfo.layerObject.layerId)return b=c,!0},this);return b},_getRelatedRecordsByRelatedQuery:function(b){var c=new l,d=new a,e=this._getOriRelationshipByDestLayer(b);d.outFields=["*"];d.returnGeometry=!0;d.outSpatialReference=this.popupManager.mapManager.map.spatialReference;
d.relationshipId=e.id;var h=b.feature.attributes[b.oriJimuLayerInfo.layerObject.objectIdField];d.objectIds=[h];b.oriJimuLayerInfo.layerObject.queryRelatedFeatures(d,f.hitch(this,function(a){(a=a[h]&&a[h].features)?c.resolve(a):c.resolve([])}),f.hitch(this,function(){c.resolve([])}));return c},_ignoreCaseToGetFieldObject:function(a,b){var c=null;b&&a&&a.fields&&k.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return c=a,!0});return c},getLocaleDateTime:function(a){return u.localizeDate(new Date(a),
{fullYear:!0,formatLength:"medium"})},_getDisplayTitleOfRelatedRecord:function(a,b,c){var d=a.getInfoTemplate();return(a="popupTitle"===c&&d?"function"===typeof d.title?d.title(b):d.title:this._getDisplayTitleFromPopup(a,b,c))?a:""},_getDisplayTitleFromPopup:function(a,b,c){(a=this._getPopupTemplateWithOnlyDisplayField(a,c))?(b.setInfoTemplate(a),c=this.popupUIController.getDisplayTitle(b),b.setInfoTemplate(null)):c=b.attributes[c];return c},_getPopupTemplateWithOnlyDisplayField:function(a,b){var c=
a._getCustomPopupInfo(a.layerObject,[b]);return new t(c)},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?a.data.relatedFeature||this.showRelatedRecords(a):this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(a){var b=a.data,c=b.oriJimuLayerInfo.layerObject,
d=f.getObject("_wabProperties.originalLayerName",!1,c)||b.oriJimuLayerInfo.title,c=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,c),e=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,c);"popupTitle"!==c&&(e=d+": "+e);this._setOperationTitle(e);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,function(c){b.oriJimuLayerInfo.layerObject.infoTemplate||
a.data.feature.setInfoTemplate(c);this.popupUIController.setFeature(a.data.feature);b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,c=f.getObject("_wabProperties.originalLayerName",!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;this._setOperationTitle(c);this._clearPage();
f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(f.hitch(this,function(c){0<c.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,
"font-normal");var d=this._showFieldSelector(b.destJimuLayerInfo);k.forEach(c,function(c,h){c._layer=b.destJimuLayerInfo.layerObject;var g=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,c,d),g=m.create("div",{"class":"item record-item "+(0===h%2?"oddLine":"evenLine"),innerHTML:g},this.contentBox);g.relatedRecord=c;g=e(g,"click",f.hitch(this,function(){this._addOperation(a);var d=this._createOperation({feature:c,oriJimuLayerInfo:b.destJimuLayerInfo});this.setPopupContent(d)}));this._temporaryData.eventHandles.push(g)},
this);this.popupManager.initPopupMenu(c);this.popupUIController.updateZoomToBtn(c)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(a).then(f.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);k.forEach(b,function(b,c){var d=m.create("div",{"class":"item table-item "+(0===c%2?"oddLine":"evenLine"),innerHTML:b.title},this.contentBox),d=e(d,"click",f.hitch(this,
function(){b.getLayerObject().then(f.hitch(this,function(){this._addOperation(a);var c=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,destJimuLayerInfo:b});this.setPopupContent(c)}))}));this._temporaryData.eventHandles.push(d)},this)}))},_createOperation:function(a){return new y.Operation({feature:a.feature||null,oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||null,relatedFeature:a.relatedFeature||null},this)},_addOperation:function(a){this.undoManager.add(a)},
_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){m.empty(this.contentBox);k.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];k.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(a,b){a&&m.create("div",{"class":"title-box "+(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){m.setAttr(this.operationTitle,
"innerHTML",a);m.setAttr(this.operationTitle,"title",a)},_showFieldSelector:function(a){var b="objecid",c=n(".title-box",this.contentBox)[0],d=a.layerObject,h=[];if(!c||!a)return b;var g=a.getPopupInfo();g&&g.title&&h.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});k.forEach(d.fields,function(a){"globalid"!==a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&h.push({label:a.alias||a.name,value:a.name})});c=(new z({items:h})).placeAt(c);c.domNode.title=window.jimuNls.popup.chooseFieldTip;
var p=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,d),l=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),r=v.getInstance().getAppConfig();p?b=p:"2.3"===r.configWabVersion&&l&&l.name?b=l.name:g&&g.title?b="popupTitle":l&&l.name?b=l.name:0<h.length&&(b=h[0].value);b&&(c.setHighlightValue(b),f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,d));this._temporaryData.dijits.push(c);a=e(c,"click-item",
f.hitch(this,function(a,b){n(".item.record-item",this.contentBox).forEach(f.hitch(this,function(c){f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,d);var e=this._getDisplayTitleOfRelatedRecord(a,c.relatedRecord,b);c.innerHTML=e}))},a));this._temporaryData.eventHandles.push(a);return b}});y.Operation=q([p],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});y.PopupUIController=
q([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn()},initTempPopup:function(){this._tempPopup=new b({},m.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=new b({},m.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&
this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&m.destroy(this._zoomToBtnANode)},addDomNode:function(a){setTimeout(f.hitch(this,function(){m.place(a,this._getRefDomNode(),"after")}),1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=n(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),m.place(this.rrPopupProjector.domNode,a,"after")},setContent:function(a){var b=n(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(a)},
getDisplayTitle:function(a){this._tempPopupForDisplayTitle.setFeatures([a]);return(a=n("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&a.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return n(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=n(".actionList",
this.popup.domNode)[0];this._oldZoomToBtnANdoe=n(".action",a)[0];this._zoomToBtnANode=m.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=m.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&m.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&m.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&
m.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&m.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(a){this._hideOldZoomToBtn();!a||1>a.length||!a[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=e(this._zoomToBtn,"click",f.hitch(this,function(){var b=null;try{b=r.graphicsExtent(a)}catch(x){console.error(x)}b&&
(this.rrPopupProjector.popupManager.mapManager.map.setExtent(b),this.popup.hide())})))},changeRefDomNode:function(){m.setStyle(this.rrPopupProjector.operationBox,"display","block");m.addClass(this.rrPopupProjector.domNode,"second-page-mode");var a=this._getViewPopupDomNode();a&&m.addClass(a,"second-page-mode")},revertRefDomNode:function(){m.setStyle(this.rrPopupProjector.operationBox,"display","none");m.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});
y.PopupMobileUIController=q([y.PopupUIController],{initTempPopup:function(){this._tempPopup=new g({},m.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=n(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(a=n(".esriViewPopup",a)[0])this.setContent(a),m.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return n(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=
n(".esriMobileInfoView.esriMobilePopupInfoView")[0];return n(".esriViewPopup",a)[0]}});return y})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(q,f,k,m,e,n){q=q([n],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},
constructor:function(e){e=e||{};e.maxOperations&&(this.maxOperations=e.maxOperations);this._historyStack=[]},add:function(e){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,e);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var e=this.peekUndo();this.position--;e?(e=e.performUndo(),this.onUndo(),this._checkAvailability(),m(e).then(f.hitch(this,
this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var e=this.peekRedo();this.position++;e?(e=e.performRedo(),this.onRedo(),this._checkAvailability(),m(e).then(f.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===
this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&
this.position<this._historyStack.length)return this.get(this.position)},get:function(e){return this._historyStack[e]},remove:function(e){0<this._historyStack.length&&(this._historyStack.splice(e,1),0<this.position&&e<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});k("extend-esri")&&(e.UndoManager=q);return q})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(q,f,k){q=q(null,{declaredClass:"esri.OperationBase",
type:"not implemented",label:"not implemented",constructor:function(f){f=f||{};f.label&&(this.label=f.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});f("extend-esri")&&(k.OperationBase=q);return q})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),
function(q,f,k,m,e,n,l,d,c){return q([f,k,c],{baseClass:"jimu-dijit-dropdownmenu",declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=n.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');
this.itemsContainer=n.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";e.forEach(this.items,m.hitch(this,function(c){var d=n.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+c.label+"\x3c/div\x3e");d.itemInfo=c;d.title=c.label;n.place(d,this.itemsContainer)}));this.own(l(this.domNode,"click",
m.hitch(this,this._onIconClick)));this.own(l(this.shelter,"click",m.hitch(this,this._onShelterClick)));this.own(l(this.itemsContainer,"click",m.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(c){c.stopPropagation();this.isShowing()?this.hideMenu():(c=n.position(c.target||c.srcElement),this.showMenu(c))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(c){c.stopPropagation();c=c.target||c.srcElement;
n.hasClass(c,this.dropdownMenuItemClass)&&(c=c.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(c),this.emit("click-item",c));this.hideMenu()},clearHighlightValue:function(){d("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(c){this.clearHighlightValue();d("."+this.dropdownMenuItemClass,this.itemsContainer).some(m.hitch(this,function(d){return d.itemInfo.value===c?(n.addClass(d,"selected"),!0):!1}))},getHighlightValue:function(){var c=
d("."+this.dropdownMenuItemClass+".selected",this.itemsContainer)[0];return c?c.itemInfo.value:null},isShowing:function(){return n.hasClass(this.domNode,"showing")},showMenu:function(c){this.itemsContainer.style.top=c.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=c.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=window.innerWidth-(c.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");n.place(this.shelter,
document.body);n.place(this.itemsContainer,document.body);n.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);n.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();n.destroy(this.itemsContainer);n.destroy(this.shelter);this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(q,f,k,m,e){var n=null,l=q(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(k.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));k.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},
getWidgetFilter:function(d,c){return f.getObject(d+".filterExprs."+c,!1,this._filters)},applyWidgetFilter:function(d,c,e,f,a){this._setFilterExp(d,c,e,f,a);c=this.layerInfos.getLayerInfoById(d)||this.layerInfos.getTableInfoById(d);d=this._getFilterExp(d);null!==d&&c&&c.setFilter(d)},_onMapLoaded:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(d){for(var c in this._filters)if(this._filters[c]){var e=
this._filters[c];if(e){var f=e.filterExprs,e=e.mapFilterControls;f&&delete f[d];e&&delete e[d]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,function(d){this._filters[d.id]||(this._filters[d.id]={definitionExpression:d.getFilter(),filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(d){d=f.getObject(d+".mapFilterControls",!1,this._filters);var c=0,e;for(e in d){var p=d[e];p.priority>c&&(c=p.priority)}return c},_getMapFilterControl:function(d){d=f.getObject(d+
".mapFilterControls",!1,this._filters);var c=0,e=null,p;for(p in d){var a=d[p];a.priority>c&&(c=a.priority,e=a)}return e},_setFilterExp:function(d,c,e,p,a){var b=d+".filterExprs."+c,g=d+".mapFilterControls."+c;e?(f.setObject(b,e,this._filters),m.isDefined(p)&&(d=this._getPriorityOfMapFilter(d),f.setObject(g,{enable:p,useAND:a,priority:d+1},this._filters))):(f.getObject(b,!1,this._filters)&&delete this._filters[d].filterExprs[c],f.getObject(g,!1,this._filters)&&delete this._filters[d].mapFilterControls[c])},
_getFilterExp:function(d){if(!this._filters[d])return null;var c=[],e=this._filters[d].definitionExpression,f=this._filters[d].filterExprs;d=this._getMapFilterControl(d);for(var a in f){var b=f[a];b&&c.push("("+b+")")}c=c.join(" AND ");return e&&d&&d.enable||e&&null===d?c?d&&!1===d.useAND?"("+e+") OR "+c:"("+e+") AND "+c:e:c}});l.getInstance=function(){if(null===n)n=new l,window._filterManager=n;else return n};return l})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/topic"],function(q,f,k){var m=null,e;e=q(null,{constructor:function(e){k.subscribe("publishData",f.hitch(this,this.onDataPublished));k.subscribe("fetchData",f.hitch(this,this.onFetchData));k.subscribe("clearAllData",f.hitch(this,this.onClearAllData));k.subscribe("removeData",f.hitch(this,this.onRemoveData));k.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=e},_dataStore:{},onDataPublished:function(e,f,d,c){"undefined"===typeof c&&(c=!1);this._dataStore[f]?
(this._dataStore[f].current=d,c&&(this._dataStore[f].history?this._dataStore[f].history.push(d):this._dataStore[f].history=[d])):(this._dataStore[f]={current:d},c&&(this._dataStore[f].history=[d]))},onFetchData:function(e){var f;if(e)"framework"===e?this._dataStore[e]?k.publish("dataFetched","framework","framework",this._dataStore[e].current,this._dataStore[e].history):k.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(e))?this._dataStore[e]?k.publish("dataFetched",f.name,
e,this._dataStore[e].current,this._dataStore[e].history):k.publish("noData",f.name,e):k.publish("noData",void 0,e);else{for(var d in this._dataStore)(f=this.widgetManager.getWidgetById(d))&&k.publish("dataFetched",f.name,d,this._dataStore[d].current,this._dataStore[d].history);f||k.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};k.publish("allDataCleared")},onRemoveData:function(e){delete this._dataStore[e];k.publish("dataRemoved",e)},onClearDataHistory:function(e){this._dataStore[e]&&
(this._dataStore[e].history=[]);k.publish("dataHistoryCleared",e)}});e.getInstance=function(f){null===m&&(m=new e(f));return m};return e})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),function(q,f,k,m,e,n,l,d,c,
h,p,a,b){var g=null,r=q(null,{constructor:function(){window.isBuilder?(e.subscribe("app/mapLoaded",k.hitch(this,this._onMapLoaded)),e.subscribe("app/mapChanged",k.hitch(this,this._onMapChanged))):(e.subscribe("mapLoaded",k.hitch(this,this._onMapLoaded)),e.subscribe("mapChanged",k.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(c){var d=c.geometryType,e=new p(p.STYLE_CIRCLE,16,null,h.fromArray([0,255,255])),g=new a(a.STYLE_SOLID,h.fromArray([0,255,255]),2),f=new b(b.STYLE_SOLID,
g,h.fromArray([0,255,255,.3]));"esriGeometryPoint"===d?c.setSelectionSymbol(e):"esriGeometryPolyline"===d?c.setSelectionSymbol(g):"esriGeometryPolygon"===d&&c.setSelectionSymbol(f)},updateSelectionByFeatures:function(a,b,d){0<b.length&&(b=m.map(b,k.hitch(this,function(b){var d=null,d=0<=a.graphics.indexOf(b)?new c(b.toJson()):b;d.wabIsTemp=!0;return d})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var e=new f;a._selectHandler({features:b},d,null,null,e);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||
(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return e},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,n.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,n.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,n.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,
[],n.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,c){return m.filter(a.graphics,k.hitch(this,function(a){return c?d.contains(b,a.geometry):d.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=m.map(a,k.hitch(this,function(a){return a.geometry})),b=d.union(b));return b},_createDisplayLayer:function(a){var b=new l;b.id="displayLayer_of_"+a.id;
this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),d=this._displayLayers[a.id];this.clearDisplayLayer(a);var e=a.getSelectionSymbol();m.forEach(b,k.hitch(this,function(a){a.setSymbol(null);a=new c(a.toJson());a.setSymbol(e);d.add(a)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});r.getInstance=function(){g||(g=new r,window._selectionManager=g);return g};return r})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(q,f,k,m,e,n,l,d,c){return q([n,l],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(e.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(e.subscribe("dataFetched",f.hitch(this,
this._onReceiveData)));this.own(e.subscribe("noData",f.hitch(this,this._onNoData)));this.own(e.subscribe("dataSourceDataUpdated",f.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(c){},onSignOut:function(){},onPositionChange:function(c){this.setPosition(c)},setPosition:function(c,
e){this.position=c;var a=d.getPositionStyle(this.position);a.position="absolute";e||(e="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);m.place(this.domNode,e);m.setStyle(this.domNode,a);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return m.getMarginBox(this.domNode)},setMap:function(c){this.map=c},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){},onConfigChanged:function(c){},onAppConfigChanged:function(c,
d,a){},onAction:function(c,d){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return c.getInstance().getPanelById(this.id+"_panel");var d=c.getInstance().getPanelById(this.gid+"_panel");return d?d:c.getInstance().getPanelById(this.id+"_panel")},publishData:function(c,d){"undefined"===typeof d&&(d=!1);e.publish("publishData",this.name,this.id,c,d)},fetchData:function(c){c?e.publish("fetchData",c):0!==this.listenWidgetIds.length?k.forEach(this.listenWidgetIds,
function(c){e.publish("fetchData",c)},this):e.publish("fetchData")},fetchDataByName:function(c){c=this.widgetManager.getWidgetsByName(c);k.forEach(c,function(c){this.fetchData(c.id)},this)},openWidgetById:function(c){return this.widgetManager.triggerWidgetOpen(c)},_onReceiveData:function(c,d,a,b){if(d!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onReceiveData(c,d,a,b)},onReceiveData:function(c,d,a,b){},updateDataSourceData:function(c,d){e.publish("updateDataSourceData",
"widget~"+this.id+"~"+c,d)},onDataSourceDataUpdate:function(c,d){},_onNoData:function(c,d){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onNoData(c,d)},onNoData:function(c,d){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b){var g,r=null;g=q(null,{constructor:function(){this.panels=
[];this.widgetManager=b.getInstance();d(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;c.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart));c.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(b){var c=new n,e=this.getPanelById(b.id+"_panel");e?("closed"===e.state&&this.openPanel(e),c.resolve(e)):l({Panel:this._loadPanelClass(b.panel.uri),nls:this._loadThemeI18N(b.panel.uri)}).then(f.hitch(this,function(e){var g=b.id+"_panel",h=this.getPanelById(g),
p={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:g,gid:b.gid,nls:e.nls};f.mixin(p,b.panel.options);try{h=new e.Panel(p),console.log("panel ["+g+"] created.")}catch(B){console.log("create panel error: "+B+", panelId: "+g);c.reject(B);return}h.setPosition(b.panel.position);a.setVerticalCenter(h.domNode);this.openPanel(h);d(h.domNode,"click",f.hitch(this,this._onPanelClick,h));c.resolve(h)}));return c},setMap:function(a){this.map=
a;d(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new n;if("string"===typeof a){if(a=this.getPanelById(a),!a)return b.reject(),
b}else this.panels.some(function(b){return b.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=!0,a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){m.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new n;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===
a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(f.hitch(this,function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&m.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+
a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+
a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=k.map(this.panels,function(a){return a.id});
k.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return h();var b=new n;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(m.setStyle(a.domNode,{opacity:0,display:""}),e.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return h();var b=new n;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?e.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=m.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(c=0,this.panels.filter(function(b){return"minimized"===b.windowState&&"closed"!==b.state&&b.id!==a.id}).some(function(a){return 0===a._mobileBottom})&&(c=a.titleHeight),a._mobileBottom=c,b.h>b.w?{left:0,right:0,top:"auto",bottom:c,width:"auto",height:a.titleHeight,
contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:c,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):b.h>b.w?{left:0,right:0,
top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",
borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"opened"===a.state&&this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&m.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),m.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:
"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&m.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&m.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},
_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){k.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),m.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?
this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new n;p([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new n;a.startWith("themes")?(a=a.split("/"),p(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});g.getInstance=function(){null===r&&(r=new g,window._panelManager=r);return r};return g})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(q,f,k,m){return q([m],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&f.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(e){this.loading=
e;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(e){this.widget=e;this.loading&&this.loading.destroy();k.place(e.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(e){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+e.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(q,f,k,m,e,n,l,d,c){return q([e,n],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var c=this.getAllWidgetConfigs(),c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];k.forEach(c,function(c){var a,b;!1!==c.visible&&(b=new l,a=this.createFrame(c),
this.addChild(a),a.setLoading(b),this.widgetManager.loadWidget(c).then(f.hitch(this,function(b){a.setWidget(b);b.startup()})))},this)},getAllWidgetConfigs:function(){var c=[];return c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(c){for(var d=this.getChildren(),a=0;a<d.length;a++)if(d[a].getWidget()&&d[a].getWidget().id===c)return d[a].getWidget()},getWidgets:function(){return this.getChildren().map(function(c){return c.getWidget()})},createFrame:function(c){return new d},
setPosition:function(d,e){this.position=d;var a=c.getPositionStyle(this.position);a.position="absolute";e||(e="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(a.display="none");m.place(this.domNode,e);m.setStyle(this.domNode,a)},getPosition:function(){return this.position},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){this.getChildren().forEach(function(c){c.resize()})},onPositionChange:function(c){this.setPosition(c)},
onOpen:function(){k.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.openWidget(c.getWidget())},this)},onClose:function(){k.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.closeWidget(c.getWidget())},this)},onMaximize:function(){k.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.maximizeWidget(c.getWidget())},this)},onMinimize:function(){k.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.minimizeWidget(c.getWidget())},
this)},onNormalize:function(){k.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.normalizeWidget(c.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(c){this._updateConfig(c)},reloadWidget:function(c){this.isWidgetInPanel(c)&&(this._updateConfig(c),this.getChildren().forEach(function(d){d.getWidget()&&d.getWidget().id===c.id&&(d.getWidget().destroy(),d.setLoading(new l),this.widgetManager.loadWidget(c).then(f.hitch(this,function(a){d.setWidget(a);
a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(c){return k.some(this.getAllWidgetConfigs(),function(d){if(c.id===d.id)return!0})?!0:!1},_updateConfig:function(c){if(Array.isArray(this.config.widgets)){for(var d=-1,a=0;a<this.config.widgets.length;a++)this.config.widgets[a].id===c.id&&(d=a);0<d&&(this.config.widgets[d]=c)}else this.config=c},destroy:function(){this.getChildren().forEach(function(c){try{c.domNode&&c.destroy()}catch(p){console.error("destroy widget frame error."+
p.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(q,f,k,m,e){return q([m,e],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(k(window,"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),
function(q,f,k,m,e,n){return{cloneSymbol:function(f){if(!f)return null;var d=null;try{var c=f.toJson(),d=e.fromJson(c)}catch(h){console.error(h)}return d},getDefaultMarkerSymbol:function(){return e.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return e.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return e.fromJson({tags:["opaque"],
title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return e.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return e.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",
style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return e.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var e=q.toUrl("jimu/css/images/grey_pin.png"),e=new n(e,16,16);e.setOffset(0,8);return e},createSymbolNode:function(l,d){var c=32,h=32,p=k.create("div",{},document.body);k.setStyle(p,"display","inline-block");if(d)c=d.width,h=d.height;else if(c=80,
h=30,this.isSimpleMarkerSymbol(l))h=c=Math.min(l.size+12,125);else if(this.isPictureMarkerSymbol(l)){if(!l.url||"http://"===l.url||-1===l.url.indexOf("http://")&&-1===l.url.indexOf("https://")&&-1===l.url.indexOf("data:"))return;h=c=Math.min(Math.max(l.width,l.height),125)}else if(this.isSimpleLineSymbol(l)||this.isCartographicLineSymbol(l))c=190,h=20;var a=m.createSurface(p,c,h);if("vml"===m.renderer){var b=a.getEventSource();k.setStyle(b,"position","relative");k.setStyle(b.parentNode,"position",
"relative")}var b=null,b=d?e.getShapeDescriptors(l):this.isSimpleLineSymbol(l)||this.isCartographicLineSymbol(l)?this._getLineShapeDesc(l):e.getShapeDescriptors(l),g;try{g=a.createShape(b.defaultShape),b.fill&&g.setFill(b.fill),b.stroke&&g.setStroke(b.stroke)}catch(t){a.clear();a.destroy();return}var a=a.getDimensions(),a={dx:a.width/2,dy:a.height/2},r=g.getBoundingBox(),b=r.width,r=r.height;if(b>c||r>h)c=((c<h?c:h)-5)/(b>r?b:r),f.mixin(a,{xx:c,yy:c});g.applyTransform(a);p&&k.addClass(p,"symbol");
return p},_getLineShapeDesc:function(e){var d=null;if(this.isSimpleLineSymbol(e)||this.isCartographicLineSymbol(e))d={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:e.getStroke()};return d},isSimpleMarkerSymbol:function(e){return e&&"esri.symbol.SimpleMarkerSymbol"===e.declaredClass},isPictureMarkerSymbol:function(e){return e&&"esri.symbol.PictureMarkerSymbol"===e.declaredClass},isSimpleLineSymbol:function(e){return e&&"esri.symbol.SimpleLineSymbol"===e.declaredClass},isCartographicLineSymbol:function(e){return e&&
"esri.symbol.CartographicLineSymbol"===e.declaredClass},isSimpleFillSymbol:function(e){return e&&"esri.symbol.SimpleFillSymbol"===e.declaredClass},isPictureFillSymbol:function(e){return e&&"esri.symbol.PictureFillSymbol"===e.declaredClass},isTextSymbol:function(e){return e&&"esri.symbol.TextSymbol"===e.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(q,
f,k,m,e,n,l){return q([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(d){return 0===this.indexOf(d)};String.prototype.endsWith=function(d){return this.substring(this.length-d.length)===d};String.prototype.count=
function(d){return this.split(d).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",
stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",
numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",
dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorMinutes:"dateOperatorMinutes",dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(d,c){this.isHosted=l.isHostedService(d);this.setFieldsStoreByFieldInfos(c)},isPartsObjHasError:function(d){var c=
!1;d&&(c=d.parts&&0<=d.parts.length?k.every(d.parts,f.hitch(this,function(c){return c.parts?0<c.parts.length?k.every(c.parts,f.hitch(this,function(c){return!c.error})):!1:!c.error})):!1);return!c},isAskForValues:function(d){var c=!1;return c=k.some(d.parts,f.hitch(this,function(c){return c.parts?k.some(c.parts,f.hitch(this,function(c){return!!c.interactiveObj})):!!c.interactiveObj}))},setFieldsStoreByFieldInfos:function(d){d=k.filter(d,f.hitch(this,function(c){return 0<=this._supportFieldTypes.indexOf(c.type)}));
d=k.map(d,function(c,d){var e;switch(c.type){case "esriFieldTypeString":e="string";break;case "esriFieldTypeDate":e="date";break;default:e="number"}return{id:d,label:c.name,shortType:e,alias:c.alias,editable:c.editable,name:c.name,nullable:c.nullable,type:c.type}},this);this.fieldsStore=new n({data:{identifier:"id",label:"label",items:d}});return d.length},_validatePartsObj:function(d){return d&&"object"===typeof d},_isObject:function(d){return d&&"object"===typeof d},_isString:function(d){return d&&
"string"===typeof d},containsNonLatinCharacter:function(d){for(var c=0;c<d.length;c++)if(255<d.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(d){if(!k.every(d.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(d))return d.expr="",d.expr;var c="";if(0===d.parts.length)c="1\x3d1";else if(1===d.parts.length)c=this.builtFilterString(d.parts[0]);else for(var f="",p=0;p<d.parts.length;p++){var a=this.builtFilterString(d.parts[p]);if(!e.isDefined(a))return null;c+=f+
"("+a+")";f=f||" "+d.logicalOperator+" "}return d.expr=c},isPartsObjReadyToBuild:function(d){return k.every(d.parts,f.hitch(this,function(c){return c.parts?k.every(c.parts,f.hitch(this,function(c){return this._isPartReadyToBuild(c)})):this._isPartReadyToBuild(c)}))},_isPartReadyToBuild:function(d){var c=d.fieldObj.shortType,e=d.operator,f=d.valueObj;d=f.type||"value";var a=f.value,b=f.value1,f=f.value2;if("value"===d){if("string"===c)return e===this.OPERATORS.stringOperatorIsBlank||e===this.OPERATORS.stringOperatorIsNotBlank?
!0:l.isNotEmptyString(a);if("number"===c)return e===this.OPERATORS.numberOperatorIsBlank||e===this.OPERATORS.numberOperatorIsNotBlank?!0:e===this.OPERATORS.numberOperatorIsBetween||e===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(b)&&l.isValidNumber(f):l.isValidNumber(a);if("date"===c)return e===this.OPERATORS.dateOperatorIsBlank||e===this.OPERATORS.dateOperatorIsNotBlank?!0:e===this.OPERATORS.dateOperatorIsBetween||e===this.OPERATORS.dateOperatorIsNotBetween?l.isNotEmptyString(b)&&l.isNotEmptyString(f):
e===this.OPERATORS.dateOperatorInTheLast||e===this.OPERATORS.dateOperatorNotInTheLast?void 0!==a&&null!==a:l.isNotEmptyString(a)}else{if("field"===d)return l.isNotEmptyString(a);if("unique"===d){if("string"===c)return l.isNotEmptyString(a);if("number"===c)return l.isValidNumber(a)}}return!1},builtFilterString:function(d){var c="";if(d.parts)for(var f="",p=0;p<d.parts.length;p++){var a=d.parts[p],b=this.builtSingleFilterString(a);a.expr=b.whereClause;if(!e.isDefined(b.whereClause))return null;c+=f+
b.whereClause;f=" "+d.logicalOperator+" "}else c=this.builtSingleFilterString(d).whereClause;return d.expr=c},_preBuiltSingleFilterString:function(d){if("string"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===this.OPERATORS.stringOperatorIs)return{whereClause:d.fieldObj.name+" IS NULL"};if(d.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}if("number"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===
this.OPERATORS.numberOperatorIs)return{whereClause:d.fieldObj.name+" IS NULL"};if(d.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}return null},builtSingleFilterString:function(d,c){this.isHosted&&(d.caseSensitive=!1);if(e.isDefined(d.valueObj.isValid)&&!d.valueObj.isValid)return{whereClause:null};var f=this._preBuiltSingleFilterString(d);if(f)return f;var f=d.valueObj.value,p=d.valueObj.value1,a=d.valueObj.value2,b=!1;d.interactiveObj&&e.isDefined(c)&&
(b=!0,e.isDefined(d.valueObj.value)&&(f="{"+c+"}"),e.isDefined(d.valueObj.value1)&&(p="{"+c+"}"),e.isDefined(d.valueObj.value2)&&(a="{"+(c+1)+"}"));var g="";if("string"===d.fieldObj.shortType)switch(p="",b&&this.isHosted?p="N":f&&"field"!==d.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(f)&&(p="N"),d.operator){case this.OPERATORS.stringOperatorIs:g="field"===d.valueObj.type?d.fieldObj.name+" \x3d "+f:d.fieldObj.name+" \x3d "+p+"'"+f.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:g=
"field"===d.valueObj.type?d.fieldObj.name+" \x3c\x3e "+f:d.fieldObj.name+" \x3c\x3e "+p+"'"+f.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:g=d.caseSensitive?d.fieldObj.name+" LIKE "+p+"'"+f.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") LIKE UPPER("+p+"'"+f.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:g=d.caseSensitive?d.fieldObj.name+" LIKE "+p+"'%"+f.replace(/\'/g,"''")+"'":"UPPER("+d.fieldObj.name+") LIKE UPPER("+p+"'%"+f.replace(/\'/g,
"''")+"')";break;case this.OPERATORS.stringOperatorContains:g=d.caseSensitive?d.fieldObj.name+" LIKE "+p+"'%"+f.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") LIKE UPPER("+p+"'%"+f.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:g=d.caseSensitive?d.fieldObj.name+" NOT LIKE "+p+"'%"+f.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") NOT LIKE UPPER("+p+"'%"+f.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:g=d.fieldObj.name+" IS NULL";
break;case this.OPERATORS.stringOperatorIsNotBlank:g=d.fieldObj.name+" IS NOT NULL"}else if("number"===d.fieldObj.shortType)switch(d.operator){case this.OPERATORS.numberOperatorIs:g=d.fieldObj.name+" \x3d "+f;break;case this.OPERATORS.numberOperatorIsNot:g=d.fieldObj.name+" \x3c\x3e "+f;break;case this.OPERATORS.numberOperatorIsAtLeast:g=d.fieldObj.name+" \x3e\x3d "+f;break;case this.OPERATORS.numberOperatorIsLessThan:g=d.fieldObj.name+" \x3c "+f;break;case this.OPERATORS.numberOperatorIsAtMost:g=
d.fieldObj.name+" \x3c\x3d "+f;break;case this.OPERATORS.numberOperatorIsGreaterThan:g=d.fieldObj.name+" \x3e "+f;break;case this.OPERATORS.numberOperatorIsBetween:g=d.fieldObj.name+" BETWEEN "+p+" AND "+a;break;case this.OPERATORS.numberOperatorIsNotBetween:g=d.fieldObj.name+" NOT BETWEEN "+p+" AND "+a;break;case this.OPERATORS.numberOperatorIsBlank:g=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:g=d.fieldObj.name+" IS NOT NULL"}else switch(e.isDefined(f)&&"field"!==
d.valueObj.type&&"string"===typeof f&&(f=new Date(f)),"field"!==d.valueObj.type&&(f&&(f=new Date(f)),p&&(p=new Date(p)),a&&(a=new Date(a))),d.operator){case this.OPERATORS.dateOperatorIsOn:g="field"===d.valueObj.type?d.fieldObj.name+" \x3d "+f:b?d.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":d.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+
"'";break;case this.OPERATORS.dateOperatorIsNotOn:g="field"===d.valueObj.type?d.fieldObj.name+" \x3c\x3e "+f:b?d.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":d.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsBefore:g="field"===d.valueObj.type?d.fieldObj.name+" \x3c "+
f:d.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"'";break;case this.OPERATORS.dateOperatorIsAfter:g="field"===d.valueObj.type?d.fieldObj.name+" \x3e "+f:d.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsOnOrBefore:g="field"===d.valueObj.type?d.fieldObj.name+" \x3c\x3d "+f:d.fieldObj.name+" \x3c\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;
case this.OPERATORS.dateOperatorIsOnOrAfter:g="field"===d.valueObj.type?d.fieldObj.name+" \x3e\x3d "+f:d.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"'";break;case this.OPERATORS.dateOperatorInTheLast:g=d.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:g=d.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,
d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:g=b?d.fieldObj.name+" BETWEEN '"+p+"' AND '"+a+"'":d.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(p)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:g=b?d.fieldObj.name+" NOT BETWEEN '"+p+"' AND '"+a+"'":d.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(p)+"' AND "+
(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsBlank:g=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:g=d.fieldObj.name+" IS NOT NULL"}return{whereClause:g}},_convertRangeToDays:function(d,c){var e=d;c===this.OPERATORS.dateOperatorYears?e=365*d:c===this.OPERATORS.dateOperatorMonths?e=30*d:c===this.OPERATORS.dateOperatorWeeks?e=7*d:c===this.OPERATORS.dateOperatorHours?e=d/24:c===this.OPERATORS.dateOperatorMinutes&&
(e=d/1440);return e=Math.round(1E6*e)/1E6},formatDate:function(d){var c=m.format(d,{datePattern:"yyyy-MM-dd",selector:"date"});d=m.format(d,{selector:"time",timePattern:"HH:mm:ss"});return c+" "+d},addDay:function(d){return new Date(d.getTime()+this.dayInMS)},getFilterObjByExpr:function(d){if(d&&this.fieldsStore){var c=this.replaceStrings(d);d=c.defExpr;var e=this.findParts(d,"AND");1===e.parts.length&&(e=this.findParts(d,"OR"),1===e.parts.length&&(e.logicalOperator="AND"));k.forEach(e.parts,function(c){c.expr=
c.expr.trim();if(c.expr.startsWith("(")&&-1<c.expr.search(/\)$/)){var a=c.expr.substring(1,c.expr.length-1),b=a.indexOf("("),d=a.indexOf(")");if(-1===b&&-1===d||b<d)c.expr=a}a=this.findParts(c.expr,"AND");1===a.parts.length&&(a=this.findParts(c.expr,"OR"));1<a.parts.length&&(c.parts=a.parts,c.logicalOperator=a.logicalOperator)},this);this.parseExpr(e);this.reReplaceStrings(c,e,f.hitch(this,function(){e&&e.parts&&k.forEach(e.parts,f.hitch(this,function(c){c&&(c.parts?k.forEach(c.parts,f.hitch(this,
function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(c),this._addDefalutValueTypeForSinglePart(c)))}))}));this.isPartsObjHasError(e)&&(e=null);return e}},_handleParsedValuesForSinglePart:function(d){d&&d.fieldObj&&"number"===d.fieldObj.shortType&&d.valueObj&&(d.valueObj.hasOwnProperty("value")&&(d.valueObj.value=parseFloat(d.valueObj.value)),d.valueObj.hasOwnProperty("value1")&&(d.valueObj.value1=parseFloat(d.valueObj.value1)),
d.valueObj.hasOwnProperty("value2")&&(d.valueObj.value2=parseFloat(d.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(d){d&&d.valueObj&&!d.valueObj.type&&(d.valueObj.type="value")},replaceStrings:function(d){for(var c=d,e=function(a,b,c){var d=-1,d=a.indexOf("'",c+1);return d===c+1?(d=a.indexOf("'",d+1),e(a,b,d)):c},f=[],a=d.indexOf("'");-1<a;){var b=a,a=d.indexOf("'",a+1),g=0,a=e(d,b,a);"%"===d[b+1]&&b++;"%"===d[a-1]&&(--a,g++);var r=d.substring(b+1,a);"N"===d[b-1]&&(d=d.substring(0,
b-1)+d.substring(b),--b,--a);this.isDateString(r)||-1!==r.indexOf("{")?a=d.indexOf("'",a+1+g):(f.push(r),d=d.substring(0,b+1)+"#"+(f.length-1)+"#"+d.substring(a),a=d.indexOf("'",d.lastIndexOf("#")+2+g))}return{origDefExpr:c,defExpr:d,savedStrings:f}},reReplaceStrings:function(d,c,h){var p=d.savedStrings;if(!p.length)h&&"function"===typeof h&&h();else if(p.length){var a=function(a,b){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;
var c=a.valueObj.value.indexOf("#"),d=a.valueObj.value.lastIndexOf("#");return e.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,d),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},a=f.hitch(this,a),b=!1;k.forEach(c.parts,function(c){if(c.parts){var d=!1;k.forEach(c.parts,function(b){d=a(b,p)||d});d&&(b=d,c.expr=this.builtFilterString(c))}else(b=a(c,p)||b)&&this.builtFilterString(c)},this);h&&"function"===typeof h&&h();b&&(c.expr=null,
this.getExprByFilterObj(c))}},isDateString:function(d){return 19===d.length&&"-"===d.charAt(4)&&"-"===d.charAt(7)&&" "===d.charAt(10)&&":"===d.charAt(13)&&":"===d.charAt(16)?!0:!1},findParts:function(d,c){for(var e=d.toLowerCase(),f=" "+c.toLowerCase()+" ",a=[],b=0,g=e.indexOf(f);0<g;){var r=d.substring(b,g),l=r.toLowerCase(),k=r.count("("),n=r.count(")"),m=r.count("'");k!==n||1===m%2?g=e.indexOf(f,g+1):-1<l.indexOf(" between ")&&-1===l.indexOf(" and ")?g=e.indexOf(f,g+1):(a.push({expr:r}),b=g+f.length,
g=e.indexOf(f,b))}a.push({expr:d.substring(b)});for(e=a.length-1;0<=e;e--)!this.hasOperator(a[e].expr)&&0<e&&(a[e-1].expr+=" "+c+" "+a[e].expr,a.splice(e,1));return{expr:d,parts:a,logicalOperator:c}},hasOperator:function(d){d=d.toLowerCase();return-1<d.indexOf("{")&&-1<d.indexOf("}")||-1<d.indexOf(" \x3d ")||-1<d.indexOf(" \x3c ")||-1<d.indexOf(" \x3e ")||-1<d.indexOf(" \x3c\x3e ")||-1<d.indexOf(" \x3c\x3d ")||-1<d.indexOf(" \x3e\x3d ")||-1<d.indexOf(" like ")||-1<d.indexOf(" between ")||-1<d.indexOf(" date")||
-1<d.indexOf(" is null")||-1<d.indexOf(" is not null")?!0:!1},parseExpr:function(d){k.forEach(d.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},this)},_preParseSingleExpr:function(d){var c=null;try{if(c=f.clone(d),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var e=d="",p=c.expr.match(/^UPPER\((.*)\)\s+/i);if(p&&2<=p.length)d=p[1];else return null;var a=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(a&&2<=a.length)e="'"+a[1]+"'";else return null;
c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,d+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,e);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(b){return console.log(b),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},_removeOperator:function(d,c,e){c=c.substring(e).trim();"date"===d&&!this.isHosted&&c.toLowerCase().startsWith("timestamp ")&&(c=c.substring(10).trim());return c},parseSingleExpr:function(d){var c=this._preParseSingleExpr(d);
c&&(d=f.mixin(d,c));var c=d.expr.trim(),h=c.indexOf(" "),p=c.substring(0,h);d.fieldObj={name:p};d.valueObj={};this.getFieldItemByName({name:p},function(a){d.fieldObj.shortType=a.shortType[0];d.fieldObj.label=a.label[0]},function(){d.error={msg:"unknown field name ("+p+")",code:1}});c=c.substring(h+1).trim();h=c.toLowerCase();h.startsWith("\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===
d.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):h.startsWith("\x3c ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsBefore:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsLessThan:d.error={msg:"operator ("+h+") not supported for string",code:3}):h.startsWith("\x3e ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===
d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsAfter:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsGreaterThan:d.error={msg:"operator ("+h+") not supported for string",code:3}):h.startsWith("\x3c\x3e ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):h.startsWith("\x3c\x3d ")?
(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsAtMost:d.error={msg:"operator ("+h+") not supported for string",code:3}):h.startsWith("\x3e\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===d.fieldObj.shortType?
d.operator=this.OPERATORS.numberOperatorIsAtLeast:d.error={msg:"operator ("+h+") not supported for string",code:3}):h.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),d),d.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),d),d.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?
(this.storeValue(c.substring(1,c.length-2),d),d.operator=this.OPERATORS.stringOperatorStartsWith):d.error={msg:"value ("+h+") not supported for LIKE",code:3}):h.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),d),d.operator=this.OPERATORS.stringOperatorDoesNotContain):d.error={msg:"value ("+h+") not supported for NOT LIKE",code:3}):h.startsWith("between ")?this._updatePartForBetween(c,
!0,d):h.startsWith("not between ")?this._updatePartForBetween(c,!1,d):"is null"===h?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===h?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):
d.error={msg:"unknown operator ("+h+")",code:2};if(e.isDefined(d.valueObj.value)&&"string"===typeof d.valueObj.value&&d.valueObj.value.startsWith("{")&&d.valueObj.value.endsWith("}")||e.isDefined(d.valueObj.value1)&&"string"===typeof d.valueObj.value1&&d.valueObj.value1.startsWith("{")&&d.valueObj.value1.endsWith("}"))d.isInteractive=!0},getFieldItemByName:function(d,c,e){this.fieldsStore.fetch({query:d,onComplete:f.hitch(this,function(d){d&&d.length?c(d[0]):e()})})},subtractDay:function(d){return new Date(d.getTime()-
this.dayInMS)},_updatePartForBetween:function(d,c,e){var f,a,b,g,h;d=this._removeOperator(e.fieldObj.shortType,d,(c?"between ":"not between ").length);f=d.toLowerCase().indexOf(" and ");if(-1<f)if(a=d.substring(0,f).trim(),a.startsWith("CURRENT_TIMESTAMP "))if(a=a.substring(18).trim(),a.startsWith("-")){e.operator=c?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{h=parseFloat(a.substring(1).trim()),1<=h?(b=this.OPERATORS.dateOperatorDays,g=h/365,1E-4>Math.abs(g-Math.round(g))?
(h=Math.round(g),b=this.OPERATORS.dateOperatorYears):(g=h/30,1E-4>Math.abs(g-Math.round(g))?(h=Math.round(g),b=this.OPERATORS.dateOperatorMonths):(g=h/7,1E-4>Math.abs(g-Math.round(g))&&(h=Math.round(g),b=this.OPERATORS.dateOperatorWeeks)))):(b=this.OPERATORS.dateOperatorMinutes,h*=24,1E-4>Math.abs(h-Math.round(h))?b=this.OPERATORS.dateOperatorHours:h*=60),e.valueObj.value=h,e.valueObj.range=b}catch(t){e.error={msg:"missing count for '"+(c?"":"not ")+"in the last'",code:3}}}else e.error={msg:"'"+(c?
"":"not ")+"in the next' not supported",code:3};else if(d=this._removeOperator(e.fieldObj.shortType,d.substring(f),5),this.storeValue1(a,e),this.storeValue2(d,e),"date"===e.fieldObj.shortType){if(e.operator=c?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,"object"===typeof e.valueObj.value1&&"object"===typeof e.valueObj.value2)try{1E3>Math.abs(this.subtractDay(e.valueObj.value2).getTime()-e.valueObj.value1.getTime())&&(e.valueObj.value=e.valueObj.value1,delete e.valueObj.value1,
delete e.valueObj.value2,e.operator=c?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(t){}}else"number"===e.fieldObj.shortType||"oid"===e.fieldObj.shortType?e.operator=c?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:e.error={msg:e.fieldObj.shortType+" field not supported for "+(c?"":"NOT ")+"BETWEEN",code:3};else e.error={msg:"missing AND operator for "+(c?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(d,c){if(d.startsWith("{")&&d.endsWith("}"))c.valueObj.value=
d;else if(d.startsWith("'{")&&d.endsWith("}'"))c.valueObj.value=d.substring(1,d.length-1);else if("date"===c.fieldObj.shortType)if(d.startsWith("'")&&d.endsWith("'")){var e=d.substring(1,d.length-1);c.valueObj.value=this.parseDate(e)}else c.valueObj.value=d,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(d.startsWith("#")||d.startsWith("%#"))&&(d.endsWith("#")||d.endsWith("#%"))?c.valueObj.value=d:d.startsWith("'")&&d.endsWith("'")?c.valueObj.value=d.substring(1,d.length-1).replace(/\'\'/g,
"'"):(c.valueObj.value=d,c.valueObj.type="field",this.getFieldItemByName({name:d},function(d){c.valueObj.label=d.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})):(c.valueObj.value=d,isNaN(d)&&(c.valueObj.type="field",this.getFieldItemByName({name:d},function(d){c.valueObj.label=d.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})))},storeValue1:function(d,c){if(d.startsWith("{")&&d.endsWith("}"))c.valueObj.value1=d;else if(d.startsWith("'{")&&d.endsWith("}'"))c.valueObj.value1=
d.substring(1,d.length-1);else if("date"===c.fieldObj.shortType)if(d.startsWith("'")&&d.endsWith("'")){var e=d.substring(1,d.length-1);c.valueObj.value1=this.parseDate(e)}else c.valueObj.value1=d,c.valueObj.type="field";else c.valueObj.value1=d,isNaN(d)&&(c.valueObj.type="field")},storeValue2:function(d,c){if(d.startsWith("{")&&d.endsWith("}"))c.valueObj.value2=d;else if(d.startsWith("'{")&&d.endsWith("}'"))c.valueObj.value2=d.substring(1,d.length-1);else if("date"===c.fieldObj.shortType)if(d.startsWith("'")&&
d.endsWith("'")){var e=d.substring(1,d.length-1);c.valueObj.value2=this.parseDate(e)}else c.valueObj.value2=d,c.valueObj.type="field";else c.valueObj.value2=d,isNaN(d)&&(c.valueObj.type="field")},parseDate:function(d){var c=m.parse(d,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=m.parse(d.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=m.parse(d.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare",
"dojo/_base/array","jimu/PanelManager"],function(q,f,k){return q(null,{constructor:function(){this.panelManager=k.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var e=this.getAllConfigs(),k=0;k<e.length;k++)if(e[k].id===f)return e[k]},getAllConfigs:function(){var k=[],k=k.concat(this.getWidgetConfigs(),this.getGroupConfigs()),
k=f.filter(k,function(e){return e.visible});return k.sort(function(e,f){return e.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(e,f){return e.index-f.index})},isControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),function(e){return e.id===k})},widgetIsControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),function(e){return e.id===k?!0:f.some(e.widgets,function(e){return e.id===
k})})},getGroupConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(e){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(e.id)&&k.push(e):"all"===this.controlledGroups&&k.push(e))},this);return k},getWidgetConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(e){this.controlledWidgets&&
(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(e.id)&&k.push(e):"all"===this.controlledWidgets&&k.push(e))},this);return k}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(q,f,k,m,e,n,l,d){var c=null,h=null,p=!1;q=q(null,function(){});var a=require.toUrl("jimu"),b=n(a+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),
g=n(a+"/SpatialReference/transform.json",{handleAs:"json"});q.loadResource=function(){var a=new m;if(c&&h)return a.resolve(),a;e([b,g]).then(function(b){c=b[0];h=b[1];p=!0;a.resolve()},function(b){console.error(b);p=!1;a.reject(b)});return a};q.getAllCSUnits=function(){if(p){var a=[];k.forEach(c.wkids,f.hitch(this,function(b){b=this.getCSUnit(b);-1===k.indexOf(a,b)&&a.push(b)}));return a}};q.convertUnit=function(a,b,c){if(p)return d.convertUnit(a,b,c)};q.getUnitRate=function(a,b){if(p)return d.getUnitRate(a,
b)};q.isProjectUnit=function(a){if(p)return d.isProjectUnit(a)};q.isGeographicUnit=function(a){if(p)return d.isGeographicUnit(a)};q.getGeographicUnits=function(){if(p)return d.getGeographicUnits()};q.getProjectUnits=function(){if(p)return d.getProjectUnits()};q.getCSUnit=function(a){if(p){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),c=a.indexOf(",",b);return a.slice(b+6,c-1)}};q.isSameSR=function(a,b){if(p){var d=this.indexOfWkid(a),e=this.indexOfWkid(b);return c.labels[d]===c.labels[e]}};
q.isValidWkid=function(a){if(p)return-1<this.indexOfWkid(a)};q.getSRLabel=function(a){if(p&&this.isValidWkid(a))return a=this.indexOfWkid(a),c.labels[a]};q.indexOfWkid=function(a){if(p)return k.indexOf(c.wkids,a)};q.isWebMercator=function(a){return l.prototype._isWebMercator?l.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new l(parseInt(a,10))).isWebMercator()};q.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};q.isValidTfWkid=function(a){if(p)return-1<this.indexOfTfWkid(a)};
q.getTransformationLabel=function(a){if(p)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),h.labels[a]):""};q.indexOfTfWkid=function(a){if(p)return k.indexOf(h.tfWkids,a)};q.isGeographicCS=function(a){if(p)return this.isValidWkid(a)?c.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};q.isProjectedCS=function(a){if(p)return this.isValidWkid(a)?c.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};q.getGeoCSByProj=function(a){if(p&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=k.indexOf(c.details,
a),c.wkids[a]};q.getSpheroidStr=function(a){if(p){if(this.isGeographicCS(a))return c.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=c.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(b,d)}return null}};q.getCSStr=function(a){if(p)return c.details[this.indexOfWkid(a)]};q.isSameSpheroid=function(a,b){if(p){var c=this.getSpheroidStr(a),d=this.getSpheroidStr(b);return c&&d&&c===d?!0:!1}};return q})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare",
"dojo/_base/array"],function(q,f){var k="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),m="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),e={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,
MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,
DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897},n=q(null,function(){});n.convertUnit=function(f,d,c){return e[f.toUpperCase()]/e[d.toUpperCase()]*c};n.getUnitRate=function(f,d){return e[f.toUpperCase()]/e[d.toUpperCase()]};n.isProjectUnit=function(e){return-1<f.indexOf(k,e.toUpperCase())};n.isGeographicUnit=function(e){return-1<f.indexOf(m,e.toUpperCase())};n.getGeographicUnits=function(){return m};n.getProjectUnits=function(){return k};return n})},"jimu/dijit-all":function(){define([],
1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(q,f,k,m,e,n,l,d){return q(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){l.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&n.add(this.domNode,"jimu-radio-checked");this.own(e(this.domNode,"click",k.hitch(this,
function(){this.checked||this.check()})))},check:function(c){void 0===c&&(c=!0);this.checked=!0;n.add(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(c){void 0===c&&(c=!0);this.checked=!1;n.remove(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(c){null!==this.group&&m.forEach(d.toArray(),function(d){d.id!==this.id&&d["class"]===this["class"]&&d.group===this.group&&(c?d.check(!1):
d.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented dojo/keys".split(" "),function(q,f,k,m,e,n,l,d){return q([f,l],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=m.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.labelNode=m.create("div",{"class":"label jimu-float-leading",
innerHTML:this.label||""},this.domNode);this.checked&&m.addClass(this.checkNode,"checked");this.status||m.addClass(this.domNode,"jimu-state-disabled");this.own(n(this.checkNode,"click",k.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.own(n(this.labelNode,"click",k.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass();this._initSection508()},setLabel:function(c){this.label=c;this.labelNode.innerHTML=
this.label;this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?m.removeClass(this.labelNode,"not-visible"):m.addClass(this.labelNode,"not-visible"))},_initSection508:function(){"undefined"!==typeof this.tabindex&&(m.setAttr(this.checkNode,"tabindex",this.tabindex),this.own(n(this.checkNode,"focus",k.hitch(this,function(){m.addClass(this.checkNode,"dijitCheckBoxFocused")}))),this.own(n(this.checkNode,"blur",k.hitch(this,function(){m.removeClass(this.checkNode,
"dijitCheckBoxFocused")}))),this.own(n(this.checkNode,"keypress",k.hitch(this,function(c){c=c.charCode||c.keyCode;m.hasClass(this.checkNode,"dijitCheckBoxFocused")&&d.SPACE===c&&this.status&&(this.checked?this.uncheck():this.check())}))))},setValue:function(c){this.status&&(!0===c?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(c){c=!!c;var d=this.status!==c;(this.status=c)?e.remove(this.domNode,"jimu-state-disabled"):e.add(this.domNode,"jimu-state-disabled");
d&&this.emit("status-change",c)},getStatus:function(){return this.status},check:function(c){if(this.status&&(this.checked=!0,m.addClass(this.checkNode,"checked"),!c))this.onStateChange()},uncheck:function(c){if(this.status&&(this.checked=!1,m.removeClass(this.checkNode,"checked"),!c))this.onStateChange()},onStateChange:function(){if(this.onChange&&k.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()}})})},
"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency dijit/form/Select dijit/form/NumberSpinner".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B){return q([f,k,m,n],{templateString:e,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(h(document.body,
"click",l.hitch(this,this._onBodyClicked)));(this._isIE8=8===p("ie"))&&d.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",
this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===
this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(a){var b=null;"marker"===this.type?b=this._getPointSymbolBySetting(a):"line"===this.type?b=this._getLineSymbolBySetting(a):"fill"===this.type?b=this._getFillSymbolBySetting(a):"text"===this.type&&(b=this._getTextSymbolBySetting(a));a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),
b=0,c=a.length;b<c;b++){var d=a[b];this[d]&&this[d].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(a,b){var c=b.domNode,e=b.dropDown.domNode,c=a===c||d.isDescendant(a,c),e=a===e||d.isDescendant(a,e);if(!c&&!e)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){a(".symbol-section",
this.domNode).style("display","none")},_showSection:function(b){this._hideAllSections();a("."+b+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return g.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=t.fromJson(c)}catch(D){console.error(D)}return b},_createSymbolIconTable:function(b,e,f){var g=this.type+"-icon-table";
b=d.toDom('\x3ctable class\x3d"'+("icon-table "+g+" "+(g+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var g=a("tbody",b)[0],h=Math.ceil(e.length/8),p=0;p<h;p++)d.create("tr",{},g);var r=a("tr",b);c.forEach(e,l.hitch(this,function(a,b){var c=l.clone(a),e=t.fromJson(a),g=d.create("td",{},r[Math.floor(b/8)]);d.addClass(g,"symbol-td-item");e=this._createSymbolNode(e);d.addClass(e,"symbol-div-item");var h=e.firstChild;d.addClass(h,"svg-node");if(this._isIE8&&"point"===f)if(window.isRTL){if("Cross"===
a.name||"X"===a.name)d.setStyle(h,"right","-20px"),d.setStyle(e,"marginTop","20px")}else"Cross"!==a.name&&"X"!==a.name||d.setStyle(e,"marginTop","20px");e.symbol=c;d.place(e,g)}));return b},_updatePreview:function(a){var b=this._cloneSymbol(this.symbol);d.empty(a);(b=r.createSymbolNode(b))||(b=d.create("div"));d.place(b,a)},_createSymbolNode:function(a){(a=r.createSymbolNode(a,{width:36,height:36}))||(a=d.create("div"));d.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=
null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new u({style:"esriSMSCircle",
color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(h(this.pointIconTables,".symbol-div-item:click",l.hitch(this,this._onPointSymIconItemClick)));this.own(h(this.pointSymClassSelect,"change",l.hitch(this,this._onPointSymClassSelectChange)));this.own(h(this.pointSize,"change",l.hitch(this,this._onPointSymbolChange)));
this.own(h(this.pointColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(h(this.pointAlpha,"change",l.hitch(this,this._onPointSymbolChange)));this.own(h(this.pointOutlineColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(h(this.pointOutlineWidth,"change",l.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=
!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&
"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");
this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a);a=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=a?a.label:""}},_hideAllPointSymIconTable:function(){a(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var b=this.pointSymClassSelect.get("value"),b=a(".marker-icon-table-"+b,this.pointIconTables);0<b.length&&b.style("display","table")},_requestPointSymJson:function(a){var c=
"def"+a,e=this.pointSymClassSelect[c];e||(e=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json"),e=b(e,{handleAs:"json"}),this.pointSymClassSelect[c]=e,e.then(l.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"point"),d.place(b,this.pointIconTables),this._showSelectedPointSymIconTable())}),l.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(a){return d.hasClass(a,
"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),d.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=t.fromJson(b);b=d.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var c=d.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){d.addClass(this.pointCustomImageTr,
"hidden");d.removeClass(this.pointIconTablesTr,"hidden");d.removeClass(this.pointColorTr,"hidden");d.removeClass(this.pointOpacityTr,"hidden");d.removeClass(this.pointOutlineColorTr,"hidden");d.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){d.addClass(this.pointCustomImageTr,"hidden");d.removeClass(this.pointIconTablesTr,"hidden");d.addClass(this.pointColorTr,"hidden");d.addClass(this.pointOpacityTr,"hidden");d.addClass(this.pointOutlineColorTr,"hidden");
d.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){d.removeClass(this.pointCustomImageTr,"hidden");d.addClass(this.pointIconTablesTr,"hidden");d.addClass(this.pointColorTr,"hidden");d.addClass(this.pointOpacityTr,"hidden");d.addClass(this.pointOutlineColorTr,"hidden");d.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(a){if(!this.symbol||a&&!this.pointSize.validate())return null;var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(a&&
!this.pointOutlineWidth.validate())return null;this.symbol.setSize(b);a=this.pointColor.getColor();b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);a=this.pointOutlineColor.getColor();var b=parseFloat(this.pointOutlineWidth.get("value")),c=new z;c.setStyle(z.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=
new B({cropImage:!1,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});d.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(h(this.imageChooser,"change",l.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(a,b){this.imageNameNode.innerHTML=b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");var c=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=
this.symbol=new v({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:c,height:c,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(h(this.lineIconTables,".symbol-div-item:click",l.hitch(this,this._onLineSymIconItemClick)));
this.own(h(this.lineColor,"change",l.hitch(this,this._onLineSymbolChange)));this.own(h(this.lineStylesSelect,"change",l.hitch(this,this._onLineSymbolChange)));this.own(h(this.lineAlpha,"change",l.hitch(this,this._onLineSymbolChange)));this.own(h(this.lineWidth,"change",l.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,
this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
a+".json");b(c,{handleAs:"json"}).then(l.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"line"),d.place(b,this.lineIconTables))}),l.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(a){return d.hasClass(a,"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),d.addClass(b,"selected-symbol-div-item"),
b=b.symbol)b=t.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(a){if(a&&!this.lineWidth.validate())return null;this.symbol=new z;a=this.lineColor.getColor();var b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");
this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(h(this.fillIconTables,".symbol-div-item:click",l.hitch(this,this._onFillSymIconItemClick)));this.own(h(this.fillColor,"change",l.hitch(this,this._onFillSymbolChange)));this.own(h(this.fillAlpha,"change",l.hitch(this,this._onFillSymbolChange)));this.own(h(this.fillOutlineColor,"change",l.hitch(this,
this._onFillSymbolChange)));this.own(h(this.fillOutlineWidth,"change",l.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,
10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");b(c,{handleAs:"json"}).then(l.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"fill"),d.place(b,this.fillIconTables))}),l.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||
b.srcElement,function(a){return d.hasClass(a,"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),d.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=t.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(a){if(a&&!this.fillOutlineWidth.validate())return null;this.symbol=new A;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();a=this.fillOutlineColor.getColor();
var c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(b);this.symbol.setStyle(A.STYLE_SOLID);b=new z;b.setStyle(z.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(h(this.inputText,"change",
l.hitch(this,this._onTextSymbolChange)));this.own(h(this.textColor,"change",l.hitch(this,this._onTextSymbolChange)));this.own(h(this.textFontSize,"change",l.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",
a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(a){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";d.setStyle(this.textPreview,{color:b,fontSize:c,fontFamily:a});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(a){if(a&&!this.textFontSize.validate())return null;this.symbol=new y;a=this.inputText.value;var b=this.textColor.getColor(),
c=parseInt(this.textFontSize.get("value"),10),d=new w;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview(d.family);return this.symbol}})})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff dojo/request esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){var u=0;q=f([k,m,q],{templateString:d,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();
a.file.supportHTML5()||c("safari")||!a.file.isEnabledFlash()||a.file.loadFileAPI().then(e.hitch(this,function(){n.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){n.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&n.addClass(this.displayText,"disable-label");n.removeAttr(this.domNode,"title")},enableChooseImage:function(){n.setStyle(this.fileForm,"display","block");this.label&&
"string"===typeof this.label&&n.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._processProperties();this._porcessMaskClick();this._setupFileInput();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,n.setStyle(this.hintText,"display",
"block"));this.showSelfImg&&n.setStyle(this.hintImage,"display","block");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var b="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?b=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(b=this.format.join(","));n.setAttr(this.fileInput,"accept",b)}a.file.supportHTML5()||c("safari")||!a.file.isEnabledFlash()||n.setStyle(this.fileInput,{width:"100%",
height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_porcessMaskClick:function(){n.setAttr(this.fileInput,"id","imageChooser_"+u);n.setAttr(this.mask,"for","imageChooser_"+u);u++;this.maskHandle=l(this.mask,"click",e.hitch(this,function(b){b.stopPropagation();if(c("safari")&&7>c("safari"))new r({message:this.nls.unsupportReaderAPI}),b.preventDefault();else{if(!a.file.supportHTML5()){if(!a.file.isEnabledFlash()){var d=n.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,
target:"_blank"});new r({message:d});b.preventDefault();return}if(!a.file.supportFileAPI()){new r({message:this.nls.unsupportReaderAPI});b.preventDefault();return}}n.setStyle(this.fileInput,"display","none");setTimeout(e.hitch(this,function(){n.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=p.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);n.setAttr(this.domNode,"title",a)}else n.setAttr(this.domNode,"title",
"")},_setupFileInput:function(){if(9>=c("ie"))this.own(l(this.fileInput,"change",e.hitch(this,this._onFileInputChange)));else l.once(this.fileInput,"change",e.hitch(this,this._onFileInputChange))},_onFileInputChange:function(b){var d=b.target.files&&b.target.files[0]||b.files&&b.files[0];if(this.format&&-1===this.format.indexOf(d.type))new r({message:this.nls.invalidType}),(!c("ie")||9<c("ie"))&&this._recreateFileForm();else{var f=9>c("ie")?23552:1024*this.maxSize;a.file.readFile(b,"image/*",f,e.hitch(this,
function(a,b,e){a?(b=this.nls[a.errCode],"exceed"===a.errCode&&(b=b.replace("1024",f/1024)),new r({message:b})):(this.fileProperty.fileName=b,window.isXT&&this.cropImage&&"image/gif"!==d.type?this._cropImageByUser(e):this._readFileData(e));(!c("ie")||9<c("ie"))&&this._recreateFileForm()}))}},_recreateFileForm:function(){var a=e.clone(this.mask),b=e.clone(this.fileInput);n.destroy(this.mask);n.destroy(this.fileInput);var c=e.clone(this.fileForm);n.place(a,c);n.place(b,c);n.place(c,this.fileForm,"replace");
this.maskHandle.remove();this.mask=a;this.fileInput=b;n.destroy(this.fileForm);this.fileForm=c;this._porcessMaskClick();this._setupFileInput()},_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&n.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?n.setAttr(this.selfImg,"src",a):this.selfImg.src=a,(a=n.getMarginBox(this.hintImage))&&a.w&&a.h&&(n.style(this.selfImg,"maxWidth",a.w+"px"),n.style(this.selfImg,"maxHeight",a.h+"px")))},_cropImageByUser:function(a){var c=
new b({imageSrc:a,nls:e.clone(this.nls),realWidth:this.goldenWidth,realHeight:this.goldenHeight}),d=new t({hidden:!0}),f=new g({titleLabel:this.nls.cropImage,content:c,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:e.hitch(this,function(){var b=c.getImageSize(),g=c.getCropSize();d.show();h("/webappbuilder/rest/cropimage",{data:{imageData:a,imageDisplaySize:b.w+","+b.h,cropRectangle:g.w+","+g.h+","+g.t+","+g.l},method:"POST",handleAs:"json",headers:{"X-Requested-With":null}}).then(e.hitch(this,
function(a){a.success?(this._readFileData(a.imageData),f.close()):(new r({message:this.nls.unknowError}),d.hide())}),e.hitch(this,function(a){console.error(a);new r({message:this.nls.unknowError});d.hide()}))})}]});d.placeAt(f.domNode);c.startup();n.addClass(f.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});q.GIF="image/gif";q.JPEG="image/jpeg";q.PNG="image/png";
return q})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message esri/lang dojo/NodeList-dom".split(" "),function(q,f,k,m,e,n,l,d,c,h){return q([n,l],{templateString:d,inDrag:!1,inSlider:!1,realWidth:30,realHeight:30,ratio:null,imageSrc:null,_currentX:null,_currentY:null,_currentTop:0,_currentLeft:0,postCreate:function(){this._dragingHandlers=
[];this.setImageSrc(this.imageSrc);this.own(m(this.ownerDocument,"mousemove",k.hitch(this,"_onMouseMove")));this.own(m(this.ownerDocument,"mouseup",k.hitch(this,"_onMouseUp")));this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.own(m(this.baseImage,"load",k.hitch(this,function(){this._init();f.setStyle(this.loadingImg,"display","none")})))},setImageSrc:function(c){f.setAttr(this.viewerImage,"src",c);f.setAttr(this.baseImage,"src",c)},getImageSize:function(){return{w:this._currentImageWidth,
h:this._currentImageHeight}},getCropSize:function(){return{l:-this._currentLeft,t:-this._currentTop,w:this.idealWidth,h:this.idealHeight}},_init:function(){var d=this._getComputedStyle(this.cropSection),a=f.getContentBox(this.cropSection),b=this._getComputedStyle(this.baseImage),g=parseFloat(b.width)||this.baseImage.offsetWidth,b=parseFloat(b.height)||this.baseImage.offsetHeight,l=g/b;this._maxImageWidth=g;this._maxImageHeight=b;if(b<this.realHeight&&g<this.realWidth)d=h.substitute({width:this.realWidth,
height:this.realHeight},this.nls.cropWaining),setTimeout(k.hitch(this,function(){this.popup.close()}),50),new c({message:d});else{this.idealWidth=this.realWidth;this.idealHeight=this.realHeight;var n=this.ratio=this.ratio?this.ratio:this.realWidth/this.realHeight;1<=this.ratio?a.h*this.ratio<=a.w?(this.idealHeight=a.h,this.idealWidth=a.h*this.ratio):(this.idealHeight=this._findProperlyValue(0,a.h,a.w-5,function(a){return a*n}),this.idealWidth=this.idealHeight*this.ratio):a.w/this.ratio<=a.h?(this.idealWidth=
a.w,this.idealHeight=a.w/this.ratio):(this.idealWidth=this._findProperlyValue(0,a.w,a.h-5,function(a){return a/n}),this.idealHeight=this.idealWidth/this.ratio);f.setStyle(this.viewerBox,{width:this.idealWidth+"px",height:this.idealHeight+"px"});d=Math.abs((parseFloat(d.height)-this.idealHeight)/2);f.setStyle(this.cropSection,{paddingTop:d+"px",paddingBottom:d+"px"});1<=l?this.idealHeight*l>=this.idealWidth?(f.setStyle(this.viewerImage,"height",this.idealHeight+"px"),f.setStyle(this.baseImage,"height",
this.idealHeight+"px")):(d=this._findProperlyValue(0,this.idealWidth,this.idealWidth,function(a){return a*l}),f.setStyle(this.viewerImage,"height",d+"px"),f.setStyle(this.baseImage,"height",d+"px")):this.idealWidth/l>=this.idealHeight?(f.setStyle(this.viewerImage,"width",this.idealWidth+"px"),f.setStyle(this.baseImage,"width",this.idealWidth+"px")):(d=this._findProperlyValue(0,this.idealHeight,this.idealHeight,function(a){return a/l}),f.setStyle(this.viewerImage,"width",d+"px"),f.setStyle(this.baseImage,
"width",d+"px"));e(".hide-status",this.domNode).removeClass("hide-status");b=this._getComputedStyle(this.baseImage);g=parseFloat(b.width)||this.baseImage.offsetWidth;b=parseFloat(b.height)||this.baseImage.offsetHeight;this._minImageWidth=g;this._minImageHeight=b;this._currentImageWidth=g;this._currentImageHeight=b;this._currentTop=-(b-this.idealHeight)/2;this._currentLeft=-(g-this.idealWidth)/2;f.setStyle(this.baseImage,{top:this._currentTop+"px",left:this._currentLeft+"px"});f.setStyle(this.viewerImage,
{top:this._currentTop+"px",left:this._currentLeft+"px"});this._zoomRatio=this._maxImageWidth/this._minImageWidth;1>=this._zoomRatio&&f.addClass(this.zoomInBtn,"disable-zoom");f.addClass(this.zoomOutBtn,"disable-zoom");this._latestPercentage=window.isRTL?100:0}},_findProperlyValue:function(c,a,b,d,e){e=isFinite(e)?parseFloat(e):1;b=0>b-e||0>b+e?e:b;var f=(c+a)/2,g=d(f);if(g<=b+e&&g>=b-e)return f;if(g>b)return this._findProperlyValue(c,f,b,d);if(g<b)return this._findProperlyValue(f,a,b,d)},_getComputedStyle:function(c){c=
f.getMarginBox(c);return{width:c.w,height:c.h,left:c.l,top:c.t}},_onViewerMouseDown:function(c){var a=this._getComputedStyle(this.baseImage),b=this._getComputedStyle(this.viewerContent);this._maxOffsetLeft=parseFloat(b.width)-parseFloat(a.width);this._maxOffsetTop=parseFloat(b.height)-parseFloat(a.height);this._maxOffsetLeft=0<this._maxOffsetLeft?0:this._maxOffsetLeft;this._maxOffsetTop=0<this._maxOffsetTop?0:this._maxOffsetTop;this.inDrag=!0;this._currentX=c.clientX;this._currentY=c.clientY;this._stopSelect()},
_stopSelect:function(){this._dragingHandlers=this._dragingHandlers.concat([m(this.ownerDocument,"dragstart",function(c){c.stopPropagation();c.preventDefault()}),m(this.ownerDocumentBody,"selectstart",function(c){c.stopPropagation();c.preventDefault()})])},_removeStopSelect:function(){for(var c=this._dragingHandlers.pop();c;)c.remove(),c=this._dragingHandlers.pop()},_onViewerMouseUp:function(c){this.inDrag&&(this.inDrag=!1,this._resetImagePosition(c.clientX,c.clientY),this._removeStopSelect(),c.stopPropagation())},
_onSliderMouseDown:function(c){if(!(1>=this._zoomRatio)){this.inSlider=!0;this._currentX=c.clientX;this._currentY=c.clientY;var a=f.position(this.sliderNode);this._startSliderLeft=a.x;this._sliderWidth=a.w;this._stopSelect();c.stopPropagation()}},_onSliderMouseUp:function(c){if(!(1>=this._zoomRatio)&&this.inSlider){this.inSlider=!1;this._resetSliderButtonPosition(c.clientX);var a=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(a.left);this._currentTop=parseFloat(a.top);this._latestPercentage=
(c.clientX-this._startSliderLeft)/this._sliderWidth*100;this._latestPercentage=this._normalizePercentage(this._latestPercentage);this._removeStopSelect();c.stopPropagation()}},_onMouseMove:function(c){this.inDrag&&this._resetImagePosition(c.clientX,c.clientY);!this.inSlider||1>=this._zoomRatio||this._resetSliderButtonPosition(c.clientX,c.clientY)},_onMouseUp:function(c){this.inDrag&&this._onViewerMouseUp(c);this.inSlider&&this._onSliderMouseUp(c)},_onZoomOutClick:function(){1>=this._zoomRatio||this._zoomImage("out")},
_onZoomInClick:function(){1>=this._zoomRatio||this._zoomImage("in")},_zoomImage:function(c){var a=0;this._latestPercentage=this._normalizePercentage(this._latestPercentage);"in"===c?a=window.isRTL?this._latestPercentage-20:this._latestPercentage+20:"out"===c&&(a=window.isRTL?this._latestPercentage+20:this._latestPercentage-20);c=this._normalizePercentage(a);this._moveSliderButton(c,this._latestPercentage);this._latestPercentage=c;c=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(c.left);
this._currentTop=parseFloat(c.top)},_resetImagePosition:function(c,a){var b=c-this._currentX,d=a-this._currentY;0<=this._currentTop+d?(f.setStyle(this.baseImage,"top",0),f.setStyle(this.viewerImage,"top",0),this._currentY=a,this._currentTop=0):this._currentTop+d<=this._maxOffsetTop?(f.setStyle(this.baseImage,"top",this._maxOffsetTop+"px"),f.setStyle(this.viewerImage,"top",this._maxOffsetTop+"px"),this._currentY=a,this._currentTop=this._maxOffsetTop):(f.setStyle(this.baseImage,"top",this._currentTop+
d+"px"),f.setStyle(this.viewerImage,"top",this._currentTop+d+"px"),this._currentY=a,this._currentTop+=d);0<=this._currentLeft+b?(f.setStyle(this.baseImage,"left",0),f.setStyle(this.viewerImage,"left",0),this._currentX=c,this._currentLeft=0):this._currentLeft+b<=this._maxOffsetLeft?(f.setStyle(this.baseImage,"left",this._maxOffsetLeft+"px"),f.setStyle(this.viewerImage,"left",this._maxOffsetLeft+"px"),this._currentX=c,this._currentLeft=this._maxOffsetLeft):(f.setStyle(this.baseImage,"left",this._currentLeft+
b+"px"),f.setStyle(this.viewerImage,"left",this._currentLeft+b+"px"),this._currentX=c,this._currentLeft+=b)},_normalizePercentage:function(c){c=0>c?0:c;return 100<c?100:c},_resetSliderButtonPosition:function(c){c=(c-this._startSliderLeft)/this._sliderWidth*100;c=this._normalizePercentage(c);this._moveSliderButton(c,this._latestPercentage)},_moveSliderButton:function(c,a){0>=c?f.addClass(this.zoomOutBtn,"disable-zoom"):f.removeClass(this.zoomOutBtn,"disable-zoom");100<=c?f.addClass(this.zoomInBtn,
"disable-zoom"):f.removeClass(this.zoomInBtn,"disable-zoom");f.setStyle(this.sliderButton,"left",c+"%");window.isRTL&&(c=100-c,a=100-a);var b=this._minImageWidth*(this._zoomRatio-1)*c/100,d=this._minImageHeight*(this._zoomRatio-1)*c/100,e=this._getComputedStyle(this.baseImage);this._currentLeft=parseFloat(e.left);this._currentTop=parseFloat(e.top);var e=(Math.abs(this._currentLeft)+this.idealWidth/2)*((this._minImageWidth+b)/this._currentImageWidth-1),h=(Math.abs(this._currentTop)+this.idealHeight/
2)*((this._minImageWidth+b)/this._currentImageWidth-1);f.setStyle(this.baseImage,{width:this._minImageWidth+b+"px",height:this._minImageHeight+d+"px"});f.setStyle(this.viewerImage,{width:this._minImageWidth+b+"px",height:this._minImageHeight+d+"px"});this._currentImageWidth=this._minImageWidth+b;this._currentImageHeight=this._minImageHeight+d;if(0<=c-a)f.setStyle(this.baseImage,{top:this._currentTop-h+"px",left:this._currentLeft-e+"px"}),f.setStyle(this.viewerImage,{top:this._currentTop-h+"px",left:this._currentLeft-
e+"px"});else{var l=0,p=0,l=0<=this._currentTop-h?0:this._currentTop-h+this._minImageHeight+d<=this.idealHeight?this.idealHeight-this._minImageHeight-d:this._currentTop-h,p=0<=this._currentLeft-e?0:this._currentLeft-e+this._minImageWidth+b<=this.idealWidth?this.idealWidth-this._minImageWidth-b:this._currentLeft-e;f.setStyle(this.baseImage,{top:l+"px",left:p+"px"});f.setStyle(this.viewerImage,{top:l+"px",left:p+"px"})}this._latestPercentage=c}})})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker jimu/utils".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p){return q([f,k],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");e.setStyle(this.domNode,"backgroundColor",this.color.toHex());
this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){c.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var b=this.tooltipDialog.domNode;return a===b||e.isDescendant(a,b)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){c.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=
!0},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();c.close(this.tooltipDialog)},_createTooltipDialog:function(){var a=e.create("div");this.tooltipDialog=new d({content:a});e.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var b=new h({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:m.hitch(this,function(a){this.ensureMode||(a=new l(a),this.setColor(a))})});b.placeAt(a);b.startup();if(this.ensureMode){var c=
e.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},a);this.own(n(c,"click",m.hitch(this,function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(c=e.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},a),this.own(n(c,"click",m.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a));this._hideTooltipDialog()}))));a=e.create("div",{"class":"jimu-btn jimu-float-trailing",
title:this.nls.apply,innerHTML:this.nls.apply},a);this.own(n(a,"click",m.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a))})))}this.own(n(this.domNode,"click",m.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(n(document.body,"click",m.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=b},setColor:function(a,
b){if(a instanceof l){var c=this.color,d="";c&&(d=c.toHex());c=a.toHex();this.color=a;e.setStyle(this.domNode,"backgroundColor",c);if(d!==c&&(this.picker.set("value",c),!1!==b))this.onChange(new l(c))}},getColor:function(){return this.color},_changeLabel:function(a){e.empty(this.domNode);e.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:p.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)},onClose:function(){},getPopup:function(){return this.tooltipDialog||
null},setLabel:function(a){e.empty(this.domNode);e.create("span",{innerHTML:a||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B){q.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",u,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:B,postMixInProperties:function(){p.contains(d.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=r.getUniqueId(this.id);k.mixin(this,A.getLocalization("dojox.widget","ColorPicker"));k.mixin(this,A.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>l("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new g.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new g.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(n.subscribe("/dnd/move/stop",k.hitch(this,"_clearTimer"))),this._subs.push(n.subscribe("/dnd/move/start",
k.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:a.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:a.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=z.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){if(a.node==this.cursorNode||a.node==this.hueCursorNode)t.focus(a.node),h.setSelectable(this.domNode,!1),this._timer=setInterval(k.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),h.setSelectable(this.domNode,!0))},_setHue:function(a){e.style(this.colorUnderlay,"backgroundColor",z.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(b,c,d){if(-1!==b){b=e.style(this.hueCursorNode,"top");c=this.PICKER_HUE_SELECTOR_H/2;b+=c;var f=!1;d.charOrCode==a.UP_ARROW?0<b&&(--b,f=!0):d.charOrCode==a.DOWN_ARROW&&b<this.PICKER_HUE_H&&(b+=1,f=!0);f&&e.style(this.hueCursorNode,"top",b-c+"px")}else this._updateColor(!0)},_updateCursorNode:function(b,
c,d){c=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==b){b=e.style(this.cursorNode,"top");var g=e.style(this.cursorNode,"left");b+=c;var g=g+f,h=!1;d.charOrCode==a.UP_ARROW?0<b&&(--b,h=!0):d.charOrCode==a.DOWN_ARROW?b<this.PICKER_SAT_VAL_H&&(b+=1,h=!0):d.charOrCode==a.LEFT_ARROW?0<g&&(--g,h=!0):d.charOrCode==a.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,h=!0);h&&(g-=f,e.style(this.cursorNode,"top",b-c+"px"),e.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,b=e.style(this.hueCursorNode,"top")+b,c=e.style(this.cursorNode,"top")+c,d=e.style(this.cursorNode,"left")+d,b=Math.round(360-b/this.PICKER_HUE_H*360),d=z.fromHsv(b,d/this.PICKER_SAT_VAL_W*100,100-c/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(d);this._updateValue(d,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
z.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=z.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=z.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var c=
this.PICKER_HUE_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();c=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-c;f=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-f;d=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-d;this.animatePoint?(b.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:c,left:0}).play(),b.slideTo({node:this.cursorNode,duration:this.slideDuration,top:d,left:f}).play()):(e.style(this.hueCursorNode,"top",c+"px"),
e.style(this.cursorNode,{left:f+"px",top:d+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){var c=
this.PICKER_HUE_SELECTOR_H/2;a=a.layerY||a.y-a.target.getBoundingClientRect().top;a-=c;this.animatePoint?b.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:k.hitch(this,function(){this._updateColor(!0);t.focus(this.hueCursorNode)})}).play():(e.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!0))},_setPoint:function(a){var c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,f=a.layerY||a.y-a.target.getBoundingClientRect().top,f=f-c,c=a.layerX||a.x-
a.target.getBoundingClientRect().left,c=c-d;a&&t.focus(a.target);this.animatePoint?b.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:c,onEnd:k.hitch(this,function(){this._updateColor(!0);t.focus(this.cursorNode)})}).play():(e.style(this.cursorNode,{left:c+"px",top:f+"px"}),this._updateColor(!0))},_handleKey:function(a){},focus:function(){this.focused||t.focus(this.focusNode)},_stopDrag:function(a){c.stop(a)},destroy:function(){this.inherited(arguments);m.forEach(this._subs,function(a){n.unsubscribe(a)});
delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(q){return q})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(q,f,k,m){q=f.getObject("color",!0,q);q.Color=k;q.blend=k.blendColors;q.fromRgb=k.fromRgb;q.fromHex=k.fromHex;q.fromArray=k.fromArray;q.fromString=k.fromString;q.greyscale=m.makeGrey;f.mixin(q,{fromCmy:function(e,n,l){f.isArray(e)?(n=e[1],l=e[2],e=e[0]):f.isObject(e)&&(n=e.m,l=e.y,e=e.c);return new k({r:Math.round(255*
(1-e/100)),g:Math.round(255*(1-n/100)),b:Math.round(255*(1-l/100))})},fromCmyk:function(e,n,l,d){f.isArray(e)?(n=e[1],l=e[2],d=e[3],e=e[0]):f.isObject(e)&&(n=e.m,l=e.y,d=e.b,e=e.c);d/=100;return new k({r:Math.round(255*(1-Math.min(1,e/100*(1-d)+d))),g:Math.round(255*(1-Math.min(1,n/100*(1-d)+d))),b:Math.round(255*(1-Math.min(1,l/100*(1-d)+d)))})},fromHsl:function(e,n,l){f.isArray(e)?(n=e[1],l=e[2],e=e[0]):f.isObject(e)&&(n=e.s,l=e.l,e=e.h);n/=100;for(l/=100;0>e;)e+=360;for(;360<=e;)e-=360;var d,c;
120>e?(d=(120-e)/60,c=e/60,e=0):240>e?(d=0,c=(240-e)/60,e=(e-120)/60):(d=(e-240)/60,c=0,e=(360-e)/60);d=2*n*Math.min(d,1)+(1-n);c=2*n*Math.min(c,1)+(1-n);e=2*n*Math.min(e,1)+(1-n);.5>l?(d*=l,c*=l,e*=l):(d=(1-l)*d+2*l-1,c=(1-l)*c+2*l-1,e=(1-l)*e+2*l-1);return new k({r:Math.round(255*d),g:Math.round(255*c),b:Math.round(255*e)})}});q.fromHsv=function(e,n,l){f.isArray(e)?(n=e[1],l=e[2],e=e[0]):f.isObject(e)&&(n=e.s,l=e.v,e=e.h);360==e&&(e=0);n/=100;l/=100;var d,c,h;if(0==n)c=h=d=l;else{var p=e/60;e=Math.floor(p);
var a=p-e,p=l*(1-n),b=l*(1-n*a);n=l*(1-n*(1-a));switch(e){case 0:d=l;c=n;h=p;break;case 1:d=b;c=l;h=p;break;case 2:d=p;c=l;h=n;break;case 3:d=p;c=b;h=l;break;case 4:d=n;c=p;h=l;break;case 5:d=l,c=p,h=b}}return new k({r:Math.round(255*d),g:Math.round(255*c),b:Math.round(255*h)})};f.extend(k,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var e,f=this.r/255,l=this.g/255,d=this.b/255;e=Math.min(1-f,1-l,1-
d);return{c:Math.round((1-f-e)/(1-e)*100),m:Math.round((1-l-e)/(1-e)*100),y:Math.round((1-d-e)/(1-e)*100),b:Math.round(100*e)}},toHsl:function(){var e=this.r/255,f=this.g/255,l=this.b/255,d=Math.min(e,l,f),c=Math.max(e,f,l),h=c-d,p=0,a=0,d=(d+c)/2;0<d&&1>d&&(a=h/(.5>d?2*d:2-2*d));0<h&&(c==e&&c!=f&&(p+=(f-l)/h),c==f&&c!=l&&(p+=2+(l-e)/h),c==l&&c!=e&&(p+=4+(e-f)/h),p*=60);return{h:p,s:Math.round(100*a),l:Math.round(100*d)}},toHsv:function(){var e=this.r/255,f=this.g/255,l=this.b/255,d=Math.max(e,f,
l),c=d-Math.min(e,l,f),h=null,p=0==d?0:c/d;0==p?h=0:(h=e==d?60*(f-l)/c:f==d?120+60*(l-e)/c:240+60*(e-f)/c,0>h&&(h+=360));return{h:h,s:Math.round(100*p),v:Math.round(100*d)}}});return q})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(q,f,k,m){var e={};f.setObject("dojo.colors",e);var n=function(d,c,e){0>e&&++e;1<e&&--e;var f=6*e;return 1>f?d+(c-d)*f:1>2*e?c:2>3*e?d+(c-d)*(2/3-e)*6:d};q.colorFromRgb=k.fromRgb=function(d,c){var e=d.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(e){var f=e[2].split(/\s*,\s*/),a=f.length,e=e[1];if("rgb"==e&&3==a||"rgba"==e&&4==a)return e=f[0],"%"==e.charAt(e.length-1)?(e=m.map(f,function(a){return 2.56*parseFloat(a)}),4==a&&(e[3]=f[3]),k.fromArray(e,c)):k.fromArray(f,c);if("hsl"==e&&3==a||"hsla"==e&&4==a){var e=(parseFloat(f[0])%360+360)%360/360,b=parseFloat(f[1])/100,g=parseFloat(f[2])/100,b=.5>=g?g*(b+1):g+b-g*b,g=2*g-b,e=[256*n(g,b,e+1/3),256*n(g,b,e),256*n(g,b,e-1/3),1];4==a&&(e[3]=f[3]);return k.fromArray(e,c)}}return null};var l=
function(d,c,e){d=Number(d);return isNaN(d)?e:d<c?c:d>e?e:d};k.prototype.sanitize=function(){this.r=Math.round(l(this.r,0,255));this.g=Math.round(l(this.g,0,255));this.b=Math.round(l(this.b,0,255));this.a=l(this.a,0,1);return this};e.makeGrey=k.makeGrey=function(d,c){return k.fromArray([d,d,d,c])};f.mixin(k.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,
226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,
150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],
navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,
87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return k})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b){return q([k,m,e,n],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:l,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var a=f.locale||"",a=a.toLowerCase();"ar"===a?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===a&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){this.opacitySlider.set("value",Math.round(100-100*a))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y){var w=f("dijit.form._SliderMover",p,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=e.position(b.sliderBarContainer,!0),b._setPixelValue_=d.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){p.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,
!0)}});k=f("dijit.form.HorizontalSlider",[z,A],{templateString:y,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:r.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case l.HOME:this._setValueAttr(this.minimum,!1);break;case l.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?l.RIGHT_ARROW:l.LEFT_ARROW:case !1===this._descending?l.DOWN_ARROW:l.UP_ARROW:case !1===this._descending?l.PAGE_DOWN:l.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?l.LEFT_ARROW:l.RIGHT_ARROW:case !1===this._descending?l.UP_ARROW:l.DOWN_ARROW:case !1===this._descending?l.PAGE_UP:l.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(c("ie")||t.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){t.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=e.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(d.style[this._progressPixelSize]),l=this.slideDuration*(c-h/100);0!=l&&(0>l&&(l=0-l),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=m.animateProperty({node:d,duration:l,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=n.getComputedStyle(this.sliderBarContainer),d=e.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=d[this._pixelCount];c--;d=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>d&&(d=0);d>c&&(d=c);d=d*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(d,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==l.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==l.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(q.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var b=a('label[for\x3d"'+this.id+'"]');b.length&&(b[0].id||(b[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",b[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(g(this.domNode,
b.wheel,d.hitch(this,"_mouseWheeled")));var a=f(w,{widget:this});this._movable=new h(this.sliderHandle,{mover:a});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});k._Mover=w;return k})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(q,f,k,m,e,n){q=q("dijit.form.HorizontalRuleLabels",
n,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(e){return e},_genHTML:function(e,d){var c=
this.labels[d];return this._positionPrefix+this._calcPosition(e)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(c)+this._labelPrefix+c+this._suffix},_genDirectionHTML:function(e){return""},getLabels:function(){var e=this.labels;!e.length&&this.srcNodeRef&&(e=m("\x3e li",this.srcNodeRef).map(function(c){return String(c.innerHTML)}));if(!e.length&&1<this.count)for(var e=[],d=this.minimum,c=(this.maximum-d)/(this.count-1),f=0;f<this.count;f++)e.push(f<this.numericMargin||f>=this.count-this.numericMargin?
"":k.format(d,this.constraints)),d+=c;return e},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});f("dojo-bidi")&&q.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),m(".dijitRuleLabelContainer",this.domNode).forEach(e.hitch(this,function(d){d.style.direction=this.getTextDir(d.innerText||d.textContent||"")})))},_genDirectionHTML:function(e){return this.textDir?"direction:"+this.getTextDir(e)+";":""}});
return q})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(q,f,k){return q("dijit.form.HorizontalRule",[f,k],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+
this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var e,k=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(k*e,e);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(100-k*e,e);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(q,f,k,m){return q("dijit.form.NumberSpinner",[k,m.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(e,f){var l=this.constraints,d=isNaN(e),c=!isNaN(l.max),h=!isNaN(l.min);d&&0!=f&&(e=0<f?h?l.min:c?l.max:0:c?this.constraints.max:h?l.min:0);var k=e+f;if(d||isNaN(k))return e;c&&k>l.max&&(k=l.max);h&&k<l.min&&(k=l.min);return k},_onKeyDown:function(e){if(!(this.disabled||this.readOnly||e.keyCode!=f.HOME&&e.keyCode!=f.END||
e.ctrlKey||e.altKey||e.metaKey||"undefined"==typeof this.get("value"))){var k=this.constraints[e.keyCode==f.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);e.stopPropagation();e.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(q,f,k,m,e,n,l,d,c,h){return q("dijit.form._Spinner",d,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:c,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(c){return c},_arrowPressed:function(c,a,b){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),a*b),!1),h.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(c,a,b){var d=
this.smallDelta;a==this.textbox&&(a=b.keyCode,d=a==f.PAGE_UP||a==f.PAGE_DOWN?this.largeDelta:this.smallDelta,a=a==f.UP_ARROW||a==f.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==c?this._arrowReleased(a):this._arrowPressed(a,a==this.upArrowNode?1:-1,d)},_wheelTimer:null,_mouseWheeled:function(c){if(this.focused){c.stopPropagation();c.preventDefault();var a=c.wheelDelta/120;Math.floor(a)!=a&&(a=0<c.wheelDelta?1:-1);c=c.detail?-1*c.detail:a;if(0!==c){var b=this[0<c?"upArrowNode":"downArrowNode"];this._arrowPressed(b,
c,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(b)},50)}}},_setConstraintsAttr:function(c){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(c,
a){this.focusNode.setAttribute("aria-valuenow",c);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,e.wheel,k.hitch(this,"_mouseWheeled")),l.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,this.textbox,{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(q,f,k){return q("dijit.form.RangeBoundTextBox",k,{rangeMessage:"",rangeCheck:function(f,e){return("min"in e?0<=this.compare(f,e.min):!0)&&("max"in e?0>=this.compare(f,e.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");if(null==f)return!1;var e=!1;"min"in this.constraints&&(e=this.constraints.min,e=0>this.compare(f,"number"==typeof e&&
0<=e&&0!=f?0:e));!e&&"max"in this.constraints&&(e=this.constraints.max,e=0<this.compare(f,"number"!=typeof e||0<e?e:0));return e},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var e=this.get("value");return null==e||""===e||"number"==typeof e&&isNaN(e)||this.isInRange(f)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(q,f,k,m,e,n){var l=function(c){c=c||{};var d=k.getLocalization("dojo.cldr","number",k.normalizeLocale(c.locale)),e=c.pattern?c.pattern:d[(c.type||"decimal")+
"Format"];c="number"==typeof c.places?c.places:"string"===typeof c.places&&0<c.places.length?c.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:d.decimal,places:c}},d=q("dijit.form.NumberTextBoxMixin",null,{pattern:function(c){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(c,this.editOptions))+"|":"")+this._regExpGenerator(c)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:e.format,_regExpGenerator:e.regexp,
_decimalInfo:l(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(c){var d="number"==typeof c.places?c.places:0;d&&d++;"number"!=typeof c.max&&(c.max=9*Math.pow(10,15-d));"number"!=typeof c.min&&(c.min=-9*Math.pow(10,15-d));this.inherited(arguments,[c]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=l(c)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var c=this.get("value");
"number"!=typeof c||isNaN(c)||(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=c));this.inherited(arguments)}},format:function(c,d){var e=String(c);if("number"!=typeof c)return e;if(isNaN(c))return"";if(!("rangeCheck"in this&&this.rangeCheck(c,d))&&!1!==d.exponent&&/\de[-+]?\d/i.test(e))return e;this.editOptions&&this.focused&&(d=f.mixin({},d,this.editOptions));return this._formatter(c,d)},_parser:e.parse,parse:function(c,d){var e=f.mixin({},d,this.editOptions&&this.focused?this.editOptions:
{});if(this.focused&&null!=e.places){var a=e.places,a="number"===typeof a?a:Number(a.split(",").pop());e.places="0,"+a}e=this._parser(c,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(c,d));return e},_getDisplayedValueAttr:function(){var c=this.inherited(arguments);return isNaN(c)?this.textbox.value:c},filter:function(c){if(null==c||"string"==typeof c&&""==c)return NaN;"number"!=typeof c||isNaN(c)||0==c||(c=e.round(c,this._decimalInfo.places));return this.inherited(arguments,[c])},serialize:function(c,
d){return"number"!=typeof c||isNaN(c)?"":this.inherited(arguments)},_setBlurValue:function(){var c=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(c,!0)},_setValueAttr:function(c,d,e){if(void 0!==c&&void 0===e)if(e=String(c),"number"==typeof c)if(isNaN(c))e="";else{if("rangeCheck"in this&&this.rangeCheck(c,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else c?c=void 0:(e="",c=NaN);this.inherited(arguments,[c,d,e])},_getValueAttr:function(){var c=
this.inherited(arguments);if(isNaN(c)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+e._realNumberRegexp(f.delegate(this.constraints))+"$")).test(this.textbox.value))return c=Number(this.textbox.value),isNaN(c)?void 0:c}else return c},isValid:function(c){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var d=this.get("value");return!isNaN(d)&&this.rangeCheck(d,this.constraints)?!1!==this.constraints.exponent&&
/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var c="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!c&&!d)return this.inherited(arguments);var a=e|0,b=0>e,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),l=(this.maxLength||20)-this.textbox.value.length,k=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",a=f?a+"."+k:a+"",l=m.rep("9",l),f=e;b?f=Number(a+
l):e=Number(a+l);return!(c&&e<this.constraints.min||d&&f>this.constraints.max)}});q=q("dijit.form.NumberTextBox",[n,d],{baseClass:"dijitTextBox dijitNumberTextBox"});q.Mixin=d;return q})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),function(q,f,k,m,e,n,l,d){return q([d],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,
declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(m(this,"Change",k.hitch(this,"_onServiceUrlChange")))},
setProcessFunction:function(c,d){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof c&&(this._fetchHandle=n.after(this,"onFetch",c),this.own(this._fetchHandle));"function"===typeof d&&(this._fetchErrHandle=n.after(this,"onFetchError",d),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),
this._fetchErrHandle=null)},onFetch:function(c){return c},onFetchError:function(c){},getStatus:function(){return this._status},_onServiceUrlChange:function(c){var d=new e;d.then(k.hitch(this,function(){this._valid()}),k.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();c?l({url:k.trim(c||""),handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(k.hitch(this,function(c){this.onFetch({url:this.getValue(),data:c})?d.resolve("success"):d.reject("error")}),
k.hitch(this,function(c){d.reject(c)})):d.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},
_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a){return q([f,
k,m],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(p.bindClickAndDblclickEvents(this.tableInBodySection,e.hitch(this,function(a){if(a=p.getAncestorDom(a.target||a.srcElement,function(a){return n.hasClass(a,"simple-table-row")&&n.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),e.hitch(this,function(a){if(a=p.getAncestorDom(a.target||a.srcElement,function(a){return n.hasClass(a,"simple-table-row")&&n.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);if(this.fields&&0<this.fields.length){var f=n.create("tr",{},this.thead);l.forEach(this.fields,e.hitch(this,function(b){var g="auto";"actions"===b.type&&(b.name="actions");b.hidden?g=1:void 0!==b.width&&null!==b.width?g=b.width:"actions"!==b.type||b.name||(b.width=this._calculateActionsWidth(b)+20,g=b.width);n.create("col",{width:g},this.headColgroup);
n.create("col",{width:g},this.bodyColgroup);g=n.create("th",{innerHTML:b.title,title:b.title},f);if("checkbox"===b.type){g.innerHTML="";var h=new a({label:b.title}),l=c(".checkbox",h.domNode)[0];l&&(l.style.marginTop="10px");this.own(d(h.domNode,"click",e.hitch(this,function(){h.getValue()?this._checkAllTdCheckBoxes(b.name):this._uncheckAllTdCheckBoxes(b.name)})));h.placeAt(g)}n.addClass(g,"simple-table-field");b.hidden&&n.addClass(g,"hidden-column");b["class"]&&n.addClass(g,b["class"]);n.addClass(g,
b.name)}))}else this.fields=null},_getThCheckBox:function(a){var b=null;a=c(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return b=h.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=c(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=l.map(a,function(a){return h.byNode(a)});return a=l.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);l.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);l.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(e.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var b=this._getAllEnabledTdCheckBoxes(a),b=l.filter(b,e.hitch(this,function(a){return a.getStatus()}));0!==b.length&&(a=this._getThCheckBox(a),l.every(b,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),c=l.map(a,e.hitch(this,function(a){return this.getRowData(a)}));n.empty(this.tbody);l.forEach(a,e.hitch(this,function(a,b){this._onDeleteRow(a,c[b])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&a&&0<a.length&&l.forEach(a,e.hitch(this,function(a){b.push(this.addRow(a,-1,!0))}));this.updateUI();return b},addRow:function(a,c,d){this._rowIndex++;var b={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return b;var f=l.filter(this.fields,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=l.filter(f,e.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<f.length)return b.errorCode=this.REPEATING_ERROR,b.errorMessage="repeating data",b.repeatFields=f,b;var g=n.create("tr",{"class":"simple-table-row not-empty"},this.tbody);n.setAttr(g,"rowId","row"+this._rowIndex);
l.forEach(this.fields,e.hitch(this,function(b){var c=a[b.name],d=b.type,e=null;"actions"===d?e=this._createActionsTd(g,b):("text"===d?e=this._createTextTd(g,b,c):"radio"===d?e=this._createRadioTd(g,b,c):"checkbox"===d?e=this._createCheckboxTd(g,b,c):"empty"===d?e=this._createEmptyTd(g,b):"extension"===d&&(e=this._createExtensionTd(g,b,c)),b.hidden&&n.addClass(e,"hidden-column"))}));d||(this.updateUI(),d=this.getRows(),"number"===typeof c&&0<=c&&c<d.length&&n.place(g,d[c],"before"));b.success=!0;b.tr=
g;b.errorMessage=null;this._onAddRow(g);return b},deleteRow:function(a){if(a){var b=this.getRowData(a);n.destroy(a);this.updateUI();this._onDeleteRow(a,b)}},selectRow:function(a){this.selectable&&(c(".simple-table-row",this.tbody).removeClass("jimu-state-active"),n.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();n.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
n.addClass(this.domNode,this._classVerticalScroll);l.forEach(this.fields,e.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=n.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof a&&0<a&&(c=a+"px");n.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();n.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=c("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=c("."+this._classRowUpDiv,a)[0])&&n.removeClass(a,this._classJimuStateDisabled);(a=c("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=c("."+this._classRowDownDiv,a)[0])&&n.removeClass(a,this._classJimuStateDisabled);a=c("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);
l.forEach(a,e.hitch(this,function(a,b){0===b%2?n.addClass(a,"odd"):n.addClass(a,"even")}));if(0<a.length){var d=a[0];n.addClass(d,this._classFirstSimpleTableRow);(d=c("."+this._classRowUpDiv,d)[0])&&n.addClass(d,this._classJimuStateDisabled);a=a[a.length-1];n.addClass(a,this._classLastSimpleTableRow);(a=c("."+this._classRowDownDiv,a)[0])&&n.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,c,d){var b=null;return b=c.editable?this._createEditableTextTd(a,c,d):this._createNormalTextTd(a,
c,d)},_createNormalTextTd:function(a,d,e){var b=n.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');n.addClass(b,d.name);var f=c("div",b)[0];f.innerHTML=e||"";f.title=e||"";d["class"]&&n.addClass(b,d["class"]);n.place(b,a);return b},_createEditableTextTd:function(a,f,h){var b=n.toDom('\x3ctd class\x3d"editable-text-td '+f.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');
n.addClass(b,"simple-table-cell");n.place(b,a);f["class"]&&n.addClass(b,f["class"]);var g=c("div",b)[0],l=c("input",b)[0];g.innerHTML=h||"";""!==g.innerHTML&&(g.title=g.innerText||g.innerHTML);l.value=g.innerHTML;this.own(d(g,"dblclick",e.hitch(this,function(a){a.stopPropagation();l.value=g.innerText||g.innerHTML;n.setStyle(g,"display","none");n.setStyle(l,"display","inline");l.focus()})));this.own(d(l,"blur",e.hitch(this,function(){l.value=e.trim(l.value);var b=g.innerText||g.innerHTML,c=l.value;
""!==c?f.unique?0<this.getRowDataArrayByFieldValue(f.name,c,a).length?l.value=b:g.innerHTML=c:g.innerHTML=c:l.value=b;n.setStyle(l,"display","none");n.setStyle(g,"display","block")})));return b},_createRadioTd:function(a,d,e){var b=n.toDom('\x3ctd class\x3d"radio-td '+d.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');n.addClass(b,"simple-table-cell");n.place(b,a);d["class"]&&n.addClass(b,d["class"]);a=c("input",b)[0];a.name=d.radio&&"row"===d.radio?this._name+this._rowIndex:
this._name+d.name;a.checked=!0===e;return b},_createCheckboxTd:function(b,c,f){var g=n.toDom('\x3ctd class\x3d"checkbox-td '+c.name+'"\x3e\x3c/td\x3e');n.addClass(g,"simple-table-cell");n.place(g,b);c["class"]&&n.addClass(g,c["class"]);var h=new a({onChange:e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(c.name);"function"===typeof c.onChange&&setTimeout(e.hitch(this,function(){c.onChange(b,h)}),200)})});this.own(d(h,"status-change",e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(c.name)})));
this._setValueForCheckBox(h,f);h.placeAt(g);return g},_createActionsTd:function(a,f){var b=n.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');n.addClass(b,"simple-table-cell");var g=c(".action-item-parent",b)[0];n.place(b,a);f["class"]&&n.addClass(b,f["class"]);l.forEach(f.actions,e.hitch(this,function(b){"up"===b?(b=n.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},g),b.title=this.nls.moveUp,
this.own(d(b,"click",e.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=c(".simple-table-row",this.tbody);var d=l.indexOf(b,a);0<d&&(b=b[d-1])&&(n.place(a,b,"before"),this.updateUI(),this.emit("row-up",a))}})))):"down"===b?(b=n.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},g),b.title=this.nls.moveDown,this.own(d(b,"click",e.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=c(".simple-table-row",this.tbody);
var d=l.indexOf(b,a);d<b.length-1&&(b=b[d+1])&&(n.place(a,b,"after"),this.updateUI(),this.emit("row-down",a))}})))):"edit"===b?(b=n.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},g),b.title=this.nls.edit,this.own(d(b,"click",e.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===b&&(b=n.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},g),b.title=this.nls.deleteRow,
this.own(d(b,"click",e.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));var h=this._calculateActionsWidth(f)+"px";n.setStyle(g,"width",h);return b},_calculateActionsWidth:function(a){return 20*l.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,c){var b=n.create("td",{"class":c.name},a);n.addClass(b,"simple-table-cell");n.addClass(b,"empty-text-td");c["class"]&&n.addClass(b,c["class"]);
return b},_createExtensionTd:function(a,c,d){a=n.create("td",{"class":c.name},a);n.addClass(a,"simple-table-cell");n.addClass(a,"extension-td");c["class"]&&n.addClass(a,c["class"]);c.create&&"function"===typeof c.create&&c.create(a);c.setValue&&"function"===typeof c.setValue&&c.setValue(a,d);return a},editRow:function(a,d){var b={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof d||!n.isDescendant(a,this.tbody))return b;var f=e.mixin([],this.fields),
f=l.filter(f,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=l.filter(f,e.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,d[b.name],a).length}));if(0<f.length)return b.errorCode=this.REPEATING_ERROR,b.errorMessage="repeating data",b.repeatFields=f,b;var g=c(".simple-table-cell",a);l.forEach(this.fields,e.hitch(this,function(a,b){if(d.hasOwnProperty(a.name)){var c=g[b],e=d[a.name],f=a.type;"text"===f?a.editable?this._editEditableText(c,a,e):this._editNormalText(c,
a,e):"radio"===f?this._editRadio(c,a,e):"checkbox"===f?this._editCheckbox(c,a,e):"extension"===f&&this._editExtension(c,a,e)}}));b.success=!0;b.tr=a;b.errorMessage=null;this._onEditRow(a);return b},_editNormalText:function(a,d,e){a=c("div",a)[0];a.innerHTML=e||"";a.title=a.innerHTML},_editEditableText:function(a,d,e){d=c("div",a)[0];d.innerHTML=e||"";c("input",a)[0].value=d.innerHTML},_editRadio:function(a,d,e){c("input",a)[0].checked=!0===e},_editCheckbox:function(a,d,e){a=c(".jimu-checkbox",a)[0];
a=h.byNode(a);this._setValueForCheckBox(a,e)},_setValueForCheckBox:function(a,c){null===c?a.setStatus(!1):(a.setStatus(!0),c!==a.getValue()&&a.setValue(c))},_editExtension:function(a,c,d){c.setValue&&"function"===typeof c.setValue&&c.setValue(a,d)},_getAllRows:function(){return c(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return l.filter(a,e.hitch(this,function(a){return!n.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return l.filter(a,
e.hitch(this,function(a){return n.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,d=c(".simple-table-row",this.tbody),d=l.filter(d,e.hitch(this,function(a){return!n.hasClass(a,"empty")&&n.hasClass(a,"jimu-state-active")}));0<d.length&&(a=d[0]);return a},getSelectedRowData:function(){var a=null,c=this.getSelectedRow();c&&(a=this._getRowDataByTr(c));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=l.filter(b,e.hitch(this,
function(b){return b!==a})));return l.map(b,e.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;l.forEach(this.fields,e.hitch(this,function(d){var e=d.type;if("actions"!==e){var f=d.name;b[f]=null;var g=c(".simple-table-cell."+f,a)[0];g&&("text"===e?(d=c("div",g)[0],b[f]=d.innerText||d.innerHTML):"radio"===e?(d=c("input",g)[0],b[f]=d.checked):"checkbox"===e?(d=c(".jimu-checkbox",
g)[0],d=h.byNode(d),d.getStatus()?b[f]=d.getValue():b[f]=null):"extension"===e&&d.getValue&&"function"===typeof d.getValue&&(b[f]=d.getValue(g,d)))}}));return b},getRowDataArrayByFieldValue:function(a,c,d){var b=[];if(!this.fields||!l.some(this.fields,e.hitch(this,function(b){return b.name===a})))return[];d=this.getData(d);return b=l.filter(d,e.hitch(this,function(b){return b[a]==c}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&n.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",
a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,c){this.emit("row-delete",a,c)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},
onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(q,f,k,m,e,n,l,d,c,h){return q([l,d,n],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new c(null,this.containerNode);var d=1/this.tabs.length*100;this.isNested&&m.addClass(this.domNode,"nested");k.forEach(this.tabs,function(a){this._createTab(a,d)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);h.setVerticalCenter(this.domNode)},_createTab:function(c,a){var b;b=m.create("div",{innerHTML:c.title,"class":"tab jimu-vcenter-text",
style:{width:this.isNested?"auto":a+"%"},label:c.title},this.controlNode);this.viewStack.viewType=c.content.domNode?"dijit":"dom";c.content.label=c.title;this.viewStack.addView(c.content);this.own(e(b,"click",f.hitch(this,this.onSelect,c.title)));b.label=c.title;this.controlNodes.push(b)},onSelect:function(c){this.selectTab(c)},selectTab:function(c){this._selectControl(c);this.viewStack.switchView(c);this.emit("tabChanged",c)},_selectControl:function(c){k.forEach(this.controlNodes,function(a){m.removeClass(a,
"jimu-state-selected");a.label===c&&m.addClass(a,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(q,f,k,m,e){return q(e,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);m.forEach(this.views,f.hitch(this,function(e){1===e.nodeType?(k.place(e,this.domNode),k.addClass(e,
"view"),k.setStyle(e,"display","none")):e.domNode&&(k.place(e.domNode,this.domNode),k.addClass(e.domNode,"view"),k.setStyle(e.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var e="",f=this.getSelectedView();f&&(e=f.label);return e},getViewByLabel:function(e){for(var f=0;f<this.views.length;f++)if(e===this.views[f].label)return this.views[f];return null},
addView:function(e){this.views.push(e);1===e.nodeType?(k.place(e,this.domNode),k.addClass(e,"view")):e.domNode&&(k.place(e.domNode,this.domNode),k.addClass(e.domNode,"view"))},removeView:function(e){var f=this.views.length;this.views=m.filter(this.views,function(d){return e!==d});f!==this.views.length&&(1===e.nodeType?k.destroy(e):e.domNode&&e.destroyRecursive())},switchView:function(e){var l,d;l="number"===typeof e?this.views[e]:"string"===typeof e?this.getViewByLabel(e):e;this.views.forEach(f.hitch(this,
function(c){if(c)if(1===c.nodeType?d=c:c.domNode&&(d=c.domNode),c===l){if(k.setStyle(d,"display","block"),c.domNode)if(!c._started)c.startup(),c._started=!0;else if("function"===typeof c.onShown)c.onShown()}else if(k.setStyle(d,"display","none"),c.domNode&&"function"===typeof c.onHidden)c.onHidden()}));this._currentView=l;this.onViewSwitch(l)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p){return q([d,c,n],{templateString:h,selected:"",tabs:null,average:!0,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var b=l("td",this.tabTr);k.forEach(b,f.hitch(this,function(b,c){m.removeClass(b,"jimu-state-active");b.label===a&&(m.addClass(b,"jimu-state-active"),
this._currentIndex=c)}));this.controlNode.removeChild(this.controlTable);m.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=l("td:last-child",this.tabTr);0<b.length&&m.destroy(b[0])}0<k.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(b=m.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),
m.place(b,this.tabTr)))},removeTab:function(a){var b=-1;if(k.some(this.tabs,function(c,d){if(c.title===a)return b=d,!0})){var c=this.tabs.splice(b,1)[0],d=l("td",this.tabTr),e;k.some(d,function(b){if(b.label===a)return e=b,!0})&&m.destroy(e);this.viewStack.removeView(c.content)}},showShelter:function(){m.setStyle(this.shelter,"display","block")},hideShelter:function(){m.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new p(null,this.containerNode);k.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed",m.addClass(this.domNode,"average");else{var a=m.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');m.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var b=m.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
b.label=a.title||"";m.place(b,this.tabTr);var c=l(".tab-item-div",b)[0];c.innerHTML=b.label;c.label=b.label;a.content.label=b.label;this.viewStack.addView(a.content);this.own(e(b,"click",f.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(q,f,k,m){return q([m],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},_placeItem:function(e){e.domNode?k.place(e.domNode,this.domNode):k.place(e,this.domNode)},addItem:function(e){this.items.push(e);this._placeItem(e);this.resize()},addItems:function(e){this.items=this.items.concat(e);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},removeItem:function(e){var f;
for(f=0;f<this.items.length;f++)if(this.items[f].label===e){this.items[f].domNode?this.items[f].destroy():k.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var e;for(e=0;e<this.items.length;e++)this.items[e].domNode?this.items[e].destroy():k.destroy(this.items[e]);this.items=[]},resize:function(){var e,m,l;e=k.getMarginBox(this.domNode);m=this.getItemSize(e);l=Math.floor((e.w+this.hmargin)/(m.width+this.hmargin));this.items.forEach(f.hitch(this,function(d,c){this.setItemPosition(d,
c,m,l)}))},getItemSize:function(e){var f={},l;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(l=0;l<this.itemSize.length;l++){if(e.w<=this.itemSize[l].screenWidth){f.width=this.itemSize[l].width;f.height=this.itemSize[l].height;break}}else"fixCols"===this.strategy&&(f.width=(e.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return f},setItemPosition:function(e,f,l,d){f++;var c=f%d;f=Math.ceil(f/d);0===c&&(c=d);d={position:"absolute",top:(this.vmargin+l.height)*(f-1)+"px"};d[window.isRTL?"right":"left"]=(this.hmargin+l.width)*(c-1)+"px";0<=l.width&&(d.width=l.width+"px");0<=l.height&&(d.height=l.height+"px");k.setStyle(e.domNode?e.domNode:e,d)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){return q([f,k,m,p],{templateString:e,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var a={};this.drawLayerId&&(a.id=this.drawLayerId);this.drawLayer=new b(a);this._initDefaultSymbols();this._initTypes();a=h(".draw-item",this.domNode);this.own(a.on("click",n.hitch(this,this._onItemClick)));this.own(c(this.btnClear,"click",n.hitch(this,this._onClickClear)));this.own(c(document.body,"keydown",n.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(c(document.body,"keyup",n.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);l.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable()},enable:function(){this._isDisabled=!1;l.addClass(this.domNode,"enabled");l.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;l.addClass(this.domNode,"disabled");l.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=h(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&
(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new g(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(c(this.drawToolBar,"draw-end",n.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=
a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();h(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var b=null,c=h(".draw-item",this.domNode);"TEXT"===a?(a="POINT",b=this.textIcon):(c=c.filter(function(b){return b.getAttribute("data-geotype")===
a}),0<c.length&&(b=c[0]));b&&this._activate(b)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c,d,e,f){this.emit("draw-end",a,b,c,d,e,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){l.removeClass(this.domNode,
"hidden")},hide:function(){l.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return h(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",
outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=r.fromJson(a));this.polylineSymbol||(this.polylineSymbol=r.fromJson(b));this.polygonSymbol||(this.polygonSymbol=r.fromJson(c))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&
(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var a=h(".draw-item",this.domNode);a.style("display","none");d.forEach(a,n.hitch(this,function(a){var b=a.getAttribute("data-geotype"),b=0<=d.indexOf(this.geoTypes,b);l.setStyle(a,"display",b?"block":"none")}))},
_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,l.hasClass(a,"draw-item")&&(l.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){h(".draw-item",this.domNode).removeClass("jimu-state-active");l.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),c=a.getAttribute("data-commontype"),d=g[b];"TEXT"===b&&(d=g.POINT);this.disableWebMapPopup();this.drawToolBar.activate(d);this.emit("draw-activate",d);this.onIconSelected(a,b,c)},
_onDrawEnd:function(b){var c=h(".draw-item.jimu-state-active",this.domNode)[0],d=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),e=null,e="extent"===b.geometry.type?t.fromExtent(b.geometry):b.geometry;e.geoType=d;e.commonType=c;b=e.type;var f=null,f="point"===b||"multipoint"===b?l.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===b||"polyline"===b?this.polylineSymbol:this.polygonSymbol,e=new a(e,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();
this.drawLayer.add(e);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(e,d,c,this._shiftKey,this._ctrlKey,this._metaKey)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E){var D=q(r,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,b){this.markerSymbol=new t(t.STYLE_SOLID,10,new u(u.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,.25]));this.lineSymbol=new u(u.STYLE_SOLID,new e([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new u(u.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,.25]));this._points=[];this._mouse=!l("esri-touch")&&!l("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),b||{});if(d("ios")||d("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=m.connect,e=D;this._options=f.mixin(f.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.TRIANGLE:case e.CIRCLE:case e.ELLIPSE:case e.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case e.LINE:case e.EXTENT:case e.FREEHAND_POLYLINE:case e.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POLYLINE:case e.POLYGON:case e.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=m.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case D.CIRCLE:case D.ELLIPSE:case D.TRIANGLE:case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.RECTANGLE:case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case D.POLYLINE:case D.POLYGON:case D.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=D,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new w(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new B(c);b=[].concat(b,[b[0].offset(0,0)]);B.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new x(c),k.forEach(b,function(b){a.addPoint(b)})}m.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=y.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=A.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;return{x:Math.min(d,
e),y:Math.max(a,b),width:Math.abs(d-e),height:Math.abs(a-b),spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=D;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new z(new w({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new w(e);c.addPath(this._points);this._graphic=b.graphics.add(new z(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new B(e),c.addRing(this._points),this._graphic=b.graphics.add(new z(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}l("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case D.POLYLINE:case D.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(l("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,e=this.map,g=e.spatialReference;b=this._graphic;var h=D,k=e.toScreen(c),p=e.toScreen(d),m=[],m=p.x-k.x,p=p.y-k.y,r=Math.sqrt(m*m+p*p);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();b.geometry=B.createCircle({center:k,r:r,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case h.ELLIPSE:this._hideTooltip();
b.geometry=B.createEllipse({center:k,longAxis:m,shortAxis:p,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case h.TRIANGLE:this._hideTooltip();m=[[0,-r],[.8660254037844386*r,.5*r],[-.8660254037844386*r,.5*r],[0,-r]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.ARROW:this._hideTooltip();c=p/r;e=m/r;d=.25*e*r;g=.25*r/(p/m);r*=.25*c;m=[[m,p],[m-d*(1+24/g),p+24*e-r],[m-d*(1+12/g),p+12*e-r],[-12*c,12*e],[12*c,-12*e],[m-d*(1-12/g),p-12*e-r],[m-d*(1-24/g),p-24*
e-r],[m,p]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.LEFT_ARROW:this._hideTooltip();m=0>=m?[[m,0],[.75*m,p],[.75*m,.5*p],[0,.5*p],[0,-.5*p],[.75*m,-.5*p],[.75*m,-p],[m,0]]:[[0,0],[.25*m,p],[.25*m,.5*p],[m,.5*p],[m,-.5*p],[.25*m,-.5*p],[.25*m,-p],[0,0]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();m=0<=m?[[m,0],[.75*m,p],[.75*m,.5*p],[0,.5*p],[0,-.5*p],[.75*m,-.5*p],[.75*m,-p],[m,0]]:[[0,0],[.25*m,p],
[.25*m,.5*p],[m,.5*p],[m,-.5*p],[.25*m,-.5*p],[.25*m,-p],[0,0]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.UP_ARROW:this._hideTooltip();m=0>=p?[[0,p],[-m,.75*p],[-.5*m,.75*p],[-.5*m,0],[.5*m,0],[.5*m,.75*p],[m,.75*p],[0,p]]:[[0,0],[-m,.25*p],[-.5*m,.25*p],[-.5*m,p],[.5*m,p],[.5*m,.25*p],[m,.25*p],[0,0]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.DOWN_ARROW:this._hideTooltip();m=0<=p?[[0,p],[-m,.75*p],[-.5*m,.75*p],[-.5*m,0],[.5*m,
0],[.5*m,.75*p],[m,.75*p],[0,p]]:[[0,0],[-m,.25*p],[-.5*m,.25*p],[-.5*m,p],[.5*m,p],[.5*m,.25*p],[m,.25*p],[0,0]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.RECTANGLE:this._hideTooltip();m=[[0,0],[m,0],[m,p],[0,p],[0,0]];b.geometry=this._toPolygon(m,k.x,k.y);b.setGeometry(b.geometry);break;case h.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case h.EXTENT:b&&e.graphics.remove(b,!0);b=new F(this._normalizeRect(c,d,g));b._originOnly=
!0;this._graphic=e.graphics.add(new z(b,this.fillSymbol),!0);e.snappingManager&&e.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,
0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}l("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&this._graphic){0===
this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,e=D,f;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:f=this._graphic.geometry;break;case e.LINE:f=new w({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case e.EXTENT:f=
(new F(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:f=new w(d);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:f=new B(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),B.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),f.addRing(c)}l("esri-touch")&&a.preventDefault();this._clear();
this._drawEnd(f)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=D;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new w(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new z(c,this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),
this._onMouseMoveHandler_connect=m.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new z(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?
(c=new B(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new z(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=m.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new z(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),
b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new x(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new z(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case d.ARROW:this._addShape([[0,
0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],
[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this._drawEnd(B.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this._drawEnd(B.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,map:b}))}this._setTooltipMessage(this._points.length)},
_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new B(d.spatialReference);e.addRing(k.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=D;l("esri-touch")&&c.push(a.mapPoint);var f=c[c.length-1],g=c[c.length-2],c=f&&g&&f.x===g.x&&f.y===g.y?c.slice(0,c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||
2>c.length){m.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new w(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){m.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new B(d);a=[].concat(c,[c[0].offset(0,0)]);B.prototype.isClockwise(a)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new x(d),k.forEach(c,function(a){b.addPoint(a)})}m.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===c.ESCAPE&&(m.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(b){this._options.showTooltips&&(b?this._tooltip||(this._tooltip=h.create("div",{"class":"esriMapTooltip"},this.map.container),
a.isBodyLtr()||p.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=m.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=m.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=m.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(m.disconnect(this._onTooltipMouseEnterHandler_connect),
m.disconnect(this._onTooltipMouseLeaveHandler_connect),m.disconnect(this._onTooltipMouseMoveHandler_connect),h.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case D.POINT:c=E.toolbars.draw.addPoint;break;case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.TRIANGLE:case D.RECTANGLE:case D.CIRCLE:case D.ELLIPSE:c=
E.toolbars.draw.addShape;break;case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:c=E.toolbars.draw.freehand;break;case D.POLYLINE:case D.POLYGON:c=E.toolbars.draw.start;1===a?c=E.toolbars.draw.resume:2<=a&&(c=E.toolbars.draw.complete);break;case D.MULTI_POINT:c=E.toolbars.draw.addMultipoint,1<=a&&(c=E.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+n.body().scrollLeft-
n.body().clientLeft,a=a.clientY+n.body().scrollTop-n.body().clientTop);b.style.display="none";p.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});f.mixin(D,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});l("extend-esri")&&f.setObject("toolbars.Draw",D,b);return D})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(q,f,k,m,e){q=q([e],
{declaredClass:"esri.toolbars._Toolbar",constructor:function(e){this.map=e},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(e,f,d,c){var h=this.map;e&&(this._mapNavState={isDoubleClickZoom:h.isDoubleClickZoom,isClickRecenter:h.isClickRecenter,isPan:h.isPan,isRubberBandZoom:h.isRubberBandZoom,isKeyboardNavigation:h.isKeyboardNavigation,
isScrollWheelZoom:h.isScrollWheelZoom},h.disableDoubleClickZoom(),h.disableClickRecenter(),h.disablePan(),h.disableRubberBandZoom(),h.disableKeyboardNavigation());f&&h.hideZoomSlider();d&&h.hidePanArrows();c&&h.graphics.disableMouseEvents()},_activateMapTools:function(e,f,d,c){var h=this.map,l=this._mapNavState;e&&l&&(l.isDoubleClickZoom&&h.enableDoubleClickZoom(),l.isClickRecenter&&h.enableClickRecenter(),l.isPan&&h.enablePan(),l.isRubberBandZoom&&h.enableRubberBandZoom(),l.isKeyboardNavigation&&
h.enableKeyboardNavigation(),l.isScrollWheelZoom&&h.enableScrollWheelZoom());f&&h.showZoomSlider();d&&h.showPanArrows();c&&h.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var e=this.map;this._scrollWheelState={isScrollWheelZoom:e.isScrollWheelZoom,isScrollWheelPan:e.isScrollWheelPan};e.disableScrollWheelZoom();e.disableScrollWheelPan()},_activateScrollWheel:function(){var e=this.map,f=this._scrollWheelState;f&&(f.isScrollWheelZoom&&e.enableScrollWheelZoom(),f.isScrollWheelPan&&e.enableScrollWheelPan())}});
k("extend-esri")&&f.setObject("toolbars._Toolbar",q,m);return q})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(q,f,k,m){return q([k],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},
postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(e){if(!1===this.required&&""===e)return!0;if(isFinite(e))return!1;var f="^"+m.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=new RegExp(f,"g");f.lastIndex=0;f=f.test(e);return this.rest?(e=/\/rest\/services/gi.test(e),f&&e):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(q,f,k){var m=q.getObject("validate.regexp",!0,
k);return m=k.validate.regexp={ipAddress:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowDottedDecimal&&(e.allowDottedDecimal=!0);"boolean"!=typeof e.allowDottedHex&&(e.allowDottedHex=!0);"boolean"!=typeof e.allowDottedOctal&&(e.allowDottedOctal=!0);"boolean"!=typeof e.allowDecimal&&(e.allowDecimal=!0);"boolean"!=typeof e.allowHex&&(e.allowHex=!0);"boolean"!=typeof e.allowIPv6&&(e.allowIPv6=!0);"boolean"!=typeof e.allowHybrid&&(e.allowHybrid=!0);var f=[];e.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
e.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");e.allowDottedOctal&&f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");e.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");e.allowHex&&f.push("0[xX]0*[\\da-fA-F]{1,8}");e.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");e.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
e="";0<f.length&&(e="("+f.join("|")+")");return e},host:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowIP&&(e.allowIP=!0);"boolean"!=typeof e.allowLocal&&(e.allowLocal=!1);"boolean"!=typeof e.allowPort&&(e.allowPort=!0);"boolean"!=typeof e.allowNamed&&(e.allowNamed=!1);var f=e.allowPort?"(\\:\\d+)?":"",l="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";e.allowIP&&(l+="|"+m.ipAddress(e));e.allowLocal&&(l+="|localhost");
e.allowNamed&&(l+="|^[^-][a-zA-Z0-9_-]*");return"("+l+")"+f},url:function(e){e="object"==typeof e?e:{};"scheme"in e||(e.scheme=[!0,!1]);return f.buildGroupRE(e.scheme,function(e){return e?"(https?|ftps?)\\://":""})+m.host(e)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowCruft&&(e.allowCruft=!1);e.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+m.host(e);
e.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(e){e="object"==typeof e?e:{};"string"!=typeof e.listSeparator&&(e.listSeparator="\\s;,");var f=m.emailAddress(e);return"("+f+"\\s*["+e.listSeparator+"]\\s*)*"+f+"\\s*["+e.listSeparator+"]?\\s*"},numberFormat:function(e){e="object"==typeof e?e:{};"undefined"==typeof e.format&&(e.format="###-###-####");return f.buildGroupRE(e.format,function(e){return f.escapeString(e,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowTerritories&&(e.allowTerritories=!0);"boolean"!=typeof e.allowMilitary&&(e.allowMilitary=!0);var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";e.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");
e.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/ColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){return f([k,e,m,q],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",
declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showColorPickerOK:!1,showCoustom:!0,showCoustomRecord:!0},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);this.value=this.value?new c(this.value):new c("#fff");this._createContent()},_createContent:function(){this.appearance=n.mixin(this._defaultAppearance,this.appearance);var a=
l.create("div",{"class":"jimu-colorpalette"},this.domNode);this.appearance.showTransparent&&this._createSpecialColors(a);this.appearance.showColorPalette&&this._createColorChooser(a);this.appearance.showCoustom&&this._createJimuColorPicker(a);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(a)},setColor:function(a){this._isColorEqual(a)||(this.value=new c(a),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new c("transparent"),
!1),this.picker.setColor(new c("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex())},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){g.close(this.tooltipDialog);this.picker.destroy();
this.inherited(arguments)},_createSpecialColors:function(a){a=l.create("div",{"class":"special-color"},a);this.transparentBtn=l.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(d(this.transparentBtn,t,n.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new c("transparent"));
this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=h(".btn-wapper",this.transparentBtn)[0];l.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&l.addClass(b,"selected")}},_createColorChooser:function(a){this.colorChooser=new p({});this.colorChooser.placeAt(a);this.own(d(this.colorChooser,"change",n.hitch(this,function(a){a=new c(a);this.setColor(a);this.changeColor()})))},_createJimuColorPicker:function(b){this.coustomtBtn=l.create("div",{"class":"coustom btn"},
b);b='\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+this.nls.custom+"\x3c/div\x3e\x3c/div\x3e";this.picker=new a({ensureMode:!0,showOk:this.appearance.showColorPickerOK,showLabel:!1,value:this.value.toHex(),onChange:n.hitch(this,function(a){a=new c(a);this.setColor(a);this.changeColor();this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(a)}),onClose:n.hitch(this,function(){this.emit("jimuColorPicker-popupClose")})});
this.picker.placeAt(this.coustomtBtn);this.picker.setLabel(b);this.picker.setColor(this.value)},isJimuColorPickerTooltipDialogOpened:function(){return this.picker.isTooltipDialogOpened()},_createCoustomRecord:function(a){this.colorRecords=new b({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(a);this.own(d(this.colorRecords,"choose",n.hitch(this,function(a){this.setColor(new c(a));this.changeColor()})))},_isColorEqual:function(a){return this.value.toString()===(new c(a)).toString()?
!0:!1},_changeLabel:function(a){l.empty(this.domNode);l.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:r.invertColor(a.toHex())}},this.domNode)},getPickerTooltipDialog:function(){var a=null;this.picker&&this.picker.tooltipDialog&&(a=this.picker.tooltipDialog);return a}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a){return f([k,m,e,q],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=h.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var b=0;b<this._row;b++)for(var c=l.create("tr",{role:"row"},this.gridNode),e=0;e<this._col;e++){var f=this.colorsArray[b][e],h=p.named[f],k="";h?k=f:"rgb(0,0,1)"===
f&&(k="black",h="rgb(0,0,1)");f=this.colorTitleNls[k];h=(new p(h)).toString();this["record"+e]=l.create("td",{"class":"dijitPaletteCell","data-title":h,role:"gridcell"},c);var m=l.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+e]);l.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:f,title:f,"data-title":k,width:"16px",height:"16px",style:"background-color: "+h},m)}this.own(d(this.gridNode,a,n.hitch(this,this.onColorClick)))},onColorClick:function(a){for(var b=
a.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=l.getAttr(b,"data-title");b=(new p(b)).toString();this.setColor(b);a.stopPropagation();a.preventDefault()},_onChange:function(a){this.emit("change",a)},setColor:function(a,d){for(var b=new p(a),e=null,f=c("td",this.domNode),g=0,h=f.length;g<h;g++)l.removeClass(f[g],"dijitPaletteCellSelected");g=0;for(h=f.length;g<h;g++)if(b.toString()===l.getAttr(f[g],"data-title")){e=f[g];break}e&&l.addClass(e,"dijitPaletteCellSelected");
(e&&"undefined"===typeof d||!0===d)&&this._onChange(b)}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b){return f([k,m,e,q],{templateString:a,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",
recordsLength:10,colorList:null,postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new h(a);for(var b=null,d=c("td",this.domNode),e=0,f=d.length;e<f;e++)l.removeClass(d[e],"dijitPaletteCellSelected");e=0;for(f=d.length;e<f;e++)if(a.toString()===
l.getAttr(d[e],"title")){b=d[e];break}b&&(l.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var c=this.colorList[a].toString();l.setAttr(b,"title",c);b=this._findImg(b);l.setStyle(b,"background-color",c);l.setAttr(b,"alt",c);l.setAttr(b,"title",c)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var a=
0;a<this.recordsLength;a++){this["record"+a]=l.create("td",{"class":"dijitPaletteCell",tabindex:a,title:"",role:"gridcell"},this.container);var c=l.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+a]);l.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},c)}this.own(d(this.gridNode,b,n.hitch(this,this.onRecordClick)))},onRecordClick:function(a){for(var b=a.target;"TD"!==b.tagName;){if(!b.parentNode||b===
this.gridNode)return;b=b.parentNode}b=l.getAttr(b,"title");b=(new h(b)).toString();this.onChoose(b);a.stopPropagation();a.preventDefault()},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=c(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],c=0,d=this.recordsLength;c<d;c++){var e=this.colorList[c];e&&e.toString&&(b[c]=e.toString())}this._cleanCookie(a);try{var f=JSON.stringify(b);p(a,f,{expires:1E3,
path:"/"})}catch(A){console.error("ColorRecords: cookieList JSON.stringify error."+A.stack)}},_getCookie:function(a){a=p(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var c=this.recordsLength;a<c;a++){var d=b[a];d&&d.toString&&(this.colorList[a]=new h(d.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+v.stack)}},_cleanCookie:function(a){p(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(q,f,k,m,e,n,l,d,c){return q([l,n],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(c){c.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(c){c.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(k.removeClass(this.foldableNode,"fold-down"),k.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(c){this.panelManager.closePanel(this);c.stopPropagation();"touchstart"===c.type&&c.preventDefault()},_normalizePositionObj:function(c){var d=
this._getLayoutBox();c.left=isFinite(c.left)?c.left:d.w-c.right;c.top=isFinite(c.top)?c.top:d.h-c.bottom;delete c.right;delete c.bottom;this.position=f.mixin(f.clone(this.position),c)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new c({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(c,d){this.disableMoveable();var a=k.getMarginBox(jimuConfig.layoutId);a.l=a.l-c+d;a.w+=2*(c-d);this.moveable=new e.boxConstrainedMoveable(this.domNode,{box:a,handle:this.titleNode,within:!0});this.own(m(this.moveable,
"Moving",f.hitch(this,this.onMoving)));this.own(m(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&this._setMobilePosition();this.inherited(arguments)},_switchToMobileUI:function(){k.removeClass(this.titleNode,"title-normal");k.addClass(this.titleNode,
"title-full");k.setStyle(this.foldableNode,"display","block");k.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down")):(k.removeClass(this.foldableNode,"fold-down"),k.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){k.removeClass(this.titleNode,"title-full");k.addClass(this.titleNode,"title-normal");k.setStyle(this.foldableNode,"display","none");k.setStyle(this.maxNode,"display",
"none")},resize:function(c){var d=this._getPositionInfo(),a={left:d.position.left,top:d.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};c&&(c.t=this.domNode.offsetTop,a.left=isFinite(c.l)?c.l:a.left,a.top=isFinite(c.t)?c.t:a.top,a.width=isFinite(c.w)?c.w:a.width,a.height=isFinite(c.h)?c.h:a.height,this._normalizePositionObj(f.clone(a)),this.makePositionInfoBox(),a.width=this._positionInfoBox.w,a.height=this._positionInfoBox.h);d.position=a;this._onResponsible(d);this.inherited(arguments)},
_onResponsible:function(c){c.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(c.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(c){this._normalizePositionObj(c);this.makePositionInfoBox();c=this._getPositionInfo();this._onResponsible(c)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var c=
jimuConfig.layoutId,c="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return k.getMarginBox(c)},_getPositionInfo:function(){var c={isRunInMobile:!1,position:{left:0,top:5}},d=this._getLayoutBox(),a=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return c.isRunInMobile=!0,c;window.isRTL?(c.position.left=d.w-a,c.position.left+this._positionInfoBox.w>d.w&&(c.position.left-=this._positionInfoBox.w,0>c.position.left&&(c.position.left=d.w-this._positionInfoBox.w))):(c.position.left=
a,c.position.left+this._positionInfoBox.w>d.w&&(c.position.left=d.w>this._positionInfoBox.w?d.w-this._positionInfoBox.w:0));a=this._positionInfoBox.t;d=d.h-a;a>=d?a>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):d>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t+40+3);return c},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.layoutId)&&k.place(this.domNode,jimuConfig.layoutId);
var c=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var e=d.getPositionStyle(c);f.mixin(e,c.borderRadiusStyle);k.setStyle(this.domNode,e)},_setDesktopPosition:function(c){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.mapId)&&k.place(this.domNode,jimuConfig.mapId);k.setStyle(this.domNode,{left:c.left+"px",right:"auto",top:c.top+"px",width:(c.width||this.position.width||this._originalBox.w)+"px",height:(c.height||
this.position.height||this._originalBox.h)+"px"})},onMoving:function(c){k.setStyle(c.node,"opacity",.9)},onMoveStop:function(c){k.setStyle(c.node,"opacity",1);c=k.getMarginBox(c.node);this._normalizePositionObj(f.clone({left:c.l,top:c.t,width:c.w,height:c.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u){q.experimental("dojox.layout.ResizeHandle");var v=b("dojox.layout._ResizeHelper",t,{show:function(){a.set(this.domNode,"display","")},hide:function(){a.set(this.domNode,"display","none")},resize:function(a){p.setMarginBox(this.domNode,a)}});return b("dojox.layout.ResizeHandle",[t,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,g.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=r.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(l.body()),
h.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(h.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(b){if(!this._isSizing&&
(k.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=r.byId(this.targetId))?this.targetWidget.domNode:c.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var d=p.position(this.targetDomNode,!0);this._resizeHelper.resize({l:d.x,t:d.y,w:d.w,h:d.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:d.x,t:d.y})}this._isSizing=!0;this.startPoint={x:b.clientX,y:b.clientY};
var d=a.getComputedStyle(this.targetDomNode),f="border-model"===p.boxModel?{w:0,h:0}:p.getPadBorderExtents(this.targetDomNode,d),h=p.getMarginExtents(this.targetDomNode,d);this.startSize={w:a.get(this.targetDomNode,"width",d),h:a.get(this.targetDomNode,"height",d),pbw:f.w,pbh:f.h,mw:h.w,mh:h.h};this.isLeftToRight()||"absolute"!=a.get(this.targetDomNode,"position")||(d=p.position(this.targetDomNode,!0),this.startPosition={l:d.x,t:d.y});this._pconnects=[k.connect(l.doc,g.move,this,"_updateSizing"),
k.connect(l.doc,g.release,this,"_endSizing")];e.stop(b)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(x){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=this.targetWidget&&f.isFunction(this.targetWidget.resize),e=this._getNewCoords(b,c&&"margin");if(!1!==e&&(c?this.targetWidget.resize(e):this.animateSizing?d[this.animateMethod]([n.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:e.w}},duration:this.animateDuration}),n.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:e.h}},
duration:this.animateDuration})]).play():a.set(this.targetDomNode,{width:e.w+"px",height:e.h+"px"}),this.intermediateChanges))this.onResize(b)},_endSizing:function(a){m.forEach(this._pconnects,k.disconnect);var b=f.partial(k.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),
function(q,f,k,m,e,n){return q(n,{constructor:function(e,d,c,f){this.noLegend=f},getExtent:function(){},_initVisible:function(){var e=!1,d=this.originOperLayer.mapService;this.originOperLayer.mapService&&d.layerInfo._subLayerVisible[d.subId]&&(e=!0);this._visible=e},_setTopLayerVisible:function(e){var d;if(this.originOperLayer.mapService&&(d=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){d.layerInfo._subLayerVisible[d.subId]=e?!0:!1;this._visible=e;var c={};this.traversal(function(d){0===
d.getSubLayers().length&&(c[d.originOperLayer.mapService.subId]=d.isVisbleOrInvisilbe())});d.layerInfo._setSubLayerVisible(c)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(e){},_sevVisible:function(e){this.visible=e},obtainNewSubLayers:function(){var e=[];f.forEach(this.originOperLayer.subLayers,function(d){d.parentLayerInfo=this;d=this._layerInfoFactory.create(d);e.push(d);d.init()},this);return e},getOpacity:function(){},setOpacity:function(e){},getLayerObject:function(){var f=
new m;this.layerObject.empty?e({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(k.hitch(this,function(d){var c=this.layerObject.url;this.layerObject=d;this.layerObject.url=c;this.layerObject.id=this.id;f.resolve(this.layerObject)}),function(d){f.reject(d)}):f.resolve(this.layerObject);return f},getLayerType:function(){var e=new m;e.resolve("GroupLayer");return e},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
getScaleRange:function(){var e=this.originOperLayer.mapService;return(e=e.layerInfo._getJsapiLayerInfoById(e.subId))&&0<=e.minScale&&0<=e.maxScale?{minScale:e.minScale,maxScale:e.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet ./LoadingIndicator".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z){return f([k,m,e,l,q],{templateString:n,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,_validOptions:!1,_layerDefinition:null,_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,noFilterTip:"",enableAskForValues:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;var a=this.nls.matchMsg.split("${any_or_all}");this.nls.strMatchMsgPart1=a[0]||"";this.nls.strMatchMsgPart2=a[1]||"";this.layerInfosObj=
c.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip)},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=this._layerDefinition=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new t;this.isBuilding()?
b.reject("Filter is already building."):(this._def=null,this.reset(),this.url=a.url,this.isHosted=d.isHostedService(this.url),this._layerDefinition=a.layerDefinition,this.featureLayerId=a.featureLayerId,a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr")),b=this._def);return b},buildByExpr:function(a,b,c){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:a,
expr:b,layerDefinition:c})},buildByFilterObj:function(a,b,c){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:a,partsObj:b,layerDefinition:c})},_updatePartsObj:function(b){g.forEach(b,a.hitch(this,function(b){b.parts?g.forEach(b.parts,a.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):b.interactiveObj&&
!0===b.interactiveObj.cascade?b.interactiveObj.cascade="previous":!1===b.interactiveObj.cascade&&(b.interactiveObj.cascade="none")}));return b},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(b,c){var d=new t;c?d.resolve(c):(this.loading.show(),u({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),d.resolve(a)):d.reject()}),a.hitch(this,function(a){console.error(a);d.reject();
this.domNode&&this.loading.hide()})));return d},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(c){var d=new t;if(!this._isString(this.url))return d.reject(),d;var e=a.hitch(this,function(){setTimeout(a.hitch(this,function(){d.resolve()}),1500)}),f=a.hitch(this,function(){b.setStyle(this.contentSection,"display","block");b.setStyle(this.errorSection,"display","none");this.removeAllFilters();this.featureLayerId&&this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition);
var f=this._layerDefinition.fields;f&&0<f.length?(f=g.filter(f,a.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<f.length?(this._validOptions=!0,b.removeClass(this.btnAddSet,"jimu-state-disabled"),b.removeClass(this.btnAddExp,"jimu-state-disabled"),b.removeClass(this.iconAddExp,"jimu-state-disabled"),b.removeClass(this.iconAddSet,"jimu-state-disabled"),this.createFieldsStore(),this.valueProviderFactory=new h({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),
"expr"===c?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?e():d.reject()):d.reject():"partsObj"===c?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),e()):d.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),e()):this._isString(this.expr)?this._parseExpr(this.expr)?e():d.reject():(this.removeAllFilters(),e())):(this._showErrorOptions(this.nls.error.noFilterFields),d.reject()):
d.reject()});this._validateLayerDefinition(this._layerDefinition)?f():(this.loading.show(),u({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,f()):d.reject()}),a.hitch(this,function(a){console.error(a);d.reject();this.domNode&&this.loading.hide()})));return d},_tryOverrideFieldAliases:function(b,c){var d=this.layerInfosObj.getLayerOrTableInfoById(b);if(d&&(d=d.getPopupInfo())){var d=
d.fieldInfos,e=c.fields;if(d&&0<d.length&&e&&0<e.length){var f={};g.forEach(d,a.hitch(this,function(a){a.fieldName&&(f[a.fieldName]=a)}));g.forEach(e,a.hitch(this,function(a){var b=f[a.name];b&&b.label&&(a.alias=b.label)}))}}},toJson:function(){var b={logicalOperator:this.allAnySelect.value,parts:[]},c=this._getAllSingleFiltersAndFilterSets();if(0===c.length)return b.expr="1\x3d1",b;g.forEach(c,a.hitch(this,function(a){a=a.toJson();b.parts.push(a)}));return g.every(b.parts,a.hitch(this,function(a){return!!a}))&&
0<b.parts.length?(b.expr=this.getExprByFilterObj(b),b):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var b=a.clone(this._layerDefinition).fields;0===this.setFieldsStoreByFieldInfos(b)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();
var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(w){b=null,console.error(w)}b?this._buildEditUIByPartsObj(b):this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(b){b&&(this._destroyAllFilters(),this.allAnySelect.value=
b.logicalOperator,g.forEach(b.parts,a.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})))},_addSingleFilter:function(b){b={url:this.url,layerInfo:this._layerDefinition,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};
b=new v(b);b.placeAt(this.allExpsBox);b.startup();this.own(r.after(b,"_destroySelf",a.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_addFilterSet:function(b){b={url:this.url,layerInfo:this._layerDefinition,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory};
b=new z(b);b.placeAt(this.allExpsBox);b.startup();this.own(r.after(b,"_destroySelf",a.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var c=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&g.forEach(this.allExpsBox.childNodes,a.hitch(this,function(a){(b.hasClass(a,
"jimu-single-filter")||b.hasClass(a,"jimu-filter-set"))&&c.push(a)}));return c},_getAllSingleFiltersAndFilterSets:function(){var b=this._getAllSingleFiltersAndFilterSetsDoms();return g.map(b,a.hitch(this,function(a){return p.byNode(a)}))},_checkFilterNumbers:function(){var c=this._getAllSingleFiltersAndFilterSetsDoms();1<c.length?b.setStyle(this.matchMsg,"display","block"):b.setStyle(this.matchMsg,"display","none");0<c.length?b.setStyle(this.noFilterTipSection,"display","none"):b.setStyle(this.noFilterTipSection,
"display","block");g.forEach(c,a.hitch(this,function(a,c){b.removeClass(a,"even-filter");b.removeClass(a,"odd-filter");b.addClass(a,0===(c+1)%2?"even-filter":"odd-filter")}));this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);b.setStyle(this.errorSection,"display","none");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&this._addFilterSet()},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&
this._addSingleFilter()}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./NumberListValueProvider jimu/LayerInfos/LayerInfos".split(" "),function(q,f,k,m,e,n,l,d,c,h){var p={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},
numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},
dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},a=k([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(a){q.mixin(this,a);this.nls=window.jimuNls.filterBuilder;a=h.getInstanceSync();this.featureLayerId&&(this.layerInfo=a.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(a,c){var b=[],d=p[c];d&&(d.value&&b.push("value"),d.field&&0<this._getSameShortTypeFieldNames(a).length&&
b.push("field"),d.unique&&this.url&&(this._isStreamServer(this.url)||10.1<=parseFloat(this.layerDefinition.currentVersion)&&b.push("unique")));return b},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(b){var c=[],d=this._getFieldInfo(this.layerDefinition,b),e=a.getShortTypeByEsriType(d.type);f.forEach(this.layerDefinition.fields,q.hitch(this,function(d){d.name!==b&&a.getShortTypeByEsriType(d.type)===e&&c.push(d.name)}));
return c},getValueProvider:function(a,g){var b=null,h=q.clone(p[a.operator]);if(h){var k=a.valueObj.type,v=a.fieldObj.name,z=this._getFieldInfo(this.layerDefinition,v),A=h[k],y=A.normalProviderType,w=null,B=this._getCodedValues(z);B||this.layerDefinition.typeIdField&&this.layerDefinition.typeIdField.toUpperCase()===v.toUpperCase()&&(B=this._getSubTypes(this.layerDefinition));"field"===k?(k=this._getSameShortTypeFieldNames(v),0<k.length&&(w=f.map(k,q.hitch(this,function(a){return{value:a,label:a}})))):
B&&0<B.length&&A.codedValueProviderType&&(y=A.codedValueProviderType);h={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:a,fieldInfo:z,codedValues:B,staticValues:w,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:h,filterCodedValueIfPossible:!!A.filterCodedValueIfPossible,runtime:g};"BLANK_VALUE_PROVIDER"===y?b=new m(h):"SIMPLE_VALUE_PROVIDER"===y?b=new e(h):"TWO_NUMBERS_VALUE_PROVIDER"===y?b=new n(h):"TWO_DATES_VALUE_PROVIDER"===y?b=new l(h):"LIST_VALUE_PROVIDER"===
y?(h.showNullValues=!1,b=new d(h)):"NUMBER_LIST_VALUE_PROVIDER"===y&&(b=new c(h))}return b},_getFieldInfo:function(a,c){for(var b=a.fields,d=0;d<b.length;d++){var e=b[d];if(c===e.name)return e}return null},_getCodedValues:function(a){var b=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(b=a.codedValues,b=f.map(b,q.hitch(this,function(a){return{value:a.code,label:a.name}})));return b},_getSubTypes:function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=
f.map(a.types,q.hitch(this,function(a){return{value:a.id,label:a.name}})));return b}});a.getOperatorInfo=function(a){return q.clone(p[a])};a.getOperatorsByShortType=function(a){var b=[];"string"===a?b="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===a?b="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsLessThan numberOperatorIsAtMost numberOperatorIsGreaterThan numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===a&&(b="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorInTheLast dateOperatorNotInTheLast dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "));return b};a.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return a})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(q,f,k){return f([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(){},getValueObject:function(){return{isValid:!0,
type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),function(q,f,k,m,e,n,l,d,c,h){return n([l,d,f],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,
url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&this.filterCodedValueIfPossible&&c.isCodedValuesSupportFilter(this.layerDefinition,
this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&e.some(this.popupInfo.fieldInfos,k.hitch(this,function(c){return c.fieldName===this.fieldName?(this.fieldPopupInfo=c,!0):!1}))},getDijits:function(){return[]},bindChangeEvents:function(){var c=this.getDijits();e.forEach(c,k.hitch(this,function(a){a.declaredClass&&0===a.declaredClass.indexOf("dijit.")&&m.addClass(a.domNode,a.declaredClass.replace(/\./g,
"-"));this.own(q(a,"change",k.hitch(this,this._onChanged)))}))},_onChanged:function(){this.emit("change")},tryLocaleNumber:function(d){var a=c.localizeNumber(d);if(null===a||void 0===a)a=d;return a},getPartObject:function(){var c=this.getValueObject();if(!c)return null;var a=k.clone(this.partObj);a.valueObj=c;return a},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var c=1,a=this.getDijits();
0<a.length&&(c=e.map(a,k.hitch(this,function(a){return this.getStatusForDijit(a)})),c=Math.min.apply(c,c));return c},getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var c="1\x3d1",c=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===
this.cascade)var a=this.getCascadeFilterExpr(),c="("+c+") AND ("+a+")";return c},getLayerFilterExpr:function(){var c="1\x3d1";this.layerInfo&&(c=this.layerInfo.getFilter());c||(c="1\x3d1");return c},_getWebMapFilterExpr:function(){var c="";this.runtime?(this.layerInfo&&(c=this.layerInfo.getFilterOfWebmap()),c||(c="1\x3d1")):c="1\x3d1";return c},getDropdownFilterExpr:function(){var c="1\x3d1",c=this._getWebMapFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var a=this.getCascadeFilterExpr(),
c="("+c+") AND ("+a+")";return c},getCascadeFilterExpr:function(){return"1\x3d1"},isDefined:function(c){return h.isDefined(c)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/NumberTextBox".split(" "),function(q,f,k,m,e,n){return f([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",
_dijit:null,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-simple-value-provider");this._dijit="string"===this.shortType?new m({required:!1,trim:!0}):"number"===this.shortType?new n({required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}}):new e({required:!1,trim:!0,value:new Date});q.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},getDijits:function(){return[this._dijit]},setValueObject:function(e){this.isDefined(e.value)&&
("date"===this.shortType?this._dijit.set("value",new Date(e.value)):this._dijit.set("value",e.value))},getValueObject:function(){if(this.isValidValue()){var e=this._dijit.get("value");"date"===this.shortType?e=e.toDateString():"number"===this.shortType&&(e=parseFloat(e));return{isValid:!0,type:this.partObj.valueObj.type,value:e}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===
this.shortType?"":null}:null},setRequired:function(e){this._dijit.set("required",e)}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(q,f,k){return q("dijit.form.DateTextBox",k,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:f,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u){var v=m("dijit.Calendar",[b,g,r],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){d.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:h.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,"keydown",h.hitch(this,"_onKeyDown")),p(this.dateRowsNode,"mouseover",h.hitch(this,"_onDayMouseOver")),p(this.dateRowsNode,"mouseout",h.hitch(this,"_onDayMouseOut")),p(this.dateRowsNode,"mousedown",h.hitch(this,"_onDayMouseDown")),p(this.dateRowsNode,"mouseup",h.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=n.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!n.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(n.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||
a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",n.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),n.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!n.contains(a,"dijitCalendarDisabledDate")&&(n.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&n.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,d,e=this.currentFocus;switch(a.keyCode){case c.RIGHT_ARROW:b=1;case c.LEFT_ARROW:d="day";this.isLeftToRight()||(b*=-1);break;case c.DOWN_ARROW:b=1;case c.UP_ARROW:d="week";break;case c.PAGE_DOWN:b=1;case c.PAGE_UP:d=a.ctrlKey||a.altKey?"year":"month";break;case c.END:e=this.dateModule.add(e,"month",1),d="day";case c.HOME:e=new this.dateClassObj(e);e.setDate(1);break;default:return!0}d&&(e=this.dateModule.add(e,d,b));this._setCurrentFocusAttr(e);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=m("dijit.Calendar._MonthDropDownButton",u,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.dropDown.set("months",
c);this.containerNode.innerHTML=(6==a("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=m("dijit.Calendar._MonthDropDown",[g,t,r],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";q.forEach(a,function(a,b){l.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(e.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){var u=f("dijit.CalendarLite",[g,r],{templateString:t,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=n.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),d=this.dateModule.getDaysInMonth(a),f=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),g=new this.dateClassObj,h=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);h>
b&&(h-=7);if(!this.summary){var l=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",l[a.getMonth()])}this._date2cell={};q.forEach(this.dateCells,function(k,l){var m=l+h,p=new this.dateClassObj(a),r="dijitCalendar",n=0;m<b?(m=f-b+m+1,n=-1,r+="Previous"):m>=b+d?(m=m-b-d+1,n=1,r+="Next"):(m=m-b+1,r+="Current");n&&(p=this.dateModule.add(p,"month",n));p.setDate(m);this.dateModule.compare(p,g,"date")||(r="dijitCalendarCurrentDate "+r);this.isDisabledDate(p,
this.lang)?(r="dijitCalendarDisabledDate "+r,k.setAttribute("aria-disabled","true")):(r="dijitCalendarEnabledDate "+r,k.removeAttribute("aria-disabled"),k.setAttribute("aria-selected","false"));(n=this.getClassForDate(p,this.lang))&&(r=n+" "+r);k.className=r+"Month dijitCalendarDateTemplate";r=p.valueOf();this._date2cell[r]=k;k.dijitDateValue=r;r=p.getDateLocalized?p.getDateLocalized(this.lang):p.getDate();this._setText(this.dateLabels[l],r);c.set(k,"aria-label",e.format(p,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;q.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?h.getObject(a.datePackage,
!1):m;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?h.getObject(a.datePackage+".locale",!1):e},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),d=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);this.dayCellsHtml=b.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return c[d++%7]});a=b.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);l.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=h.hitch(this,function(a,
b,c){this[a].dojoClick=!0;return p(this[a],"click",h.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(b,c){var d=this.currentFocus,e=this._getNodeByDate(d);b=this._patchDate(b);this._set("currentFocus",b);this._date2cell&&0==this.dateModule.difference(d,b,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));d=this._getNodeByDate(b);d.setAttribute("tabIndex",this.tabIndex);(this.focused||c)&&d.focus();e&&e!=d&&(a("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!d.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){d.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}q.forEach(this._selectedCells||[],h.partial(b,!1));this._selectedCells=q.filter(q.map(a,this._getNodeByDate,this),function(a){return a});q.forEach(this._selectedCells,h.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
u._MonthWidget=f("dijit.CalendarLite._MonthWidget",g,{_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b),d=6==a("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+q.map(c,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=d+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(q,f,k,m,e,n,l,d){new Date("X");return m("dijit.form._DateTimeTextBox",[n,l],{templateString:d,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:f.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(c,d){var e=this._isInvalidDate(c),a=this._isInvalidDate(d);if(e||a)return e&&a?0:e?-1:1;var e=this.format(c,this._unboundedConstraints),a=this.format(d,this._unboundedConstraints),
b=this.parse(e,this._unboundedConstraints),f=this.parse(a,this._unboundedConstraints);return e==a?0:q.compare(b,f,this._selector)},autoWidth:!0,format:function(c,d){return c?this.dateLocaleModule.format(c,d):""},parse:function(c,d){return this.dateLocaleModule.parse(c,d)||(this._isEmpty(c)?null:void 0)},serialize:function(c,d){c.toGregorian&&(c=c.toGregorian());return k.toISOString(c,d)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(c){c=
c||{};this.dateModule=c.datePackage?e.getObject(c.datePackage,!1):q;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=c.datePackage?e.getObject(c.datePackage+".locale",!1):f;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(c){c.selector=this._selector;c.fullYear=!0;var d=k.fromISOString;"string"==typeof c.min&&(c.min=d(c.min),this.dateClassObj instanceof Date||(c.min=new this.dateClassObj(c.min)));"string"==typeof c.max&&(c.max=d(c.max),this.dateClassObj instanceof Date||(c.max=new this.dateClassObj(c.max)));this.inherited(arguments);this._unboundedConstraints=e.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(c){return!c||
isNaN(c)||"object"!=typeof c||c.toString()==this._invalidDate},_setValueAttr:function(c,d,e){void 0!==c&&("string"==typeof c&&(c=k.fromISOString(c)),this._isInvalidDate(c)&&(c=null),c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c)));this.inherited(arguments,[c,d,e]);this.value instanceof Date&&(this.filterString="");!1!==d&&this.dropDown&&this.dropDown.set("value",c,!1)},_set:function(c,d){if("value"==c){d instanceof Date&&!(this.dateClassObj instanceof Date)&&
(d=new this.dateClassObj(d));var e=this._get("value");if(e instanceof this.dateClassObj&&0==this.compare(d,e))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(c){this._isInvalidDate(c)&&(c=new this.dateClassObj);this._set("dropDownDefaultValue",c)},openDropDown:function(c){this.dropDown&&this.dropDown.destroy();var d=e.isString(this.popupClass)?e.getObject(this.popupClass,!1):this.popupClass,f=this,a=this.get("value");this.dropDown=new d({onChange:function(a){f.set("value",
a,!0)},id:this.id+"_popup",dir:f.dir,lang:f.lang,value:a,textDir:f.textDir,currentFocus:this._isInvalidDate(a)?this.dropDownDefaultValue:a,constraints:f.constraints,filterString:f.filterString,datePackage:f.datePackage,isDisabledDate:function(a){return!f.rangeCheck(a,f.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(c,d){this._setValueAttr(this.parse(c,this.constraints),d,c)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox".split(" "),
function(q,f,k,m,e,n){return f([k,m,e],{templateString:n,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-two-numbers-filter-value-provider")},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var e=parseFloat(this._dijit1.get("value")),d=parseFloat(this._dijit2.get("value"));e>d&&(this._dijit1.set("value",d),this._dijit2.set("value",e))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this.isDefined(e.value1)&&
this._dijit1.set("value",e.value1);this.isDefined(e.value2)&&this._dijit2.set("value",e.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var e={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(e.value1)&&(e.value1=null);isNaN(e.value2)&&(e.value2=null);return e}return null},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoDatesValueProvider.html dijit/form/DateTextBox".split(" "),function(q,f,k,m,e,n){return f([k,m,e],{templateString:n,postCreate:function(){this.inherited(arguments);
q.addClass(this.domNode,"jimu-two-dates-filter-value-provider")},_onRangeDateBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var e=this._dijit1.get("value"),d=e.getTime(),c=this._dijit2.get("value"),f=c.getTime();d>f&&(this._dijit1.set("value",c),this._dijit2.set("value",e))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this.isDefined(e.value1)&&this._dijit1.set("value",new Date(e.value1));this.isDefined(e.value2)&&this._dijit2.set("value",
new Date(e.value2))},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:this._dijit1.get("value").toDateString(),value2:this._dijit2.get("value").toDateString()}:null},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListValueProvider.html dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a){return n([l,d,c],{templateString:h,codedValues:null,staticValues:null,showNullValues:!1,postCreate:function(){this.inherited(arguments);m.addClass(this.domNode,"jimu-filter-list-value-provider");this._uniqueValueCache={};var a=new p({idProperty:"id",data:[]});this.valuesSelect.set("store",a);this.staticValues||"function"!==typeof this.valuesSelect._onDropDownMouseDown||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.own(q.before(this.valuesSelect,
"_onDropDownMouseDown",k.hitch(this,this._onBeforeDropDownMouseDown)))},_onFilteringSelectInput:function(){this.emit("change")},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},getDijits:function(){return[this.valuesSelect]},setValueObject:function(a){return this.staticValues?this._setValueForStaticValues(a.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(a.value,!1):this._setValueForStaticValues(a.value,
this.codedValues):this._tryUpdatingUniqueValues(a.value,!1)},getValueObject:function(){if(this.isValidValue()){var a=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(a){this.valuesSelect.set("required",a)},_setValueForStaticValues:function(a,
c){var b=null,d=-1,b=null;c&&(b=e.map(c,k.hitch(this,function(b,c){var e={id:c,value:b.value,label:b.label};e.value===a&&(d=c);return e})),this.valuesSelect.store.setData(b),0<=d&&(b=this.valuesSelect.store.get(d))&&this.valuesSelect.set("item",b))},_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(a,c){var b=new f;if(this.valuesSelect._opened)b.resolve();else{var d=this.getDropdownFilterExpr();d!==this._uniqueValueLoadingExpr?(this.valuesSelect.readOnly=
!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=d,this._uniqueValueLoadingDef=this._getUniqueValues(d),this._uniqueValueLoadingDef.then(k.hitch(this,function(d){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(a,d),this._hideLoadingIcon(),c&&this.valuesSelect.toggleDropDown(),b.resolve())}),k.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=
null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),b.reject(a))}))):b.resolve()}return b},_setValueForUniqueValues:function(a,c){c.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(c=e.filter(c,k.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===a){var b=this.getValueObject();b&&(a=b.value)}var d=-1,b=null,f=e.map(c,k.hitch(this,function(b,c){var e={id:c,value:b.value,label:b.label};b.value===a&&(d=c);return e}));
this.valuesSelect.store.setData(f);0<=d&&(b=this.valuesSelect.store.get(d));this.valuesSelect.set("item",b)},_showLoadingIcon:function(){m.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){m.removeClass(this.valuesSelect.domNode,"loading")},_getUniqueValues:function(b){var c=new f;this._uniqueValueCache[b]?c.resolve(this._uniqueValueCache[b]):(this._showLoadingIcon(),a.getUniqueValues(this.url,this.fieldName,b,this.layerDefinition,this.fieldPopupInfo).then(k.hitch(this,function(a){this.domNode&&
(this._uniqueValueCache[b]=a,c.resolve(a),this._hideLoadingIcon())}),k.hitch(this,function(a){this.domNode&&(c.reject(a),this._hideLoadingIcon())})));return c}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),function(q,f,k,m,e,n,l,d){return m([e,n,
l],{templateString:d,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());k.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),q.hitch(this,function(c){this.rangeSelect.addOption({value:c,label:this.nls[c]})}));this.rangeSelect.set("value","dateOperatorDays")},getDijits:function(){return[this._dijit1,
this.rangeSelect]},setValueObject:function(c){this.isDefined(c.value)&&this._dijit1.set("value",c.value);this.isDefined(c.range)&&this.rangeSelect.set("value",c.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var c=this.rangeSelect.get("value");"none"===c&&(c=null);return c},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var c={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(c.value)&&(c.value=null);return c}return null},setRequired:function(c){this._dijit1.set("required",c);this.rangeSelect.set("required",c)}})})},"jimu/dijit/_SingleFilter":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a){return q([f,k,m],{templateString:e,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);
this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},c=this._getFieldObjByUI();if(!c)return null;a.fieldObj=c;c=this._getOperatorByUI();if(!c)return null;a.operator=c;a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();if(c=this._isUseAskForValues()){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),
null;a.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};this.uniqueRadio&&this.uniqueRadio.checked&&(a.interactiveObj.cascade=this.cascadeSelect.get("value"))}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;this.valueRadio.checked?c.type="value":this.fieldRadio.checked?c.type="field":this.uniqueRadio.checked&&(c.type="unique");a.valueObj=c;return a},_getFieldObjByUI:function(){var a=
this._getSelectedFilteringItem(this.fieldsSelect);return a?{name:a.name,label:a.name,shortType:a.shortType,type:a.type}:null},_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){l.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){l.setStyle(this.btnDelete,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);l.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},
_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);l.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_initSelf:function(){this.layerInfo=n.mixin({},this.layerInfo);this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(c(this.fieldsSelect,"MouseEnter",n.hitch(this,this._updateFieldsSelectTitle)));this.own(c(this.operatorsSelect,"MouseEnter",n.hitch(this,
this._updateOperatorsSelectTitle)));this.enableAskForValues?(l.setStyle(this.cbxAskValues.domNode,"display","inline-block"),l.setStyle(this.promptSection,"display","block"),this.own(c(this.cbxAskValues,"status-change",n.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=n.hitch(this,this._onCbxAskValuesClicked)):(l.setStyle(this.cbxAskValues.domNode,"display","none"),l.setStyle(this.promptSection,"display","none"));this._initValueTypeRadios();var a=this.layerInfo.fields;a&&
0<a.length&&(a=d.filter(a,n.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),0<a.length&&(this._enableRadios(),this._initFieldsSelect(a),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(n.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=c(this.fieldsSelect,"change",n.hitch(this,this._onFieldsSelectChange));
this._handle2=c(this.operatorsSelect,"change",n.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,c){return this._isStreamServer(a)?!1:10.1<=parseFloat(c.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title=
"";var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var a=this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label)},_showValidationErrorTip:function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(g){console.error(g)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=
a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(a){a=d.map(a,n.hitch(this,function(a,b){var c=n.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);var d="";"string"===c.shortType?d=this.nls.string:"number"===c.shortType?d=this.nls.number:"date"===
c.shortType&&(d=this.nls.date);c.displayName=c.alias+" ("+d+")";return c}));if(0<a.length){var b=new h({data:a});this.fieldsSelect.set("store",b);this.fieldsSelect.set("value",a[0].id)}this._updateOperatorsByFieldsSelect()},_showPart:function(a){if((this.part=a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});
0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();
this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",label:this.nls.none});var b=this._getSelectedFilteringItem(this.fieldsSelect);b&&(this.operatorsSelect.shortType=b.shortType,b=a.getOperatorsByShortType(b.shortType),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),d.forEach(b,n.hitch(this,function(a){this.operatorsSelect.addOption({value:a,
label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_initValueTypeRadios:function(){var a="radio_"+p.getRandomString();this.valueRadio.name=a;this.fieldRadio.name=a;this.uniqueRadio.name=a;this.valueRadio.valueType="value";this.fieldRadio.valueType="field";this.uniqueRadio.valueType="unique";p.combineRadioCheckBoxWithLabel(this.valueRadio,this.valueLabel);p.combineRadioCheckBoxWithLabel(this.fieldRadio,this.fieldLabel);p.combineRadioCheckBoxWithLabel(this.uniqueRadio,
this.uniqueLabel);this.own(c(this.valueRadio,"click",n.hitch(this,function(){this._resetByFieldAndOperator(null,"value")})));this.own(c(this.fieldRadio,"click",n.hitch(this,function(){this._resetByFieldAndOperator(null,"field")})));this.own(c(this.uniqueRadio,"click",n.hitch(this,function(){this._resetByFieldAndOperator(null,"unique")})));this._isServiceSupportDistinctValues(this.url,this.layerInfo)||(this.uniqueTd.style.display="none")},_updateValueTypeClass:function(){l.removeClass(this.domNode,
"value-type");l.removeClass(this.domNode,"field-type");l.removeClass(this.domNode,"unique-type");l.removeClass(this.domNode,"support-cascade");if(this.valueRadio.checked)l.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none");else if(this.fieldRadio.checked)l.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none");else{l.addClass(this.domNode,"unique-type");this.cascadeSelect.set("value","previous");var a=!0,a=this._getSelectedFilteringItem(this.fieldsSelect),
a=this._getCodedValuesOrTypesCount(a);(a=0<a?p.isCodedValuesSupportFilter(this.layerInfo,a):!0)?(this.cascadeSelect.set("value","previous"),l.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none")}},_getCodedValuesOrTypesCount:function(a){if(a){if(a.domain&&"codedValue"===a.domain.type&&a.domain.codedValues)return a.domain.codedValues.length;if(this.layerInfo.typeIdField===a.name&&this.layerInfo.types)return this.layerInfo.types.length}return 0},_enableRadios:function(){this.valueRadio.disabled=
!1;this.fieldRadio.disabled=!1;this.uniqueRadio.disabled=!1},_disableAndUncheckRadios:function(){this._enableRadios();this.valueRadio.checked=!1;this.fieldRadio.checked=!1;this.uniqueRadio.checked=!1;this.valueRadio.disabled=!0;this.fieldRadio.disabled=!0;this.uniqueRadio.disabled=!0},_resetByFieldAndOperator:function(b,c){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideAndDisableCaseSensitive();this._disableAndUncheckRadios();b||(b={fieldObj:"",operator:"",
valueObj:"",interactiveObj:"",caseSensitive:!1},b.fieldObj=this._getFieldObjByUI(),b.operator=this._getOperatorByUI());var d=[],e=null;if(b.fieldObj&&b.operator){var d=this.valueProviderFactory.getSupportedValueTypes(b.fieldObj.name,b.operator),f=null;b.valueObj?e=b.valueObj.type:(e=c&&0<=d.indexOf(c)?c:d[0],b.valueObj={type:e});0<=d.indexOf("value")&&(this.valueRadio.disabled=!1);0<=d.indexOf("field")&&(this.fieldRadio.disabled=!1);0<=d.indexOf("unique")&&(this.uniqueRadio.disabled=!1);"value"===
e?f=this.valueRadio:"field"===e?f=this.fieldRadio:"unique"===e&&(f=this.uniqueRadio);f&&(f.disabled=!1,f.checked=!0)}0<d.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(b,!1),this.valueProvider.placeAt(this.attributeValueContainer,"first"),this.valueProvider.setValueObject(b.valueObj),this.valueProvider.isBlankValueProvider()?(l.addClass(this.valueProvider.domNode,"hidden"),l.addClass(this.attributeValueContainer,"hidden")):l.removeClass(this.attributeValueContainer,"hidden"),
(d=a.getOperatorInfo(b.operator))&&e&&(d[e]&&d[e].supportCaseSensitive&&this._showAndEnableCaseSensitive(),b&&this.cbxCaseSensitive.setValue(b.caseSensitive))):l.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged()},_updateWhenValueRadioChanged:function(){this._updatePrompt();this._updateValueTypeClass()},_getRadioByValueType:function(a){return"value"===a?this.valueRadio:"field"===a?this.fieldRadio:"unique"===a?this.uniqueRadio:null},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();
this._updatePrompt()},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){return this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},_getValueTypeByUI:function(){return!this.valueRadio.disabled&&this.valueRadio.checked?"value":!this.fieldRadio.disabled&&this.fieldRadio.checked?"field":!this.uniqueRadio.disabled&&
this.uniqueRadio.checked?"unique":null},_updatePrompt:function(){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);l.setStyle(this.promptTable,"display","table");var b=this.operatorsSelect.get("value"),c=this.nls[b],d=!1,e=this._getValueTypeByUI(),f=a.getOperatorInfo(b);f&&e&&(e=f[e])&&e.supportAskForValue&&(d=!0);d||this.cbxAskValues.setStatus(!1);this.cbxAskValues.status&&this.cbxAskValues.checked?(l.setStyle(this.promptTable,"display","table"),(d=this._getSelectedFilteringItem(this.fieldsSelect))&&
"none"!==b&&this.promptTB.set("value",(d.alias||d.name)+" "+c)):l.setStyle(this.promptTable,"display","none")},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b){return q([f,k,m],{templateString:e,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;var a=this.nls.matchMsgSet.split("${any_or_all}");this.nls.strMatchMsgPart1=a[0]||"";this.nls.strMatchMsgPart2=a[1]||"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelf()},toJson:function(){var b=a(".jimu-single-filter",this.allExpsBox),b=c.map(b,l.hitch(this,function(a){return n.byNode(a).toJson()}));return c.every(b,l.hitch(this,function(a){return!!a}))&&0<b.length?{logicalOperator:this.allAnySelect.value,parts:b}:null},showDelteIcon:function(){d.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){d.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(h(this.btnAdd,"click",l.hitch(this,this._addSingleFilter)));
if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):c.forEach(a,l.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter()},_addSingleFilter:function(a){a=new b({url:this.url,layerInfo:this.layerInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,
part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,style:{margin:"15px auto 0 auto",border:0,background:"inherit"}});a.placeAt(this.allExpsBox);a.startup();this.own(p.after(a,"_destroySelf",l.hitch(this,this._checkFilterNumbers)));this._checkFilterNumbers()},_checkFilterNumbers:function(){var b=a(".jimu-single-filter",this.allExpsBox),d=2<b.length;c.forEach(b,l.hitch(this,function(a){a=n.byNode(a);d?a.showDelteIcon():
a.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u){return e([n,l,d,f],{baseClass:"jimu-filter-parameters",
templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new g;this.OPERATORS=c.clone(this._filterUtils.OPERATORS);this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;
this.inherited(arguments)},getFilterExpr:function(){var a=this._getNewValidPartsObj(this.partsObj,!0);return a?this._getFilterExprByPartsObj(a):null},getValueProviders:function(){for(var a=[],b=this._getAllInteractiveSinglePartArray(this.partsObj),c=0;c<b.length;c++){var d=b[c].spId;d&&(d=this._getSingleFilterParameterBySpId(d),a.push(d))}return a},_getNewValidPartsObj:function(a,b){a=c.clone(a);for(var d={logicalOperator:a.logicalOperator,parts:[]},e=c.hitch(this,function(a){if(a.spId){var b=this._getSingleFilterParameterBySpId(a.spId);
a.valueObj=b.getValueObject();return b.getStatus()}return a.valueObj?1:-1}),f=c.hitch(this,function(a){var b=e(a);0<b&&d.parts.push(a);return b}),g=c.hitch(this,function(a){var b=[];a.parts=p.filter(a.parts,c.hitch(this,function(a){a=e(a);b.push(a);return 0<a}));1===a.parts.length?d.parts.push(a.parts[0]):2<=a.parts.length&&d.parts.push(a);return Math.min.apply(b,b)}),h=0;h<a.parts.length;h++){var k=a.parts[h];if(k.parts){if(0>g(k)&&b)return null}else if(0>f(k)&&b)return null}return d},_getFilterExprByPartsObj:function(a){this._filterUtils.isHosted=
r.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(a)},_getSingleFilterParameterBySpId:function(a){return this._spObj[a]},_getCascadeFilterExpr:function(a){var b="1\x3d1",d={logicalOperator:this.partsObj.logicalOperator,parts:[]},e=c.clone(this.partsObj),f,g,h;f="none";a.interactiveObj&&a.interactiveObj.cascade&&(f=a.interactiveObj.cascade);if("previous"===f)for(f=0;f<e.parts.length;f++)g=e.parts[f],g.majorCascadeIndex<a.majorCascadeIndex?d.parts.push(g):g.parts&&g.majorCascadeIndex===
a.majorCascadeIndex&&(h=c.clone(g),h.parts=p.filter(h.parts,c.hitch(this,function(b){return b.minorCascadeIndex<a.minorCascadeIndex})),d.parts.push(h));else if("all"===f)for(f=0;f<e.parts.length;f++)g=e.parts[f],g.majorCascadeIndex!==a.majorCascadeIndex?d.parts.push(g):g.majorCascadeIndex===a.majorCascadeIndex&&g.parts&&(h=c.clone(g),p.some(g.parts,c.hitch(this,function(b){return b.spId===a.spId}))&&(h.parts=p.filter(h.parts,c.hitch(this,function(b){return b.minorCascadeIndex!==a.minorCascadeIndex})),
d.parts.push(h)));(d=this._getNewValidPartsObj(d,!1))&&(b=this._getFilterExprByPartsObj(d));b||(b="1\x3d1");return b},clear:function(){this.featureLayerId=this.url=null;var d=a(".jimu-widget-query-single-parameter",this.tbody);p.forEach(d,c.hitch(this,function(a){b.byNode(a).destroy()}));h.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(b,d,e,f){var g=new k;this.clear();this.url=b;this.layerInfo=d;this.partsObj=c.clone(e);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=
f;this._setCascadeIndexForPartsObj(this.partsObj);b=this._getAllInteractiveSinglePartArray(this.partsObj);if(0<b.length){var l=new u({url:this.url,layerDefinition:d,featureLayerId:this.featureLayerId});b=p.map(b,c.hitch(this,function(b){var e=h.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody),e=a("td",e)[0],f=this._getFieldInfo(b.fieldObj.name,this.layerInfo),f=new t({nls:this.nls,url:this.url,layerDefinition:d,fieldInfo:f,part:b,valueProviderFactory:l});this.own(q(f,"change",c.hitch(this,
this._onSingleFilterParameterChanged)));f.placeAt(e);f.startup();b.spId=f.id;return this._spObj[f.id]=f}));p.forEach(b,c.hitch(this,function(a){a.valueProvider.getCascadeFilterExpr=c.hitch(this,this._getCascadeFilterExpr,a.part)}));b=p.map(b,c.hitch(this,function(a){return a.init()}));m(b).then(c.hitch(this,function(){g.resolve()}),c.hitch(this,function(){g.reject()}))}else g.resolve();return g},_updatePartsObj:function(a){p.forEach(a,c.hitch(this,function(a){a.parts?p.forEach(a.parts,c.hitch(this,
function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},_setCascadeIndexForPartsObj:function(a){for(var b=0;b<a.parts.length;b++){var c=a.parts[b];c.majorCascadeIndex="AND"===a.logicalOperator?b:0;c.minorCascadeIndex=0;c.cascadeIndex=
c.majorCascadeIndex;if(c.parts)for(var d=0;d<c.parts.length;d++){var e=c.parts[d];e.majorCascadeIndex=c.majorCascadeIndex;e.minorCascadeIndex="AND"===c.logicalOperator?d:0;e.cascadeIndex=parseFloat(e.majorCascadeIndex+"."+e.minorCascadeIndex)}}},_getFieldInfo:function(a,b){for(var c=b.fields,d=0;d<c.length;d++){var e=c[d];if(a===e.name)return e}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],c=0;c<a.parts.length;c++){var d=a.parts[c];if(d.parts)for(var e=0;e<d.parts.length;e++){var f=
d.parts[e];f.interactiveObj&&b.push(f)}else d.interactiveObj&&b.push(d)}return b},_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang".split(" "),function(q,f,k,m,e,n,l,d,c){return m([e,n,l,f],{baseClass:"jimu-single-filter-parameter",
templateString:d,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(q(this.valueProvider,"change",c.hitch(this,this._onValueProviderChanged)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,
this.part)},build:function(c,d){var a=null;this.fieldInfo=c;this.part=d;if(a=d.interactiveObj)this.promptNode.innerHTML=a.prompt||"",this.hintNode.innerHTML=a.hint||"";a=this.valueProvider.setValueObject(this.part.valueObj);a&&"function"===typeof a.then||(a=new k,a.resolve());return a},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},
_showValidationErrorTip:function(c){!c.validate()&&c.domNode&&c.focusNode&&(c.focusNode.focus(),c.focusNode.blur())},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(q,f,k,m,e,n,l,d,c){return n("dijit.layout._LayoutWidget",[f,k,m],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,
_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);l.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var c=this.getParent&&this.getParent();c&&c.isLayoutContainer||(this.resize(),this.own(e.on("resize",q.hitch(this,"resize"))))}},resize:function(e,f){var a=this.domNode;e&&d.setMarginBox(a,e);var b=f||{};q.mixin(b,e||{});"h"in b&&"w"in b||(b=q.mixin(d.getMarginBox(a),b));var g=c.getComputedStyle(a),h=d.getMarginExtents(a,g),k=
d.getBorderExtents(a,g),b=this._borderBox={w:b.w-(h.w+k.w),h:b.h-(h.h+k.h)},h=d.getPadExtents(a,g);this._contentBox={l:c.toPixelValue(a,g.paddingLeft),t:c.toPixelValue(a,g.paddingTop),w:b.w-h.w,h:b.h-h.h};this.layout()},layout:function(){},_setupChild:function(c){l.add(c.domNode,this.baseClass+"-child "+(c.baseClass?this.baseClass+"-"+c.baseClass:""))},addChild:function(c,d){this.inherited(arguments);this._started&&this._setupChild(c)},removeChild:function(c){l.remove(c.domNode,this.baseClass+"-child"+
(c.baseClass?" "+this.baseClass+"-"+c.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t){p("dijit-legacy-requires")&&t(0,function(){q(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});
return k("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return b.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||
a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=m.byId(b,this.ownerDocument);var f;if("iframe"==b.tagName.toLowerCase()){var g=b;f=this._iframeContentWindow(g);f=a.body(f.document)}else f=b==a.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var k={node:b,iframe:g};e.set(b,"_dijitMenu"+this.id,this._bindings.push(k));var l=c.hitch(this,function(a){var b=this.selector,c=b?function(a){return h.selector(b,
a)}:function(a){return a},e=this;return[h(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<e._lastKeyDown+500||e._scheduleOpen(this,g,{x:a.pageX,y:a.pageY},a.target)}),h(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==d.F10||e.leftClickToOpen&&a.keyCode==d.SPACE)a.stopPropagation(),a.preventDefault(),e._scheduleOpen(this,g,null,a.target),e._lastKeyDown=(new Date).getTime()})]});k.connects=f?l(f):[];g&&(k.onloadHandler=
c.hitch(this,function(){var b=this._iframeContentWindow(g),b=a.body(b.document);k.connects=l(b)}),g.addEventListener?g.addEventListener("load",k.onloadHandler,!1):g.attachEvent("onload",k.onloadHandler))},unBindDomNode:function(a){var b;try{b=m.byId(a,this.ownerDocument)}catch(w){return}a="_dijitMenu"+this.id;if(b&&e.has(b,a)){for(var c=e.get(b,a)-1,d=this._bindings[c],f;f=d.connects.pop();)f.remove();(f=d.iframe)&&(f.removeEventListener?f.removeEventListener("load",d.onloadHandler,!1):f.detachEvent("onload",
d.onloadHandler));e.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){u.refocus&&q&&q.focus();g.close(u)}var c=a.target,d=a.iframe,e=a.coords,f=!e;this.currentTarget=a.delegatedTarget;if(e){if(d){a=n.position(d,!0);var c=this._iframeContentWindow(d),c=n.docScroll(c.document),h=l.getComputedStyle(d),
k=l.toPixelValue,r=(p("ie")&&p("quirks")?0:k(d,h.paddingLeft))+(p("ie")&&p("quirks")?k(d,h.borderLeftWidth):0),d=(p("ie")&&p("quirks")?0:k(d,h.paddingTop))+(p("ie")&&p("quirks")?k(d,h.borderTopWidth):0);e.x+=a.x+r-c.x;e.y+=a.y+d-c.y}}else e=n.position(c,!0),e.x+=10,e.y+=10;var u=this,d=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var q=!a||m.isDescendant(a,this.domNode)?d:a;g.open({popup:this,x:e.x,y:e.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();
f||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);g.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(q,f,k){return q("dgrid.OnDemandGrid",[f,k],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),
function(q,f,k,m,e,n,l){function d(c,a){a&&a.nodeType&&c.appendChild(a)}function c(c,a,b,d){if(this.formatter){d=this.formatter;var e=this.grid.formatterScope;b.innerHTML="string"===typeof d&&e?e[d](a,c):this.formatter(a,c)}else null!=a&&b.appendChild(document.createTextNode(a))}var h=8>m("ie")&&!m("quirks");f=f("dgrid.Grid",n,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(c){return"object"!=typeof c?this.columns[c]:this.cell(c).column},listType:"grid",cell:function(c,
a){if(c.column&&c.element)return c;c.target&&c.target.nodeType&&(c=c.target);var b;if(c.nodeType){do{if(this._rowIdToObject[c.id])break;var d=c.columnId;if(d){a=d;b=c;break}c=c.parentNode}while(c&&c!=this.domNode)}if(!b&&"undefined"!=typeof a){var e=this.row(c);if(d=e&&e.element)for(var d=d.getElementsByTagName("td"),f=0;f<d.length;f++)if(d[f].columnId==a){b=d[f];break}}if(null!=c)return{row:e||this.row(c),column:a&&this.column(a),element:b}},createRowCells:function(c,a,b,d){var f=e("table.dgrid-row-table[role\x3dpresentation]"),
g=9>m("ie")||m("quirks")?e(f,"tbody"):f,k,p,n,q,y,w,B,x,F,E;b=b||this.subRows;p=0;for(n=b.length;p<n;p++)for(w=b[p],k=e(g,"tr"),w.className&&e(k,"."+w.className),q=0,y=w.length;q<y;q++){B=w[q];x=B.id;F=B.field?".field-"+l.escapeCssIdentifier(B.field,"-"):"";(E="function"===typeof B.className?B.className(d):B.className)&&(F+="."+E);F=e(c+(".dgrid-cell.dgrid-cell-padding"+(x?".dgrid-column-"+l.escapeCssIdentifier(x,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===c?"columnheader":"gridcell")+"]");
F.columnId=x;h?(x=e(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=x):x=F;if(E=B.colSpan)F.colSpan=E;if(E=B.rowSpan)F.rowSpan=E;a(x,B);k.appendChild(F)}return f},left:function(c,a){c.element||(c=this.cell(c));return this.cell(this._move(c,-(a||1),"dgrid-cell"))},right:function(c,a){c.element||(c=this.cell(c));return this.cell(this._move(c,a||1,"dgrid-cell"))},renderRow:function(f,a){var b=this.createRowCells("td",function(b,e){var g=f;e.get?g=e.get(f):"field"in e&&"_item"!=e.field&&(g=
g[e.field]);e.renderCell?d(b,e.renderCell(f,g,b,a)):c.call(e,f,g,b,a)},a&&a.subRows,f);return e("div[role\x3drow]\x3e",b)},renderHeader:function(){var c=this,a=this.headerNode,b=a.childNodes.length;for(a.setAttribute("role","row");b--;)e(a.childNodes[b],"!");b=this.createRowCells("th",function(a,b){var c=b.headerNode=a;h&&(a=a.parentNode);var e=b.field;e&&(a.field=e);b.renderHeaderCell?d(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field));
!1!==b.sortable&&e&&"_item"!=e&&(a.sortable=!0,a.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[b.id=this.id+"-header"]=this.columns;a.appendChild(b);this._sortListener&&this._sortListener.remove();this._sortListener=k(b,"click,keydown",function(b){if("click"==b.type||32==b.keyCode||!m("opera")&&13==b.keyCode){var d=b.target,e,f,g;do if(d.sortable){g=[{attribute:e=d.field||d.columnId,descending:(f=c._sort[0])&&f.attribute==e&&!f.descending}];e={bubbles:!0,
cancelable:!0,grid:c,parentType:b.type,sort:g};k.emit(b.target,"dgrid-sort",e)&&(c._sortNode=d,c.set("sort",g));break}while((d=d.parentNode)&&d!=a)}})},resize:function(){var c=this.headerNode.firstChild,a=this.contentNode,b;this.inherited(arguments);if(!m("ie")||7<m("ie")&&!m("quirks"))a.style.width="",a&&c&&(b=c.offsetWidth)!=a.offsetWidth&&(a.style.width=b+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(c,
a){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(c){var a=this.columns,b;for(b in a){var d=a[b];if(d.field==c)return d.headerNode}},updateSortArrow:function(c,a){this._lastSortedArrow&&(e(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),e(this._lastSortedArrow,"!"),delete this._lastSortedArrow);a&&(this._sort=c);if(c[0]){var b=c[0].attribute,d=c[0].descending,b=this._sortNode||this._findSortArrowParent(b),f;delete this._sortNode;b&&(b=b.contents||
b,f=this._lastSortedArrow=e("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),f.innerHTML="\x26nbsp;",b.insertBefore(f,b.firstChild),e(b,d?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(c,a){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+l.escapeCssIdentifier(c,"-"),a)},_configColumns:function(c,a){var b=[],d=a instanceof Array;l.each(a,function(e,f){"string"==typeof e&&(a[f]=e={label:e});d||e.field||(e.field=f);f=e.id=e.id||(isNaN(f)?
f:c+f);this._configColumn&&(this._configColumn(e,f,a,c),f=e.id);d&&(this.columns[f]=e);e.grid=this;"function"===typeof e.init&&e.init();b.push(e)},this);return d?a:b},_destroyColumns:function(){var c=this.subRows,a=c&&c.length,b,d,e,f;this.cleanup();for(b=0;b<a;b++)for(d=0,f=c[b].length;d<f;d++)e=c[b][d],"function"===typeof e.destroy&&e.destroy()},configStructure:function(){var c=this.subRows,a=this._columns=this.columns;this.columns=!a||a instanceof Array?{}:a;if(c)for(a=0;a<c.length;a++)c[a]=this._configColumns(a+
"-",c[a]);else this.subRows=[this._configColumns("",a)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(c){this._destroyColumns();this.subRows=null;this.columns=c;this._updateColumns()},_setSubRows:function(c){this._destroyColumns();this.subRows=c;this._updateColumns()},setColumns:function(c){q.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",c)},setSubRows:function(c){q.deprecated("setSubRows(...)",'use set("subRows", ...) instead',
"dgrid 0.4");this.set("subRows",c)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=d;f.defaultRenderCell=c;return f})},"put-selector/put":function(){(function(q){var f,k=/[-+,> ]/;q([],f=function(m,e){function n(e){function a(){u&&q&&u!=q&&(q==e&&(b||(b=k.test(y)&&m.createDocumentFragment()))?
b:q).insertBefore(u,p||null)}for(var b,f,p,q,u,v=arguments,z=v[0],A=0;A<v.length;A++){var y=v[A];if("object"==typeof y){f=!1;if(y instanceof Array){u=m.createDocumentFragment();for(var w=0;w<y.length;w++)u.appendChild(n(y[w]));y=u}if(y.nodeType)u=y,a(),q=y,p=0;else for(w in y)u[w]=y[w]}else if(f)f=!1,u.appendChild(m.createTextNode(y));else{1>A&&(e=null);f=!0;if(z=y.replace(l,function(b,f,g,k,l,r){f&&(a(),"-"==f||"+"==f?(q=(p=u||q).parentNode,u=null,"+"==f&&(p=p.nextSibling)):("\x3c"==f?q=u=(u||q).parentNode:
(","==f?q=e:u&&(q=u),u=null),p=0),u&&(q=u));if((b=!g&&k)||!u&&(g||l))"$"==b?(b=v[++A],q.appendChild(m.createTextNode(b))):(b=b||n.defaultTag,(f=h&&v[A+1]&&v[A+1].name)&&(b="\x3c"+b+' name\x3d"'+f+'"\x3e'),u=c&&~(d=b.indexOf("|"))?m.createElementNS(c[b.slice(0,d)],b.slice(d+1)):m.createElement(b));if(g)if("$"==k&&(k=v[++A]),"#"==g)u.id=k;else if(f=(b=u.className)&&(" "+b+" ").replace(" "+k+" "," "),"."==g)u.className=b?(f+k).substring(1):k;else if("!"==y){var t;h?n("div",u,"\x3c").innerHTML="":(t=
u.parentNode)&&t.removeChild(u)}else f=f.substring(1,f.length-1),f!=b&&(u.className=f);l&&("$"==r&&(r=v[++A]),"style"==l?u.style.cssText=r:(g="!"==l.charAt(0)?(l=l.substring(1))&&"removeAttribute":"setAttribute",r=""===r?l:r,c&&~(d=l.indexOf("|"))?u[g+"NS"](c[l.slice(0,d)],l.slice(d+1),r):u[g](l,r)));return""}))throw new SyntaxError("Unexpected char "+z+" in "+y);a();q=z=u||q}}e&&b&&e.appendChild(b);return z}k=e||k;var l=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,
d,c=!1;m=m||document;var h="object"==typeof m.createElement;n.addNamespace=function(d,a){m.createElementNS?(c||(c={}))[d]=a:m.namespaces.add(d,a)};n.defaultTag="div";n.forDocument=f;return n})})(function(q,f,k){k=k||f;"function"===typeof define?define([],function(){return k()}):"undefined"==typeof window?require("./node-html")(module,k):put=k()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),
function(q,f,k,m,e,n,l,d,c){function h(a,b){c(document.body,a,".dgrid-scrollbar-measure");var d=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return d}function p(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+b);c(this.domNode,b);this._class=a}function a(){return this._class}function b(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function g(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&
(this.bodyNode.scrollTop=a.y)}d("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var r,t;e.add("dom-scrollbar-width",function(a,b,c){return h(c,"Width")});e.add("dom-scrollbar-height",function(a,b,c){return h(c,"Height")});e.add("dom-rtl-scrollbar-left",function(a,b,d){a=c("div");c(document.body,d,".dgrid-scrollbar-measure[dir\x3drtl]");c(d,a);b=!!e("ie")||!!e("trident")||a.offsetLeft>=e("dom-scrollbar-width");d.className="";document.body.removeChild(d);c(a,"!");d.removeAttribute("dir");
return b});var u=0,v=/ +/g,z=7>e("ie")&&!e("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};return f("dgrid.List",e("touch")?l:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,
postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){var d=this.domNode=b||c("div"),g;a?(this.params=a,f.safeMixin(this,a),g=a["class"]||a.className||d.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject=
{};this.postMixInProperties&&this.postMixInProperties();this.id=d.id=d.id||this.id||"dgrid_"+u++;null===this.useTouchScroll&&(this.useTouchScroll=!e("dom-scrollbar-width"));this.buildRendering();g&&p.call(this,g);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,d=this,f,g,h,k;k=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className=
"";c(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));f=this.headerNode=c(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(e("quirks")||8>e("ie"))&&c(a,"div.dgrid-spacer");g=this.bodyNode=c(a,"div.dgrid-scroller");e("ff")&&(g.tabIndex=-1);this.headerScrollNode=c(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));h=this.footerNode=c("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));
c(a,h);k&&(a.className+=" dgrid-rtl"+(e("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));m(g,"scroll",function(b){d.showHeader&&(f.scrollLeft=b.scrollLeft||g.scrollLeft);b.stopPropagation();m.emit(a,"scroll",{scrollTarget:g})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=c(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=m(window,"resize",n.throttleDelayed(z,this)))},postCreate:e("touch")?function(){this.useTouchScroll&&
this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.headerNode,c=this.footerNode,d=b.offsetHeight,f=this.showFooter?c.offsetHeight:0,g=e("quirks")||7>e("ie");this.headerScrollNode.style.height=a.style.marginTop=d+"px";a.style.marginBottom=f+"px";g&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-
d-f,0)+"px",f&&(c.style.bottom="1px",setTimeout(function(){c.style.bottom=""},0)));r||(r=e("dom-scrollbar-width"),t=e("dom-scrollbar-height"),e("ie")&&(r++,t++),n.addCssRule(".dgrid-scrollbar-width","width: "+r+"px"),n.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17==r||g||(n.addCssRule(".dgrid-header-row","right: "+r+"px"),n.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+r+"px")));g&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,
b){var c=n.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=m(this.domNode,a,b);e("dom-addeventlistener")||this._listeners.push(c);return c},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=
this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();c(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,d,e,f){if(b){var g=this.insertRow(a,b,d,e,f);c(g,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){c(g,"!dgrid-highlight!ui-state-highlight")},
this.highlightDuration);return g}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&c(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<r)for(var d=0;d<b.length;d++){var f=b[d],g=p[f?0:p.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];
k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),p[f](k.element),c.count++)}}}function e(a){return!k.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){t=h.insertRow(a,q,null,l++,c);t.observerIndex=r;return t}function g(a){v=a.slice(0);(n=b?b.parentNode:h.contentNode)&&n.parentNode&&(n!==h.contentNode||a.length)?(n.insertBefore(q,b||null),(t=a[a.length-1])&&h.adjustRowIndices(t)):m[r]&&h.cleanEmptyObservers&&"undefined"!==
typeof r&&(m[r].cancel(),m[r]=0,h._numObservers--);p=a;u&&(u.rows=p)}c=c||{};var h=this,l=c.start||0,m=this.observers,p,n,r;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var u=a.observe(function(f,g,k){var l,m,u;-1<g&&p[g]&&(l=p.splice(g,1)[0],l.parentNode==n&&((m=l.nextSibling)&&g!=k&&m.rowIndex--,h.removeRow(l)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(p.length)if(0===k)u=(u=p[k])&&e(u);else{if(u=p[k-1])u=e(u),u=(u.connected||u).nextSibling}else u=
h._getFirstRowSibling&&h._getFirstRowSibling(n);l&&u&&l.id===u.id&&(u=(u.connected||u).nextSibling);u&&!u.parentNode&&(u=document.getElementById(u.id));l=b&&b.parentNode||u&&u.parentNode||h.contentNode;if(l=h.newRow(f,l,u,c.start+k,c))if(l.observerIndex=r,p.splice(k,0,l),!m||k<g)m=(m=l.previousSibling)&&m.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?m:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&m&&h.adjustRowIndices(m);h._onNotification(p,f,g,k)},!0);r=m.push(u)-1}var q=document.createDocumentFragment(),
t,v;if(a.map){if(p=a.map(f,console.error),p.then)return a.then(function(b){a=b;return p.then(function(a){g(a);d(1,1,0,0);return v})})}else{p=[];for(var A=0,z=a.length;A<z;A++)p[A]=f(a[A])}g(p);d(1,1,0,0);return v},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===
c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return c("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||c(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;
a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=
a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:e("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):g.call(this,
a)}:g,getScrollPosition:e("touch")?function(){return this.useTouchScroll?this.inherited(arguments):b.call(this)}:b,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:a,
_setClass:p,_getClassName:a,_setClassName:p,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){var e=c[a],f=d[a];void 0===e&&(e="");void 0===f&&(f="");return e==f?0:e>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){q.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",
a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;c(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){q.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;c(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has",
"put-selector/put"],function(q,f){q.add("dom-contains",function(c,d,e){return!!e.contains});var k=[],m,e,n,l=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,d={defaultDelay:15,throttle:function(c,e,f){var a=!1;f=f||d.defaultDelay;return function(){a||(a=!0,c.apply(e,arguments),setTimeout(function(){a=!1},f))}},throttleDelayed:function(c,e,f){var a=!1;f=f||d.defaultDelay;return function(){if(!a){a=!0;var b=arguments;setTimeout(function(){a=!1;c.apply(e,b)},f)}}},debounce:function(c,e,f){var a;f=f||d.defaultDelay;
return function(){a&&(clearTimeout(a),a=null);var b=arguments;a=setTimeout(function(){c.apply(e,b)},f)}},each:function(c,d,e){var a,b;if(c)if("number"===typeof c.length)for(a=0,b=c.length;a<b;a++)d.call(e,c[a],a,c);else for(a in c)d.call(e,c[a],a,c)},contains:function(c,d){return q("dom-contains")?c.contains(d):c.compareDocumentPosition(d)&8},addCssRule:function(c,d){m||(m=f(document.getElementsByTagName("head")[0],"style"),m=m.sheet||m.styleSheet,e=m.deleteRule?"deleteRule":"removeRule",n=m.cssRules?
"cssRules":"rules");var h=k.length;k[h]=(m.cssRules||m.rules).length;m.addRule?m.addRule(c,d):m.insertRule(c+"{"+d+"}",k[h]);return{get:function(a){return m[n][k[h]].style[a]},set:function(a,b){"undefined"!==typeof k[h]&&(m[n][k[h]].style[a]=b)},remove:function(){var a=k[h],b,c;if(void 0!==a)for(m[e](a),k[h]=void 0,b=h+1,c=k.length;b<c;b++)k[b]>a&&k[b]--}}},escapeCssIdentifier:function(c,d){return"string"===typeof c?c.replace(l,d||"\\$1"):c}};return d})},"xstyle/has-class":function(){define(["dojo/has"],
function(q){var f={};return function(){for(var k,m=arguments,e=0;e<m.length;e++)if(k=m[e],!f[k]){f[k]=!0;var n=k.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),l=q(n[2]),d=-n[4];(0<d?d<=l&&(-n[5]||d)>=l:!!l)==!n[1]&&(document.documentElement.className+=" has-"+k)}}})},"xstyle/css":function(){define(["require"],function(q){function f(f,m,e){var k=document.documentElement;f=k.insertBefore(document.createElement(f),k.firstChild);f.id=m;m=(f.currentStyle||getComputedStyle(f,null)||{})[e];k.removeChild(f);
return m}return{load:function(k,m,e,n){function l(c){var a=f("x-parse",null,"content"),b=c&&(c.sheet||c.styleSheet);a&&"none"!=a&&"normal"!=a?m([eval(a)],function(a){c?a.process(c,e):(a.processAll(),e(b))}):e(b)}var d=m.toUrl(k),c;d.match(/!$/)&&(c={wait:!1},d=d.slice(0,-1));var h=m.cache&&m.cache["url:"+d];if(h)h.xCss&&(h=h.cssText),q(["./core/load-css"],function(c){l(c.insertCss(h))});else{if("none"==f("div",k.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return l();q(["./core/load-css"],
function(e){e(d,l,c)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(q,f,k,m,e,n,l,d,c){return k("dgrid.OnDemandList",[q,f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:d.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);
var c=this;l(this.bodyNode,"scroll",d[this.pagingMethod](function(d){c._processScroll(d)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(d,f){function a(a){c(q,"!");if(a)throw b._refreshDeferred&&(b._refreshDeferred.reject(a),delete b._refreshDeferred),a;}var b=this,g=f&&f.container||this.contentNode,h={query:d,count:0,options:f},k,l=this.preload,n,p={node:c(g,"div.dgrid-preload",{rowIndex:0}),count:0,
query:d,next:h,options:f};p.node.style.height="0";h.node=k=c(g,"div.dgrid-preload");h.previous=p;k.rowIndex=this.minRowsPerPage;l?((h.next=l.next)&&k.offsetTop>=l.node.offsetTop?h.previous=l:(h.next=l,h.previous=l.previous),h.previous.next=h,h.next.previous=h):this.preload=h;var q=c(k,"-div.dgrid-loading");c(q,"div.dgrid-below").innerHTML=this.loadingMessage;f=m.mixin(this.get("queryOptions"),f,{start:0,count:this.minRowsPerPage},"level"in d?{queryLevel:d.level}:null);this._trackError(function(){return n=
d(f)});if("undefined"===typeof n)a();else return e.when(b.renderArray(n,k,f),function(d){return e.when("undefined"===typeof n.total?n.length:n.total,function(a){var e=d.length,g=k.parentNode,l=b.noDataNode;c(q,"!");"queryLevel"in f||(b._total=a);0===a&&g&&(l&&(c(l,"!"),delete b.noDataNode),b.noDataNode=l=c("div.dgrid-no-data"),g.insertBefore(l,b._getFirstRowSibling(g)),l.innerHTML=b.noDataMessage);for(l=g=0;l<e;l++)g+=b._calcRowHeight(d[l]);e&&g&&(b.rowHeight=g/e);g=b.rowHeight*b.bufferRows;g>b.farOffRemoval&&
(b.farOffRemoval=g);a-=e;h.count=a;k.rowIndex=e;a?k.style.height=Math.min(a*b.rowHeight,b.maxEmptySpace)+"px":(k.style.display="none",f.count++);b._previousScrollPosition&&(b.scrollTo(b._previousScrollPosition),delete b._previousScrollPosition);b._processScroll();b._refreshDeferred&&(b._refreshDeferred.resolve(n),delete b._refreshDeferred);return d},a)},a),n},refresh:function(c){var d=this,a=c&&c.keepScrollPosition,b;"undefined"===typeof a&&(a=this.keepScrollPosition);a&&(this._previousScrollPosition=
this.getScrollPosition());this.inherited(arguments);if(this.store)return a=this._refreshDeferred=new e,b=d.renderQuery(function(a){return d.store.query(d.query,a)}),"undefined"===typeof b&&a.reject(),a.then(function(a){d._refreshTimeout=setTimeout(function(){l.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:a});d._refreshTimeout=null},0);delete d._refreshDeferred;return a},function(a){delete d._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);
this._processScroll()},_getFirstRowSibling:function(c){return c.lastChild},_calcRowHeight:function(c){var d=c.nextSibling;return d&&!/\bdgrid-preload\b/.test(d.className)?d.offsetTop-c.offsetTop:c.offsetHeight},lastScrollTop:0,_processScroll:function(d){function f(b,d,e,f){var h=g.farOffRemoval,k=b.node;if(d>2*h){for(var l,m=k[e],n=0,p=0,r=[];l=m;){var u=g._calcRowHeight(l);if(n+u+h>d||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[e];n+=u;p+=l.count||1;g.removeRow(l,
!0);r.push(l)}b.count+=p;f?(k.rowIndex-=p,a(b)):k.style.height=k.offsetHeight+n+"px";var q=c("div",r);setTimeout(function(){c(q,"!")},1)}}function a(a,b){a.node.style.height=Math.min(a.count*g.rowHeight,b?Infinity:g.maxEmptySpace)+"px"}function b(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var g=this,h=g.bodyNode;d=d&&d.scrollTop||this.getScrollPosition().y;var h=h.offsetHeight+d,k,l,n=g.preload,q=g.lastScrollTop,A=g.bufferRows*g.rowHeight,y=A-g.rowHeight,w,B,x,F=!0;for(g.lastScrollTop=
d;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=k;){k=g.preload;g.preload=n;l=n.node;var E=l.offsetTop;if(h+1+y<E)n=b(n,F=!1);else if(d-1-y>E+l.offsetHeight)n=b(n,F=!0);else{var D=((l.rowIndex?d-A:h)-E)/g.rowHeight,E=(h-d+2*A)/g.rowHeight,E=E+Math.min(Math.abs(Math.max(Math.min((d-q)*g.rowHeight,g.maxRowsPerPage/2),g.maxRowsPerPage/-2)),10);0==l.rowIndex&&(D-=E);D=Math.max(D,0);10>D&&0<D&&E+D<g.maxRowsPerPage&&(E+=Math.max(0,D),D=0);E=Math.min(Math.max(E,g.minRowsPerPage),g.maxRowsPerPage,n.count);
if(0==E)n=b(n,F);else{var E=Math.ceil(E),D=Math.min(Math.floor(D),n.count-E),G=m.mixin(g.get("queryOptions"),n.options);n.count-=E;var H=l,K,I=g.queryRowsOverlap,N=(0<l.rowIndex||l.offsetTop>d)&&n;if(N){var L=n.previous;L&&(f(L,d-(L.node.offsetTop+L.node.offsetHeight),"nextSibling"),0<D&&L.node==l.previousSibling?(D=Math.min(n.count,D),n.previous.count+=D,a(n.previous,!0),l.rowIndex+=D,I=0):E+=D,n.count-=D);G.start=l.rowIndex-I;G.count=Math.min(E+I,g.maxRowsPerPage);l.rowIndex=G.start+G.count}else n.next&&
(f(n.next,n.next.node.offsetTop-h,"previousSibling",!0),H=l.nextSibling,H==n.next.node?(n.next.count+=n.count-D,n.next.node.rowIndex=D+E,a(n.next),n.count=D,I=0):K=!0),G.start=n.count,G.count=Math.min(E+I,g.maxRowsPerPage);K&&H&&H.offsetWidth&&(K=H.offsetTop);a(n);"level"in n.query&&(G.queryLevel=n.query.level);if("queryLevel"in G||!(G.start>g._total||0>G.count)){l=c(H,"-div.dgrid-loading[style\x3dheight:"+E*g.rowHeight+"px]");c(l,"div.dgrid-"+(N?"below":"above")).innerHTML=g.loadingMessage;l.count=
E;var Q=n.query(G);if(void 0===g._trackError(function(){return Q})){c(l,"!");return}(function(b,d,f,h){x=e.when(g.renderArray(h,b,G),function(k){B=h;H=b.nextSibling;c(b,"!");if(f&&H&&H.offsetWidth){var l=g.getScrollPosition();g.scrollTo({x:l.x,y:l.y+H.offsetTop-f,preserveMomentum:!0})}e.when(h.total||h.length,function(b){"queryLevel"in G||(g._total=b);d&&(d.count=b-d.node.rowIndex,0===d.count&&G.count++,a(d))});g._processScroll();return k},function(a){c(b,"!");throw a;})}).call(this,l,N,K,Q);n=n.previous}}}}x&&
(w=this._refreshDeferred)&&(delete this._refreshDeferred,e.when(x,function(){w.resolve(B)}))},removeRow:function(c,d){if(c){var a=c.previousSibling,b=c.nextSibling,e;if(e=a)e=a.observerIndex,e=null!=e?e:a.previousObserverIndex;a=e;if(e=b)e=b.observerIndex,e=null!=e?e:b.nextObserverIndex;b=c.observerIndex;c.observerIndex=void 0;d&&(c.nextObserverIndex=e,c.previousObserverIndex=a);if(this.cleanEmptyObservers&&-1<b&&b!==a&&b!==e&&(a=this.observers,e=a[b])){if(!d)for(var f=e.rows,h=0;h<f.length;h++)if(f[h]!=
c&&n.isDescendant(f[h],this.domNode))return this.inherited(arguments);e.cancel();this._numObservers--;a[b]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(q,f,k,m,e,n,l){function d(c){return c}function c(c){if("object"!==typeof c)c=Error(c);else if("cancel"===c.dojoType)return;c.grid=this;e.emit(this.domNode,"dgrid-error",{grid:this,error:c,cancelable:!0,
bubbles:!0})&&console.error(c)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};n.before(this,"configStructure",k.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&
this._notifyHandle.remove()},_configColumn:function(c){c.set&&(this._columnsWithSet[c.field]=c);this.inherited(arguments)},_updateNotifyHandle:function(c){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);c&&"function"===typeof c.notify&&this.shouldObserveStore&&(this._notifyHandle=n.after(c,"notify",k.hitch(this,"_onNotify"),!0),(c=this.get("sort"))&&c.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},
_setStore:function(c,d,a){this._updateNotifyHandle(c);this.store=c;this.dirty={};this.set("query",d,a)},_setQuery:function(c,d){var a=d&&d.sort;this.query=void 0!==c?c:this.query;this.queryOptions=d||this.queryOptions;this._started&&(a?this.set("sort",a):this.refresh())},setStore:function(c,d,a){q.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",c,d,a)},setQuery:function(c,d){q.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",
c,d)},_getQueryOptions:function(){var c=k.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)c.sort=this._sort;return c},_getQuery:function(){var c=this.query;return"object"==typeof c&&null!=c?k.delegate(c,{}):c},_setSort:function(c,d){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(c,d){this.inherited(arguments);c&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var c=this.inherited(arguments);
this.store||(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return c},renderArray:function(){var c=this,d=this.inherited(arguments);this.store||m.when(d,function(a){a.length&&c.noDataNode&&l(c.noDataNode,"!")});return d},insertRow:function(c,d,a,b,e){var f=this.store,g=this.dirty,f=f&&f.getIdentity(c),h;f in g&&!(f in this._updating)&&(h=g[f]);h&&(c=k.delegate(c,h));return this.inherited(arguments)},updateDirty:function(c,d,a){var b=this.dirty,
e=b[c];e||(e=b[c]={});e[d]=a},setDirty:function(c,d,a){q.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(c,d,a)},save:function(){function c(c,e){return function(f){var g=d._columnsWithSet,h=d._updating,k,l;if("function"===typeof f.set)f.set(e);else for(k in e)f[k]=e[k];for(k in g)l=g[k].set(f),void 0!==l&&(f[k]=l);h[c]=!0;return m.when(a.put(f),function(){delete b[c];delete h[c]})}}var d=this,a=this.store,b=this.dirty,e=new m,f=e.promise,k=function(b){var c;return d.getBeforePut||
!(c=d.row(b).data)?function(){return a.get(b)}:function(){return c}},l;for(l in b)var n=c(l,b[l]),f=f.then(k(l)).then(n);e.resolve();return f},revert:function(){this.dirty={};this.refresh()},_trackError:function(e){var f;"string"==typeof e&&(e=k.hitch(this,e));try{f=e()}catch(a){c.call(this,a)}return m.when(f,d,k.hitch(this,c))},newRow:function(){var c=this.inherited(arguments);this.noDataNode&&(l(this.noDataNode,"!"),delete this.noDataNode);return c},removeRow:function(c,d){var a={element:c};!d&&
this.noDataMessage&&this.up(a).element===c&&this.down(a).element===c&&(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(q,f,k,m,e,n,l,d,c){function h(a,b){for(var c=a.unselectable=b?"on":
"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"!==d[e].tagName&&"TEXTAREA"!==d[e].tagName&&(d[e].unselectable=c)}function p(a,c){var d=a.bodyNode,f=c?"text":21>e("ff")?"-moz-none":"none";b&&"msUserSelect"!==b?d.style[b]=f:e("dom-selectstart")?c||a._selectstartHandle?c&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=m(d,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(h(d,!c),
c||a._unselectableHandle)?c&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=n.after(a,"renderRow",function(a){h(a,!0);return a})}e.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});e.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});e.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==
typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});e.add("dom-selectstart","undefined"!==typeof document.onselectstart);var a=e("mac")?"metaKey":"ctrlKey",b=e("css-user-select"),g=(l=e("pointer"))&&"MS"===l.slice(0,2),r=l?l+(g?"Down":"down"):"mousedown",t=l?l+(g?"Up":"up"):"mouseup";"WebkitUserSelect"===b&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(b=!1);return f("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:r+","+t+",dgrid-cellfocusin",
selectionTouchEvents:e("touch")?d.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&
this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){q.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?
p(this,a):p(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==t||b==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===r&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=
null}},_singleSelectionHandler:function(b,c){var d=b.keyCode?b.ctrlKey:b[a];this._lastSelected===c?this.select(c,null,!d||!this.isSelected(c)):(this.clearSelection(),this.select(c),this._lastSelected=c)},_multipleSelectionHandler:function(b,c){var d=this._lastSelected,e=b.keyCode?b.ctrlKey:b[a],f;b.shiftKey||(f=e?null:!0,d=null);this.select(c,d,f);d||(this._lastSelected=c)},_extendedSelectionHandler:function(b,c){(2===b.button?this.isSelected(c):b.keyCode?b.ctrlKey:b[a])||this.clearSelection(null,
!0);this._multipleSelectionHandler(b,c)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,c=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};e("touch")&&!e("pointer")&&this.selectionTouchEvents?(m(c,d.selector(f,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),m(c,m.selector(f,this.selectionEvents),function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,
this):a.type===t&&(b._ignoreMouseSelect=null)})):m(c,m.selector(f,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(c){c[a]&&65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className)&&(c.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&n.after(this,"_setStore",function(){b._updateDeselectionAspect()});this._updateDeselectionAspect()},
_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=n.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=n.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=n.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in
this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];m.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,
b,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,d||this.allSelected?e[a.id]=d:delete this.selection[a.id],g&&(d?c(g,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):c(g,"!dgrid-selected!ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(e=this._determineSelectionDirection(g,b),e||(b=
document.getElementById(b.id),e=this._determineSelectionDirection(g,b));a.element!=b&&(a=this[e](a));)this._select(a,null,d)}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:e("dom-comparedocumentposition")?function(a,b){var c=
b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);k.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(q,f,k,m,e){function n(c){c=document.getElementsByTagName(c);for(var e=0;e<c.length;e++)d(c[e])}function l(){n("link");n("style")}function d(e,f,a){function b(){q(["xstyle/core/load-imports"],function(a){a(e,
function(){d(e,f,!0)})})}function g(a){for(var b=a.cssRules,d=0;d<b.length;d++){var e=b[d];if(e.selectorText&&"x-"==e.selectorText.substring(0,2)&&(k=!0,/^'/.test(e.style.content)))return c(eval(e.style.content),a,f),!0}}var h=e.sheet||e.styleSheet;if(h&&(!h.processed||a)){h.processed=!0;var k=h.needsParsing,l=h.rules||h.cssRules;if((h.href||h.imports&&h.imports.length)&&!a)return b();if(!k)for(var m=0;m<l.length;m++){var n=l[m];if(n.href&&!a){if(!g(n.styleSheet))return b();return}}c(h.localSource||
(h.ownerNode||h.owningElement).innerHTML,h,f)}}function c(c,d,a){d.addRule||(d.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var b=1;(d.href||location.href).replace(/[^\/]+$/,"");k.css=c;f(k,c,d);0==--b&&a&&a(d);return k}m.ready(l);f.getStyleSheet=function(c,d){return c.styleSheet||c};return{process:d,processAll:l,parse:c,generate:e,update:m.update,load:function(c,e,a,b){e(["xstyle/css"],function(f){f.load(c,e,function(b){b?
d({sheet:b},a):(l(),a())},b)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function q(){this.push.apply(this,arguments)}function f(a){this.value=a}function k(){var a,b=this.args[0];if("string"==typeof b)a=b.split(/\s*,\s*/);else if(b){a=[];for(var c=0,d=0;d<b.length+1;d++){var e=b[d];if("string"==typeof e||void 0===e)if(e=e&&e.split(/\s*,\s*/),1<a.length||void 0===e){var f=b.slice(c,d);0<c&&f.unshift(a.pop());c=d+1;a.push(f);e&&a.push.apply(a,e.slice(1))}}}else return[];
return a}function m(a,b,g){function p(b,g){function r(a){A=!1;var b=u.lastIndex;a.then(function(){A=!0;c&&(u.lastIndex=b,z())});var c=!0}function z(){function a(a){a&&"string"==typeof a&&y&&(a=y+a);J?J.push?"string"==typeof J[J.length-1]&&"string"==typeof a?J[J.length-1]+=a:a&&J.push(a):"string"==typeof J&&"string"==typeof a?J+=a:J=new q(J,a):J=a}for(A=!0;A;){var l=u.exec(b);if(!l)break;var z=l[5],y=l[1],w=l[2],F=l[3],O=l[4],M,P,J,S,O=O&&h(O),w=w&&h(w);H?(F?(P=w,M=F.charAt(0),S="?"==F.charAt(1),-1<
F.indexOf("\n")&&(O=F.slice(1))):O=w,J=O,H=!1):(O=F?w+F:w,a(O));"{"!=z&&(G+=l[0]);switch(z){case "'":case '"':var W="'"==z?e:n;W.lastIndex=u.lastIndex;(z=W.exec(b))||B("unterminated string");w=z[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});u.lastIndex=W.lastIndex;a(new f(w));G+=z[0];continue;case "\\":z=W.lastIndex++;a(b.charAt(z));continue;case "(":case "{":case "[":if("{"==z){H=!0;":"==M&&F&&(w+=F);G=h((G+w).replace(/\s+/g," "));a(F=
x.newRule(G));"\x3d"==M&&(D=!1,J.creating=!0);var R=null,ba=E;l[6]&&(O=g.cssRules||g.rules,F.cssRule=R=O[l[6].slice(1)])&&(G=R.selectorText);if(x.root&&D)for(O=g.cssRules||g.rules;R=O[E++];)if(R.selectorText==G||R.selectorText&&R.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){F.cssRule=R;break}R||(F.ruleIndex=E=ba);F.styleSheet=g;J.creating?(F.selector="."+("\x3d"==M?w.match(/[\w-]*$/g,"")[0]:"")+"-x-"+c++,F.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?
F.setMediaSelector(G):F.selector=x.root?G:x.selector+" "+G;G=""}else w=O.match(/(.*?)([\w-]*)$/),a(F=x.newCall(w[2],J,x)),F.ref=x.getDefinition(w[2]),F.getArgs=k,(J.calls||(J.calls=[])).push(F);x.currentName=P;x.currentSequence=J;x.assignmentOperator=M;var C;"{"==z&&(C=F.selector.match(/[@:]\w+/))&&(C=C[0],(P=x.getDefinition(C))&&P.selector&&P.selector(F));v.push(x=F);x.operator=z;x.start=u.lastIndex;J=P=null;continue}if(J)if(w="string"==typeof J?J:J[0],w.charAt&&"@"==w.charAt(0))if(l=w.match(/\w+/)[0],
"import"==l)w=m.getStyleSheet((g.cssRules||g.imports)[E++],J,g),l=u.lastIndex,p(w.localSource,w),u.lastIndex=l;else{if("xstyle"==l){if("start"==w.slice(8,13))F=x?x.newRule(""):Z,F.root=x.root,v.push(x=F);else{var Z=x||Z;v.pop();x=v[v.length-1]}u=x?t:/(@[\w\s])/g}}else if("\x3d"===M)try{var T=x.declareDefinition(P,J,S);T&&T.then&&r(T)}catch(U){B(U)}switch(z){case ":":"\x3d"==M?(H=!0,M=":"):a(":");break;case "}":if(P&&!x.root&&!x.isMediaBlock)try{x[":"==M?"setValue":"declareDefinition"](P,J,S)}catch(U){B(U)}case ")":case "]":d[x.operator]!=
z&&B("Incorrect opening operator "+x.operator+" with closing operator "+z);P=null;P=b.slice(x.start,u.lastIndex-1);x.cssText=x.cssText?x.cssText+";"+P:P;if("}"==z){"}"==X&&(X=x.parent.selector)&&"@"==!X.charAt(0)&&B("A nested rule must end with a semicolon");if(x.root)B("Unmatched "+z);else{try{x.onRule(x.selector,x)}catch(U){B(U)}D=!0}G=""}if(")"==z||"]"==z)x.args=[J];if(")"==z&&!M){try{T=v[v.length-2].onArguments(x)}catch(U){B(U)}T&&T.then&&r(T)}v.pop();x=v[v.length-1];J=x.currentSequence;P=x.currentName;
M=x.assignmentOperator;if(x.root&&"}"==z){if(M)try{x[":"==M?"setValue":"declareDefinition"](P,J,S)}catch(U){B(U)}H=!0;M=!1}break;case "":case void 0:return;case ";":if(x&&P){try{(T=x[":"==M?"setValue":"declareDefinition"](P,J,S))&&T.then&&r(T)}catch(U){B(U)}P}J=null;H=!0;M=D=!1;G=""}var X=z}}function B(a){var c=b.slice(0,u.lastIndex).split("\n"),d=c[c.length-1],c=(g.href||"in-page stylesheet")+":"+c.length+":"+d.length+" near:\n"+d.slice(-40);if(p.onerror)p.onerror(a,c);console.error(a.message||a,
c);a.stack&&console.error(a.stack)}b=b.replace(l,function(a){return a.replace(/[^\n]/g,"")});var x=a;u.lastIndex=0;var A,E=0,D=!0,G="",H=!0;z()}g=g||{addRule:function(){},cssRules:[]};var t,u=t=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[a];a.parse=p;p(b,g)}var e=/((?:\\.|[^'])*)'/g,n=/((?:\\.|[^"])*)"/g,l=/\/\*[\w\W]*?\*\//g,d={"{":"}","[":"]","(":")"},c=0,h="".trim?function(a){return a.trim()}:
function(a){return a.replace(/^\s+|\s+$/g,"")},p=q.prototype=[];p.toString=function(){return this.join("")};p.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return m})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(q,f,k,m,e,n,l){function d(b,c,
e){function f(c){return{selectElement:function(a){e.newElement&&(a=a.parentNode);if(c&&c.selector)for(;!u(a,c);)if(a=a.parentNode,!a)throw Error("Rule not found");if(e.inherit)for(;!(b in a);)if(a=a.parentNode,!a)throw Error(b?b+" not found":"Property was never defined");return a},forElement:function(d){var f=d;d=this.selectElement(d);e.newElement&&(d["_"+b+"Node"]=f);d=e.get?e.get(d,b):d[b];return void 0===d&&c?a(b).valueOf().forRule(c):d},forRule:e.inherit&&function(a){return f(a)}}}var g=new k(function(){return f(c)});
g.define=function(a,c){return d(b||c,a,e)};g.keepCSSValue=!0;g.put=e.inherit?function(c,d){return a(b).put(c,d,b)}:function(a){return{forElement:function(d){if(c&&c.selector)for(;!u(d,c);)if(d=d.parentNode,!d)throw Error("Rule not found");e.set?e.set(d,b,a):d[b]=a;g.invalidate({elements:[d]})}}};return g}function c(a,b,c,d){return m.when(f.evaluate(a,c),function(b){b.forElement?q.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}function h(a,b){return{apply:function(d,e,f){c(d,f,e[0],function(c,
e){c.observe(function(c){c=c?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),c);e?e.style[f]=c:d.setStyle(f,c)})})}}}function p(a,b){var c=a.variables;if(c&&b in c)return c[b];if(c=a.bases)for(var d=0;d<c.length;d++){var e=p(c[d],b);if(void 0!==e)return e}}function a(a){var b=v[a];b||(b=v[a]=new k(function(){return{forRule:function(b){a:{do{var c=p(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);
for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var b=e("div"),g=navigator.userAgent,r=-1<g.indexOf("WebKit")?"-webkit-":-1<g.indexOf("Firefox")?"-moz-":-1<g.indexOf("MSIE")?"-ms-":-1<g.indexOf("Opera")?"-o-":"",t;n=new n;var u=q.matchesRule;n.root=!0;var v={};n.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new l.Promise(function(b){require([a],
function(a){b(a)})})).then(b)}}}),item:d("item",null,{inherit:!0}),pageContent:new k,content:d("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:d(null,null,{}),elementClass:d(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!u(b,
a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(t)},valueOf:function(){return t}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,c,d){return{forRule:function(c){if("string"==typeof b.style[r+d])return c._setStyleFromValue(r+d,a),!0}}}},"var":{define:function(b,c){return a(c)},selfResolving:!0,apply:function(b,c){return a(m.convertCssNameToJs(c[0]))}},inline:h("inline","none"),block:h("block","none"),visible:h("visible",
"hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return m.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){q.on(document,c.charAt(2).toLowerCase()+c.slice(3),b,function(d){t=d;try{m.when(f.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&
(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(d.target));t=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(x){console.error("Error in "+c+" event handler, executing "+a,x)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function c(a){var d;if(d=a.match(/^\s*not(.*)/))return!c(d[1]);if(d=a.match(/\((.*)\)/))return c(d[1]);if(d=a.match(/([^:]*):(.*)/))return a=
m.convertCssNameToJs(d[1]),d=b.style[a]=d[2],b.style[a]==d;if(d=a.match(/\w+\[(.*)=(.*)\]/))return e(d[0])[d[1]]==d[2];if(d=a.match(/\w+/))return m.isTagSupported(d);throw Error("can't parse @supports string");}c(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};n.elementProperty=d;return n})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(q,f){function k(c,d,e,f){function g(a){if(!e)return f(a);
var b=a.target;do if(w(b,e))return f(a);while((b=b.parentNode)&&1===b.nodeType)}a?c.addEventListener(d,g,!!b[d]):m(c,b[d]||d,g)}function m(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function e(a){/e/.test(h.readyState||"")?a():h.addEventListener("DOMContentLoaded",a)}function n(a){for(var b=h.querySelectorAll(a.selector),c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities=
{});var k=f.renderings;k||(k=f.renderings=[],z.push(f));k.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function l(){for(;z.length;){for(var a=z.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;y=c[d.name]==e.propertyValue;if(!f&&y)try{e.render(a)}catch(H){console.error(H,H.stack),q(a,"div.error",H.toString())}f&&!y&&e.unrender&&e.unrender(a)}a.renderings=void 0}}function d(a,b){for(var c=0,d=u.length;c<d;c++){var e=u[c];
b&&b!=e.selector||!w(a,e.rule)||e.render(a)}}function c(a,b){var c={selector:a.selector,rule:a,render:b};u.push(c);A&&n(c);l();return{remove:function(){u.splice(u.indexOf(c),1)}}}var h=document,p=1,a=!!h.addEventListener,b={blur:"focusout",focus:"focusin"};k(h,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));
var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&k(h,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});var g=h.createElement("div"),r={"dom-qsa2.1":!!g.querySelectorAll},t=g.matches||
g.matchesSelector||g.webkitMatchesSelector||g.mozMatchesSelector||g.msMatchesSelector||g.oMatchesSelector,u=[],v=[],z=[],A;e(function(){if(!A)if(A=!0,r["dom-qsa2.1"]){for(var a=0,b=u.length;a<b;a++)n(u[a]);l()}else for(var c=h.all,a=0,b=c.length;a<b;a++)d(c[a])});var y,w=t?function(a,b){return t.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+p++,"true");return!!a.currentStyle[b.ieId]};return{ready:e,on:k,matchesRule:w,addRenderer:c,addInputConnector:function(a,b){v.push({rule:a,
definition:b})},update:d,clearRenderers:function(){u=[]},observeForElement:function(a,b,d){return f.when(a,function(a){function e(a){a.observe?a.observe(d):d(a)}a.forElement?c(b,function(b){e(a.forElement(b))}):e(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function q(e,f){for(var k=0,d=e.length;k<d;k++){var c=e[k];if(c&&"object"==typeof c&&f in c)return!0}}function f(e,f){return f.toUpperCase()}var k="div"==document.createElement("div").tagName,m={};return{when:function(e,
f,k){return e&&e.then?e.then(f,k)||e:f(e)},whenAll:function(e,f){return q(e,"then")?{then:function(k,d){function c(){h--;h||k(f(l))}for(var h=1,l=[],a=0;a<e.length;a++){var b=e[a];h++;b&&b.then?function(a){b.then(function(b){l[a]=b;c()},d)}(a):(l[a]=b,c())}c()},inputs:e}:f(e)},convertCssNameToJs:function(e){return e.replace(/-(\w)/g,f)},isTagSupported:function(e){if(e in m)return m[e];var f=document.createElement(e);k?(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==
e.toUpperCase();return m[e]=f},extend:function(e,f){var k=f.split(".");f=k[0];var d=e.getDefinition(f,"rules");k[0]="";e.selector+=e.extraSelector=k.join(".");if(d)return this.when(d,function(c){if(c.extend)c.extend(e,!0);else for(var d in c)e[d]=c[d]});e.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:q}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(q,f){function k(a,
b){var d=b[0];return d&&a?(d=c(d),k(a.property?a.property(d):a[d],b.slice(1))):a}function m(a,b,c){if(h(b,a)){var d={};d[a]=function(d){for(var e=[],f=0,g=b.length;f<g;f++){var h=b[f];h&&"function"==typeof h[a]&&(h=h[a](d));e[f]=h}return c(e)};return d}return c(b)}function e(a,b){return{apply:function(c,d,e){for(var f=0,g=d.length;f<g;f++){var h=d[f];h.dependencyOf&&h.dependencyOf(e)}f=function(){var b=[];if(a.selfExecuting)return a.apply(c,d,e);for(var f=0,g=d.length;f<g;f++)b[f]=d[f].valueOf();
if(a.selfWaiting)return a.apply(c,b,e);b.push(c);return q.whenAll(b,function(b){var c=b.pop();return m("forRule",b,function(b){return m("forElement",b,function(b){return a.apply(c,b,e)})})})};f.reverse=function(a){return b(a,d)};return f}}}function n(b){return a[b]||(a[b]=new Function("a","b","return "+b))}function l(a,c,d,f,h){function g(a){a.skipResolve=!0;a.precedence=c;a.infix=!1!==h}var k=function(a,b){var c=b[0],d=b[1];if(c&&c.put)d=f(a,d&&d.valueOf()),d!==p&&c.put(d);else if(d&&d.put)d.put(h(a,
c&&c.valueOf()));else throw new TypeError("Can not put");},l={apply:function(c,l,m){var p;d=n(d);f=f&&n(f);h=h&&n(h);b[a]=p=e(d,k);g(p);return p.apply(c,l,m)}};g(l);b[a]=l}function d(a,c){function g(a){for(;n<=a.precedence;){var c=p.pop(),d=b[p.pop()],e=new f;e.setCompute(d.apply(null,d.infix?[p.pop(),c]:[c],e));r=p.length?p[p.length-1]:void 0;p.push(e);n=r&&b[r]&&b[r].precedence}}var h,l;c=c.join?c.slice():[c];for(h=0;h<c.length;h++)if(l=c[h],"string"==typeof l){var m=l.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);
l=[h,1];m&&l.push.apply(l,m);c.splice.apply(c,l);h+=l.length-3}var n,p=[],r,m={};for(h=0;h<c.length;h++){l=c[h];if("("==l.operator){var B=p[p.length-1];void 0===B||b.hasOwnProperty(B)?l=d(a,l.getArgs()[0]):(p.pop(),l=function(b,c){function g(f){return q.when(b.valueOf(),function(g){var m=b.parent&&b.parent.valueOf();if(!g.selfResolving){if(!h){h=[];for(var n=0,p=c.length;n<p;n++)h[n]=d(a,c[n]);k=g.selfReacting?g.apply(m,h,l):e(g).apply(m,h,l)}return k()}g=g.apply(m,c,l);return f?g:g.valueOf()})}var h,
k,l=new f(g);l.setReverseCompute(function(){var a=arguments;return q.when(g(!0),function(b){return b.put.apply(b,a)})});return l}(B,l.getArgs()))}else if(b.hasOwnProperty(l))B=b[l],g(B),n=(r||B).precedence;else if(-1<l)l=+l;else if(l.isLiteralString)l=l.value;else{l=l.split(/\s*\/\s*/);var B=l[0],x=a.getDefinition(B);if("string"==typeof x||x instanceof Array)x=d(a,x);else if(void 0===x)throw Error('Could not find reference "'+B+'"');m[B]=x;1<l.length&&(x=k(x,l.slice(1)));l=x}p.push(l)}g({precedence:100});
if(1<p.length)throw Error("Could not reduce expression");l=p[0];l.inputs=m;return l}var c=q.convertCssNameToJs,h=q.someHasProperty,p={},a={},b={};l("+",6,"a+b","a-b","a-b");l("-",6,"a-b","a+b","b-a");l("*",5,"a*b","a/b","a/b");l("/",5,"a/b","a*b","b/a");l("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");l(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");l("!",4,"!a","!a",!1);l("%",5,"a%b");l("\x3e",8,"a\x3eb");l("\x3e\x3d",8,"a\x3e\x3db");l("\x3c",8,"a\x3cb");l("\x3c\x3d",8,"a\x3c\x3db");
l("\x3d\x3d",9,"a\x3d\x3d\x3db");l("\x26",8,"a\x26\x26b");l("|",8,"a||b");return{react:e,evaluate:d,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(q,f){function k(d){(this.computeValue=d)&&d.reverse&&this.setReverseCompute(d.reverse)}function m(d,c,h){if(c&&c.forElement)return{forElement:function(k){k=c.selectElement?c.selectElement(k):k;var a=["_cache_"+d.id];if(a in k){var b=k[a+"observe"];b.addKey&&
b.addKey(h);return k[a][h]}var g=k[a]=c.forElement(k),l=k[a+"observe"]=e(d,g,h,{elements:[k]});k.xcleanup=function(a){a&&f.unobserve(g,l)};return g[h]}}}function e(d,c,e,k){var a=d._properties,b;"object"==typeof c&&(b=function(b){for(var c=0;c<b.length;c++){var d=a[b[c].name];d&&d.invalidate&&d.invalidate(k)}},f.observe(c,b),b.addKey&&b.addKey(e));return b}var n={},l=1;k.prototype={id:"x-variable-"+l++,cache:n,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==n)return this.cache;
var d=this,c=this.computeValue;if(c.then)return this.cache=c.then(function(c){d.computeValue=c;(c=d.cache=c())&&c.then&&c.then(function(c){d.cache=c});return c});(c=d.cache=c())&&c.then&&c.then(function(c){d.cache=c});return c},property:function(d){var c=this._properties||(this._properties={}),f=c[d];if(!f){var l=this,f=c[d]=new k(function(){return q.when(l.valueOf(),function(a){if(a&&a.forRule)return{forRule:function(b){b=a.selectRule?a.selectRule(b):b;var c=["_cache_"+l.id],f;if((f=c in b?b[c]:
b[c]=a.forRule(b))&&f.forElement)return m(l,f,d);var g=b[c+"observe"];g&&(g.addKey?g.addKey(d):b[c+"observe"]=e(l,f,d,{rules:[b]}));return f[d]}};if(a&&a.forElement)return m(l,a,d);var b=l.cacheObserve;b?b.addKey&&b.addKey(d):b=l.cacheObserve=e(l,a,d);return a[d]})});f.key=d;f.parent=this;f.put=function(a){return q.when(l.valueOf(),function(b){function c(b){if(b.forElement)return{forElement:function(c){b.forElement(c)[d]=a}};b[d]=a}if(b.forRule)return{forRule:function(a){return c(b.forRule(a))}};
c(b)})};f.id=this.id+"-"+d}return f},invalidate:function(d){var c=this.cacheObserve;c&&(f.unobserve(this.cache,c),this.cacheObserve=null);this.cache=n;var e,c=this._properties;for(e in c)c[e].invalidate(d);var k=this.dependents||0;e=0;for(c=k.length;e<c;e++)try{k[e].invalidate(d)}catch(a){console.error(a,"invalidating a definition")}},dependencyOf:function(d){(this.dependents||(this.dependents=[])).push(d)},notDependencyOf:function(d){for(var c=this.dependents||0,e=0;e<c.length;e++)c[e]===d&&c.splice(e--,
1)},setReverseCompute:function(d){this.put=function(){var c=d.apply(this,arguments);this.invalidate();return c}},setCompute:function(d){(this.computeValue=d)&&d.reverse&&this.setReverseCompute(d.reverse);this.invalidate()},setSource:function(d){this.computeValue=function(){return d};this.invalidate()},observe:function(d){this.computeValue&&d(this.valueOf());var c=this;return this.dependencyOf({invalidate:function(){d(c.valueOf())}})},newElement:function(){return q.when(this.valueOf(),function(d){return d&&
d.newElement&&d.newElement()})}};return k})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function q(a,c,d){n?-1===n.indexOf(a)&&n.push(a):(n=[a],setTimeout(function(){n.forEach(function(a){var b=[];a.properties.forEach(function(c){b.push({target:a.object,name:c})});a(b);a.object=null;a.properties=null});n=null},0));a.object=c;a=a.properties||(a.properties=[]);-1===a.indexOf(d)&&a.push(d)}function f(){return f}var k=Object.observe,m;if(m=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});m=!0;break a}catch(b){}m=void 0}var e={observe:k,defineProperty:m,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},k=e.observe?Object.observe:e.defineProperty?function(a,c){c.addKey=function(b){var d="key"+b;if(!this[d]){this[d]=!0;var e=a[b];if((d=Object.getOwnPropertyDescriptor(a,b))&&d.set){var f=d.set,g=d.get;Object.defineProperty(a,b,{get:function(){return e=g.call(this)},set:function(a){f.call(this,a);e!==a&&(e=a,c&&q(c,this,b))}})}else Object.defineProperty(a,
b,{get:function(){return e},set:function(a){e!==a&&(e=a,c&&q(c,this,b))}})}};c.remove=function(){c=null}}:function(a,e){h||(h=!0,setInterval(function(){for(var a=0,b=l.length;a<b;a++){var e=d[a],f=l[a],g=c[a],h=void 0,k=void 0;for(k in e)e.hasOwnProperty(k)&&e[k]!==f[k]&&(e[k]=f[k],(h||(h=[])).push({name:k}));for(k in f)f.hasOwnProperty(k)&&!e.hasOwnProperty(k)&&(e[k]=f[k],(h||(h=[])).push({name:k}));h&&g(h)}},20));var b={},f;for(f in a)a.hasOwnProperty(f)&&(b[f]=a[f]);l.push(a);d.push(b);c.push(e)},
n;m=e.observe?Object.unobserve:function(a,e){e.remove&&e.remove();for(var b=0,f=l.length;b<f;b++)if(l[b]===a&&c[b]===e){l.splice(b,1);d.splice(b,1);c.splice(b,1);break}};var l=[],d=[],c=[],h=!1,p=1,a=function(){};a.prototype.toJSON=f;return{Promise:e.promise?Promise:function(){function a(b){function c(a){a&&a.then?a.then(c,d):(g=a,e())}function d(a){h=a;e()}function e(){f=!0;for(var a=0,b=k.length;a<b;a++)k[a]();k=0}var f,g,h,k=0;b(c,d);return{then:function(b,c){return new a(function(a,d){function e(){try{h&&
!c?d(h):a(h?c(h):b?b(g):g)}catch(D){d(D)}}f?e():(k||(k=[])).push(e)})}}}return a}(),WeakMap:e.WeakMap?WeakMap:function(b,c){var d="__"+(c||"")+p++;return e.defineProperty?{get:function(a){return a[d]},set:function(a,b){Object.defineProperty(a,d,{value:b,enumerable:!1})}}:{get:function(a){return(a=a[d])&&a.value},set:function(b,c){(b[d]||(b[d]=new a)).value=c}}},observe:k,unobserve:m,copy:function(a,c){for(var b in c)a[b]=c[b];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(q,f,k,m,e){function n(a,b,c){try{a[b]=c}catch(A){}}function l(){}function d(b,d,e,g){if(b.calls){var h;for(e=0;e<b.length;e++){var k=b[e];if(k instanceof c){b.hasOwnProperty(e)||(b[e]=k=a(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(d,k.getArgs(),d):q.evaluate(d,[k.caller,k]));void 0!==l&&((h||(h=[])).push(l),k.evaluated=!0)}}}if(h)return d=q.react(function(){for(var a=0,d=b.slice(),e=0;e<b.length;e++){var f=
b[e];f instanceof c&&f.evaluated&&(d[e-1]=b[e-1].slice(0,-f.caller.length),d[e]=arguments[a++])}return d.join("")}),d.skipResolve=!0,g=new f,g.setCompute(d.apply(g,h,g)),g;if(!g)return b.toString()}function c(a){this.caller=a;this.args=[]}function h(a,b,c,d){return e.when(b,function(b){var e=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=e.forRule(a,!0);b&&b.forElement?p(a,b,d):c&&c(b)}),b=b.forRule(a));if(b&&b.forElement)return p(a,b,d);c&&c(b)})}function p(a,
b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var a=Object.create||function(a){function b(){}b.prototype=a;return new b},b=e.convertCssNameToJs,g={"{":"}","[":"]","(":")"},r=k("div").style;l.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",
b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new l;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new c(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(w){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];n(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?n(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,c,d){a=a&&b(a);if(!this.disabled){var f=this;if(c.length)if("\x3e"==c[0].toString().charAt(0))a||(this.generator=c,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){c=a.forSelector(c,f);b.addRenderer(f,c)}));else{var g=a in r||this.getDefinition(a);if(!d||!g){d=this.definitions||(this.definitions={});var h=c[0];if(h.indexOf&&-1<h.indexOf(","))for(var h=
c.join("").split(/\s*,\s*/),k=[],l=0;l<h.length;l++)k[l]=q.evaluate(this,h[l]);c[0]&&"{"==c[0].operator?k=c[0]:c[1]&&"{"==c[1].operator&&(k=c[1],e.extend(k,c[0]));k=k||q.evaluate(this,c);if(k.then)var m=k,k={then:function(a){return m.then(function(b){return a(n(b))})}};var n=function(b){b.define&&(b=b.define(f,a));return b};g&&console.warn('Overriding existing property "'+a+'"');return d[a]=n(k)}}else return d=this.definitions||(this.definitions={}),d[a]=c}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,c,d){var e=b(a);if(!this.disabled){var f=this.values||(this.values=[]);f.push(a);f[a]=c;if(a){do{f=(d||this).getDefinition(a);if(void 0!==f){if(this.cssRule&&(!f||!f.keepCSSValue)){var g=this.cssRule.style;e in g&&n(g,e,"")}h(this,f.put(c,this,e))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}e in r&&this._setStyleFromValue(e,c,!0)}},_setStyleFromValue:function(a,b,c){var f=b[0];if(f instanceof l)for(c=f.values,f=0;f<c.length;f++){var g=c[f];this._setStyleFromValue(a+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),c[g])}else{if(b.calls){var h=this;if(b.expression=d(b,this,a,!0)){var k=b.expression&&b.expression.valueOf(),m=function(b,c){var d=k&&k.forRule?k.forRule(b,!0):k;if(d&&d.forElement){var e=c&&c.elements;if(e)for(var f=0;f<e.length;f++)for(var g=e[f].querySelectorAll(b.selector),h=0;h<g.length;h++){var l=g[h];n(l.style,a,d.forElement(l))}else p(b,d,function(b,c){n(c.style,a,b)})}else b.setStyle(a,d)},q=[h];e.when(k,function(a){(k=a)&&k.forRule&&(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){q.push(a);m(a)});m(h)});b.expression.dependencyOf({invalidate:function(a){e.when(b.expression.valueOf(),function(b){k=b;for(b=0;b<q.length;b++){var c=!0,d=q[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&m(d,a)}})}})}}c||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=
b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(c,d){(this.derivatives||(this.derivatives=[])).push(c);var e=this.extraSelector;e&&(c.selector+=e);for(var f=this.cssRule.style,g=c.getCssRule().style,h=c.inheritedStyles||(c.inheritedStyles={}),e=0;e<f.length;e++){var k=b(f[e]);if(!g[k]||h[k])g[k]=f[k],h[k]=!0}if(e=this.values){var e=a(e),l=c.values;c.values=l?m.copy(e,l):e}if(d){if(e=this.definitions){var e=a(e),n=c.definitions;c.definitions=n?m.copy(e,n):e}c.tagName=this.tagName||c.tagName}(c.bases||
(c.bases=[])).push(this);k=this._subRuleListeners||0;for(e=0;e<k.length;e++)k[e](c);var p=c.getCssRule().style;this.eachProperty(function(d,e){var f=b(d);"object"==typeof e&&(e=a(e));f in r&&!p[f]&&c._setStyleFromValue(f,e)});if(l&&c.definitions)for(e=0,f=l.length;e<f;e++)k=l[e],g=b(k),c.definitions[g]!==(n&&n[g])&&c.setValue(k,l[g]);if(l=this.generator){if(l instanceof Array)for(l=l.slice(0),e=0;e<l.length;e++)n=l[e],"{"===n.operator&&(k=c.newRule(),k.selector=n.selector+c.selector.slice(1),k.styleSheet=
c.styleSheet||c.cssRule.parentStyleSheet,n.extend(k,!0),l[e]=k);c.declareDefinition(null,l)}},getDefinition:function(a,c){a=b(a);var d=this;do{var e=d.definitions&&d.definitions[a];void 0===e&&c&&d[c]&&(e=d[c][a]);d=d.parent}while(void 0===e&&d);return e},newElement:function(){return k((this.tagName||"span")+(this.selector||""))},cssText:""};q.evaluateText=d;var t=c.prototype=new l;t.declareDefinition=t.setValue=function(a,b){this.args.push(b)};t.toString=function(){var a=this.operator;return a+this.args+
g[a]};l.updateStaleProperties=function(){};return l})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(q,f,k,m,e){function n(a,b){a=a.sort?a:[a];return function(d,e,g){var m=d,n;"content"in d||(d.content=void 0);if(void 0===g){var p=(d._contentNode||d).childNodes||0,t=p[0];if(t){var u=r.createDocumentFragment();do u.appendChild(t);while(t=p[0]);d.content=u}if(d._contentNode){d._contentNode=
void 0;try{d.innerHTML=""}catch(J){}}}for(var v=0,y=[d],z=[],p=0,t=a.length;p<t;p++){var A=I,I=a[p];try{if(I.eachProperty){if(I.args)if("("==I.operator){var N=a[p+1];l(I,N,m,function(a,c,d){h(a,c,d,b)})}else{var L=I.args[0];if("string"===typeof L){var Q=L.split("\x3d");try{m.setAttribute(Q[0],Q[1])}catch(J){console.error(J)}}else{var V=L[0].replace(/=$/,""),O=L[1];"("==O.operator?l(L[1],V,m,function(a,d,e){c(a,d,e,b)}):m.setAttribute(V,O.value)}}}else if("string"==typeof I){"\x3d"==I.charAt(0)&&(I=
I.slice(1));var M=m,N=a[p+1],Q=[];I.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){Q.push(arguments)});for(var P=0;P<Q.length;P++)(function(a,c,h,l,p,q,r){function t(){var a=M._contentNode;a&&(a.innerHTML="",M=a)}c?(a=h?h.length:0,a>v?(t(),y[a]=M):M=y[a]||M,v=a):t();var u;if(l)u=(A&&A.args?"":"span")+l+p;else{l=p.match(/^[-\w]+/);if(!l)throw new SyntaxError("Unable to parse selector",p);l=l[0];var w;P===Q.length-1&&N&&N.selector?(N.bases||k.extend(N,
l),w=N):w=b.getDefinition(l);w&&(w.then||w.newElement)?M=function(a,b,c,d){var e,g;k.when(w&&w.newElement&&w.newElement(),function(a){(e=a)?(c=c.slice(d.length))&&f(e,c):e=f(c);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);g=f("span");return a.insertBefore(g,b||null)}(M,g,p,l):u=p}u&&(M=f(g||M,(g?"-":"")+u));g=null;q&&M.setAttribute(q,""===r?q:r);e&&(M.item=e);n=n||M;(P<Q.length-1||M!=m&&M!=d)&&z.push(P==
Q.length-1&&N&&N.selector,M);m=M}).apply(this,Q[P])}else m.appendChild(r.createTextNode(I.value))}catch(J){console.error(J,J.stack),m.innerHTML&&(m.innerHTML=""),m.appendChild(r.createTextNode(J))}}for(;I=z.pop();)q.update(I,z.pop());return n}}function l(a,b,c,d){var e,g;b&&b.eachProperty?(f(c,e=b.selector),g=b):(f(c,e=a.selector||(a.selector=".-xbind-"+t++)),g=a);var h=a.getArgs()[0],k=a.expressionResult,l=a.expressionDefinition;l||(l=a.expressionDefinition=m.evaluate(a.parent,h),k=l.valueOf(),q.addInputConnector(g,
l),function(b,c,e){a.expressionResult=k;e.dependencyOf&&e.dependencyOf({invalidate:function(a){a=a?q.matchesRule(a.elements[0],g)?a.elements:a.elements[0].querySelectorAll(c):document.querySelectorAll(c);for(var f=0,h=a.length;f<h;f++)d(a[f],b,e.valueOf())}})}(b,e,l));d(c,b,k)}function d(a,b,c,d){return k.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(c));d(a)})}function c(a,b,c,e){d(c,e,a,function(c){a.setAttribute(b,c)})}function h(a,c,e,h){a._defaultBinding=
!0;if(e&&e.then&&"INPUT"!==a.tagName)try{a.appendChild(r.createTextNode("Loading"))}catch(y){}d(e,h,a,function(d){if(a._defaultBinding)if(p(a),a.childNodes.length&&(a.innerHTML=""),d&&d.sort)if(d.isSequence)n(d,h)(a);else{var e=c&&c.definitions&&c.definitions.each,k=h.newRule(),e=e?n(e,k):function(a,c,d){return f(d||a,(d?"-":"")+(b[a.tagName]||"span"),""+c)},l=[],m;d.track&&(d=d.track(),m=d.tracking);d.forEach(function(b){l.push(e(a,b,null))});if(d.on)var q=d.on("add,delete,update",function(b){var c=
b.target,d=b.previousIndex;b=b.index;if(-1<d){var f=l[d];p(f,!0);f.parentNode.removeChild(f);l.splice(d,1)}-1<b&&l.splice(b,0,e(a,c,l[b]||null))});if(m=m||q)a.xcleanup=function(){m.remove()}}else d&&d.nodeType?a.appendChild(d):(d=void 0===d?"":d,a.tagName in g?"checkbox"===a.type?a.checked=d:a.value=d:a.appendChild(r.createTextNode(d)))})}function p(a,b){a.xcleanup&&a.xcleanup(b);for(var c=a.getElementsByTagName("*"),d=0,e=c.length;d<e;d++){var f=c[d];f.xcleanup&&f.xcleanup(!0)}}function a(a,b){return n(b,
e)(a)}var b={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},g={INPUT:1,TEXTAREA:1,SELECT:1},r=document,t=1;a.forSelector=n;return a})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a){k.isAsync||d(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var b=f("dojo.dnd.Source",p,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){m.mixin(this,m.mixin({},b));var d=this.accept;if(d.length){this.accept={};for(var f=0;f<d.length;++f)this.accept[d[f]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&e.add(this.node,"dojoDndSource");this.targetState="";this.accept&&e.add(this.node,
"dojoDndTarget");this.horizontal&&e.add(this.node,"dojoDndHorizontal");this.topics=[c.subscribe("/dnd/source/over",m.hitch(this,"onDndSourceOver")),c.subscribe("/dnd/start",m.hitch(this,"onDndStart")),c.subscribe("/dnd/drop",m.hitch(this,"onDndDrop")),c.subscribe("/dnd/cancel",m.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;
break}if(!e)return!1}return!0},copyState:function(b,c){if(b)return!0;2>arguments.length&&(c=this==a.manager().target);if(c){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){b.superclass.destroy.call(this);q.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(c){if(!this.isDragging||"Disabled"!=this.targetState){b.superclass.onMouseMove.call(this,c);var d=a.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&
(Math.abs(c.pageX-this._lastX)>this.delay||Math.abs(c.pageY-this._lastY)>this.delay)){var e=this.getSelectedNodes();e.length&&d.startDrag(this,e,this.copyState(h.getCopyKeyState(c),!0))}this.isDragging&&(e=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=n.position(this.current,!0)),e=this.horizontal?c.pageX-this.targetBox.x<this.targetBox.w/2==n.isBodyLtr(this.current.ownerDocument):c.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||e!=
this.before)&&(this._markTargetAnchor(e),d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&h.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,b.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,b.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(b){this!==b?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):
this.isDragging&&(b=a.manager(),b.canDrop("Disabled"!=this.targetState&&(!this.current||b.source!=this||!(this.current.id in this.selection))))},onDndStart:function(b,c,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==b?d?"Copied":"Moved":"");c=this.accept&&this.checkAcceptance(b,c);this._changeState("Target",c?"":"Disabled");this==b&&a.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,c){var d=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return d.call(this,a.getItem(b.id).data,c)}:c?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=h.getUniqueId();return{node:b,
data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();c||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!c&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=d},onDropInternal:function(a,b){var c=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return c.call(this,this.getItem(a.id).data,b)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=h.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=c}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){b.superclass.onOverEvent.call(this);a.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){b.superclass.onOutEvent.call(this);a.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!l.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(e.contains(a,"dojoDndHandle"))return!0;if(e.contains(a,"dojoDndItem")||e.contains(a,
"dojoDndIgnore"))break}return!1}});return b})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a){var b=f("dojo.dnd.Selector",a,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(c(this.node,h.press,m.hitch(this,
"onMouseDown")),c(this.node,h.release,m.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new d,b=p._empty,c;for(c in this.selection)c in b||a.push(e.byId(c));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(e.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=p._empty,b;for(b in this.selection)if(!(b in a)){var c=
e.byId(b);this.delItem(b);n.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||k.global;var c=this.selection,d=p._empty,e;for(e in c)e in d||a.call(b,this.getItem(e),e,this)},sync:function(){b.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],c=p._empty,d;for(d in this.selection)d in c||this.getItem(d)||a.push(d);q.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
c,d,e){var f=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=f.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};b.superclass.insertNodes.call(this,c,d,e);this._normalizedCreator=
f;return this},destroy:function(){b.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!p.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,l.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){p.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&(d=b[c],d!=this.anchor&&d!=this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?p.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):p.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=c(this.node,h.move,m.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=p._empty,b;for(b in this.selection)if(!(b in a)){var c=e.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return b})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){f=f("dojo.dnd.Container",c,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=n.byId(a);c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&n.byId(c.dropParent);this.map={};this.current=null;this.containerState="";l.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[p(this.node,b.over,m.hitch(this,"onMouseOver")),p(this.node,b.out,m.hitch(this,"onMouseOut")),p(this.node,"dragstart",
m.hitch(this,"onSelectStart")),p(this.node,"selectstart",m.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||k.global;var c=this.map,d=g._empty,e;for(e in c)e in d||a.call(b,c[e],e,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return a((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=g.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<
a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){q.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=g._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(u){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(t){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.skipForm&&g.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,d=a.toLowerCase()+"State";l.replace(this.node,c+b,c+this[d]);this[d]=b},_addItemClass:function(a,b){l.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){l.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=
a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&l.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,b){var c=(this.creator||this.defaultCreator).call(this,a,b);m.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=g.getUniqueId());l.add(c.node,"dojoDndItem");return c}});g._createNode=function(a){return a?function(b){return d.create(a,{innerHTML:b})}:g._createSpan};g._createTrTd=function(a){var b=d.create("tr");d.create("td",
{innerHTML:a},b);return b};g._createSpan=function(a){return d.create("span",{innerHTML:a})};g._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};g._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?g._createTrTd:g._createNode(g._defaultCreatorNodes[a]);return function(a,c){var d=a&&m.isObject(a),e,f;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"],f=a):(e=d&&a.data?a.data:
a,d=d&&a.type?a.type:["text"],f=("avatar"==c?g._createSpan:b)(String(e)));f.id||(f.id=g.getUniqueId());return{node:f,data:e,type:d}}};return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g){var r=f("dojo.dnd.Manager",[n],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;
this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:l("touch")?4:16,OFFSET_Y:l("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());h.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),h.publish("/dnd/source/over",null)):h.publish("/dnd/source/over",null)},startDrag:function(a,d,f){function g(a){a.preventDefault();
a.stopPropagation()}b.autoScrollStart(m.doc);this.source=a;this.nodes=d;this.copy=!!f;this.avatar=this.makeAvatar();m.body().appendChild(this.avatar.node);h.publish("/dnd/start",a,d,this.copy);this.events=[c(m.doc,p.move,k.hitch(this,"onMouseMove")),c(m.doc,p.release,k.hitch(this,"onMouseUp")),c(m.doc,"keydown",k.hitch(this,"onKeyDown")),c(m.doc,"keyup",k.hitch(this,"onKeyUp")),c(m.doc,"dragstart",g),c(m.body(),"selectstart",g)];a="dojoDnd"+(f?"Copy":"Move");e.add(m.body(),a)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){e.remove(m.body(),["dojoDndCopy","dojoDndMove"]);q.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new g(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(c){var d=this.avatar;d&&(b.autoScrollNodes(c),d=d.node.style,d.left=c.pageX+this.OFFSET_X+"px",d.top=
c.pageY+this.OFFSET_Y+"px",d=!!this.source.copyState(a.getCopyKeyState(c)),this.copy!=d&&this._setCopyStatus(d));l("touch")&&c.preventDefault()},onMouseUp:function(b){if(this.avatar){if(this.target&&this.canDropFlag){var c=!!this.source.copyState(a.getCopyKeyState(b));h.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,b);h.publish("/dnd/drop",this.source,this.nodes,c,this.target,b)}else h.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case d.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case d.ESCAPE:h.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==d.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();e.replace(m.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});a._manager=null;r.manager=a.manager=function(){a._manager||
(a._manager=new r);return a._manager};return r})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(q,f,k,m,e,n,l,d){return q("dojo.dnd.Avatar",null,{constructor:function(c){this.manager=c;this.construct()},construct:function(){var c=n.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),d=this.manager.source,e,a=n.create("tbody",null,c),b=n.create("tr",
null,a),f=n.create("td",null,b),k=Math.min(5,this.manager.nodes.length),q=0;l("highcontrast")&&n.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},f);n.create("span",{innerHTML:d.generateText?this._generateText():""},f);for(m.set(b,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});q<k;++q)d.creator?e=d._normalizedCreator(d.getItem(this.manager.nodes[q].id).data,"avatar").node:(e=this.manager.nodes[q].cloneNode(!0),"tr"==e.tagName.toLowerCase()&&(b=n.create("table"),n.create("tbody",
null,b).appendChild(e),e=b)),e.id="",b=n.create("tr",null,a),f=n.create("td",null,b),f.appendChild(e),m.set(b,{"class":"dojoDndAvatarItem",style:{opacity:(9-q)/10}});this.node=c},destroy:function(){n.destroy(this.node);this.node=!1},update:function(){e.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(l("highcontrast")){var c=k.byId("a11yIcon"),f="+";this.manager.canDropFlag&&!this.manager.copy?f="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(f="x"):
f="o";c.innerHTML=f}d("tr.dojoDndAvatarHeader td span"+(l("highcontrast")?" span":""),this.node).forEach(function(c){c.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(q,f,k,m){return q("dijit.CheckedMenuItem",k,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:m,checked:!1,_setCheckedAttr:function(e){this.domNode.setAttribute("aria-checked",e?"true":"false");this._set("checked",e)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(e){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(e)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(q,f,k,m,e,n,l,d,c,h,p){var a=c("dijit.ColorPalette",[k,m,e],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,d,e){return new this._dyeClass(a,
c,d,e)},buildRendering:function(){this.inherited(arguments);this._dyeClass=c(a._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],l.getLocalization("dojo","colors",this.lang))}});a._Color=c("dijit._Color",d,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":q.toUrl("./themes/a11y/colors7x10.png"),"3x4":q.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,c,e,f){this._title=f;this._row=c;this._col=e;this.setColor(d.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,c){var b=p.substitute(n("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});h.place(b,a)}});return a})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(q,f,k,m,e,n,l,d,c,h,p){return q("dijit._PaletteMixin",d,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?n.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,b){this._cells=[];var d=this._blankGif;this.own(l(this.gridNode,c,n.hitch(this,"_onCellClick")));for(var f=0;f<a.length;f++)for(var h=m.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),k=0;k<a[f].length;k++){var q=a[f][k];if(q){var z=this._dyeFactory(q,f,k,b[q]),q=m.create("td",{"class":this.cellClass,tabIndex:"-1",title:b[q],role:"gridcell"},h);z.fillCell(q,d);q.idx=this._cells.length;this._cells.push({node:q,
dye:z})}}this._xDim=a[0].length;this._yDim=a.length;var A={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},y;for(y in A)this.own(p.addKeyListener(this.domNode,{keyCode:e[y],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=A[y];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){h.focus(this._currentFocus)},
_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var c=this._getDye(b).getValue();this._setCurrent(b);h.focus(b);this._setValueAttr(c,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&f.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&k.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;k.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,b){if(-1!=b){var c=this._currentFocus.idx+a;c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(n.hitch(h,"focus",c)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(q){return q})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(q,f,k,m,e,n,l,d,c){m("dijit-legacy-requires")&&n(0,function(){q(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[l,d],{templateString:c,baseClass:"dijitCheckBox",_setValueAttr:function(c,
d){"string"==typeof c&&(this.inherited(arguments),c=!0);this._created&&this.set("checked",c,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&e("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&e("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(q,f){return q("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(k){this._set("readOnly",k);f.set(this.focusNode,"readOnly",k)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(k){k=this._getSubmitValue(k);this._set("value",k);f.set(this.focusNode,
"value",k)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(q,f,k){return q("dijit.form.ComboBox",[f,k],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang",
"../when","../_base/array"],function(q,f,k,m){q=function(e){function n(c,a){var b=e[c];b&&(e[c]=function(d){var f;"put"===c&&(f=e.getIdentity(d));if(h)return b.apply(this,arguments);h=!0;try{var g=b.apply(this,arguments);k(g,function(b){a("object"==typeof b&&b||d,f)});return g}finally{h=!1}})}var l=[],d=0;e=f.delegate(e);e.notify=function(c,a){d++;for(var b=l.slice(),e=0,f=b.length;e<f;e++)b[e](c,a)};var c=e.query;e.query=function(h,a){a=a||{};var b=c.apply(this,arguments);if(b&&b.forEach){var g=
f.mixin({},a);delete g.start;delete g.count;var n=e.queryEngine&&e.queryEngine(h,g),p=d,q=[],v;b.observe=function(c,f){1==q.push(c)&&l.push(v=function(c,g){k(b,function(b){var h=b.length!=a.count,k,l;if(++p!=d)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,t=-1,u=-1;if(void 0!==g){var v=[].concat(b);n&&!c&&(v=n(b));k=0;for(l=b.length;k<l;k++){var w=b[k];if(e.getIdentity(w)==g&&!(0>v.indexOf(w))){r=w;t=k;!n&&c||b.splice(k,1);break}}}n?c&&(n.matches?
n.matches(c):n([c]).length)&&(k=-1<t?t:b.length,b.splice(k,0,c),u=m.indexOf(n(b),c),b.splice(k,1),a.start&&0==u||!h&&u==b.length?u=-1:b.splice(u,0,c)):c&&(void 0!==g?u=t:a.start||(u=e.defaultIndex||0,b.splice(u,0,c)));if((-1<t||-1<u)&&(f||!n||t!=u))for(h=q.slice(),k=0;b=h[k];k++)b(c||r,t,u)})});var g={};g.remove=g.cancel=function(){var a=m.indexOf(q,c);-1<a&&(q.splice(a,1),q.length||l.splice(m.indexOf(l,v),1))};return g}}return b};var h;n("put",function(c,a){e.notify(c,a)});n("add",function(c){e.notify(c)});
n("remove",function(c){e.notify(void 0,c)});return e};f.setObject("dojo.store.Observable",q);return q})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(q,f,k,m){return q("dijit.form.SimpleTextarea",m,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&
this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);k("ie")&&this.cols&&f.add(this.textbox,"dijitTextAreaCols")},filter:function(e){e&&(e=e.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(e){if(this.maxLength){var f=parseInt(this.maxLength),l=this.textbox.value.replace(/\r/g,""),f=l.length-f;if(0<f){var d=this.textbox;if(d.selectionStart){var c=d.selectionStart,h=0;k("opera")&&(h=(this.textbox.value.substring(0,
c).match(/\r/g)||[]).length);this.textbox.value=l.substring(0,c-f-h)+l.substring(c-h);d.setSelectionRange(c-f,c-f)}else this.ownerDocument.selection&&(d.focus(),l=this.ownerDocument.selection.createRange(),l.moveStart("character",-f),l.text="",l.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(q,f,k){return q("dijit.form.RadioButton",[f,k],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),
function(q,f,k,m,e,n){return f("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var f=[];e("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(m.hitch(this,function(d){d.name==this.name&&d.form==this.focusNode.form&&(d=n.getEnclosingWidget(d))&&f.push(d)}));return f},_setCheckedAttr:function(e){this.inherited(arguments);this._created&&e&&q.forEach(this._getRelatedWidgets(),m.hitch(this,function(d){d!=this&&d.checked&&d.set("checked",!1)}))},_getSubmitValue:function(e){return null==
e?"on":e},_onClick:function(e){if(this.checked||this.disabled)return e.stopPropagation(),e.preventDefault(),!1;if(this.readOnly)return e.stopPropagation(),e.preventDefault(),q.forEach(this._getRelatedWidgets(),m.hitch(this,function(c){k.set(this.focusNode||this.domNode,"checked",c.checked)})),!1;var d=!1,c;q.some(this._getRelatedWidgets(),function(d){return d.checked?(c=d,!0):!1});this.checked=!0;c&&(c.checked=!1);if(!1===this.onClick(e)||e.defaultPrevented)d=!0;this.checked=!1;c&&(c.checked=!0);
d?e.preventDefault():this.set("checked",!0);return!d}})})},"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"jimu-loading"\x3e\x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d"custom"\x3e${nls.customImage}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cdiv class\x3d"crop-section" data-dojo-attach-point\x3d"cropSection"\x3e\r\n\t\t\x3cdiv class\x3d"viewer-box hide-status" data-dojo-attach-point\x3d"viewerBox"\x3e\r\n\t\t\t\x3cdiv class\x3d"viewer-content" data-dojo-attach-point\x3d"viewerContent"\x3e\r\n\t\t\t\t\x3cimg class\x3d"viewer-image hide-status" data-dojo-attach-point\x3d"viewerImage" src\x3d""\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" data-dojo-attach-event\x3d"mousedown:_onViewerMouseDown,mouseup:_onViewerMouseUp"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"controller hide-status" data-dojo-attach-point\x3d"zoomController"\x3e\r\n\t\t\x3cdiv class\x3d"zoom-out" data-dojo-attach-point\x3d"zoomOutBtn" data-dojo-attach-event\x3d"click:_onZoomOutClick"\x3e-\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"slider" data-dojo-attach-point\x3d"sliderNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"button" data-dojo-attach-point\x3d"sliderButton" data-dojo-attach-event\x3d"mousedown:_onSliderMouseDown,mouseup:_onSliderMouseUp"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"horizontal"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"zoom-in" data-dojo-attach-point\x3d"zoomInBtn" data-dojo-attach-event\x3d"click:_onZoomInClick"\x3e+\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv class\x3d"add-btn-section"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAddExp" data-dojo-attach-event\x3d"click:_onBtnAddExpClick"\r\n\t\t\t class\x3d"add-with-icon jimu-state-disabled add-expression jimu-float-leading"\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"iconAddExp" class\x3d"jimu-icon jimu-icon-add jimu-state-disabled"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAddSet" data-dojo-attach-event\x3d"click:_onBtnAddSetClick"\r\n\t\t\t class\x3d"add-with-icon jimu-state-disabled add-set jimu-float-leading"\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"iconAddSet" class\x3d"jimu-icon jimu-icon-add jimu-state-disabled"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"matchMsg" style\x3d"margin-top:11px;margin-bottom:11px;display:none;"\x3e\r\n\t\t\t\x3cspan\x3e${nls.strMatchMsgPart1}\x3c/span\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.all}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.any}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\t\x3cspan\x3e${nls.strMatchMsgPart2}\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" style\x3d"display:none;"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:false,trim:true\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-event\x3d"change:_onRangeDateBlur" data-dojo-props\x3d\'value:new Date(),required:false,trim:true\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/ListValueProvider.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"valuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"input:_onFilteringSelectInput"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"setting-table" cellpadding\x3d"0" cellspacing\x3d"0" cellpadding\x3d"10px" style\x3d"table-layout:fixed;"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd class\x3d"fields-td" nowrap\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"dijit-form-FilteringSelect" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"operators-td" nowrap\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"value-td" nowrap data-dojo-attach-point\x3d"valueTd"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"value-container"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-table-container"\x3e\r\n\t\t\t\t\t\t\t\x3ctable class\x3d"radio-table" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t\t\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" data-dojo-attach-point\x3d"valueRadio" checked\x3d"true" disabled  title\x3d"${nls.valueTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"valueLabel" title\x3d"${nls.valueTooltip}"\x3e${nls.value}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" data-dojo-attach-point\x3d"fieldRadio" disabled title\x3d"${nls.fieldTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"fieldLabel" title\x3d"${nls.fieldTooltip}"\x3e${nls.field}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"uniqueTd"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" data-dojo-attach-point\x3d"uniqueRadio" disabled title\x3d"${nls.uniqueValueTooltip}" /\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"uniqueLabel" title\x3d"${nls.uniqueValueTooltip}"\x3e${nls.unique}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"delete-td" nowrap\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\r\n\t\t\t\t\t data-dojo-attach-event\x3d"click:_destroySelf"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"askvalues"\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.strMatchMsgPart1}\x3c/span\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.all}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.any}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.strMatchMsgPart2}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:15px;padding-right:10px;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"onclick:_destroySelf"\r\n\t\t\t\t\t class\x3d"jimu-icon jimu-icon-delete"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:15px;padding-right:14px;"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAdd" class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"*now":function(q){q(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main".split(" "),function(q,f,k,m,e,n,l,d,c,h,p,a,b,g,r,t,u,v,z,A,y,w,B,x,F,E,D,G){function H(a){K=
a;c.setStyle(jimuConfig.loadingId,"display","none");c.setStyle(jimuConfig.mainPageId,"display","block")}t={};var K;window.topic=g;z.defaults.io.timeout=18E4;"function"!==typeof r.getAll&&(r.getAll=function(a){var b=[];(a=r(a))&&b.push(a);return b});window.jimuNls=D;window.apiNls=G.bundle;w.setProtocolErrorHandler(function(){return!0});w=x.getAncestorWindow();var I=!1;try{I=0===w.location.href.indexOf("https://")}catch(N){console.log(N),I="https:"===window.location.protocol}A.setRequestPreCallback(function(a){a.content&&
a.content.printFlag&&(a.timeout=3E5);I&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=z.defaults.io.proxyUrl;c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));x.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());!window.isBuilder&&K&&!K.mode&&K.appProxies&&0<K.appProxies.length&&p.some(K.appProxies,function(b){if(0<=a.url.indexOf(b.sourceUrl))return a.url=
a.url.replace(b.sourceUrl,b.proxyUrl),!0});return a});a(window,"mousedown",function(a){if(b.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=h.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",
mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.6";window.productVersion="Online 5.3";window.isBuilder?(g.subscribe("app/appConfigLoaded",H),g.subscribe("app/appConfigChanged",H)):(g.subscribe("appConfigLoaded",H),g.subscribe("appConfigChanged",H));t.initApp=function(){var a,b;console.log("jimu.js init...");var g=window.location.search;if(""===g)a={};else{g=v.queryToObject(g.substr(1));for(a in g)g[a]=x.sanitizeHTML(g[a]);a=g}if(a.mobileBreakPoint)try{b=
parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(V){console.error("mobileBreakPoint URL parameter must be a number.",V)}a.mode&&(c.setStyle(jimuConfig.loadingId,"display","none"),c.setStyle(jimuConfig.mainPageId,"display","block"));k.getInstance(m.getInstance());e.getInstance();n.getInstance();l.getInstance();d.getInstance();b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=q.getInstance(a);b.startup();a.loadConfig();F(["dynamic-modules/preload"])};return t});