// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(f,m,g,r,c,u,v){f=f(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(c,f){c=c||{};c.layers||c.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=c.id;this.itemId=c.itemId;this.layers=
c.layers;this.title=c.title||"";this.thumbnailUrl=c.thumbnailUrl;this.basemapGallery=f},getLayers:function(f){if(this.layers)return this.layers;if(this.itemId)return f=u({url:(f||c.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:g.hitch(this,function(c,f){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),f.addCallback(g.hitch(this,
function(c,f){if(c.baseMap)return this.layers=[],m.forEach(c.baseMap.baseMapLayers,function(c){this.layers.push(new v(c))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),f}});r("extend-esri")&&g.setObject("dijit.Basemap",f,c);return f})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(f,m,g,r){f=f(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(c){c=c||{};c.url||c.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=c.url;this.type=c.type;this.isReference=!0===c.isReference?!0:!1;this.opacity=c.opacity;this.visibleLayers=c.visibleLayers;this.displayLevels=c.displayLevels;this.exclusionAreas=c.exclusionAreas;this.bandIds=c.bandIds;this.templateUrl=c.templateUrl;this.copyright=c.copyright;this.subDomains=
c.subDomains;this.fullExtent=c.fullExtent;this.initialExtent=c.initialExtent;this.tileInfo=c.tileInfo;this.tileServers=c.tileServers;this.styleUrl=c.styleUrl}});g("extend-esri")&&m.setObject("dijit.BasemapLayer",f,r);return f})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(f,m,g,r,c,u,v,z,B,x,y,p,t,A,n,w,a,d,e,k,h,C,q,J,D,E,K,F,L,G,H,I,M,N,O){m=m([N,n,w],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:O,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(b,l){b=b||{};b.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=b.map;this._hasUI=l?!0:!1;this.bingMapsKey=b.bingMapsKey&&0<b.bingMapsKey.length?b.bingMapsKey:null;this.showArcGISBasemaps=!1!==b.showArcGISBasemaps;this.basemaps=b.basemaps||[];this.basemapIds=b.basemapIds;this.referenceIds=b.referenceIds;this.basemapsGroup=b.basemapsGroup;this.arcgisUrl=a.dijit._arcgisUrl;b.portalUrl&&(this.arcgisUrl=b.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=e.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);g.forEach(this.basemaps,function(b){b.id&&0!==b.id.length||(b.id=this._getUniqueId());g.forEach(b.layers,function(b){b.opacity=0<=b.opacity?b.opacity:1;b.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&g.forEach(this.basemapIds,function(b){this.map.getLayer(b)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&g.forEach(this.referenceIds,
function(b){b=this.map.getLayer(b);b._basemapGalleryLayerType="reference";b.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(c.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(c.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup();this._checkVTLSupport().then(c.hitch(this,function(b){this._supportsVTL=b}))},startup:function(){this.loaded?
this._refreshUI():r.connect(this,"onLoad",c.hitch(this,function(){this._refreshUI()}))},select:function(b){this._select(b)},getSelected:function(){return this._selectedBasemap},get:function(b){var a;for(a=0;a<this.basemaps.length;a++)if(this.basemaps[a].id===b)return this.basemaps[a];return null},add:function(b){return b&&!b.id?(b.id=this._getUniqueId(),this.basemaps.push(b),this._refreshUI(),this.onAdd(b),!0):b&&this._isUniqueId(b.id)?(this.basemaps.push(b),this._refreshUI(),this.onAdd(b),!0):!1},
remove:function(b){var a;for(a=0;a<this.basemaps.length;a++){var d=this.basemaps[a];if(d.id===b)return this._selectedBasemap&&this._selectedBasemap.id===d.id&&(this._selectedBasemap=null),this.basemaps.splice(a,1),this._refreshUI(),this.onRemove(d),d}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(b){},onRemove:function(b){},onError:function(b){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=
!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(b){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,b):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(b))},_findArcGISBasemapsGroup:function(b){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(b);
else{var a=this.arcgisUrl+"/portals/self",d={f:"json"};d.culture=u.locale;k({url:a,content:d,callbackParamName:"callback",load:c.hitch(this,function(a,d){this._basemapGalleryGroupQuery=a&&a.basemapGalleryGroupQuery?a.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(b)}),error:c.hitch(this,function(b,a){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(b){var a=c.hitch(this,"_findArcGISBasemaps"),
d=this.arcgisUrl+"/community/groups",e={};e.q=this._basemapGalleryGroupQuery;e.f="json";k({url:d,content:e,callbackParamName:"callback",load:c.hitch(this,function(d,l){if(0<d.results.length)a(d.results[0].id,b,d.results[0].sortField,d.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:c.hitch(this,function(b){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(b,a,d,e){var l=c.hitch(this,
function(b,a,d,e){var l=this.arcgisUrl+"/search",h={};h.q="group:"+b+' AND type:"web map" NOT type:"web mapping application"';h.sortField=d;h.sortOrder="asc"===e?"desc":"asc";h.num=50;h.f="json";k({url:l,content:h,callbackParamName:"callback",load:c.hitch(this,function(b,d){if(0<b.results.length)a(b.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:c.hitch(this,function(b,a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});
d&&e?l(b,a,d,e):k({url:this.arcgisUrl+"/community/groups/"+b,content:{f:"json"},callbackParamName:"callback",load:c.hitch(this,function(d,e){d.sortField?l(b,a,d.sortField,d.sortOrder):l(b,a,"name","desc")}),error:c.hitch(this,function(d,e){l(b,a,"name","desc")})})},_handleArcGISBasemapsResponse:function(b){0<b.length&&(g.forEach(b,function(b,d){if(this.bingMapsKey||!this.bingMapsKey&&b.title&&-1===b.title.indexOf("Bing Maps")){var l={};l.id=this._getUniqueId();l.title=b.title;l.thumbnailUrl="";if(b.thumbnail&&
b.thumbnail.length&&(l.thumbnailUrl=this.arcgisUrl+"/content/items/"+b.id+"/info/"+b.thumbnail,a.id)){var k=a.id.findCredential(e.urlToObject(this.arcgisUrl).path);k&&(l.thumbnailUrl+="?token\x3d"+k.token)}l.itemId=b.id;l=new M(l,this);this.basemaps.splice(0,0,l)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(t.empty(this.flowContainer),g.forEach(this.basemaps,function(b,a){b.id||(b.id="basemap_"+a);this.flowContainer.appendChild(this._buildNodeLayout(b))},this),t.create("br",
{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(b){var a=t.create("div",{id:"galleryNode_"+b.id,"class":"esriBasemapGalleryNode"}),d=t.create("a",{href:"javascript:void(0);"},a);r.connect(d,"onclick",c.hitch(this,"_onNodeClick",b));var e=b.title||"";b.thumbnailUrl?t.create("img",{"class":"esriBasemapGalleryThumbnail",src:b.thumbnailUrl,title:e,alt:e},d):t.create("img",{"class":"esriBasemapGalleryThumbnail",src:f.toUrl("./images/transparent.gif"),
title:e,alt:e},d);b=t.create("div",{"class":"esriBasemapGalleryLabelContainer"},a);t.create("span",{innerHTML:e,alt:e,title:e},b);return a},_onNodeClick:function(b,a){a.preventDefault();this._markSelected(b);this.select(b.id)},_markSelected:function(b){b&&(g.forEach(u.query(".esriBasemapGallerySelectedNode",this.domNode),function(b){A.remove(b,"esriBasemapGallerySelectedNode")}),(b=p.byId("galleryNode_"+b.id))&&A.add(b,"esriBasemapGallerySelectedNode"))},_select:function(b){this._selectBasemapInProgress=
!0;var a=this.get(b);a?(a.layers?this._getServiceInfos(a):(b=a.getLayers(this.arcgisUrl),c.isArray(b)?this._getServiceInfos(a):b.addCallback(c.hitch(this,function(b){this._getServiceInfos(a)}))),this._markSelected(a)):this._selectBasemapInProgress=!1},_getServiceInfos:function(b){"https:"===location.protocol&&g.forEach(b.layers,function(b){if(this._isAgolService(b.url)||this._isHostedService(b.url))b.url=b.url.replace("http:","https:")},this);this._selectedBasemap=b;var a=[];g.forEach(b.layers,function(b){b.url&&
0<b.url.length&&!b.isReference&&!b.type&&(b.deferredsPos=a.length,a.push(this._getServiceInfo(b.url)))},this);0<a.length?(new y(a)).addCallback(c.hitch(this,function(a){var d=null;g.forEach(b.layers,function(b){if(0===b.deferredsPos||b.deferredsPos){b.serviceInfoResponse=a[b.deferredsPos][1];var e=b.serviceInfoResponse.fullExtent;e||(e=b.serviceInfoResponse.extent);d=d?d.union(new h(e)):new h(e)}},this);this.map.extent&&5>this._getIntersectionPercent(d,this.map.extent)&&this.map.setExtent(d,!0);this._switchBasemapLayers(b);
this._updateReferenceLayer(b)})):(this._switchBasemapLayers(b),this._updateReferenceLayer(b))},_checkVTLSupport:function(){var b=new x;v("ie")?b.resolve(!1):b.resolve(F.supported());return b},_switchBasemapLayers:function(b){var a=b.layers,d=!1,e,k,w;g.forEach(a,function(b){"VectorTileLayer"===b.type&&(d=!0)});if(d&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()&&("OpenStreetMap"===a[0].type||a[0].type&&-1<a[0].type.indexOf("BingMaps")||"WebTiledLayer"===a[0].type||"VectorTileLayer"===a[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{g.forEach(a,function(b){if(!b.isReference&&b.type&&-1<b.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var f=0;g.forEach(a,
function(b,d){if(!b.isReference){var l;if("OpenStreetMap"===b.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}l=new J({id:"layer_osm",opacity:b.opacity})}else if(b.type&&-1<b.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}l=q.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===b.type?l=q.MAP_STYLE_AERIAL:"BingMapsRoad"===b.type&&(l=q.MAP_STYLE_ROAD);l=new q({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:l,opacity:b.opacity})}else if("WebTiledLayer"===b.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}l=b.initialExtent||b.fullExtent;l=
new K(b.templateUrl||b.url,{visible:b.visibility,opacity:b.opacity,copyright:b.copyright,fullExtent:b.fullExtent&&new h(b.fullExtent),initialExtent:l&&new h(l),subDomains:b.subDomains,tileInfo:b.tileInfo?new L(b.tileInfo):null,tileServers:b.tileServers})}else if("VectorTileLayer"===b.type){l=new F(b.styleUrl,{visible:b.visibility,opacity:b.opacity});0===d&&1<a.length&&this._removeBasemapLayers();var g=this;r.connect(l,"onLoad",c.hitch(this,function(b,d,e){var l;if(g._sameSpatialReference(e.spatialReference,
g.map.spatialReference))if(0<g.map.getNumLevels())if(l=g._sameTilingScheme(e.tileInfo,g.map.__tileInfo))0===d&&1===a.length&&g._removeBasemapLayers(),e._basemapGalleryLayerType="basemap",g.map.addLayer(e,b);else g.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");else g.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else g.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.")},
f,d))}else if(b.serviceInfoResponse&&b.serviceInfoResponse.mapName){e=new C(b.serviceInfoResponse.spatialReference);k=this._sameSpatialReference(e,this.map.spatialReference);if(this.map.spatialReference&&!k){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===b.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(w=this._sameTilingScheme(b.serviceInfoResponse.tileInfo,this.map.__tileInfo),!w){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}}else if(!0===b.serviceInfoResponse.singleFusedMapCache&&-1<b.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}l=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===b.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(b):this._loadAsDynamic(b)}else if(b.serviceInfoResponse&&
b.serviceInfoResponse.pixelSizeX){e=new C(b.serviceInfoResponse.spatialReference);k=this._sameSpatialReference(e,this.map.spatialReference);if(!k){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===b.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&(w=this._sameTilingScheme(b.serviceInfoResponse.tileInfo,this.map.__tileInfo),!w)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}b.serviceInfoResponse.singleFusedMapCache?l=new D(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility}):b.serviceInfoResponse.pixelSizeX?(l=new H,l.bandIds=b.bandIds,!b.bandIds&&b.serviceInfoResponse.bandCount&&3<parseInt(b.serviceInfoResponse.bandCount,10)&&(l.bandIds=[0,1,2]),l=new G(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility,imageServiceParameters:l})):(l=new I,l.format="png24",b.serviceInfoResponse.supportedImageFormatTypes&&
-1<b.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(l.format="png32"),l=new E(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility,imageParameters:l}))}"VectorTileLayer"===b.type?f++:l&&(0===d&&this._removeBasemapLayers(),l._basemapGalleryLayerType="basemap",this.map.addLayer(l,f),f++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var b=this.map.layerIds,a=[];g.forEach(b,function(b){b=this.map.getLayer(b);
"basemap"===b._basemapGalleryLayerType&&a.push(b)},this);0===a.length&&0<b.length&&a.push(this.map.getLayer(b[0]));0<a.length&&g.forEach(a,function(b){this.map.removeLayer(b)},this)},_updateReferenceLayer:function(b){var a;this._removeReferenceLayer();for(a=0;a<b.layers.length;a++)!0===b.layers[a].isReference&&this._addReferenceLayer(b.layers[a])},_removeReferenceLayer:function(){var b;for(b=this.map.layerIds.length-1;0<=b;b--){var a=this.map.getLayer(this.map.layerIds[b]);"reference"===a._basemapGalleryLayerType&&
this.map.removeLayer(a)}},_addReferenceLayer:function(b){"VectorTileLayer"===b.type?this._handleReferenceServiceInfoResponse(b):this._getServiceInfo(b.url,c.hitch(this,"_handleReferenceServiceInfoResponse",b))},_handleReferenceServiceInfoResponse:function(b,a,d){var e;b.serviceInfoResponse=a;"VectorTileLayer"===b.type?e=new F(b.styleUrl,{visible:b.visibility,opacity:b.opacity}):a&&a.mapName?e=!0===a.singleFusedMapCache?this._loadAsCached(b):this._loadAsDynamic(b):a&&a.pixelSizeX&&(b.serviceInfoResponse.singleFusedMapCache?
e=new D(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility}):b.serviceInfoResponse.pixelSizeX?(d=new H,d.bandIds=b.bandIds,!b.bandIds&&a.bandCount&&3<parseInt(a.bandCount,10)&&(d.bandIds=[0,1,2]),e=new G(b.url,{resourceInfo:a,opacity:b.opacity,visible:b.visibility,imageServiceParameters:d})):(a=new I,a.format="png24",b.serviceInfoResponse.supportedImageFormatTypes&&-1<b.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(a.format="png32"),a.transparent=!0,
e=new E(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility,imageParameters:a})));e&&(e._basemapGalleryLayerType="reference",e.attr("data-reference",!0),this.map.addLayer(e))},_getServiceInfo:function(b,a){return k({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){a&&a(b,d)},error:c.hitch(this,function(b,a){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(b){var a=[];b.displayLevels||(a=g.map(b.serviceInfoResponse.tileInfo.lods,
function(b){return b.level}));var d=null;b.exclusionAreas&&b.exclusionAreas.length&&(d=[],g.forEach(b.exclusionAreas,function(b){d.push({minZoom:b.minZoom,maxZoom:b.maxZoom,minScale:b.minScale,maxScale:b.maxScale,geometry:new h(b.geometry)})}));return new D(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility,exclusionAreas:d,displayLevels:b.displayLevels||a})},_loadAsDynamic:function(b){var a=new E(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility});
b.visibleLayers&&a.setVisibleLayers(b.visibleLayers);return a},_getIntersectionPercent:function(b,a){var d=a.intersects(b);if(d){var d=d.getWidth()*d.getHeight(),e=a.getWidth()*a.getHeight();return d/e*100}return 0},_getIds:function(){var b=[];g.forEach(this.basemaps,function(a){b.push(a.id)},this);return b},_getUniqueId:function(){for(var b=","+this._getIds().toString()+",",a=0;;)if(-1<b.indexOf(",basemap_"+a+","))a++;else return"basemap_"+a},_isUniqueId:function(b){return-1===(","+this._getIds().toString()+
",").indexOf(","+b+",")?!0:!1},_isAgolService:function(b){return b?-1!==b.indexOf("/services.arcgisonline.com/")||-1!==b.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(b){return b?-1!==b.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(b,a){return b&&a&&b.wkt==a.wkt&&(b.wkid===a.wkid||d.isDefined(b.latestWkid)&&b.latestWkid===a.wkid||d.isDefined(a.latestWkid)&&b.wkid===a.latestWkid||d.isDefined(b.latestWkid)&&b.latestWkid===a.latestWkid)||b&&a&&b.isWebMercator()&&a.isWebMercator()?
!0:!1},_sameTilingScheme:function(b,a){var d=this.map,d=d.width>d.height?d.width:d.height,e=!1,k=!1,h,c;for(h=0;h<b.lods.length;h++){var w=b.lods[h].scale;b.dpi!==a.dpi&&(w=b.lods[h].scale/b.dpi);for(c=0;c<a.lods.length;c++){var q=a.lods[c].scale;b.dpi!==a.dpi&&(q=a.lods[c].scale/a.dpi);if(Math.abs(q-w)/q<1/d)if(e){k=!0;break}else e=!0;if(q<w)break}if(k)break}return k||e&&(1===b.lods.length||1===a.lods.length)?!0:!1}});z("extend-esri")&&c.setObject("dijit.BasemapGallery",m,a);return m})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(f,m,g,r,c,u,v,z,B,x,y,p,t,A,n){f=f(t,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(c){try{if(c=m.mixin({bingMapsKey:null,culture:"en-US"},c||{}),this.url=x.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=x.urlToObject(this.url),this.spatialReference=new y({wkid:102100}),this.tileInfo=new p({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new A(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new y({wkid:102100})),m.mixin(this,c),this.hasAttributionData=this.showAttribution,this._initLayer=m.hitch(this,this._initLayer),this._errorHandler=m.hitch(this,this._errorHandler),this._getTileInfo=m.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(a){throw this.onError(a),a;}},_unsetMap:function(c,a){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var c=this._url.path+"/Imagery/Metadata/"+this.mapStyle,a=window.location.protocol;if(this.bingMapsKey){var d=this.resourceInfo;!this.loaded&&d?this._initLayer(d):n({url:c,content:m.mixin({},{uriScheme:"https:"===a?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(c,a){if(200!==c.statusCode){var d=Error();d.code=c.statusCode;d.message=c.statusDescription;d.details=c.errorDetails;d.authenticationResultCode=c.authenticationResultCode;this.onError(d)}else try{this.resourceInfo=g.toJson(c);var d=c.resourceSets[0].resources[0],e=d.imageUrl.replace("{","${");this.tileServers=r.map(d.imageUrlSubdomains,function(a){var d=x.getProtocolForWebResource();return v.substitute(e,{subdomain:a}).replace("http:",d)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var k=this.loadCallback;k&&(delete this.loadCallback,k(this))}}catch(h){this.onError(h)}},getAttributionData:function(){var f=new z,a=g.fromJson(this.resourceInfo),d;this.hasAttributionData&&a&&(d=m.getObject("resourceSets.0.resources.0.imageryProviders",!1,a));d?f.callback({contributors:d}):
(a=Error("Layer does not have attribution data"),a.log=c.isDebug,f.errback(a));return f},getTileUrl:function(c,a,d){return v.substitute(this.tileServers[a%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(c,a,d),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(c,a,d){var e="",k,h;for(h=c;0<h;h--)c="0",k=1<<h-1,0!=(d&k)&&c++,0!=(a&k)&&(c++,c++),e+=c;return e},setMapStyle:function(c){this.mapStyle=c;this._getTileInfo()},setCulture:function(c){this.culture=c;this._getTileInfo()},
setBingMapsKey:function(c){this.bingMapsKey=c},onMapStyleChange:function(){}});m.mixin(f,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"roadOnDemand"});u("extend-esri")&&m.setObject("virtualearth.VETiledLayer",f,B);return f})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(f,m,g,r,c,u,v,z,B,x,y,p,t,A){function n(c,a){var d=[],e,k;if(c&&a&&(a.customLayerParameters||a.customParameters)){e=m.clone(a.customParameters||{});m.mixin(e,a.customLayerParameters||{});k=x.urlToObject(c);for(var h in k.query)e.hasOwnProperty(h)||d.push(h+"\x3d"+k.query[h]);c=k.path+(d.length?"?"+d.join("\x26"):"")}return c}f=f(t,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(f,a){a||(a={});this.urlTemplate=f=n(f,a.wmtsInfo);var d=new p(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new y({wkid:102100})),e=new p(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new y({wkid:102100}));this.initialExtent=a.initialExtent||d;this.fullExtent=a.fullExtent||e;this.tileInfo=a.tileInfo?a.tileInfo:new A({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new y(this.tileInfo.spatialReference.toJson());this.copyright=a.copyright||"";var k=new r(f),d=k.scheme+"://"+k.authority+"/";this.urlPath=f.substring(d.length);this.tileServers=a.tileServers||[];-1===k.authority.indexOf("{subDomain}")&&
this.tileServers.push(d);if(a.subDomains&&0<a.subDomains.length&&1<k.authority.split(".").length){this.subDomains=a.subDomains;var h;g.forEach(a.subDomains,function(a){-1<k.authority.indexOf("${subDomain}")?h=k.scheme+"://"+u.substitute(k.authority,{subDomain:a})+"/":-1<k.authority.indexOf("{subDomain}")&&(h=k.scheme+"://"+k.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(h)},this)}this.tileServers=g.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});
this._levelToLevelValue=[];var C=0;g.forEach(this.tileInfo.lods,function(a,d){this._levelToLevelValue[a.level]=a.levelValue||a.level;0===d&&(C=this._levelToLevelValue[a.level])},this);this._wmtsInfo=a.wmtsInfo;var q=m.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(c("chrome")){var d=this.getTileUrl(C,0,0),e=v.defaults.io,z="with-credentials"===e.useCors?x.canUseXhr(d,!0):-1;(e=-1<z?e.corsEnabledServers[z]:null)&&e.withCredentials?B({url:d,handleAs:"arraybuffer"}).addBoth(function(){q()}):
q()}else q()},getTileUrl:function(c,a,d){c=this._levelToLevelValue[c];var e=this.tileServers[a%this.tileServers.length]+u.substitute(this.urlPath,{level:c,col:d,row:a}),e=e.replace(/\{level\}/gi,c).replace(/\{row\}/gi,a).replace(/\{col\}/gi,d),e=this._appendCustomLayerParameters(e),e=this.addTimestampToURL(e);return x.addProxy(e)},_appendCustomLayerParameters:function(c){var a,d;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters))for(a in d=m.clone(this._wmtsInfo.customParameters||
{}),m.mixin(d,this._wmtsInfo.customLayerParameters||{}),d)c+=(-1===c.indexOf("?")?"?":"\x26")+a+"\x3d"+encodeURIComponent(d[a]);return c}});c("extend-esri")&&m.setObject("layers.WebTiledLayer",f,z);return f})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(f,m,g,r,c,u){f=f(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,
format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(c){var f=this.bbox||this.extent;c=(f=f&&c&&f._normalize(!0))?f.spatialReference.wkid||g.toJson(f.spatialReference.toJson()):null;var m=this.imageSpatialReference,f={bbox:f?f.xmin+","+f.ymin+","+f.xmax+","+f.ymax:null,bboxSR:c,size:null!==this.width&&null!==this.height?this.width+
","+this.height:null,imageSR:m?m.wkid||g.toJson(m.toJson()):c,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?g.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?g.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?g.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,
adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};c=this.timeExtent;f.time=c?c.toJson().join(","):null;return u.filter(f,function(c){if(null!==c&&void 0!==c)return!0})}});m.mixin(f,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});r("extend-esri")&&m.setObject("layers.ImageServiceParameters",
f,c);return f})},"widgets/BasemapGallery/utils":function(){define("dojo/_base/lang dojo/Deferred dojo/json dojo/_base/array dojo/promise/all esri/SpatialReference jimu/portalUtils jimu/shared/basePortalUrlUtils esri/request dojo/text!./esri_tileinfo.json".split(" "),function(f,m,g,r,c,u,v,z,B,x){function y(a){if(!a)return null;var d=a.indexOf("?");return 0===a.search(/http|\/\//)&&-1!==d?a.slice(0,d).replace(/\/*$/g,""):a}function p(a){return a?z.removeProtocol(y(a)):""}function t(a){var d=new m;
v.getPortalSelfInfo(a).then(f.hitch(this,function(e){var c=e.basemapGalleryGroupQuery;!0===e.useVectorBasemaps&&e.vectorBasemapGalleryGroupQuery&&(c=e.vectorBasemapGalleryGroupQuery);n.getBasemapGalleryGroup(a,c).then(f.hitch(this,function(a){a.queryItems({start:1,num:100,f:"json",q:v.webMapQueryStr}).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(){d.reject()}))}),f.hitch(this,function(){d.reject()}))}));return d}function A(a){return B({url:a,content:{f:"json"},handleAs:"json",
callbackParamName:"callback"}).then(function(a){return a},function(){return null})}var n={},w=g.parse(x);n._loadPortalBaseMaps=function(a,d){var e=new m,k=[];t(a).then(function(a){r.forEach(a.results,function(a){var e=new m,c=p(a.thumbnailUrl);k.push(e);a.getItemData().then(function(k){n._getBasemapSpatialReference(a,k).then(f.hitch(this,function(h){var q=k.baseMap.baseMapLayers;n.isBasemapCompatibleWithMap(h,q,d).then(f.hitch(this,function(d){d?e.resolve({layers:q,title:a.title||k.baseMap.title,
thumbnailUrl:c,spatialReference:h}):e.resolve({})}))}))})});c(k).then(function(a){a=r.filter(a,function(a){return a&&a.title?!0:!1},this);e.resolve(a)})},function(a){e.reject(a)});return e};n.isBasemapCompatibleWithMap=function(a,d,e){var c=new m,h=e.spatialReference,f=e.width>e.height?e.width:e.height;if(!h||!d||0>=d.length||!a||!h.equals(new u(+a.wkid)))return c.resolve(!1),c;0===e.getNumLevels()?"OpenStreetMap"===d[0].layerType||d[0].layerType&&-1<d[0].layerType.indexOf("BingMaps")||"WebTiledLayer"===
d[0].layerType||"VectorTileLayer"===d[0].layerType||"ArcGISImageServiceVectorLayer"===d[0].layerType||"ArcGISTiledImageServiceLayer"===d[0].layerType?c.resolve(!1):c.resolve(!0):d[0].layerType&&0===d[0].layerType.indexOf("ArcGIS")&&d[0].url?A(d[0].url).then(function(a){(d[0].serviceInfoResponse=a)&&a.tileInfo?c.resolve(n.tilingSchemeCompatible(e.__tileInfo,a.tileInfo,f)):a&&a.capabilities&&(0<=a.capabilities.indexOf("Map")||a.capabilities.indexOf("Image"))?c.resolve(!0):c.resolve(!1)}):"WMS"===d[0].layerType?
c.resolve(!0):n.isNoUrlLayerMap(d)||"VectorTileLayer"===d[0].layerType?c.resolve(n.tilingSchemeCompatible(e.__tileInfo,w,f)):c.resolve(n.tilingSchemeCompatible(e.__tileInfo,d[0].tileInfo,f));return c};n.tilingSchemeCompatible=function(a,d,e){if(a&&d){var c=!1,f=!1,g,q;for(g=0;g<a.lods.length;g++){var m=a.lods[g].scale;a.dpi!==d.dpi&&(m=a.lods[g].scale/a.dpi);for(q=0;q<d.lods.length;q++){var n=d.lods[q].scale;a.dpi!==d.dpi&&(n=d.lods[q].scale/d.dpi);if(Math.abs(n-m)/n<1/e)if(c){f=!0;break}else c=!0;
if(n<m)break}if(f)break}a=f?!0:!c||1!==a.lods.length&&1!==d.lods.length?!1:!0;return a}return!0};n.isSameBasemapLayer=function(a,d){var e,c;if(a.layerType&&d.layerType){if(a.layerType!==d.layerType)return!1;if("ArcGISImageServiceVectorLayer"===a.layerType||"ArcGISTiledImageServiceLayer"===a.layerType||"ArcGISTiledMapServiceLayer"===a.layerType||"ArcGISMapServiceLayer"===a.layerType||"ArcGISImageServiceLayer"===a.layerType)return e=p(a.url||""),c=p(d.url||""),e.toLowerCase()===c.toLowerCase();if("BingMapsAerial"===
a.layerType||"BingMapsRoad"===a.layerType||"BingMapsHybrid"===a.layerType||"OpenStreetMap"===a.layerType)return!0;if("VectorTileLayer"===a.layerType)return e=p(a.styleUrl||""),c=p(d.styleUrl||""),e.toLowerCase()===c.toLowerCase();if("WMS"===a.layerType)return e=p(a.mapUrl||""),c=p(d.mapUrl||""),e.toLowerCase()===c.toLowerCase();if("WebTiledLayer"===a.layerType){if(a.templateUrl&&d.templateUrl)return e=p(a.templateUrl||""),c=p(d.templateUrl||""),e.toLowerCase()===c.toLowerCase();if(a.wmtsInfo&&d.wmtsInfo)return e=
p(a.wmtsInfo.url||""),c=p(d.wmtsInfo.url||""),e.toLowerCase()===c.toLowerCase()}}else return e=p(a.url||""),c=p(d.url||""),e.toLowerCase()===c.toLowerCase();return!1};n.compareSameBasemapByOrder=function(a,d){var c=a.layers,f=d.layers;if(c.length!==f.length)return!1;for(var h=0;h<c.length;h++)if(!n.isSameBasemapLayer(c[h],f[h]))return!1;return!0};n.isBingMap=function(a){if(!a||!a.layers)return!1;for(var d=0;d<a.layers.length;d++)if("BingMapsAerial"===a.layers[d].type||"BingMapsRoad"===a.layers[d].type||
"BingMapsHybrid"===a.layers[d].type)return!0;return!1};n.isNoUrlLayerMap=function(a){for(var d=0;d<a.length;d++)if("BingMapsAerial"===a[d].type||"BingMapsRoad"===a[d].type||"BingMapsHybrid"===a[d].type||"OpenStreetMap"===a[d].type)return!0;return!1};n.getToken=function(a){a=v.getPortal(a);a.updateCredential();return a.credential?"?token\x3d"+a.credential.token:""};n.removeUrlQuery=function(a){return y(a)};n.getStanderdUrl=function(a){return p(a)};n.getUniqueTitle=function(a,d){if(!d||0===d.length)return a;
var c=r.filter(d,function(d){return d===a?!0:0===d.indexOf(a)?(d=d.substr(a.length+1),!isNaN(+d)):!1});if(0===c.length)return a;c=r.map(c,function(d){return d===a?0:+d.substr(a.length+1)});c=c.sort();return a+" "+(c[c.length-1]+1)};n.getBasemapInfo=function(a,d){var c,f;return v.getPortal(a).getItemById(d).then(function(a){c=a;return a.getItemData()}).then(function(a){f=a;return n._getBasemapSpatialReference(c,a)}).then(function(a){return{thumbnailUrl:c.thumbnailUrl,title:c.title||f.baseMap.title,
layers:f.baseMap.baseMapLayers,spatialReference:new u(a)}})};n.getBasemapGalleryGroup=function(a,d){var c=new m,k=v.getPortal(a),h=d.indexOf("esri_");if(0<=h){var h=d.slice(h,h+7),g="esri_"+dojoConfig.locale.slice(0,2);d=d.replace(h,g)}k.queryGroups({f:"json",q:d}).then(f.hitch(this,function(a){0<a.results.length?c.resolve(a.results[0]):c.reject()}),f.hitch(this,function(){c.reject()}));return c};n._getBasemapSpatialReference=function(a,d){var c=null,k=!1,h=new m;if(a.owner&&0===a.owner.indexOf("esri_")||
n.isNoUrlLayerMap(d.baseMap.baseMapLayers))c={wkid:"102100"};else if(d.spatialReference||a.spatialReference)c=d.spatialReference||a.spatialReference;else if(d.baseMap.baseMapLayers&&d.baseMap.baseMapLayers[0]){var g=d.baseMap.baseMapLayers[0];if(g.url&&0<g.url.indexOf("rest/services"))k=!0,A(d.baseMap.baseMapLayers[0].url).then(f.hitch(this,function(a){a&&a.spatialReference&&(c=a.spatialReference);h.resolve(c)}),function(a){console.error(a);h.resolve(null)});else if("VectorTileLayer"===g.layerType)c=
{wkid:"102100"};else if(g=g.fullExtent||g.initialExtent)c=g.spatialReference}k||h.resolve(c);return h};return n})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/BasemapGallery/esri_tileinfo.json":'{\r\n  "rows": 256,\r\n  "cols": 256,\r\n  "dpi": 96,\r\n  "compressionQuality": 75,\r\n  "origin": {\r\n   "x": -2.0037508342787E7,\r\n   "y": 2.0037508342787E7\r\n  },\r\n  "spatialReference": {\r\n   "wkid": 102100,\r\n   "latestWkid": 3857\r\n  },\r\n  "lods": [\r\n   {\r\n    "level": 0,\r\n    "resolution": 156543.03392800014,\r\n    "scale": 5.91657527591555E8\r\n   },\r\n   {\r\n    "level": 1,\r\n    "resolution": 78271.51696399994,\r\n    "scale": 2.95828763795777E8\r\n   },\r\n   {\r\n    "level": 2,\r\n    "resolution": 39135.75848200009,\r\n    "scale": 1.47914381897889E8\r\n   },\r\n   {\r\n    "level": 3,\r\n    "resolution": 19567.87924099992,\r\n    "scale": 7.3957190948944E7\r\n   },\r\n   {\r\n    "level": 4,\r\n    "resolution": 9783.93962049996,\r\n    "scale": 3.6978595474472E7\r\n   },\r\n   {\r\n    "level": 5,\r\n    "resolution": 4891.96981024998,\r\n    "scale": 1.8489297737236E7\r\n   },\r\n   {\r\n    "level": 6,\r\n    "resolution": 2445.98490512499,\r\n    "scale": 9244648.868618\r\n   },\r\n   {\r\n    "level": 7,\r\n    "resolution": 1222.992452562495,\r\n    "scale": 4622324.434309\r\n   },\r\n   {\r\n    "level": 8,\r\n    "resolution": 611.4962262813797,\r\n    "scale": 2311162.217155\r\n   },\r\n   {\r\n    "level": 9,\r\n    "resolution": 305.74811314055756,\r\n    "scale": 1155581.108577\r\n   },\r\n   {\r\n    "level": 10,\r\n    "resolution": 152.87405657041106,\r\n    "scale": 577790.554289\r\n   },\r\n   {\r\n    "level": 11,\r\n    "resolution": 76.43702828507324,\r\n    "scale": 288895.277144\r\n   },\r\n   {\r\n    "level": 12,\r\n    "resolution": 38.21851414253662,\r\n    "scale": 144447.638572\r\n   },\r\n   {\r\n    "level": 13,\r\n    "resolution": 19.10925707126831,\r\n    "scale": 72223.819286\r\n   },\r\n   {\r\n    "level": 14,\r\n    "resolution": 9.554628535634155,\r\n    "scale": 36111.909643\r\n   },\r\n   {\r\n    "level": 15,\r\n    "resolution": 4.77731426794937,\r\n    "scale": 18055.954822\r\n   },\r\n   {\r\n    "level": 16,\r\n    "resolution": 2.388657133974685,\r\n    "scale": 9027.977411\r\n   },\r\n   {\r\n    "level": 17,\r\n    "resolution": 1.1943285668550503,\r\n    "scale": 4513.988705\r\n   },\r\n   {\r\n    "level": 18,\r\n    "resolution": 0.5971642835598172,\r\n    "scale": 2256.994353\r\n   },\r\n   {\r\n    "level": 19,\r\n    "resolution": 0.29858214164761665,\r\n    "scale": 1128.497176\r\n   },\r\n   {\r\n    "level": 20,\r\n    "resolution": 0.14929107082380833,\r\n    "scale": 564.248588\r\n   },\r\n   {\r\n    "level": 21,\r\n    "resolution": 0.07464553541190416,\r\n    "scale": 282.124294\r\n   },\r\n   {\r\n    "level": 22,\r\n    "resolution": 0.03732276770595208,\r\n    "scale": 141.062147\r\n   },\r\n   {\r\n    "level": 23,\r\n    "resolution": 0.01866138385297604,\r\n    "scale": 70.5310735\r\n   }\r\n  ]\r\n }',
"url:widgets/BasemapGallery/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"basemapGalleryDiv" \x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n\r\n',"url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemapgallery {height: 100%;}.jimu-widget-basemapgallery .esriBasemapGalleryNode:hover{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {border: 1px solid #fff; margin: 1px; -moz-box-shadow: 0px 0px 0px #000; -webkit-box-shadow: 0px 0px 0px #000; box-shadow: 0px 0px 7px #000;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode{color: #51B1FE;}.jimu-widget-basemapgallery .esriBasemapGalleryLabelContainer{padding-top: 2px;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail{width: 100px; height: 67px;}.jimu-widget-basemapgallery .esriBasemapGallerySelectedNode .esriBasemapGalleryThumbnail{border-color: #51B1FE !important;}.jimu-widget-basemapgallery .esriBasemapGalleryNode {width: 85px; margin: 5px 10px 0 10px;}.jimu-rtl .jimu-widget-basemapgallery .esriBasemapGalleryNode {float: right;}.jimu-widget-basemapgallery .esriBasemapGalleryThumbnail {display: block; margin: 1px auto;}",
"*now":function(f){f(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/Deferred jimu/BaseWidget jimu/portalUtils jimu/PanelManager jimu/portalUrlUtils jimu/utils esri/dijit/Basemap esri/dijit/BasemapLayer esri/dijit/BasemapGallery dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/on dojo/promise/all ./utils jimu/dijit/LoadingIndicator".split(" "),function(f,m,g,r,c,u,v,z,B,x,y,p,t,A,n,w,a,d){return f([r,m],{name:"BasemapGallery",baseClass:"jimu-widget-basemapgallery",basemapGallery:null,spatialRef:null,
startup:function(){this.inherited(arguments);this.initBasemaps()},resize:function(){this._responsive()},_responsive:function(){setTimeout(p.hitch(this,function(){var a=n("#"+this.id)[0],a=A.getStyle(a,"width"),d=parseInt(a/105,10);if(0<d){var c=parseInt(a%105/d,10);n(".esriBasemapGalleryNode",this.id).forEach(function(a){A.setStyle(a,"width",85+c+"px")})}}),100)},initBasemaps:function(){var e,f,h=p.clone(this.config.basemapGallery);this.loadingShelter.show();1===h.mode?e=d._loadPortalBaseMaps(this.appConfig.portalUrl,
this.map):(e=new g,e.resolve(h.basemaps));f=c.getPortal(this.appConfig.portalUrl).loadSelfInfo();a({portalSelf:f,basemaps:e}).then(p.hitch(this,function(a){for(var c=a.basemaps,e=[],f=0,g=this._getWebmapBasemap(),c=t.filter(c,function(c){if(!c||!c.title)return!1;var e;e=d.isBingMap(c)?a.portalSelf.bingKey?!0:!1:!0;return c.title&&e},this),f=0;f<c.length&&!d.compareSameBasemapByOrder(c[f],g);f++);f===c.length&&c.push(g);for(f=0;f<c.length;f++){for(var g=c[f].layers.length,k=[],m=0;m<g;m++)k.push(new x(c[f].layers[m]));
c[f].layers=k;c[f].thumbnailUrl?/^(https?:)?\/\//.test(c[f].thumbnailUrl)?c[f].thumbnailUrl+=d.getToken(this.appConfig.portalUrl):c[f].thumbnailUrl=z.processUrlInWidgetConfig(c[f].thumbnailUrl,this.folderUrl):c[f].thumbnailUrl=this.folderUrl+"images/default.jpg";e.push(new B(c[f]))}h.map=this.map;this.appConfig.portalUrl&&(h.portalUrl=this.appConfig.portalUrl);h.basemaps=e;h.showArcGISBasemaps=!1;h.bingMapsKey=a.portalSelf.bingKey;this.basemapGallery=new y(h,this.basemapGalleryDiv);this.basemapGallery.startup();
this.own(w(this.basemapGallery,"selection-change",p.hitch(this,this.selectionChange)));this._responsive();this.loadingShelter.hide()}))},_getWebmapBasemap:function(){var a;a=this.map.itemInfo.item.thumbnail?v.getItemUrl(this.appConfig.portalUrl,this.map.itemInfo.item.id)+"/info/"+this.map.itemInfo.item.thumbnail:null;return{title:this.map.itemInfo.itemData.baseMap.title,thumbnailUrl:a,layers:this.map.itemInfo.itemData.baseMap.baseMapLayers,spatialReference:this.map.spatialReference}},selectionChange:function(){this.updateExtent();
"widgetOnScreen"===this.gid&&u.getInstance().closePanel(this.id+"_panel")},updateExtent:function(){if(0<this.map.getNumLevels()){var a=this.basemapGallery.getSelected().getLayers(),c=this.map.__tileInfo.lods[this.map.getLevel()],d;if(0<a.length&&(a=a[0],(d=a.tileInfo||a.serviceInfoResponse&&a.serviceInfoResponse.tileInfo)&&c)){var f=c.scale/this.map.__tileInfo.dpi,g;t.forEach(d.lods,function(a){a=a.scale/d.dpi;if(!g||Math.abs(a-f)<Math.abs(g-f))g=a});Math.abs(g-f)/f>1/this.map.width&&this.map.setScale(g*
d.dpi)}}}})});