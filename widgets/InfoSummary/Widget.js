// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(T,K,x,n,a,m,q,u){function U(a,c){this.start=a;this.end=c}function l(a,c,f){this.start=a;this.end=c;this.units=f}function g(a,c){this.start=a;this.end=c;this.temp=new n}function A(a){this.values=a;this.length=a.length}function H(a,c){this.values=a;this.def=c?c:{}}function Q(a,c){this.stack=a;this.original=c}function t(a,
c,f,l){if(a.values)return new A(a.values);var B,z;z=a.start?K.normalizeColor(a.start):B=c?f?c[f]:c:l;a.end?a=K.normalizeColor(a.end):(B||(B=c?f?c[f]:c:l),a=B);return new g(z,a)}var E=K.fx={};U.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};l.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};g.prototype.getValue=function(a){return n.blendColors(this.start,this.end,a,this.temp)};A.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*
this.length),this.length-1)]};H.prototype.getValue=function(a){var c=T.clone(this.def),f;for(f in this.values)c[f]=this.values[f].getValue(a);return c};Q.prototype.getValue=function(g){var c=[];a.forEach(this.stack,function(f){if(f instanceof x.Matrix2D)c.push(f);else if("original"==f.name&&this.original)c.push(this.original);else if("matrix"==f.name){if(f.start instanceof x.Matrix2D&&f.end instanceof x.Matrix2D){var l=new x.Matrix2D,B;for(B in f.start)l[B]=(f.end[B]-f.start[B])*g+f.start[B];c.push(l)}}else f.name in
x&&(l=x[f.name],"function"!=typeof l?c.push(l):(B=a.map(f.start,function(a,c){return(f.end[c]-a)*g+a}),l=l.apply(x,B),l instanceof x.Matrix2D&&c.push(l)))},this);return c};var F=new n(0,0,0,0);E.animateStroke=function(a){a.easing||(a.easing=m._defaultEasing);var c=new m.Animation(a),f=a.shape,g;q.connect(c,"beforeBegin",c,function(){g=f.getStroke();var c=a.color,l={},m;c&&(l.color=t(c,g,"color",F));(c=a.style)&&c.values&&(l.style=new A(c.values));if(c=a.width){var z=c,n=g;z.values?m=new A(z.values):
(c=z.start?z.start:m=n?n.width:1,z.end?m=z.end:"number"!=typeof m&&(m=n?n.width:1),m=new U(c,m));l.width=m}(c=a.cap)&&c.values&&(l.cap=new A(c.values));if(c=a.join)c.values?l.join=new A(c.values):(m=c.start?c.start:g&&g.join||0,c=c.end?c.end:g&&g.join||0,"number"==typeof m&&"number"==typeof c&&(l.join=new U(m,c)));this.curve=new H(l,g)});q.connect(c,"onAnimate",f,"setStroke");return c};E.animateFill=function(a){a.easing||(a.easing=m._defaultEasing);var c=new m.Animation(a),f=a.shape,g;q.connect(c,
"beforeBegin",c,function(){g=f.getFill();var c=a.color;c&&(this.curve=t(c,g,"",F))});q.connect(c,"onAnimate",f,"setFill");return c};E.animateFont=function(a){a.easing||(a.easing=m._defaultEasing);var c=new m.Animation(a),f=a.shape,g;q.connect(c,"beforeBegin",c,function(){g=f.getFont();var c=a.style,m={},n,q;c&&c.values&&(m.style=new A(c.values));(c=a.variant)&&c.values&&(m.variant=new A(c.values));(c=a.weight)&&c.values&&(m.weight=new A(c.values));(c=a.family)&&c.values&&(m.family=new A(c.values));
(c=a.size)&&c.units&&(n=parseFloat(c.start?c.start:f.font&&f.font.size||"0"),q=parseFloat(c.end?c.end:f.font&&f.font.size||"0"),m.size=new l(n,q,c.units));this.curve=new H(m,g)});q.connect(c,"onAnimate",f,"setFont");return c};E.animateTransform=function(g){g.easing||(g.easing=m._defaultEasing);var c=new m.Animation(g),f=g.shape,l;q.connect(c,"beforeBegin",c,function(){l=f.getTransform();this.curve=new Q(g.transform,l)});q.connect(c,"onAnimate",f,"setTransform");if("svg"===K.renderer&&(9<=u("ie")||
u("ff")))var n=[q.connect(c,"onBegin",c,function(){for(var a=f.getParent();a&&a.getParent;)a=a.getParent();a&&(f.__svgContainer=a.rawNode.parentNode,f.__svgRoot=a.rawNode,f.__svgRoot&&f.__svgRoot.getAttribute&&(f.__svgWidth=parseInt(f.__svgRoot.getAttribute("width"),10),isNaN(f.__svgWidth)&&delete f.__svgWidth))}),q.connect(c,"onAnimate",c,function(){try{if(f.__svgContainer){var a=f.__svgContainer.style.visibility;f.__svgContainer.style.visibility="visible";f.__svgContainer.style.visibility=a;var c=
f.__svgWidth;if(!isNaN(c))try{f.__svgRoot.setAttribute("width",c-5E-6),f.__svgRoot.setAttribute("width",c)}catch(V){}}}catch(V){}}),q.connect(c,"onEnd",c,function(){a.forEach(n,q.disconnect);if(f.__svgContainer){var c=f.__svgContainer;if(null==c.getAttribute("__gotVis")){c.setAttribute("__gotVis",!0);var g=f.__svgContainer.style.visibility,l=f.__svgRoot,m=f.__svgWidth;c.style.visibility="visible";setTimeout(function(){try{c.style.visibility=g;c.removeAttribute("__gotVis");c=null;try{isNaN(m)||(l.setAttribute("width",
m-5E-6),l.setAttribute("width",m))}catch(S){}}catch(S){}},100)}}delete f.__svgContainer;delete f.__svgRoot;delete f.__svgWidth})];return c};return E})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(T,K,x,n,a,m,q,u,U,l,g,A,H,Q,t,E,F,z,c,f,Z,B,X,R,V,D,S,Y){return T("ClusterLayer",[Q,A],{constructor:function(k){this.clusterGraphics=[];this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=void 0;this.hidePanel=k.hidePanel;this._parent=k._parent;if(this._parentLayer=k.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=k.name;this._map=k.map;this.color=a.fromString(k.color||"#ff0000");
this._styleColor=k._styleColor;this.symbolData=k.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=k.lyrInfo.itemId;this.refresh=k.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=k.node;this.countEnabled=k.countEnabled;this.legendNode=k.legendNode;this.id=k.id;this.infoTemplate=k.infoTemplate;this.url=k.lyrInfo.url;this._testRenderer=k.lyrInfo.renderer;(this.originOperLayer=k.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);
this.lyrInfo=k.lyrInfo;this.lyrType=k.lyrType;this.filter=k.filter;this.showAllFeatures=k.showAllFeatures;this.listDisabled=k.listDisabled;this.selfType=k.selfType;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(n.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(a){var k=new R;k.geometry=this.showAllFeatures?a.fullExtent:this._map.extent;a.queryCount?a.queryCount(k,n.hitch(this,
function(k){if(0<k)this.hidePanel||(this.nodeCount=k),this._initFeatures(this._parentLayer);else if(!this.hidePanel){this.nodeCount=0;var c=new Y(a.url);g(c,"load",n.hitch(this,function(){this.countFeatures(c)}))}})):this._initFeatures(this._parentLayer)},_initFeatures:function(a){this._features=[];var k=!0,c=new R;-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||null===this.url?(this._getSourceFeatures(a.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):
(c.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1",c.outFields=["*"],c.returnGeometry=!0,a.queryFeatures?a.queryFeatures(c).then(n.hitch(this,function(a){a.features&&(this._getSourceFeatures(a.features),this.clusterFeatures())})):k="error");"error"!==k&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",n.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",n.hitch(this,this.handleClick))))},_getSourceFeatures:function(a){this._features=
[];for(var k=0;k<a.length;k++){var c=a[k];c.geometry&&this._features.push(c)}},_getInfoTemplate:function(a){a=a.parentLayerInfo?a.parentLayerInfo:a;if(a.controlPopupInfo&&(a=a.controlPopupInfo.infoTemplates)){if(this.url){var k=this.url.split("/").pop();k&&(a.indexOf?-1<a.indexOf(k)&&(this.infoTemplate=a[k].infoTemplate):a.hasOwnProperty(k)&&(this.infoTemplate=a[k].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==
typeof this.infoTemplate.info){var a=this.infoTemplate.info.fieldInfos;if(a)for(var c=0;c<a.length;c++)a[c].visible&&this._fieldNames.push(a[c].fieldName)}if(this.symbolData.featureDisplayOptions&&0<this.symbolData.featureDisplayOptions.fields.length)for(a=0;a<this.symbolData.featureDisplayOptions.fields.length;a++)c=this.symbolData.featureDisplayOptions.fields[a],-1===this._fieldNames.indexOf(c.name)&&this._fieldNames.push(c.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(a){this.lyrInfo=
a},clearSingles:function(a){K.forEach(a||this._singles,function(a){this.remove(a)},this);this._singles.length=0},_getSingleGraphic:function(a){a=new t(new F(a.geometry.x,a.geometry.y,this._map.spatialReference),null,a.attributes);a.setSymbol(this._singleSym);return a},_addSingles:function(a){K.forEach(a,function(a){a=this._getSingleGraphic(a);this._singles.push(a);this._showSingles&&this.add(a)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(a){if(!this.hidePanel){var c=
new R;c.returnGeometry=!1;c.geometry=this.showAllFeatures?null:this._map.extent;c.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1";(new V(a)).executeForIds(c).then(n.hitch(this,function(a){var c;this.node?(u.contains(this.node,"searching")&&u.remove(this.node,"searching"),this.node.innerHTML=a?H.localizeNumber(a.length):0,c=this.node.parentNode):this.legendNode&&(c=this.legendNode.previousSibling);this.updateExpand(c,a?!1:!0)}))}},updateExpand:function(a,c){if(!this.hidePanel&&"undefined"!==
typeof a){var k;-1<a.id.indexOf("rec_")&&(k=a.id.replace("rec_",""),k=U.byId("exp_"+k));c?(a&&(m.addClass(a,"recDefault"),m.addClass(a,"inActive")),k&&m.addClass(k,"expandInActive")):(a&&(m.removeClass(a,"recDefault"),m.removeClass(a,"inActive")),k&&m.removeClass(k,"expandInActive"))}},loadData:function(a){if(0<a.length){this.initalCount(a);var c=new R;c.where="1\x3d1";!this.showAllFeatures&&this.filter&&(c.where=this.filter);c.returnGeometry=!1;this.queryPending=!0;(new V(a)).executeForIds(c).then(n.hitch(this,
function(c){if(c){this.queryIDs=c;c=[];var k,g;k=0;for(g=this.queryIDs.length;k<g;k+=1E3){var f=this.queryIDs.slice(k,k+1E3),l=new R;l.outFields=["*"];l.objectIds=f;l.returnGeometry=!0;l.outSpatialReference=this._map.spatialReference;f=new V(a);c.push(f.execute(l))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new q(c)).then(n.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var c=this._map.spatialReference,
k=[],b=0;b<a.length;b++)if(a[b][1].features)for(var h=0;h<a[b][1].features.length;h++){var d=a[b][1].features[h];if("undefined"!==typeof d.geometry&&null!==d.geometry&&d.geometry){var e=new F(d.geometry.x,d.geometry.y,c),e=new t(e);e.setAttributes(d.attributes);this.infoTemplate&&e.setInfoTemplate(this.infoTemplate);k.push(e)}}a=!0;1E4>k&&(a=JSON.stringify(this._features)!==JSON.stringify(k));a&&(this._features=k,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},
handleClick:function(a){var c=[];if(a.graphic&&(c=a.graphic,c.attributes)){var k=c.attributes;k.Data&&1<k.Data.length?(this.clearSingles(this._singles),c=k.Data,a.stopPropagation(),this._addSingles(c)):k.Data&&1===k.Data.length?(k.Data[0].symbol=c.symbol,this._map.infoWindow.setFeatures([k.Data[0]])):this._map.infoWindow.setFeatures([c])}this.infoTemplate&&this._map.infoWindow.show(a.mapPoint);x.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();else if(a.delta){a=
a.delta;var c=Math.abs(a.y);(50<Math.abs(a.x)||50<c)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;"undefined"===typeof this.updateFeatures&&(this.updateFeatures=a);var c=!0;1E4>a.length&&(c=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(c){this.requiresReload=!0;this._features=[];this._parentLayer.clear();var c=this._parentLayer.spatialReference,k;this._parentLayer.renderer?k=this._parentLayer.renderer:this._testRenderer&&(k=this._testRenderer);
for(var g=0;g<a.length;g++){var f=a[g];if(f.geometry){var l=new t(this.getGraphicOptions(f,c,k));l.setAttributes(f.attributes);this.infoTemplate&&l.setInfoTemplate(this.infoTemplate);l.setSymbol(k.getSymbol(l));this._parentLayer.add(l);this._features.push(l)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,c,g){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:c.wkid}}}:
"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.points?{geometry:{points:a.geometry.points,spatialReference:{wkid:c.wkid}}}:{geometry:new F(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:g.symbol}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},flashSingle:function(k){if("undefined"===typeof k.symbol){var g=new f(f.STYLE_NULL,new a(0,0,0,0),0),l=this.color.toRgb();
k.setSymbol(new c(c.STYLE_CIRCLE,9,g,new a([l[0],l[1],l[2],.5])))}this.flashGraphics([k])},flashGraphics:function(a){for(var c=0;c<a.length;c++)this._flashFeature(a[c]);setTimeout(n.hitch(this,this._clearFeatures),1100)},_flashFeature:function(k){var g;if(k.geometry){var m=a.fromHex(this._styleColor),aa=n.clone(m);aa.a=.4;"undefined"!==typeof k.symbol&&(g=new c(c.STYLE_CIRCLE,k.symbol.size,new f(f.STYLE_SOLID,m,1),aa))}"undefined"!==typeof g&&(k=new t(k.geometry,g),this._map.graphics.add(k),g=k.getDojoShape())&&
(l.animateStroke({shape:g,duration:700,color:{start:g.strokeStyle.color,end:g.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,k))},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(a){a.getLayer().remove(a)},setColor:function(a){this.color=a},setStyleColor:function(a){this._styleColor=a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&
(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var a=this._features,c=0;if("undefined"!==typeof a){if(0<a.length&&(this.visible||this.requiresReload)){var g=this.clusterSize;this.clusterGraphics=[];for(var f=this._map.spatialReference,l=this._map.extent,m=new F(l.xmin,
l.ymax,f),n=Math.ceil(this._map.height/g),r=Math.ceil(this._map.width/g),q=l.getWidth()/this._map.width*g,g=l.getHeight()/this._map.height*g,l=0;l<n;l++)for(var u=0;u<r;u++){var b=m.x+q*u,h=m.y-g*l,h=new E(b,h-g,b+q,h,f),b=[],d;for(d in a){var e=a[d];h.contains(e.geometry)&&(c+=1,b.push(e))}0<b.length&&(h=this.getClusterCenter(b),this.clusterGraphics.push({center:h,graphics:b}))}for(var p in this.clusterGraphics){f=this.clusterGraphics[p];m=f.graphics.length;n=f.graphics;d=H.localizeNumber(m);q=r=
19*d.length;r+=5;g=new B;g.family="Arial";g.size="16px";d=new Z(d,g,this.countColor);d.setOffset(0,-4);var y;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?y=this.symbolData.symbol.size:this.symbolData.symbol.width&&(y=this.symbolData.symbol.width,g=this.symbolData.symbol.height,y=y>=g?y:g):this.icon.width?(r=this.icon.width>=r?this.icon.width+5:r,r=this.icon.height>=r?this.icon.height+5:r,q=this.icon.width>=q?this.icon.width+1:q,q=this.icon.height>=q?this.icon.height+1:q):this.icon.size&&
(y=this.icon.size);y&&(r=y>=r?y+5:r,q=y>=q?y+1:q);q>=r&&(r+=0===q-r?4:q-r+5);this._setSymbols(r+15,r);n={Count:m,Data:n};1<m?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new t(f.center,this.csym,n)),this.displayFeatureCount?this.add(new t(f.center,d,n)):this.add(new t(f.center,this.csym3,n))):(this.add(new t(f.center,this.csym,n)),this.displayFeatureCount?this.add(new t(f.center,d,n)):this.add(new t(f.center,this.psym,n))):(this.add(new t(f.center,this.csym,
n)),this.displayFeatureCount?this.add(new t(f.center,d,n)):this.add(new t(f.center,this.psym,n))):(f=f.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(f=new t(f,null,n.Data[0].attributes,this.infoTemplate),f.setSymbol(this.renderer.getSymbol(f))):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?(f=new t(f,null,n.Data[0].attributes,this.infoTemplate),f.setSymbol(D.fromJson(this.renderer.symbol))):
f="EsriSymbol"===this.symbolData.symbolType?new t(f,D.fromJson(this.symbolData.symbol),n,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new t(f,this.psym,n,this.infoTemplate):this.renderer.symbol?new t(f,this.renderer.symbol,n,this.infoTemplate):new t(f,this.psym,n,this.infoTemplate),"undefined"!==typeof f&&this.add(f)))}}this._updateNode(this.showAllFeatures?a.length:c)}},_getSym:function(a){var c;this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?
c=this.renderer.getSymbol(a):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?c=this.renderer.symbol:"EsriSymbol"===this.symbolData.symbolType?c=this.symbolData.symbol:this.symbolData.symbol&&(c=this.symbolData.symbol);return c},_updateNode:function(a){if(!this.hidePanel){var c;this.node?(this.node.innerHTML=H.localizeNumber(a?a:0),c=this.node.parentNode):this.legendNode&&(c=this.legendNode.previousSibling);this.updateExpand(c,a&&0<a&&this.visible?!1:!0)}},_updatePanelTime:function(a){if(!this.hidePanel){this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e";var c="";""!==this.config.mainPanelText&&(c=this.config.mainPanelText+" ");this.pageTitle.innerHTML=c+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}},_setSymbols:function(g,l){var k=this.color.toRgb(),m,q,u;if("undefined"!==typeof this.symbolData){var t;"custom"===this.backgroundClusterSymbol?t=k:(m=D.fromJson(this.backgroundClusterSymbol),0===m.outline.color.a||0===m.outline.width?
(q=f.STYLE_NULL,u=0):(q=f.STYLE_SOLID,u=m.outline.width));m?(k=f(q,m.outline.color,u),t=m.color.toRgb(),this.csym=new c(c.STYLE_CIRCLE,g,k,new a([t[0],t[1],t[2],.75]))):this.csym=new c(c.STYLE_CIRCLE,g,null,new a([t[0],t[1],t[2],.75]));(k=this.symbolData.s)&&-1<k.indexOf("${appPath}")?(k=window.location.pathname.replace("index.html",""),k=this.symbolData.s.replace("${appPath}",window.location.origin+k)):k=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(k&&"CustomIcon"===this.symbolData.iconType){var r,
x;this.symbolData.symbol&&this.symbolData.symbol.height&&(r=this.symbolData.symbol.height);this.symbolData.symbol&&this.symbolData.symbol.width&&(x=this.symbolData.symbol.width);r&&x?x=r=x>r?x:r:(r=this.symbolData.icon.height?this.symbolData.icon.height:l,x=this.symbolData.icon.width?this.symbolData.icon.width:l);this.psym=new z(k,r,x)}else k&&"LayerIcon"===this.symbolData.iconType?this.psym=D.fromJson(this.symbolData.symbol):"esriPMS"===this.icon.type?this.psym=this.icon:(r=f(this.icon.outline.style,
this.icon.outline.color,this.icon.outline.width),this.psym=new c(this.icon.style,this.icon.size,r,this.icon.color));this.csym2=n.clone(this.psym);this.csym3=n.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else r=new f(f.STYLE_NULL,new a(0,0,0,0),0),this.csym=new c(c.STYLE_CIRCLE,g,r,new a([k[0],k[1],k[2],.5])),this.psym=new z(this.icon.url,g-10,g-10),this.psym2=new z(this.icon.url,l-7,l-7),r=new f(f.STYLE_NULL,
new a(0,0,0,0),0),this.csym2=new c(c.STYLE_CIRCLE,l,r,new a([k[0],k[1],k[2],.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer.toJson?this._parentLayer.renderer:S.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=
S.fromJson(this._testRenderer):this.symbolData.renderer&&(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:S.fromJson(this.symbolData.renderer)):this.renderer=new X(D.fromJson(this.symbolData.symbol));var g=this.color.toRgb(),l=new f(f.STYLE_NULL,new a(0,0,0,0),0);this._singleSym=new c(c.STYLE_CIRCLE,9,l,new a([g[0],g[1],g[2],.5]))}},getLayer:function(){return this},getClusterCenter:function(a){var c=0,g=0,f=a.length;K.forEach(a,function(a){c+=a.geometry.x;g+=a.geometry.y},this);
return new F(c/f,g/f,a[0].geometry.spatialReference)},destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.url&&this.loadData(this.url)}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page" data-dojo-attach-point\x3d"panelPage"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody roundedBottom" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; min-height: 100%; overflow: visible;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .page-dart {position: relative; width: 360px; margin-left: 0; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent-dart {left: 10px; right: 10px; top: 5px; overflow: visible; display: block; background-color: #4c4c4c;}.jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px; color: whitesmoke; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px; color: whitesmoke; background-color: #4c4c4c;}.jimu-widget-InfoSummary .featureItem-dart:hover {background-color: black;}.jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right; background-color: #4c4c4c;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table; color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5); color: whitesmoke;}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .groupField-dart {text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 5px; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .groupField-dart {text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 5px; background-color: #4c4c4c;}.jimu-widget-InfoSummary .groupFieldImage-dart {text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 20px; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage-dart {text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 20px; background-color: #4c4c4c;}.jimu-widget-InfoSummary .groupCountLabel-dart {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel-dart {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px; background-color: #4c4c4c;}.jimu-widget-InfoSummary .expandImageContainer-dart {width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px; background-color: #4c4c4c;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer-dart {width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px; background-color: #4c4c4c;}.jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart{background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart{background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor: pointer; background-color: #4c4c4c;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover{background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart{background-color: black;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 20px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 20px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .featureItem:hover{background-color: lightgray;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .roundedBottom {-moz-border-radius: 0 0 5px 5px; -webkit-border-radius: 0 0 5px 5px; border-radius: 0 0 5px 5px;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: auto; margin-top: 0px; z-index: 300;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; overflow: visible; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 210px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 190px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .pageClose {position: absolute; left: 0px; top: 0px; background: url(../images/x.png) no-repeat 50% 50%; cursor: pointer; width: 30px; height: 30px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 190px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 210px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 190px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; height: auto;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity: 0.8; filter: alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {opacity: 0.8; filter: alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px;}.jimu-widget-InfoSummary .inActive {opacity: 0.6; filter: alpha(opacity\x3d60);}.jimu-widget-InfoSummary .lightThemeColor {color: #000000;}.jimu-widget-InfoSummary .darkThemeColor {color: whitesmoke;}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 35px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 35px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 55px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 55px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageLabel {padding-top: 10px; color: whitesmoke; font-size: 17px; text-align: center;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: left;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {width: 20px; height: 20px; display: block; float: right;}.jimu-widget-InfoSummary .expandArrow {width: 100%; height: 20px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor: pointer; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expandSearching-empty {background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 50%; display: block; width: 50px; height: 9px;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching-empty {background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 50%; display: block; width: 50px; height: 9px;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expand-empty {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 50%; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-empty {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 50%; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent{} .jimu-widget-InfoSummary .pageHeader{position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 50px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 50px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%; margin-top: 0px; z-index: 300;} .jimu-widget-InfoSummary .pageContent {position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; overflow: visible; display: block; background-color: rgba(255,255,255,1);} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 35px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 65px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; top: 25px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity: 0.3; filter: alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 35px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; background-color: white;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 65px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto; overflow-y: auto; background-color: white;}}",
"*now":function(T){T(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/DeferredList dojo/Deferred dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(T,
K,x,n,a,m,q,u,U,l,g,A,H,Q,t,E,F,z,c,f,Z,B,X,R,V,D,S,Y,k,W,ga,aa,ba,ca,ea,r,fa,da){return U([T,Z],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],row:null,postCreate:function(){this.inherited(arguments);this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=this.config.layerInfos;this.layerList=
{};this._initWidget()},_orientationChange:function(){},inPanelOverrides:function(b){b=(this.isDartTheme="DartTheme"===b)?!0:!1;this.isDartTheme?a.contains(this.pageContent,"pageContent")&&a.remove(this.pageContent,"pageContent"):a.contains(this.pageContent,"pageContent-dart")&&a.remove(this.pageContent,"pageContent-dart");a.add(this.pageContent,b?"pageContent-dart":"pageContent")},addResizeOrientationHandlers:function(){"undefined"===typeof this.resizeHandler&&(this.resizeHandler=q(this.map,"resize",
l.hitch(this,this._windowResize)));window.hasOwnProperty("matchMedia")&&window.matchMedia("(orientation: portrait)").addListener(l.hitch(this,this._orientationChange))},removeResizeOrientationHandlers:function(){"undefined"!==typeof this.resizeHandler&&(this.resizeHandler.remove(),this.resizeHandler=void 0);window.hasOwnProperty("matchMedia")&&window.matchMedia("(orientation: portrait)").removeListener(l.hitch(this,this._orientationChange))},startup:function(){this.inherited(arguments);this.hidePanel||
this.showAllFeatures?this.showAllFeatures&&this._mapExtentChange():(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.addResizeOrientationHandlers()},onOpen:function(){this.hidePanel||this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);var b=[],h;for(h in this.layerList){var d=this.layerList[h],e=d.li,p=d.layerObject;if(e&&e.orgRenderer){if(p.setRenderer)p.setRenderer(e.newRenderer);
else if(p.setLayerDrawingOptions){var a=[],c=new da;c.renderer=e.newRenderer;a[e.subLayerId]=c;p.setLayerDrawingOptions(a)}else console.log("Error setting the new renderer...will use the default rendering of the layer");p.refresh()}var v;p&&p.layerInfos?v=p:e&&"undefined"!==typeof e.parentLayerID&&(v=this.map.getLayer(e.parentLayerID));if(v&&v.visibleLayers){p=!1;a=0;a:for(;a<b.length;a++)if(b[a].id===v.id){p=!0;break a}0!==b.length&&p||b.push({id:v.id,layers:v.visibleLayers});p=0;p;a:for(;p<b.length;p++)if(b[p].id===
v.id)break a;a=b[p].layers;if(v.layerInfos){if(0<v.layerInfos.length&&e&&"undefined"!==typeof e.subLayerId){var c=-1<a.indexOf(e.subLayerId),g=d.parentLayerVisible,f=d.layerObject.parentLayerVisible;"ClusterLayer"===d.type&&(c||g||f)?(d.parentLayerVisible=!0,d.layerObject.parentLayerVisible=!0,d.visible=!0,c&&a.splice(a.indexOf(e.subLayerId),1)):c||g?(d.parentLayerVisible=!0,d.visible=!0,-1===a.indexOf(e.subLayerId)&&a.push(e.subLayerId)):(d.parentLayerVisible=!1,d.visible=!1,c&&a.splice(a.indexOf(e.subLayerId),
1),"ClusterLayer"===d.type&&(d.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(d.id)&&(e=this.map.getLayer(d.id),e.setVisibility(!1))))}b[p].layers=a}this.updatePanelVisibility(d,h,d)}else p&&("ClusterLayer"===d.type&&p._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(d.id)&&(e=this.map.getLayer(d.id),"undefined"===typeof d.layerObject.parentLayerVisible&&(d.parentLayerVisible=p._parentLayer.visible,d.layerObject.parentLayerVisible=p._parentLayer.visible),e.setVisibility(d.layerObject.parentLayerVisible)),
p._parentLayer.setVisibility&&p._parentLayer.setVisibility(!1)),this.updatePanelVisibility(p,h,d));this.showAllFeatures&&this.config.expandList&&d.legendOpen&&!d.isLoaded&&(e=this._inVisibleRange(d,h),d.visible&&e&&(d.updateList=!0))}for(h=0;h<b.length;h++)(d=this.map.getLayer(b[h].id))&&d.setVisibleLayers(b[h].layers);this.hidePanel||this.showAllFeatures||"undefined"!==typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),
this._mapExtentChange());this.addResizeOrientationHandlers();this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow&&(this.map.infoWindow.highlight=!0)},updatePanelVisibility:function(b,h,d){if(!this.hidePanel&&"undefined"!==typeof b.visible){var e=n.byId("recLabel_"+h);b.visible?(a.contains("recIcon_"+h,"active")||a.add("recIcon_"+h,"active"),this.config.countEnabled&&a.contains("recNum_"+h,"recNumInActive")&&(a.remove("recNum_"+h,"recNumInActive"),a.add("recNum_"+h,"recNum")),e&&e.firstChild&&
a.remove(e.firstChild,"inActive"),d.listDisabled||a.contains("exp_"+h,"expandInActive")&&a.remove("exp_"+h,"expandInActive"),a.contains("rec_"+h,"recDefault")&&a.remove("rec_"+h,"recDefault")):(a.contains("recIcon_"+h,"active")&&a.remove("recIcon_"+h,"active"),this.config.countEnabled&&a.contains("recNum_"+h,"recNum")&&(a.remove("recNum_"+h,"recNum"),a.add("recNum_"+h,"recNumInActive")),e&&e.firstChild&&a.add(e.firstChild,"inActive"),d.listDisabled||(a.contains("exp_"+h,"expandInActive")||a.add("exp_"+
h,"expandInActive"),d.toggleLegend.remove()),a.contains("rec_"+h,"rec")&&a.add("rec_"+h,"recDefault"))}},enableRefresh:function(){var b=null,h=!1,d;for(d in this.layerList){b=this.layerList[d];if("ClusterLayer"!==b.type)!h&&b.li&&b.li.itemId&&(this.getItem(b.li.itemId),h=!0),b=b.layerObject;else for(var e=0;e<this.opLayers.length;e++){var a=this.opLayers[e];if(a.layerObject){b=a.layerObject;break}}b&&(b.refreshInterval=this.config.refreshInterval)}b=6E4*this.config.refreshInterval;0===this.refreshInterval&&
0===this.refreshIntervalValue?(this.refreshIntervalValue=b,this.refreshInterval=setInterval(l.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==b&&(this.refreshIntervalValue=b,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(l.hitch(this,this.refreshLayers),this.refreshIntervalValue))},getItem:function(b){var h=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+
b;ca({url:h,content:{f:"json",requestTime:Date.now()}}).then(l.hitch(this,function(d){if(d){d=d.modified;var e=!0;this.lastModifiedTime&&(e=this.lastModifiedTime<d);-1<this.currentQueryList.indexOf(b)&&this.currentQueryList.splice(this.currentQueryList.indexOf(b),1);e&&(this.lastModifiedTime=d,this._updatePanelTime(d),ca({url:h+"/data",content:{f:"json",requestTime:Date.now()}}).then(l.hitch(this,this._updateItem,b)))}}))},_updatePanelTime:function(b){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",
this.lastUpdated.innerHTML=x.fieldFormatter.getFormattedDate(new Date(b),{dateFormat:"shortDateShortTime"}))},refreshLayers:function(){for(var b in this.layerList){var h=this.layerList[b],d;h.li&&h.li.itemId?d=h.li.itemId:h.layerObject.itemId&&(d=h.layerObject.itemId);d&&-1===this.currentQueryList.indexOf(d)&&(this.currentQueryList.push(d),this.getItem(d))}},_updateItem:function(b,h){for(var d=0;d<h.layers.length;d++)this._updateLayerItem(h.layers[d],this.lastModifiedTime);this.currentQueryList.splice(this.currentQueryList.indexOf(b),
1)},_updateLayerItem:function(b){var h,d,e,a,c;for(c in this.layerList)if(this.layerList[c].pl&&this.layerList[c].pl.layerDefinition){if(this.layerList[c].pl.layerDefinition.name===b.layerDefinition.name){h=this.layerList[c];d=h.pl;break}}else this.layerList[c].layerObject._parentLayer&&this.layerList[c].layerObject._parentLayer.name===b.layerDefinition.name&&(e="undefined"!==typeof this.layerList[c].listDisabled?this.layerList[c].listDisabled:!1,a=this.layerList[c].li.symbolData.featureDisplayOptions.fields&&
0<this.layerList[c].li.symbolData.featureDisplayOptions.fields.length,!e&&a&&(this.layerList[c].isLoaded=!1),this.layerList[c].layerObject.refreshFeatures(b),this.layerList[c].layerObject&&this._loadList(this.layerList[c],!0));if(b&&d&&(b=b.featureSet.features,e=d.featureSet.features,a=!0,1E4>b.length&&(a=JSON.stringify(e)!==JSON.stringify(b)),a)){e="undefined"!==typeof h.listDisabled?h.listDisabled:!1;a=h.li.symbolData.featureDisplayOptions.fields&&0<h.li.symbolData.featureDisplayOptions.fields.length;
!e&&a&&(h.isLoaded=!1,h.requiresReload=!0);e&&(h.li.layerListExtentChanged=!0);d.layerObject.clear();e=h.layerObject.spatialReference;for(a=0;a<b.length;a++)if(c=b[a],c.geometry){var g=this.getGraphicOptions(c,e,h.layerObject.renderer),v=new B(g);v.setSymbol(g.symbol);v.setAttributes(c.attributes);this._infoTemplate&&v.setInfoTemplate(this._infoTemplate);d.layerObject.add(v)}else console.log("Null geometry skipped");h.layerObject.refresh();d.layerObject.refresh();d.featureSet.features=b;this.countFeatures(h);
h.layerObject&&h.layerObject.visible&&this._loadList(h,!0)}},getGraphicOptions:function(b,a,d){return"undefined"!==typeof b.geometry.rings?{geometry:{rings:b.geometry.rings,spatialReference:{wkid:a.wkid}}}:"undefined"!==typeof b.geometry.paths?{geometry:{paths:b.geometry.paths,spatialReference:{wkid:a.wkid}}}:"undefined"!==typeof b.geometry.points?{geometry:{points:b.geometry.points,spatialReference:{wkid:a.wkid}}}:{geometry:new X(b.geometry.x,b.geometry.y,b.geometry.spatialReference),symbol:d.symbol}},
_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?this.config.hidePanel:!1;this.showAllFeatures="undefined"!==typeof this.config.showAllFeatures?this.config.showAllFeatures:!1;this.map.itemId&&K.getInstance(this.map,this.map.itemInfo).then(l.hitch(this,function(b){this.opLayers=b._operLayers;this.opLayerInfos=b._layerInfos;this.operLayerInfos=b;this._updateLayerIDs();this.config.upgradeFields&&this._upgradeFields();this._createPanelUI(this.configLayerInfos,b);this._addFilterChanged(b);
this._addVisibleChanged(b)}))},_updateLayerIDs:function(){for(var b=0;b<this.configLayerInfos.length;b++){var a=this.configLayerInfos[b],d=this.operLayerInfos.getLayerInfoById(a.id);if(!d){for(var e=!1,p=0;p<this.opLayerInfos.length;p++){var c=this.opLayerInfos[p],g=c?c.originOperLayer:void 0;if(g&&g.url&&a.url&&g.url===a.url){if(d=this.operLayerInfos.getLayerInfoById(g.id))this.configLayerInfos[b].id=g.id,this.configLayerInfos[b].layer=g.id,e=!0}else(c&&c.subId&&c.subId===a.id||g&&g.itemId===a.itemId)&&
g&&g.itemId===a.itemId&&g.featureCollection&&g.featureCollection.layers&&g.featureCollection.layers.hasOwnProperty("length")&&(c=g.featureCollection.layers[0].id,d=this.operLayerInfos.getLayerInfoById(c))&&(this.configLayerInfos[b].id=c,this.configLayerInfos[b].layer=c,e=!0)}e||d||this.configLayerInfos.splice(b,1)}}},_upgradeFields:function(){if(this.config.layerInfos)for(var b=0;b<this.config.layerInfos.length;b++){var a=this.config.layerInfos[b];if(a&&a.symbolData&&a.symbolData.featureDisplayOptions){var d=
this.operLayerInfos.getLayerInfoById(a.id),e=a.symbolData.featureDisplayOptions.fields;if("undefined"===typeof e||e.hasOwnProperty("length")&&0===e.length){var p=d&&d.layerObject?d.layerObject:void 0,c=p&&p.objectIdField?p.objectIdField:void 0,g=e="";if((p=a.fields?a.fields:p?p.fields:void 0)&&0<p.length){var v=0;a:for(;v<p.length;v++){var f=p[v];""===e&&"esriFieldTypeOID"!==f.type&&"esriFieldTypeGeometry"!==f.type&&f.name!==c&&(e=f.name,g=f.alias||f.name);c||(c="esriFieldTypeOID"===f.type?f.name:
c);if(c&&""!==e)break a}}p=c="";a=a.infoTemplate&&a.infoTemplate.info&&a.infoTemplate.info.fieldInfos?a.infoTemplate:d?d.getInfoTemplate():void 0;if(!a)a:for(d=d.getSubLayers(),v=0;v<d.length;v++)if(f=d[v],f.title&&f.layerObject&&f.layerObject.name&&f.title===f.layerObject.name){a=f.getInfoTemplate?f.getInfoTemplate():a;break a}d=a?a.info.fieldInfos:[];a=0;a:for(;a<d.length;a++)if((v=d[a])&&v.visible){c=v.fieldName;p=v.label||v.fieldName;break a}this.config.layerInfos[b].symbolData.featureDisplayOptions.fields=
[{name:c?c:e,label:c?p:g}]}}}},_addFilterChanged:function(b){2.1<=parseFloat(this.appConfig.wabVersion)&&this.own(b.on("layerInfosFilterChanged",l.hitch(this,function(b){Q.forEach(b,l.hitch(this,function(b){var a=b.id,d=b.id+this.UNIQUE_APPEND_VAL_CL;this.layerList.hasOwnProperty(a)?this.layerList[a].filter=b.getFilter():this.layerList.hasOwnProperty(d)&&(this.layerList[d].layerObject.filter=b.getFilter(),this.layerList[d].layerObject._initFeatures())}))})))},_addVisibleChanged:function(b){this.own(b.on("layerInfosIsVisibleChanged",
l.hitch(this,function(b){Q.forEach(b,function(b){var a=b.id,d=b.isShowInMap();if(this.layerList.hasOwnProperty(a))a===this.layerList[a].li.id&&this.layerList[a].visible!==d?this._toggleLayerUI(this.layerList[a].li,d):a===this.layerList[a].id&&this.layerList[a].visible!==d&&this._toggleLayerUI(b,d);else for(var h in this.layerList){var c=d,g=this.layerList[h];if(g.layerObject&&g.layerObject.id===a){var f=this.operLayerInfos.getLayerInfoById(h),c=b.layerObject&&b.layerObject.visibleLayers&&g.hasOwnProperty("li")&&
g.li.hasOwnProperty("subLayerId")?d&&-1<b.layerObject.visibleLayers.indexOf(g.li.subLayerId):f?d&&f._visible:d;g.visible!==c&&this._toggleLayerUI(f,c)}}},this)})))},_updatePanelHeader:function(){this.pageLabel.innerHTML=x.stripHTML(this.label);u.set(this.pageLabel,"display","block");var b;b=this.map.width;this.config.displayPanelIcon&&750<b?(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeaderNoIcon"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==
this.config.mainPanelText?g.addClass(this.pageHeader,"pageHeaderRefresh"):g.addClass(this.pageHeader,"pageHeaderRefreshNoText"):g.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(g.removeClass(this.pageBody,"pageBodyNoIcon"),g.removeClass(this.pageBody,"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?g.addClass(this.pageBody,"pageBodyRefresh"):g.addClass(this.pageBody,"pageBodyRefreshNoText"):g.addClass(this.pageBody,"pageBody")),this.pageTitle&&(g.addClass(this.pageTitle,
"pageTitleWidth"),this.config.refreshEnabled?(g.removeClass(this.pageTitle,"pageTitle"),g.addClass(this.pageTitle,"pageTitleRefresh")):(g.removeClass(this.pageTitle,"pageTitleRefresh"),g.addClass(this.pageTitle,"pageTitle"))),b=this.config.mainPanelText,"undefined"===typeof b&&(b=""),this.pageTitle.innerHTML=b,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):this.config.displayPanelIcon||this.config.refreshEnabled?!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&
(g.removeClass(this.pageHeader,"pageHeader"),g.removeClass(this.pageHeader,"pageHeaderNoIcon"),g.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(g.removeClass(this.pageBody,"pageBody"),g.removeClass(this.pageBody,"pageBodyNoIcon"),g.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&g.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&
750>=b&&this.config.refreshEnabled&&(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeaderNoIcon"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),g.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?g.addClass(this.pageHeader,"pageHeaderRefresh"):g.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&(g.removeClass(this.pageBody,"pageBodyNoIcon"),g.removeClass(this.pageBody,"pageBodyNoIconRefresh"),g.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?
g.addClass(this.pageBody,"pageBodyRefresh"):g.addClass(this.pageBody,"pageBodyRefreshNoText")),this.pageTitle&&g.addClass(this.pageTitle,"pageTitleWidth"),b=this.config.mainPanelText,"undefined"===typeof b&&(b=""),this.pageTitle.innerHTML=b):(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeader"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),g.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(g.removeClass(this.pageBody,"pageBody"),g.removeClass(this.pageBody,"pageBodyNoIconRefresh"),
g.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e");470<this.windowWidth?this._setMaxHeight():this._setMobileMaxHeight();this._setMaxWidth()},_createPanelUI:function(b,a){this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var d=0;d<b.length;d++){var e=b[d];"ThemeCluster"===e.symbolData.clusterType&&this.updateThemeClusterSymbol(e,
d);var h=a.getLayerInfoById(e.id);if(!h)for(var c=0;c<this.opLayerInfos.length;c++){var g=this.opLayerInfos[c];g&&g._subLayerInfoIndex&&(g=Object.keys(g._subLayerInfoIndex),g.length&&0<g.length&&(b[d].id=g[0],b[d].layer=g[0],h=a.getLayerInfoById(e.id)))}h&&this._createLayerListItem(e,h)}if(!this.hidePanel){m.create("div",{"class":"expandArrow roundedBottom jimu-main-background dart-bgcolor box-bgcolor"},this.pageMain);for(var f in this.layerList)d=this.layerList[f],"ClusterLayer"!==d.type&&d&&d.layerObject&&
d.layerObject.hasOwnProperty("refreshInterval")&&0<d.layerObject.refreshInterval&&this.updateEnd.push(this.own(q(d.layerObject,"update-end",l.hitch(this,this._updateEnd))))}this.addMapLayers()},_updateEnd:function(b){b=this.layerList.hasOwnProperty(b.target.id)?b.target.id:b.target.id+"_CL";b=this.layerList[b];b.isLoaded=!1;b.updating=!1;b.requiresReload=!0;b&&(b.legendOpen?this._loadList(b,this.config.countEnabled):this.config.countEnabled&&this.countFeatures(b))},updateThemeClusterSymbol:function(b,
a){var d=b.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var e=A.fromHex(this._styleColor),h=a+1,c=0<h?30*h:30,g=0===h%2,f=e.g,k=e.b,e=e.r-c;g&&(255<e?e-=255:0>e&&(e+=255));k-=c;0===h%3&&g&&(255<k?k-=255:0>k&&(k+=255));c=f-c;0===h%5&&g&&(255<c?c-=255:0>c&&(c+=255));d.clusterType="CustomCluster";d.clusterSymbol={color:[e,c,k,1],outline:{color:[0,0,0,0],width:0,
type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},_createLayerListItem:function(b,a){a=this.operLayerInfos.getLayerInfoById(b.id);for(var d=["ArcGISFeatureLayer","KML","ArcGISStreamLayer","CSV","GeoRSS"],e=0;e<this.opLayers.length;e++){var h=this.opLayers[e];if(h.id===b.id||h.id===b.parentLayerID||h.featureCollection&&h.featureCollection.layers&&0<h.featureCollection.layers.length&&h.featureCollection.layers[0].id===b.id)if("ArcGISMapServiceLayer"===h.layerType){if(h=this._getSubLayerByURL(b.id),
"undefined"!==typeof h){this.updateLayerList(h,b,"Feature Layer",a);break}}else if(-1<d.indexOf(h.layerType)||"undefined"===typeof h.layerType)if(h.layerObject&&h.id===b.id){this.updateLayerList(h,b,"undefined"===typeof h.layerType?"Feature Layer":h.layerType,a);break}else if(h.featureCollection)for(var c=0;c<h.featureCollection.layers.length;c++){var g=h.featureCollection.layers[c];if(g.id===b.id||h.id===b.id){this.updateLayerList(g,b,"Feature Collection",a);break}}else if(h.layerObject&&h.id===
b.parentLayerID){var f,k;"GeoRSS"===h.type?(k="GeoRSS",f=h.layerObject.getFeatureLayers()):"KML"===h.type&&(k="KML",f=h.layerObject.getLayers());if(f)for(h=0;h<f.length;h++)if(c=f[h],c.id===b.id){this.updateLayerList(c,b,k,a);break}}}},removeOldClusterLayers:function(b){var a=[],d;for(d in this.layerList)if("ClusterLayer"===this.layerList[d].type){var e=0;a:for(;e<b.length;e++){var c=b[e];if(c.id+this.UNIQUE_APPEND_VAL_CL===d){c.symbolData&&!c.symbolData.clusteringEnabled&&a.push(d);break a}}}if(0<
a.length)for(var g in a)this.layerList.hasOwnProperty(a[g])&&(this.layerList[a[g]].layerObject.destroy(),delete this.layerList[a[g]])},addMapLayers:function(){for(var b=Object.keys(this.layerList).reverse(),a=0;a<b.length;a++){var d=b[a],e=this.layerList[d];e.type&&"ClusterLayer"===e.type&&-1===this.map.graphicsLayerIds.indexOf(d)&&this.map.addLayer(e.layerObject)}},_getSubLayerByURL:function(b){for(var a=null,d=0;d<this.opLayerInfos.length;d++){var e=this.opLayerInfos[d];if(0<e.newSubLayers.length&&
(a=this._recurseOpLayers(e.newSubLayers,b)))break}return a},_recurseOpLayers:function(b,a){for(var d=0;d<b.length;d++){var e=b[d];if(0<e.newSubLayers.length)this._recurseOpLayers(e.newSubLayers,a);else if(e.id===a)return e}},updateLayerList:function(b,a,d,e){var h=null,c=null,g=null,f=null;e=null===e?this.operLayerInfos.getLayerInfoById(b.id):e;var k=e.getInfoTemplate()||a.infoTemplate,m=e&&e.isShowInMap?e.isShowInMap():!0,n=a.symbolData.featureDisplayOptions.listDisabled?a.symbolData.featureDisplayOptions.listDisabled:
a.symbolData.featureDisplayOptions.fields?0===a.symbolData.featureDisplayOptions.fields.length:!0,w=e&&e.originOperLayer?e.originOperLayer:void 0,r=w&&w.selfType?e.originOperLayer.selfType:"";!r&&d&&"KML"===d&&(r="kml");"ArcGISFeatureLayer"===b.layerType?a.symbolData.clusteringEnabled?(h=this._getClusterLayer(a,b,e,d),this.layerList[h.id]={type:"ClusterLayer",layerObject:h,visible:h.visible,id:h.id,li:a,filter:e?e.getFilter():"1\x3d1",infoTemplate:k,selfType:r,listDisabled:n,showAllFeatures:this.showAllFeatures},
this.hidePanel||this.showAllFeatures||this.own(q(h,"update-end",l.hitch(this,function(){this.layerList[h.id].listDisabled||this._loadList(this.layerList[h.id],!0)}))),this.numClusterLayers+=1):(b.parentLayerInfo&&b.parentLayerInfo.layerObject&&(c=b.parentLayerInfo.layerObject,g=a.id),h=b.layerObject,f=g?g:a.id,this.layerList[f]={type:c?d:h.type,layerObject:c?c:h,visible:m,pl:b,li:a,filter:e?e.getFilter():"1\x3d1",infoTemplate:k,selfType:r,listDisabled:n},this.updateRenderer(f)):"ArcGISStreamLayer"===
b.layerType?(h=b.layerObject,this.layerList[h.id]={type:"StreamLayer",layerObject:h,visible:m,id:h.id,filter:e?e.getFilter():"1\x3d1",infoTemplate:k,selfType:r,listDisabled:n}):a.symbolData.clusteringEnabled?(h=this._getClusterLayer(a,b,e,d),this.layerList[h.id]={type:"ClusterLayer",layerObject:h,visible:h.visible,id:h.id,li:a,filter:e?e.getFilter():"1\x3d1",infoTemplate:k,selfType:r&&""!==r?r:w&&w.layerType&&"CSV"===w.layerType?"collection":"Feature Collection"===d?"collection":"",listDisabled:n,
showAllFeatures:this.showAllFeatures},this.hidePanel||this.showAllFeatures||this.own(q(h,"update-end",l.hitch(this,function(){this.layerList[h.id].listDisabled||this._loadList(this.layerList[h.id],!0)}))),this.numClusterLayers+=1):(b.parentLayerInfo&&b.parentLayerInfo.layerObject&&(c=b.parentLayerInfo.layerObject,g=c.visibleLayers?b.id:c.id),h=b.layerObject,f=g?g:b.id,this.layerList[f]={type:c?d:h?h.type:d,layerObject:c?c:h?h:b,visible:m,pl:b,li:a,filter:e?e.getFilter():"1\x3d1",infoTemplate:k,selfType:r&&
""!==r?r:w&&w.layerType&&"CSV"===w.layerType?"collection":"Feature Collection"===d?"collection":"",listDisabled:n},this.updateRenderer(f));this.hidePanel||this._addPanelItem(c?c:h?h:b,a,n)},updateRenderer:function(b){b=this.layerList[b];if("LayerSymbol"!==b.li.symbolData.symbolType){"undefined"===typeof b.li.orgRenderer&&(b.li.orgRenderer=b.layerObject.renderer?b.layerObject.renderer:b.li.renderer);var a=new ea(ba.fromJson(b.li.symbolData.symbol));b.li.newRenderer=a;if(b.layerObject.setRenderer)b.layerObject.setRenderer(a);
else if(b.layerObject.setLayerDrawingOptions){var d=[],e=new da;e.renderer=a;d[b.li.subLayerId]=e;b.layerObject.setLayerDrawingOptions(d)}else console.log("Error setting the new renderer...will use the default rendering of the layer");b.layerObject.refresh()}},_onRecNodeMouseover:function(b){a.add(b,this.isDartTheme?"layer-row-mouseover-dart":"layer-row-mouseover")},_onRecNodeMouseout:function(b){a.remove(b,this.isDartTheme?"layer-row-mouseover-dart":"layer-row-mouseover")},_addPanelItem:function(b,
a,d){var e=b.visibleLayers?a.id:b.id,h=this.layerList[e].type,c;c=this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:["rec","expand","expandDown","solidBorder"];var f=m.create("div",{"class":c[0]+" "+c[3],id:"rec_"+e},this.pageMain);d?(g.setStyle(f,"cursor","default"),c="expand-empty"):(this.own(q(f,"mouseover",l.hitch(this,this._onRecNodeMouseover,f))),this.own(q(f,"mouseout",l.hitch(this,this._onRecNodeMouseout,f))),c=c[1]+" "+c[2]);m.create("div",{"class":c,id:"exp_"+
e},f);c=m.create("div",{"class":"recIcon active",id:"recIcon_"+e},f);if(a.panelImageData&&-1<a.panelImageData.toString().indexOf("\x3cimg")){var k=document.createElement("div");k.innerHTML=a.panelImageData;k=new V(k.children[0].src,26,26);a.panelImageData=this._createImageDataDiv(k,44,44,void 0,!0).innerHTML}c.innerHTML=a.panelImageData;u.set(c.firstChild,"border-radius","41px");var k=this.isDartTheme?" darkThemeColor":" lightThemeColor",n;this.config.countEnabled?(a=m.create("div",{"class":"recLabel"+
k,id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},f),g.setStyle(a,"top","20px"),n=m.create("div",{"class":"recNum"+k,id:"recNum_"+e,innerHTML:""},f)):a=m.create("div",{"class":"recLabelNoCount"+k,id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+a.label+"\x3c/p\x3e"},f);"ClusterLayer"===h?(b.node=n,d||this._addLegend(e,this.layerList[e]),b._updateNode(b.nodeCount)):"StreamLayer"===h?(this.layerList[e].node=n,this.countFeatures(this.layerList[e]),d||this._addLegend(e,this.layerList[e])):(this.layerList[e].node=
n,this._addLegend(e,this.layerList[e]));q(c,"click",l.hitch(this,this._toggleLayerVisibility,this.layerList[e]));d||(this.layerList[e].toggleLegend=q(f,"click",l.hitch(this,this._toggleLegend,this.layerList[e])))},_addLegend:function(b,a){a.legendOpen=null===this.row&&this.config.expandList;a.legendNode=m.create("div",{"class":"legendLayer "+(a.legendOpen?"legendOn":"legendOff"),id:"legend_"+b},this.pageMain);"ClusterLayer"===a.type&&(a.layerObject.legendNode=a.legendNode);this.row="firstRowExpanded"},
_getListFields:function(b){var a=[],d=this._getInfoTemplate(b);if(d&&d.info){var e=d.info.fieldInfos;if("undefined"!==typeof e)for(var c=0;c<e.length;c++)e[c].visible&&a.push(e[c].fieldName)}if(b.li.symbolData&&(e=b.li.symbolData.featureDisplayOptions)){if(e.fields)for(c=0;c<e.fields.length;c++)-1===a.indexOf(e.fields[c].name)&&a.push(e.fields[c].name);e.groupField&&-1===a.indexOf(e.groupField.name)&&a.push(e.groupField.name)}if(0===a.length||"undefined"===typeof d)a=["*"];"*"!==a[0]&&b.layerObject&&
b.layerObject.objectIdField&&-1===a.indexOf(b.layerObject.objectIdField)&&a.push(b.layerObject.objectIdField);return a},_loadList:function(b,c){if(!this.hidePanel){var d=[],e=[],h=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id;c&&this._addSearching(h);var g=this._getListFields(b);if("ClusterLayer"===b.type){var f=[];if(b.layerObject.clusterGraphics||b.layerObject._features){if(this.showAllFeatures)f=b.layerObject._features;else for(var h=b.layerObject.clusterGraphics,v=0;v<h.length;v++){var m=
h[v];if(m.graphics&&0<m.graphics.length)for(var n=0;n<m.graphics.length;n++)f.push(m.graphics[n])}setTimeout(l.hitch(this,function(){this._updateList(f,b.legendNode,b.layerObject.node,g,c,b)}),100)}else this._removeSearching(h,b.legendNode?!a.contains(b.legendNode,"legendOff"):!0)}h=["StreamLayer","GeoRSS","KML","Feature Layer"];if("ClusterLayer"!==b.type){if(b.pl&&b.pl.featureSet){this.getFeatures(b,g,c);return}if(-1<h.indexOf(b.type)||"CSV"===b.pl.type){this.getFeatures(b,g,c);return}}b.li&&b.li.url&&
"ClusterLayer"!==b.type&&"undefined"===typeof b.queryFeatures&&(v=b.li.url,-1<v.indexOf("MapServer")||-1<v.indexOf("FeatureServer"))&&(this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),h=new k,h.where=b.filter?b.filter:"1\x3d1",h.geometry=this.map.extent,h.returnGeometry=b.listDisabled?!1:!0,h.outFields=g,v=new W(v),d.push(v.execute(h)),e.push({node:b.node,legendNode:b.legendNode,fields:g,updateCount:c,li:b.li}));0<d.length&&(this.promises=H(d).then(l.hitch(this,function(b){this.promises=
void 0;if(b)for(var a=0;a<b.length;a++)if(b[a]){var d=e[a];this._updateList(b[a].features,d.legendNode,d.node,d.fields,d.updateCount,d.li)}})))}},_addSearching:function(b){var c=this.layerList[b].listDisabled,d=c?"expand-empty":this.isDartTheme?"expandDown-dart":"expandDown",e=c?"expand-empty":this.isDartTheme?"expandUp-dart":"expandUp",c=c?"expandSearching-empty":"expandSearching";a.contains("exp_"+b,d)&&(a.remove("exp_"+b,d),a.add("exp_"+b,c));a.contains("exp_"+b,e)&&(a.remove("exp_"+b,e),a.add("exp_"+
b,c))},_removeSearching:function(b,c){var d=this.layerList[b].listDisabled,e=d?"expand-empty":this.isDartTheme?"expandDown-dart":"expandDown",h=d?"expand-empty":this.isDartTheme?"expandUp-dart":"expandUp",d=d?"expandSearching-empty":"expandSearching";a.contains("exp_"+b,d)&&(a.remove("exp_"+b,d),a.add("exp_"+b,c?h:e))},_getClusterLayer:function(b,a,d,c){var e=a.layerObject?a.layerObject:a,h=b.infoTemplate,g=e&&e.originOperLayer?e.originOperLayer:a.parentLayerInfo?a.parentLayerInfo:d?d.originOperLayer:
void 0,f=null,f=b.id+this.UNIQUE_APPEND_VAL_CL;a=!0;-1<this.map.graphicsLayerIds.indexOf(f)||-1<this.map._layers.indexOf(f)?(f=this.map.getLayer(f),h=e=!1,JSON.stringify(f.symbolData)!==JSON.stringify(b.symbolData)&&(f.symbolData=b.symbolData,f.countColor=b.symbolData._highLightColor,h=!0),c=m.toDom(b.panelImageData),JSON.stringify(f.icon)!==JSON.stringify(c.src)&&(f.icon=c.src,h=!0),m.destroy(c.id),f.displayFeatureCount=b.symbolData.displayFeatureCount,f.refresh!==b.refresh&&(f.refresh=b.refresh,
e=!0),h&&f._setupSymbols(),f.countEnabled=this.config.countEnabled,f.hidePanel=this.hidePanel,f.showAllFeatures!==this.showAllFeatures&&(e=!0,f.showAllFeatures=this.showAllFeatures),f.listDisabled!==this.listDisabled&&(e=!0,f.listDisabled=this.listDisabled),e?f.url&&f.refreshFeatures(f.url):h&&f.clusterFeatures()):(a=!1,f=new fa({name:b.label+this.UNIQUE_APPEND_VAL_CL,id:f,map:this.map,node:n.byId("recNum_"+f),legendNode:n.byId("legend_"+f),infoTemplate:"undefined"!==typeof e.infoTemplate?e.infoTemplate:
h,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:e,lyrInfo:b,lyrType:c,_styleColor:this._styleColor,originOperLayer:g,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:d?d.getFilter():"1\x3d1",showAllFeatures:this.showAllFeatures,listDisabled:this.listDisabled}));f.setVisibility(a?f.visible:d.isShowInMap?d.isShowInMap():!0);return f},_createImageDataDiv:function(b,a,d,e,f){var h;if(b){h=a;var g=d;if(b.height&&b.width){var p;if(b.height>
b.width)p=b.width/b.height,g=a*p;else if(b.width===b.height||b.width>b.height)g=a,p=b.width/b.height,h=0<p?d*p:d}"undefined"!==typeof b.setWidth?"undefined"!==typeof b.setHeight?(b.setWidth(f?g-.25*g:g),b.setHeight(f?h-.25*h:h)):b.setWidth(2):"undefined"!==typeof b.size&&20<b.size&&b.setSize(20);h=m.create("div",{"class":"imageDataGFX"},e);e=c.createSurface(h,a,d);b=ba.getShapeDescriptors(b);e.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).applyTransform({dx:a/2,dy:d/2})}return h},
_updateUI:function(b){this.styleName=b},_getLayerListLayerID:function(b){var a=b.id?b.id:b.layerObject.id;!this.layerList[a]&&b.pl&&(a=b.pl.id);return a},_toggleLayerVisibility:function(b,c){c.stopPropagation();this.map.infoWindow.hide();var d=this._getLayerListLayerID(b),e=this.layerList[d];if(e){var h=!1;e.li&&e.li.hasOwnProperty("subLayerId")&&(h="undefined"!==typeof e.li.subLayerId&&"-1"!==e.li.subLayerId.toString());if(a.contains("recIcon_"+d,"active"))if(h&&"ClusterLayer"!==e.type){d=e.layerObject.visibleLayers;
for(h=d.length;h--;)-1===d[h]&&d.splice(h,1);h=d.indexOf(e.li.subLayerId);-1<h&&d.splice(h,1);e.layerObject.setVisibleLayers(d);e.layerObject.setVisibility(!0)}else e&&(e.layerObject.setVisibility(!1),"undefined"!==typeof e.pl&&(e.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(d)&&(e=this.map.getLayer(d),e.setVisibility(!1))));else if(h&&"ClusterLayer"!==e.type){d=e.layerObject.visibleLayers;d.push(e.li.subLayerId);for(h=d.length;h--;)-1===d[h]&&d.splice(h,1);e.layerObject.setVisibleLayers(d);
e.layerObject.setVisibility(!0)}else e&&(e.layerObject.setVisibility(!0),"ClusterLayer"===e.type&&(e.layerObject.handleMapExtentChange({levelChange:!0}),e.layerObject.flashFeatures()),"undefined"!==typeof e.pl&&(e.pl.visibility=!0,-1<this.map.graphicsLayerIds.indexOf(d)&&(e=this.map.getLayer(d),e.setVisibility(!0))))}return!1},_toggleLayerUI:function(b,c){var d=this.isDartTheme?" darkThemeColor":" lightThemeColor",e=this._getLayerListLayerID(b),h=this.layerList[e],f=this._inVisibleRange(this.layerList[e],
e),g=this.isDartTheme?"expandDown-dart":"expandDown",k=this.isDartTheme?"expandUp-dart":"expandUp";if(h){var m=n.byId("recLabel_"+e);if(c)if(h&&(this.layerList[e].visible=!0,this.layerList[e].parentLayerVisible=!0),this.layerList[e].visible=!0,this.layerList[e].parentLayerVisible=!0,"ClusterLayer"===h.type&&(this.layerList[e].layerObject.parentLayerVisible=!0),this.hidePanel)"ClusterLayer"===h.type&&h.layerObject.clusterFeatures();else{n.byId("recIcon_"+e)&&a.add("recIcon_"+e,"active");this.config.countEnabled&&
a.contains("recNum_"+e,"recNumInActive")&&(a.remove("recNum_"+e,"recNumInActive"),a.add("recNum_"+e,"recNum"+d));m&&m.firstChild&&f&&a.remove(m.firstChild,"inActive");if(h.listDisabled)this.config.countEnabled&&h.li&&h.li.layerListExtentChanged&&("ClusterLayer"===h.type&&h.layerObject.clusterFeatures(),this.countFeatures(h));else{h.toggleLegend&&h.toggleLegend.remove();if(d=n.byId("rec_"+e))h.toggleLegend=q(d,"click",l.hitch(this,this._toggleLegend,h));h.legendOpen?a.contains("legend_"+e,"legendOff")&&
(a.remove("legend_"+e,"legendOff"),a.add("legend_"+e,"legendOn"),a.contains("exp_"+e,g)&&(a.remove("exp_"+e,g),a.add("exp_"+e,k))):(a.contains("exp_"+e,k)&&a.remove("exp_"+e,k),f&&a.add("exp_"+e,g));!h.isLoaded&&(h.li&&h.li.layerListExtentChanged||!h.isLoaded)&&h.legendOpen&&!this.hidePanel&&f?this._loadList(h,!0):("ClusterLayer"===h.type&&h.layerObject.clusterFeatures(),f&&this.countFeatures(h))}a.contains("rec_"+e,"recDefault")&&a.remove("rec_"+e,"recDefault")}else this.layerList[e].visible=!1,
this.layerList[e].parentLayerVisible=!1,"ClusterLayer"===this.layerList[e].type&&(this.layerList[e].layerObject.parentLayerVisible=!1),this.hidePanel||(a.remove("recIcon_"+e,"active"),this.config.countEnabled&&a.contains("recNum_"+e,"recNum")&&(a.remove("recNum_"+e,"recNum"),a.add("recNum_"+e,"recNumInActive"+d)),m&&m.firstChild&&a.add(m.firstChild,"inActive"),h.listDisabled||(a.contains("exp_"+e,"expandInActive")||a.add("exp_"+e,"expandInActive"),h.legendOpen&&a.contains("legend_"+e,"legendOn")&&
(a.remove("legend_"+e,"legendOn"),a.add("legend_"+e,"legendOff"),a.contains("exp_"+e,k)&&(a.remove("exp_"+e,k),a.add("exp_"+e,g))),h.toggleLegend&&h.toggleLegend.remove()),a.contains("rec_"+e,"rec")&&a.add("rec_"+e,"recDefault"))}return!1},_toggleLegend:function(b,h){if("thumb2"!==h.currentTarget.className&&"recIcon"!==h.currentTarget.className){var d=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id;if(a.contains("legend_"+d,"legendOff")){this._addSearching(d);this.layerList[d].legendOpen=
!0;if("undefined"===typeof this.layerList[d].li.layerListExtentChanged||this.layerList[d].requiresReload)this.layerList[d].li.layerListExtentChanged=!0,this.layerList[d].requiresReload=!1;this.layerList[d].li.layerListExtentChanged?setTimeout(l.hitch(this,function(){this._loadList(b,!1)}),500):this._removeSearching(d,!0);a.remove("legend_"+d,"legendOff");a.add("legend_"+d,"legendOn")}else if(a.contains("legend_"+d,"legendOn")){this.layerList[d].legendOpen=!1;var c=this.isDartTheme?"expandDown-dart":
"expandDown",f=this.isDartTheme?"expandUp-dart":"expandUp";a.contains("exp_"+d,f)&&(a.remove("exp_"+d,f),a.add("exp_"+d,c));a.remove("legend_"+d,"legendOn");a.add("legend_"+d,"legendOff");470>window.innerWidth&&this._setMobileMaxHeight()}}h.stopPropagation()},_toggleGroup:function(b,c){var d=c.currentTarget.id.slice(0,-2),h=this.isDartTheme?"featureItem-dart":"featureItem",f=!0;c.target.parentNode&&(""!==c.target.parentNode.id&&a.contains(c.target.parentNode.id,h)&&(f=!1),""!==c.target.id&&a.contains(c.target.id,
h)&&(f=!1));var h=this.isDartTheme?"groupItemImage-dart":"groupItemImage",k=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp",l=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";if(f){var f=b.layerObject.id in this.layerList?b.layerObject.id:b.li.id,m=document.getElementById(c.currentTarget.id),n=m.childNodes[0].childNodes.length-1;a.contains(d,"groupOff")?(this.layerList[f].openGroups&&0<this.layerList[f].openGroups.length?-1===this.layerList[f].openGroups.indexOf(d)&&this.layerList[f].openGroups.push(d):
this.layerList[f].openGroups=[d],a.remove(d,"groupOff"),a.add(d,"groupOn"),this.layerList[f].groupOpen=!0,-1<m.childNodes[0].childNodes[n].childNodes[0].className.indexOf(h)&&(g.removeClass(m.childNodes[0].childNodes[n].childNodes[0],l),g.addClass(m.childNodes[0].childNodes[n].childNodes[0],k))):a.contains(d,"groupOn")&&(a.remove(d,"groupOn"),a.add(d,"groupOff"),this.layerList[f].openGroups&&0<this.layerList[f].openGroups.length?(d=this.layerList[f].openGroups.indexOf(d),-1<d&&this.layerList[f].openGroups.splice(d,
1),0===this.layerList[f].openGroups.length&&(this.layerList[f].groupOpen=!1)):this.layerList[f].groupOpen=!1,-1<m.childNodes[0].childNodes[n].childNodes[0].className.indexOf(h)&&(g.removeClass(m.childNodes[0].childNodes[n].childNodes[0],k),g.addClass(c.currentTarget.childNodes[0].childNodes[n].childNodes[0],l)))}},onAppConfigChanged:function(b,a,d){switch(a){case "themeChange":this.inPanelOverrides(d);this.destroy();break;case "layoutChange":this.destroy();break;case "styleChange":this.hidePanel||
(this._updateUI(d),this._updateStyleColor(d));break;case "widgetChange":this.widgetChange=!0;d&&d.config&&d.config.layerInfos&&this.removeOldClusterLayers(d.config.layerInfos);this.row=null;break;case "mapChange":this._clearMap()}},_updateStyleColor:function(b){setTimeout(l.hitch(this,function(){this.getPanel();if(!this.hidePanel){var a=window.getComputedStyle(this.pageHeader,null).getPropertyValue("background-color");this._styleColor=a?Y.fromRgb(a).toHex():"#485566";for(var d in this.layerList)a=
this.layerList[d],"ClusterLayer"===a.type&&a.layerObject.setStyleColor(this._styleColor)}this._updateUI(b)}),50)},_clearMap:function(){if(this.layerList){for(var b in this.layerList){var a=this.layerList[b];if("ClusterLayer"===a.type){var d=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(d=!this.continuousRefreshEnabled);d&&(a.layerObject._clear(),this.map.removeLayer(a.layerObject))}}this.layerList={}}},_updateHeight:function(a){if(470>window.innerWidth){var b=n.byId("map");u.set(b,"bottom",
a+"px");u.set(this.domNode,"top",window.innerHeight-a+"px")}},_windowResize:function(){this.windowWidth=window.innerWidth;470<this.windowWidth?this.isSmall?(this._close(),this.widgetManager.triggerWidgetOpen(this.id)):(this._resetMapDiv(),this._setMaxHeight()):this.isSmall?(this.maxHeight=.35*window.innerHeight,this._updateHeight(this.maxHeight),this._setMobileMaxHeight(),this.halfWidth=window.innerWidth/2):(this._close(),this.widgetManager.triggerWidgetOpen(this.id));this._setMaxWidth()},_setMaxHeight:function(){var a=
this.map.height-this.pageHeader.clientHeight;switch(this.appConfig.theme.name){case "BoxTheme":a-=70;break;case "DartTheme":a-=90;break;case "LaunchpadTheme":a-=55;break;default:a-=20}this.pageBody&&a&&u.set(this.pageBody,"maxHeight",a+"px")},_setMobileMaxHeight:function(){var a=this.pageHeader.clientHeight,c=this.maxHeight-a,d=c;if(0<this.pageHeader.clientHeight&&470>=window.innerWidth){var e=70*this.config.layerInfos.length,d=1<Math.floor(c/70)&&70<e?e+10:80,d=d+a<this.maxHeight?d+a:70<e?e-70+a+
10:80+a;this.pageMain.clientHeight>d&&(d=c)}this.pageBody&&d&&u.set(this.pageBody,"maxHeight",d+"px");this._updateHeight(this.pageMain.clientHeight>d?this.maxHeight:d)},_setMaxWidth:function(){this.mw=this.halfWidth;var a=360>this.mw&&window.innerWidth>window.innerHeight;u.set(this.panelMain,"maxWidth",a?this.mw+"px":"none");u.set(this.panelMain,"minWidth",a?"100px":"none");u.set(this.panelPage,"maxWidth",a?this.mw+"px":"none");u.set(this.panelPage,"minWidth",a?"100px":"none");u.set(this.pageBody,
"maxWidth",a?this.mw+"px":"none");u.set(this.pageBody,"minWidth",a?"100px":"none")},setPosition:function(a,c){var b;this.hidePanel||(this.inherited(arguments),this.position={right:0,bottom:0,top:0,height:"auto","z-index":"auto"},this.windowWidth=window.innerWidth,470<this.windowWidth?(this.isSmall=!1,b=x.getPositionStyle(this.position),b.position="static",g.place(this.domNode,this.map.id),b.width="",g.setStyle(this.domNode,b),"LaunchpadTheme"===this.appConfig.theme.name&&u.set(this.pageContent,"top",
"25px"),"DartTheme"===this.appConfig.theme.name&&u.set(this.panelMain,window.isRTL?"left":"right","10px"),this._setMaxHeight()):(this.isSmall=!0,this.maxHeight=.35*window.innerHeight,this.position={right:0,bottom:0,height:"none","z-index":"auto",relativeTo:"browser",top:window.innerHeight-this.maxHeight,left:0},this.position.relativeTo="browser",b=x.getPositionStyle(this.position),g.place(this.domNode,window.jimuConfig.layoutId),n.byId("map").style.bottom=this.maxHeight+"px",u.set(this.domNode,"top",
window.innerHeight-this.maxHeight+"px"),u.set(this.domNode,"left","0px"),u.set(this.domNode,"right","0px"),"DartTheme"===this.appConfig.theme.name&&u.set(this.panelMain,window.isRTL?"left":"right","0px"),this._setMobileMaxHeight()),this.halfWidth=window.innerWidth/2,this._setMaxWidth())},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);for(var a in this.layerList){var c=this.layerList[a];c.li&&c.li.orgRenderer&&(c.layerObject.setRenderer?c.layerObject.setRenderer(c.li.orgRenderer):
c.layerObject.setLayerDrawingOptions?c.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),c.layerObject.refresh())}a=!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.hidePanel||("undefined"!==typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=
void 0),this.removeResizeOrientationHandlers(),this._resetMapDiv())},_resetMapDiv:function(){n.byId("map").style.bottom="0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},_inVisibleRange:function(a,c){var b=!0;a.layerObject&&a.layerObject.hasOwnProperty("visibleAtMapScale")&&(b=a.layerObject.visibleAtMapScale);var e=this.operLayerInfos.getLayerInfoById(c);e&&e.isCurrentScaleInTheScaleRange&&(b=e.isCurrentScaleInTheScaleRange());return b},_mapExtentChange:function(){var b=
this.config.countEnabled,c=[],d=[],e;for(e in this.layerList){var f=this.layerList[e],l=this._inVisibleRange(f,e);this.showAllFeatures||this._clearList(f);if(!f.legendOpen||f.groupEnabled&&!f.groupOpen)if(f.li&&(f.li.layerListExtentChanged=!0),f.visible&&l){if(f.li&&f.li.url&&"ClusterLayer"!==f.type&&"undefined"===typeof f.layerObject.queryCount){var m=f.li.url;if(-1<m.indexOf("MapServer")||-1<m.indexOf("FeatureServer"))this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0),l=
new k,l.where=f.filter&&!this.showAllFeatures?f.filter:"1\x3d1",this.showAllFeatures||(l.geometry=this.map.extent),l.returnGeometry=!1,m=new W(m),c.push(m.executeForIds(l)),b?d.push(f.node):d.push(f.legendNode)}"ClusterLayer"===f.type&&f.layerObject.initalLoad&&this.config.countEnabled&&f.layerObject._updateNode(f.layerObject.node.innerHTML);"ClusterLayer"!==f.type&&("undefined"===typeof f.layerObject?console.log("layer object not known"):this.countFeatures(f))}else l||this._updateList([],f.legendNode,
f.node,[],!0,f);else f.visible&&l?(f.updateList=!0,this._loadList(f,f.updateList)):this._updateList([],f.legendNode,f.node,[],!0,f)}0<c.length&&(this.promises=H(c).then(function(c){this.promises=void 0;if(c)for(var e=0;e<c.length;e++){var h;c[e]?(a.contains(d[e].id,"searching")&&a.remove(d[e].id,"searching"),h=c[e].length):h=0;var k;b?(d[e].innerHTML=x.localizeNumber(h),k=d[e].parentNode):k=d[e].previousSibling;var l;-1<k.id.indexOf("rec_")&&(l=k.id.replace("rec_",""),l=n.byId("exp_"+l));0===h?(k&&
(g.addClass(k,"recDefault"),g.addClass(k,"inActive")),l&&!f.listDisabled&&g.addClass(l,"expandInActive")):(k&&(g.removeClass(k,"recDefault"),g.removeClass(k,"inActive")),l&&!f.listDisabled&&g.removeClass(l,"expandInActive"))}}))},_chunkRequest:function(a,c,d,e,f,g){var b=new E,h=[],m,p;m=0;for(p=d.length;m<p;m+=e){var y=d.slice(m,m+e),n=new k;n.outFields=f;n.objectIds=y;n.returnGeometry=g;a.queryFeatures?h.push(a.queryFeatures(n)):c&&(y=new W(c),h.push(y.execute(n)))}(new t(h)).then(l.hitch(this,
function(a){if(a){for(var c=[],d=0;d<a.length;d++)a[d][1].features&&c.push.apply(c,a[d][1].features);b.resolve(c)}}));return b},getFeatures:function(a,c,d){var b=a.layerObject,h=a.legendNode,f=a.node,g=!a.listDisabled&&a.legendOpen?!0:!1,m=this._inVisibleRange(b,a.id||a.li.id),n=b&&b.maxRecordCount?b.maxRecordCount:void 0,q,r=[],w=new k;w.geometry=this.showAllFeatures?null:this.map.extent;w.outFields=c;var t=["collection","kml","geo_rss"];a.selfType&&-1<t.indexOf(a.selfType)?this.showAllFeatures&&
b&&b.fullExtent&&(w.geometry=b.fullExtent):w.where=a.filter?a.filter:"1\x3d1";w.returnGeometry=g;if(a.visible&&m)if(b.queryFeatures)a.listDisabled||r.push(b.queryFeatures(w)),r.push(b.queryIds(w));else{if(q=a.li.url,-1<q.indexOf("MapServer")||-1<q.indexOf("FeatureServer"))m=new W(q),a.listDisabled||r.push(m.execute(w)),r.push(m.executeForIds(w))}else this._updateList([],a.legendNode,a.node,[],!0,a);0<r.length&&H(r).then(l.hitch(this,function(e){var k=a.layerObject.id in this.layerList?a.layerObject.id:
a.li.id,m;f&&(m=this.config.countEnabled?f.parentNode:f.previousSibling);e&&1<e.length?(k=e[1])&&n&&k.length>n?this._chunkRequest(b,q,k,n,c,g).then(l.hitch(this,function(b){this._updateList(b,h,f,c,d,a)})):this._updateList(e[0].features,h,f,c,d,a):e&&1===e.length?(this.config.countEnabled&&(f.innerHTML=x.localizeNumber(e[0].length)),this._removeSearching(k,!1)):(this.config.countEnabled&&(f.innerHTML=x.localizeNumber(0)),this.updateExpand(m,!0),this._removeSearching(k,a.legendOpen))}))},_clearList:function(a){!a.isLoaded&&
a.legendNode&&(a.isLoaded=!1,a.legendNode.innerHTML="")},_updateList:function(b,c,d,e,f,g,k){"ClusterLayer"===g.type&&g.layerObject.node&&a.contains(g.layerObject.node.id,"searching")&&a.remove(g.layerObject.node.id,"searching");var h=g.infoTemplate,n=g.li.symbolData.featureDisplayOptions;if(d||c)c&&(g.hasOwnProperty("isLoaded")?!g.isLoaded:1)&&(c.innerHTML=""),f&&d&&this.config.countEnabled&&(d.innerHTML=x.localizeNumber(b.length)),d=this.config.countEnabled?d.parentNode:c.previousSibling,("ClusterLayer"===
g.type&&g.visible||"ClusterLayer"!==g.type)&&this.updateExpand(d,0===b.length);if(!k){if(!g.listDisabled&&!g.isLoaded&&0<b.length){var p;"ClusterLayer"===g.type?p=g.layerObject.renderer:b[0]._graphicsLayer?p=b[0]._graphicsLayer.renderer:g.layerObject.renderer?p=g.layerObject.renderer:g.li.renderer&&(p=r.fromJson(g.li.renderer)||g.li.renderer);d=[];f=[];k=[];for(var t=0;t<b.length;t++){var w=b[t];"undefined"===typeof w.infoTemplate&&h&&(w.infoTemplate=h);var u;p&&p.getSymbol?u=p.getSymbol(w):w.symbol&&
(u=ba.fromJson(w.symbol));var y,B;w._layer&&w._layer.objectIdField?(y=w.attributes[w._layer.objectIdField],B=w._layer.objectIdField):g.li&&g.li.oidFieldName?(y=w.attributes[g.li.oidFieldName.name],B=g.li.oidFieldName.name):g.layerObject&&g.layerObject.objectIdField?(y=w.attributes[g.layerObject.objectIdField],B=g.layerObject.objectIdField):y=c.id+t;var z,A=!1;"*"===e[0]?z=w.attributes:(z=e,A=!0);A=this.getDisplayString(w,g,z,n,B,A);z=A.displayString;var N=A.aliasNames,A=A.firstValue,I,L,J,O;if(n.groupEnabled){var G,
D,H=void 0;if("undefined"===typeof n.groupByField||n.groupByField)I=n.groupField,G=w.attributes[I.name],O="byField",H=G;else if(I=n.groupByRendererOptions.fields[0],G=w.attributes[I.name],L=n.groupByRendererOptions.values,O="byRenderer",null!==G&&""!==G){J=0;a:for(;J<L.length;J++){var M=L[J],C=M.value,C=(C=C.split("\x26\x26"))&&1<C.length?G+C[0]+"\x26\x26 "+G+C[1]:isNaN(G)?"'"+G+"'"+M.value:G+M.value;if(eval(C)){D=M;break a}}"undefined"!==typeof D&&null!==D&&(H=D.label.replace(/ /g,""))}L="group_"+
g.li.id+"_"+I.name+"_"+H;var M=!0,K;if(0<d.length)a:for(J=0;J<d.length;J++)if(C=d[J],L===C.id&&("byField"===O&&G===C.value||"byRenderer"===O)){M=!1;K=C.node;J=C.parent;break a}if(M){J=m.create("div",{"class":this.isDartTheme?"groupItem-dart":"groupItem",id:L+"_c"});var M=m.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:L+"_t"},J),C="",P="byRenderer"===O?"":I.name+": ";"undefined"!==typeof N&&N.hasOwnProperty(I.name)&&""!==N[I.name]&&(P="byField"===O?N[I.name]+": ":
"");"byField"===O?"undefined"!==typeof I.label&&""!==I.label&&(P=C=I.label+": "):"undefined"!==typeof D?"undefined"!==typeof D.label&&""!==D.label&&(P=C=P+D.label):P=C=P+G;": "===C&&(P=C="");N=G;this._checkDateField(g,I.name)&&(N=this.formatDateValue(G,I.name,g));var E=this._checkDomainField(g,I.name);E&&(N=this.formatDomainValue(G,E));"byRenderer"===O&&u&&this._createImageDataDiv(l.clone(u),30,30,M,F);m.create("div",{"class":"byField"===O?this.isDartTheme?"groupField-dart":"groupField":"groupFieldImage",
innerHTML:"byField"===O?C+N:C,title:"byField"===O?P+N:P},M);F=!1;g.openGroups&&0<g.openGroups.length&&(F=-1<g.openGroups.indexOf(L));N=this.isDartTheme?" darkThemeColor":" lightThemeColor";N=m.create("div",{"class":this.isDartTheme?"groupCountLabel-dart":"groupCountLabel"+N},M);M=m.create("div",{"class":this.isDartTheme?"expandImageContainer-dart":"expandImageContainer"},M);C=this.isDartTheme?"groupItemImageUp-dart":"groupItemImageUp";P=this.isDartTheme?"groupItemImageDown-dart":"groupItemImageDown";
E=this.isDartTheme?"groupItemImage-dart":"groupItemImage";E+=F?" "+C:" "+P;m.create("div",{"class":E},M);E=this.isDartTheme?"groupItem-dart":"groupItem";E+=g.groupOpen&&F?" groupOn":" groupOff";L=m.create("div",{"class":E,id:L},J);d.push({id:"group_"+g.li.id+"_"+I.name+"_"+H,node:L,parent:J,value:G});f.push({value:G,node:J,countNode:N,count:1});q(J,"click",l.hitch(this,this._toggleGroup,g))}else f.filter(function(a){if(a.node.id===K.id+"_c")return a})[0].count+=1,L=K}y=m.create("div",{"class":this.isDartTheme?
"featureItem-dart":"featureItem",id:"feature_"+g.li.id+"_"+y});var F=!1;g.li&&g.li.symbolData&&(F="CustomSymbol"===g.li.symbolData.symbolType);!u||n.groupEnabled&&"byRenderer"===O||this._createImageDataDiv(l.clone(u),30,30,y,F);q(y,"click",l.hitch(this,this._panToFeature,w));-1<z.indexOf(" - ")&&(z=z.slice(0,-3));m.create("div",{style:"padding: 7px 5px 5px "+(n.groupEnabled&&"byRenderer"===O?"15px":"35px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:z,title:z},y);k.push({node:y,updateNode:L?
L:c,firstValue:A})}if(0<f.length){b=f.sort(function(a,b){return"undefined"===typeof a.value?b.value:"undefined"===typeof b.value?a.value:isNaN(a.value)?a.value.localeCompare(b.value):parseFloat(a.value)-parseFloat(b.value)});var R=this.config.countEnabled;Q.forEach(b,function(a){R&&(a.countNode.innerHTML=x.localizeNumber(a.count));c.appendChild(a.node)})}0<k.length&&(b=k.sort(function(a,b){var c=a.firstValue,d=b.firstValue;return"undefined"===typeof c||null===c||""===c?1:"undefined"===typeof d||null===
d||""===d?-1:c===d?0:c.toString().localeCompare(d.toString())}),Q.forEach(b,function(a){m.place(a.node,a.updateNode)}))}g.li.layerListExtentChanged=!1;b=g.layerObject.id in this.layerList?g.layerObject.id:g.li.id;this.showAllFeatures&&(g.isLoaded=!0);470>window.innerWidth&&this._setMobileMaxHeight();this._removeSearching(b,g.legendOpen)}},updateDomainValues:function(a,c,d,e){var b,h,f,g;for(g in d)f=c?d[g]:g,b=this._checkDomainField(e,f),h=a.attributes[f],b&&(a.attributes[f]=this.formatDomainValue(h,
b));return a},updateExpand:function(b,c){if("undefined"!==typeof b){var d;-1<b.id.indexOf("rec_")&&(d=b.id.replace("rec_",""),d=n.byId("exp_"+d));c?(b&&(g.addClass(b,"recDefault"),g.addClass(b,"inActive")),d&&(a.contains(d,"expand-empty")||g.addClass(d,"expandInActive"))):(b&&(g.removeClass(b,"recDefault"),g.removeClass(b,"inActive")),d&&(a.contains(d,"expand-empty")||g.removeClass(d,"expandInActive")))}},getDisplayString:function(a,c,d,e,f,g){var b="",h={},k="";0<e.fields.length&&Q.forEach(e.fields,
l.hitch(this,function(e){for(var f in d){var l=g?d[f]:f;if(l===e.name){f=this._checkAliasName(c,l);var m="",n="";"undefined"!==typeof e.label&&(n=e.label,m=""===e.label.trim()?"":": ");e=a.attributes[l];this._checkDateField(c,l)&&(e=this.formatDateValue(e,l,c));var p=this._checkDomainField(c,l);p&&(e=this.formatDomainValue(e,p));(h[l]=f)&&(l=f);""===k&&(k=e);b+=n+m+e+" - ";break}}}));return{displayString:b,aliasNames:h,firstValue:k}},_getInfoTemplate:function(a){var b=a.infoTemplate;b||(a.layerObject&&
a.layerObject.infoTemplate?b=a.layerObject.infoTemplate:a.li&&a.li.infoTemplate&&(b=a.li.infoTemplate));if(!b&&"undefined"!==typeof a.li.subLayerId){var c=a.layerObject.infoTemplates;c&&c.hasOwnProperty(a.li.subLayerId)&&(b=c[a.li.subLayerId].infoTemplate)}return b},formatDomainValue:function(a,c){if(c&&c.codedValues)for(var b=c.codedValues,e=0;e<b.length;e++){var f=b[e];if(f.code===a)return f.name}},formatDateValue:function(a,c,d){if(a){var b;if(d=this._getInfoTemplate(d))if(d=d._fieldsMap)for(var f in d)if(d[f].fieldName===
c){b=d[f].format;break}"undefined"===typeof b&&(b={dateFormat:"shortDate"});return x.fieldFormatter.getFormattedDate(new Date(a),b)}return""},_checkAliasName:function(a,c){var b=a.li.fields;if(b){for(var e=0;e<b.length;e++){var f=b[e];if(f.name===c)return"undefined"!==typeof f.alias?f.alias:!1}return!1}},_checkDomainField:function(a,c){var b=a.li.fields;if(b){for(var e=0;e<b.length;e++){var f=b[e];if(f.name===c)return"undefined"!==typeof f.domain?f.domain:!1}return!1}},_checkDateField:function(a,
c){var b=a.li.fields;if(b){for(var e=0;e<b.length;e++){var f=b[e];if(f.name===c){if("esriFieldTypeDate"===f.type)return!0;break}}return!1}},_checkDisplayField:function(a,c){var b=!0;if(a)for(var e=0;e<a.length;e++){if(a[e].name===c)return a[e];b=!1}return b},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b])},_flashFeature:function(a){var b;if(a.geometry){var c=Y.fromHex(this._styleColor),e=l.clone(c);e.a=.4;switch(a.geometry.type){case "point":b=new R(R.STYLE_CIRCLE,15,
new D(D.STYLE_SOLID,c,1),e);break;case "polyline":b=new D(D.STYLE_SOLID,c,3);break;case "polygon":b=new S(S.STYLE_DIAGONAL_CROSS,new D(D.STYLE_SOLID,c,2),e)}}a=new B(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())z.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;
if("polyline"===b.type)var c=b.paths[Math.ceil(b.paths.length/2)-1],c=c[Math.ceil((c.length-1)/2)],b=new X(c[0],c[1],b.spatialReference);"point"!==b.type&&(b=b.getExtent().getCenter());this._pan(a,b).then(l.hitch(this,function(){this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),this.map.infoWindow.select(0),this.map.infoWindow.show(b)}))}},_pan:function(a,c){var b=new E;this.showAllFeatures&&!this.map.extent.contains(a.geometry)?this.map.centerAt(c).then(function(a){b.resolve(a)}):
b.resolve(void 0);return b},countFeatures:function(a){if(!this.hidePanel){var b=a.layerObject,c=this.config.countEnabled?a.node:a.legendNode,e=new k;e.geometry=this.showAllFeatures?null:this.map.extent;var f=["collection","kml","geo_rss"];a.selfType&&-1<f.indexOf(a.selfType)?this.showAllFeatures&&b&&b.fullExtent&&(e.geometry=b.fullExtent):e.where=a.filter?a.filter:"1\x3d1";b.queryCount&&b.visible?b.queryCount(e,l.hitch(this,function(a){if(c){var b;this.config.countEnabled?(c.innerHTML=x.localizeNumber(a),
b=c.parentNode):b=c.previousSibling;this.updateExpand(b,0===a)}})):a.li&&a.li.url&&(a=a.li.url,(-1<a.indexOf("MapServer")||-1<a.indexOf("FeatureServer"))&&(new W(a)).executeForIds(e).then(l.hitch(this,function(a){if(c){var b=a?a.length:0;this.config.countEnabled?(c.innerHTML=x.localizeNumber(b),a=c.parentNode):a=c.previousSibling;this.updateExpand(a,0===b)}})))}}})});