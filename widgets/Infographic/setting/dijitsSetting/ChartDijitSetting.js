// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Infographic/setting/dijitsSetting/ChartDijitSetting.html":'\x3cdiv\x3e\r\n  \x3cdiv style\x3d"font-size: 14px;"\x3e${nls.chartSettings}\x3c/div\x3e\r\n  \x3cdiv class\x3d"section data-section padding-right-10" data-dojo-attach-point\x3d"dataSection"\x3e\r\n    \x3cdiv class\x3d"section-item chart-mode-section-item feature-mode category-mode count-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.displayMode}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"chartModeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onChartModeChanged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item label-field-section-item feature-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.labelField}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"labelFieldSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onLabelFieldChanged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item category-field-section-item category-mode count-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.categoryField}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"categoryFieldSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onCategoryFieldChanged" class\x3d"restrict-select-width"\x3e\x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \r\n    \x3cdiv class\x3d"section-item category-mode count-mode"\x3e\r\n      \x3cdiv class\x3d"average-align" data-dojo-attach-point\x3d"periodDiv"\x3e\r\n        \x3cdiv\x3e${nls.minPeriod}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"periodSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onChartConfigDijitsChanged" class\x3d"restrict-select-width"\x3e\r\n          \x3coption value\x3d"automatic"\x3e${nls.automatic}\x3c/option\x3e\r\n          \x3coption value\x3d"year"\x3e${nls.year}\x3c/option\x3e\r\n          \x3coption value\x3d"month"\x3e${nls.month}\x3c/option\x3e\r\n          \x3coption value\x3d"day"\x3e${nls.day}\x3c/option\x3e\r\n          \x3coption value\x3d"hour"\x3e${nls.hour}\x3c/option\x3e\r\n          \x3coption value\x3d"minute"\x3e${nls.minute}\x3c/option\x3e\r\n          \x3coption value\x3d"second"\x3e${nls.second}\x3c/option\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \r\n    \x3cdiv class\x3d"section-item category-mode count-mode"\x3e\r\n      \x3cdiv style\x3d"height: auto; margin-top: 5px;margin-bottom: 5px;" class\x3d"average-align flexStart" data-dojo-attach-point\x3d"periodsRecordsDiv"\x3e\r\n        \x3cdiv\x3e${nls.periodsWithOutRecords}\x3c/div\x3e\r\n        \x3cdiv class\x3d"tb-radio-div"\x3e\r\n          \x3cdiv class\x3d"lr-radio-label-div"\x3e\r\n            \x3cinput checked type\x3d"radio" name\x3d"periodswithoutrecords" data-dojo-attach-event\x3d"change:_onChartConfigDijitsChanged" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"showRadioBtn"\x3e\r\n            \x3clabel class\x3d"marginleft10 textOverFlow tb-radio-label" title\x3d"${nls.show}"\x3e${nls.show}\x3c/label\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv style\x3d"margin-top: 10px;" class\x3d"lr-radio-label-div"\x3e\r\n            \x3cinput type\x3d"radio" name\x3d"periodswithoutrecords" data-dojo-attach-event\x3d"change:_onChartConfigDijitsChanged" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"hideRadioBtn"\x3e\r\n            \x3clabel class\x3d"marginleft10 textOverFlow tb-radio-label" title\x3d"${nls.hide}"\x3e${nls.hide}\x3c/label\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e \r\n\r\n    \x3cdiv class\x3d"section-item operation-section-item category-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.operation}\x3c/div\x3e\r\n      \x3cselect data-dojo-attach-point\x3d"operationSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"change:_onOperationSelectChanged" class\x3d"restrict-select-width"\x3e\r\n        \x3coption value\x3d"sum"\x3e${nls.sumOption}\x3c/option\x3e\r\n        \x3coption value\x3d"average"\x3e${nls.averageOption}\x3c/option\x3e\r\n        \x3coption value\x3d"min"\x3e${nls.minOption}\x3c/option\x3e\r\n        \x3coption value\x3d"max"\x3e${nls.maxOption}\x3c/option\x3e\r\n      \x3c/select\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"section-item category-mode field-mode"\x3e\r\n      \x3cdiv style\x3d"height: auto; margin-top: 5px;margin-bottom: 10px;" class\x3d"average-align flexStart" data-dojo-attach-point\x3d"nullValue"\x3e\r\n        \x3cdiv\x3e${nls.nullValue}\x3c/div\x3e\r\n        \x3cdiv class\x3d"tb-radio-div"\x3e\r\n          \x3cdiv class\x3d"lr-radio-label-div"\x3e\r\n            \x3cinput checked type\x3d"radio" name\x3d"nullValue" data-dojo-attach-event\x3d"change:_onChartConfigDijitsChanged" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"zeroRadioBtn"\x3e\r\n            \x3clabel class\x3d"marginleft10 textOverFlow tb-radio-label" title\x3d"${nls.calculatedAsZero}"\x3e${nls.calculatedAsZero}\x3c/label\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv style\x3d"margin-top: 10px;" class\x3d"lr-radio-label-div"\x3e\r\n            \x3cinput type\x3d"radio" name\x3d"nullValue" data-dojo-attach-event\x3d"change:_onChartConfigDijitsChanged" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"ignoreRadioBtn"\x3e\r\n            \x3clabel class\x3d"marginleft10 textOverFlow tb-radio-label" title\x3d"${nls.ignored}"\x3e${nls.ignored}\x3c/label\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e \r\n\r\n    \x3cdiv style\x3d"height: auto;" class\x3d"section-item value-fields-section-item feature-mode category-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.valueFields}\x3c/div\x3e\r\n      \x3cdiv\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"valueFields" data-dojo-type\x3d"jimu/dijit/_DataFields" data-dojo-attach-event\x3d"change:_onValueFieldsChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"height: auto; margin-top: 10px" class\x3d"section-item feature-mode category-mode count-mode field-mode average-align flexStart"\x3e\r\n      \x3cdiv\x3e${nls.sortBy}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"chartSort"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \r\n    \x3cdiv style\x3d"margin-top: 5px" class\x3d"section-item feature-mode category-mode count-mode field-mode average-align"\x3e\r\n      \x3cdiv\x3e${nls.maxCategories}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"maxLabelsDiv"\x3e   \r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"section display-section" data-dojo-attach-point\x3d"displaySection"\x3e\r\n    \x3cdiv class\x3d"section-item column-type bar-type pie-type line-type average-align"\x3e\r\n      \x3cdiv\x3e${nls.backgroundColor}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"bgColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onBgColorChanged"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv style\x3d"height: auto;" class\x3d"section-item column-type bar-type pie-type line-type average-align flexStart"\x3e\r\n      \x3cdiv\x3e${nls.chartColor}\x3c/div\x3e\r\n      \x3cdiv class\x3d"tb-flex"\x3e\r\n\r\n        \x3cdiv style\x3d"margin-bottom: 10px;" data-dojo-attach-point\x3d"useLayerSymbolController" class\x3d"lr-flex"\x3e\r\n           \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"useLayerSymbol" data-dojo-attach-event\x3d"change:_onUseLayerSymbolChange"\x3e\x3c/div\x3e\x3clabel class\x3d"jimu-leading-margin05 check-label textOverFlow" title\x3d"${nls.useLayerSymbology}"\x3e${nls.useLayerSymbology}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"chartColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onChartColorChanged"\x3e\x3c/div\x3e\r\n\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"legendTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"legendTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onLegendTextColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"horTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"horTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onHorColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"verTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"verTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onVerColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"dataLabelTogglePocketContent"\x3e\r\n      \x3cdiv class\x3d"average-align"\x3e\r\n        \x3cdiv\x3e${nls.textColor}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dataLabelTextColor" data-dojo-type\x3d"widgets/Infographic/setting/dijitsSetting/_dijits/ChartColorSetting" data-dojo-attach-event\x3d"change:_onDataLabelColorChanged"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/on dojo/query dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./BaseDijitSetting dijit/_WidgetsInTemplateMixin dojo/text!./ChartDijitSetting.html jimu/utils jimu/DataSourceManager jimu/LayerInfos/LayerInfos jimu/dijit/TabContainer3 ./_dijits/ChartSort ./_dijits/TogglePocket dijit/form/NumberSpinner ./_dijits/ChartColorSetting jimu/utils jimu/dijit/_DataFields dijit/form/Select".split(" "),function(h,m,d,g,k,n,p,q,r,t,u,v,w,x,l,y){return n([p,q],{templateString:r,type:"chart",
baseClass:"infographic-chart-dijit-setting",layerDefinition:null,_webMapLayerId:null,highLightColor:"#ff0000",oidFieldType:"esriFieldTypeOID",_stringFieldType:"esriFieldTypeString",_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_dateFieldType:"esriFieldTypeDate",ignoreChangeEvents:!1,layerInfosObj:null,dataSourceManager:null,dataSourceType:"",allAvailableValueFields:null,tabContainer:null,_layerIsFromMap:!1,postCreate:function(){this.inherited(arguments);
this.layerInfosObj=v.getInstanceSync();this.dataSourceManager=u.getInstance();this._setDefaultValueForConfig();this._initSelf();this._hasLoaded=!0},_initSelf:function(){this.tabContainer=new w({average:!0,tabs:[{title:this.nls.data,content:this.dataSection},{title:this.nls.display,content:this.displaySection}]});this.legendTogglePocket=new l({titleLabel:this.nls.legend,content:this.legendTogglePocketContent,className:"section-item column-type bar-type line-type pie-type"});this.own(h(this.legendTogglePocket,
"change",d.hitch(this,this._onLegendTogglePocketChanged)));this.legendTogglePocket.placeAt(this.displaySection);this.horTogglePocket=new l({titleLabel:this.nls.horizontalAxis,content:this.horTogglePocketContent,className:"section-item column-type bar-type line-type"});this.own(h(this.horTogglePocket,"change",d.hitch(this,this._onHorTogglePocketChanged)));this.horTogglePocket.placeAt(this.displaySection);this.verTogglePocket=new l({titleLabel:this.nls.verticalAxis,content:this.verTogglePocketContent,
className:"section-item column-type bar-type line-type"});this.own(h(this.verTogglePocket,"change",d.hitch(this,this._onVerTogglePocketChanged)));this.verTogglePocket.placeAt(this.displaySection);this.dataLabelTogglePocket=new l({titleLabel:this.nls.dataLabels,content:this.dataLabelTogglePocketContent,className:"section-item pie-type"});this.own(h(this.dataLabelTogglePocket,"change",d.hitch(this,this._onDataLabelsTogglePocketChanged)));this.dataLabelTogglePocket.placeAt(this.displaySection);this.chartSortDijit=
new x({nls:this.nls,layerDefinition:this.layerDefinition});this.own(h(this.chartSortDijit,"change",d.hitch(this,this._onChartConfigDijitsChanged)));this.chartSortDijit.placeAt(this.chartSort);this.tabContainer.placeAt(this.domNode);this.maxLabels=new y({intermediateChanges:!0});"pie"===this.config.type?(this.maxLabels.constraints={min:1,max:100},this.maxLabels.set("value",100),this.maxLabels.required=!0):(this.maxLabels.constraints={min:1,max:3E3},this.maxLabels.required=!1);this.own(h(this.maxLabels,
"change",function(){this._onChartConfigDijitsChanged()}.bind(this)));this.maxLabels.placeAt(this.maxLabelsDiv);this.ignoreChangeEvents=!0;this._clear();this.ignoreChangeEvents=!1;this._onChartModeChanged();this._updateDijitBackgroundColor()},_setDefaultValueForConfig:function(){this.config&&(this.config.backgroundColor||(this.config.backgroundColor="#ffffff"),this.config.legendTextColor||(this.config.legendTextColor="#000000"),"pie"===this.config.type?this.config.dataLabelColor||(this.config.dataLabelColor=
"#000000"):(this.config.horizontalAxisTextColor||(this.config.horizontalAxisTextColor="#000000"),this.config.verticalAxisTextColor||(this.config.verticalAxisTextColor="#000000")))},setDataSource:function(a){this.inherited(arguments);this.dataSourceType="";this.categoryFieldSelect.set("disabled",!1);if(a.layerId)this._layerIsFromMap=!0,this.featureLayer=this._getFeatureLayer(a.layerId),this._setDataSourceForLayerId(a);else if(a.frameWorkDsId){var b=a.frameWorkDsId,c=this.dataSourceManager.parseDataSourceId(b);
c&&("undefined"!==c.layerId&&(this._layerIsFromMap=!0,this.featureLayer=this._getFeatureLayer(c.layerId)),b=(this.appConfig.dataSource&&this.appConfig.dataSource.dataSources)[b],"Features"===b.type?this._setDataSourceForFrameworkFeatures(b):"FeatureStatistics"===b.type&&this._setDataSourceForFeatureStatistics(b))}this._switchUseLayerSymbologyDisplay()},_getFeatureLayer:function(a){var b=null;this.map&&"undefined"!==typeof a&&(b=this.map.getLayer(a));return b},_setDataSourceForLayerId:function(a){this.dataSourceType=
"CLIENT_FEATURES";(a=this.layerInfosObj.getLayerInfoById(a.layerId))&&this._getServiceDefinitionByLayerInfo(a).then(d.hitch(this,function(a){this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(a):this._resetByNewLayerDefinition(a);setTimeout(d.hitch(this,function(){this.ignoreChangeEvents=!1}),200)}),d.hitch(this,function(a){console.error(a)}))},_sholdTryUseLayerSymbol:function(){var a=!1,b=this.chartModeSelect.get("value")||"";if(this._layerIsFromMap)if("feature"===b)a=!0;else if("category"===
b||"count"===b)a=this.categoryFieldSelect.get("value"),a=this._shouldDisplayUseLayerSymbolForChartColor(a);return a},_switchUseLayerSymbologyDisplay:function(){this._sholdTryUseLayerSymbol()?this._showUseLayerSymbology():(this.useLayerSymbol.uncheck(),this._hideUseLayerSymbology())},_shouldDisplayUseLayerSymbolForChartColor:function(a){var b=!1;if(!this.featureLayer)return b;if(this.featureLayer.renderer){var c=this.featureLayer.renderer;if("esri.renderer.ClassBreaksRenderer"===c.declaredClass||"esri.renderer.UniqueValueRenderer"===
c.declaredClass)c.attributeField!==a||this._isDateField(a)||(b=!0)}return b},_showUseLayerSymbology:function(){g.setStyle(this.useLayerSymbolController,"display","flex")},_hideUseLayerSymbology:function(){g.setStyle(this.useLayerSymbolController,"display","none")},_getServiceDefinitionByLayerInfo:function(a){return a.getServiceDefinition().then(d.hitch(this,function(b){return b?b:a.getLayerObject().then(d.hitch(this,function(a){return a?t.getFeatureLayerDefinition(a):null}))}))},_setDataSourceForFrameworkFeatures:function(a){this.dataSourceType=
"FRAMEWORK_FEATURES";a=d.clone(a.dataSchema);this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(a):this._resetByNewLayerDefinition(a);setTimeout(d.hitch(this,function(){this.ignoreChangeEvents=!1}),200)},_setDataSourceForFeatureStatistics:function(a){this.dataSourceType="FRAMEWORK_STATISTICS";var b={type:"Table",fields:[]};a=d.clone(a.dataSchema);var c=a.groupByFields||[];this.allAvailableValueFields=k.filter(a.fields,d.hitch(this,function(a){return 0>c.indexOf(a.name)}));b.fields=a.fields;
this.ignoreChangeEvents=!0;this.config.mode?this._resetByConfig(b):this._resetByNewLayerDefinition(b);this.chartModeSelect.removeOption("feature");0<c.length?(this.chartModeSelect.removeOption("field"),this.config.mode||(this.categoryFieldSelect.set("value",c[0]),this.categoryFieldSelect.set("disabled",!0))):(this.chartModeSelect.removeOption("count"),this.chartModeSelect.removeOption("category"));setTimeout(d.hitch(this,function(){this.ignoreChangeEvents=!1}),200)},getConfig:function(){if(this.config){var a=
{mode:"",type:""};if(!this.layerDefinition)return null;var b=this.chartModeSelect.get("value");if(!b)return null;a.mode=b;var c=this.valueFields.getSelectedFieldNames();if("feature"===b){var e={labelField:"",valueFields:[]};if(0===c.length)return null;e.labelField=this.labelFieldSelect.get("value");e.valueFields=c;d.mixin(a,e)}else if("category"===b){e={categoryField:"",operation:"",valueFields:[]};if(0===c.length)return null;e.categoryField=this.categoryFieldSelect.get("value");e.operation=this.operationSelect.get("value");
e.valueFields=c;d.mixin(a,e)}else if("count"===b)c={categoryField:""},c.categoryField=this.categoryFieldSelect.get("value"),d.mixin(a,c);else if("field"===b){e={operation:"",valueFields:[]};if(0===c.length)return null;e.operation=this.operationSelect.get("value");e.valueFields=c;d.mixin(a,e)}c=this.chartSortDijit.getConfig();"feature"===b&&c.field===this.labelFieldSelect.get("value")&&(c.isLabelAxis=!0);a.sortOrder=c;this._isDateFieldAsCategory()&&(c={},c.minPeriod=this.periodSelect.get("value"),
c.isNeedFilled=this.showRadioBtn.checked,a.dateConfig=d.clone(c));c=this.maxLabels.get("value");if(!this.maxLabels.isValid()||"pie"===this.config.type&&""===c)return!1;c&&(a.maxLabels=c);if("category"===b||"field"===b)a.nullValue=this.zeroRadioBtn.checked?!0:!1;this._sholdTryUseLayerSymbol()&&(a.useLayerSymbology=this.useLayerSymbol.getValue());a.type=this.config.type;a.backgroundColor=this.bgColor.getSingleColor();this.useLayerSymbol.getValue()||(a.colors=this.chartColor.getColors());a.showLegend=
this.legendTogglePocket.getState();a.legendTextColor=this.legendTextColor.getSingleColor();"pie"===a.type?(a.showDataLabel=this.dataLabelTogglePocket.getState(),a.dataLabelColor=this.dataLabelTextColor.getSingleColor()):(a.showHorizontalAxis=this.horTogglePocket.getState(),a.horizontalAxisTextColor=this.horTextColor.getSingleColor(),a.showVerticalAxis=this.verTogglePocket.getState(),a.verticalAxisTextColor=this.verTextColor.getSingleColor());return a}},_resetByConfig:function(a){a&&(this._resetByNewLayerDefinition(a),
this.chartModeSelect.set("value",this.config.mode),this.config.labelField&&this.labelFieldSelect.set("value",this.config.labelField),this.config.categoryField&&this.categoryFieldSelect.set("value",this.config.categoryField),this.config.valueFields&&this.valueFields.selectFields(this.config.valueFields),this.config.operation&&this.operationSelect.set("value",this.config.operation),this.config.dateConfig&&(a=this.config.dateConfig,this.periodSelect.set("value",a.minPeriod),this.showRadioBtn.setChecked(a.isNeedFilled),
this.hideRadioBtn.setChecked(!a.isNeedFilled)),this.config.sortOrder&&this.chartSortDijit.resetUI(this.config.sortOrder),"undefined"!==typeof this.config.maxLabels&&this.maxLabels.set("value",this.config.maxLabels),"undefined"!==typeof this.config.nullValue&&(this.zeroRadioBtn.setChecked(this.config.nullValue),this.ignoreRadioBtn.setChecked(!this.config.nullValue)),"undefined"!==typeof this.config.useLayerSymbology&&(this.config.useLayerSymbology?this.useLayerSymbol.check():this.useLayerSymbol.uncheck()),
this._tryUpdatePreview())},_resetByNewLayerDefinition:function(a){a&&(this._addAliasForLayerInfo(a),this._clear(),this.layerDefinition=a,this._resetFieldsDijitsByLayerInfo(this.layerDefinition))},_clear:function(){this.allAvailableValueFields=this.layerDefinition=null;this.dijit.clearChart();this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());this.categoryFieldSelect.set("disabled",!1);this.labelFieldSelect.removeOption(this.labelFieldSelect.getOptions());this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());
this.operationSelect.set("value","sum");this.valueFields.clear();this.chartSortDijit&&this.chartSortDijit.clear();this._checkPieValueFields();this._updateChartTypes();this.bgColor.setSingleColor(this.config.backgroundColor);this.config.colors?(this.chartColor.setColorsAutomatically(this.config.colors[0]),this.chartColor.setColorsAutomatically(this.config.colors)):this.chartColor.setColorsAutomatically(["#5d9cd3"]);this.legendTextColor.setSingleColor(this.config.legendTextColor);this.horTextColor.setSingleColor(this.config.horizontalAxisTextColor);
this.verTextColor.setSingleColor(this.config.verticalAxisTextColor);this.dataLabelTextColor.setSingleColor(this.config.dataLabelColor);this.legendTogglePocket.setState(!!this.config.showLegend);this.horTogglePocket.setState(!!this.config.showHorizontalAxis);this.verTogglePocket.setState(!!this.config.showVerticalAxis);this.dataLabelTogglePocket.setState(!!this.config.showDataLabel)},_resetFieldsDijitsByLayerInfo:function(a){this.chartModeSelect.removeOption(this.chartModeSelect.getOptions());if(this._hasNumberFields(a)){this.chartModeSelect.addOption({value:"feature",
label:this.nls.featureOption});this.chartModeSelect.addOption({value:"category",label:this.nls.categoryOption});this.chartModeSelect.addOption({value:"count",label:this.nls.countOption});this.chartModeSelect.addOption({value:"field",label:this.nls.fieldOption});var b=this.chartModeSelect.getOptions()[0];this.chartModeSelect.set("value",b.value)}else this.chartModeSelect.addOption({value:"count",label:this.nls.countOption}),this.chartModeSelect.set("value","count");var c=a.displayField;a=d.clone(a.fields);
a.forEach(function(a){a.checked=!1});var e=[this._stringFieldType,this._dateFieldType],e=e.concat(d.clone(this._numberFieldTypes)),b=k.filter(a,d.hitch(this,function(a){return 0<=e.indexOf(a.type)}));this.categoryFieldSelect.removeOption(this.categoryFieldSelect.getOptions());var f="";k.forEach(b,d.hitch(this,function(a){this.categoryFieldSelect.addOption({value:a.name,label:a.alias||a.name});a.name===c&&(f=c)}));this.categoryFieldSelect.set("value",f);var g=[this._stringFieldType,this.oidFieldType,
this._dateFieldType].concat(d.clone(this._numberFieldTypes)),b=k.filter(a,d.hitch(this,function(a){return 0<=g.indexOf(a.type)}));this.labelFieldSelect.removeOption(this.labelFieldSelect.getOptions());var h="";k.forEach(b,d.hitch(this,function(a){var b={value:a.name,label:a.alias||a.name};c?a.name===c&&(h=a.name):a.type===this.oidFieldType&&(h=a.name);this.labelFieldSelect.addOption(b)}));this.labelFieldSelect.set("value",h);a=k.filter(a,d.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)}));
this.valueFields.setFields(a);b=this.chartModeSelect.get("value")||"";a=this.config.sortOrder?this.config.sortOrder.field:this.chartSortDijit.getSelectedField(b);b=this._getSortFieldOptions(b);this.chartSortDijit.setFields(b,a)},_addAliasForLayerInfo:function(a){a&&a.fields&&0<a.fields.length&&k.forEach(a.fields,d.hitch(this,function(a){a.name&&!a.alias&&(a.alias=a.name)}))},_getSortFieldOptions:function(a){if(this.layerDefinition&&this.layerDefinition.fields)return"feature"===a?this._getOptionOfFieldSelect():
this.valueFields.getSelectedFieldNames().map(function(a){var b={value:a};b.label=this._getFieldAliasByFieldName(a);return b}.bind(this))},_hasNumberFields:function(a){var b=!1;(a=a.fields)&&0<a.length&&(b=k.some(a,d.hitch(this,function(a){return 0<=this._numberFieldTypes.indexOf(a.type)})));return b},_checkPieValueFields:function(){var a=this.chartModeSelect.get("value");"feature"!==a&&"category"!==a||!this.config||"pie"!==this.config.type?this.valueFields.setMultipleMode():this.valueFields.setSingleMode()},
_onChartModeChanged:function(){this._checkPieValueFields();var a=this.chartModeSelect.get("value")||"",b=a+"-mode",c=m(".section-item",this.dataSection);k.forEach(c,d.hitch(this,function(a){g.hasClass(a,b)?this._showSectionItem(a):this._hideSectionItem(a)}));this._updateChartTypes(a);this._handleDateCategoryField();this._switchUseLayerSymbologyDisplay();this._updateChartSortWhenChartModeChanged(a);this._onChartConfigDijitsChanged()},_updateChartSortWhenChartModeChanged:function(a){this.chartSortDijit&&
(this.chartSortDijit.switchMode(a,this.config.type),this._updateChartSortFieldByValueFields(a))},_updateChartSortFieldByValueFields:function(a){var b=this._getSortFieldOptions(a);a=this.config.sortOrder?this.config.sortOrder.field:this.chartSortDijit.getSelectedField(a);this.chartSortDijit.setFields(b,a)},_onLabelFieldChanged:function(){this._onChartConfigDijitsChanged()},_isDateFieldAsCategory:function(){var a=this.categoryFieldSelect.get("value"),a=this._isDateField(a),b=this.chartModeSelect.get("value");
return("category"===b||"count"===b)&&a},_handleDateCategoryField:function(){this._isDateFieldAsCategory()?(this._showPeridoDiv(),this._showPeriodsRecordsDiv()):(this._hidePeridoDiv(),this._hidePeriodsRecordsDiv())},_showPeridoDiv:function(){g.setStyle(this.periodDiv,"display","")},_hidePeridoDiv:function(){g.setStyle(this.periodDiv,"display","none")},_showPeriodsRecordsDiv:function(){g.setStyle(this.periodsRecordsDiv,"display","")},_hidePeriodsRecordsDiv:function(){g.setStyle(this.periodsRecordsDiv,
"display","none")},_onCategoryFieldChanged:function(){this._switchUseLayerSymbologyDisplay();this._handleDateCategoryField();this._onChartConfigDijitsChanged()},_onOperationSelectChanged:function(){this._onChartConfigDijitsChanged()},_onValueFieldsChanged:function(){var a=this.chartModeSelect.get("value")||"";"feature"!==a&&this._updateChartSortFieldByValueFields(a);this._updateChartTypes();this._onChartConfigDijitsChanged()},_onBgColorChanged:function(){this._updateDijitBackgroundColor();this._onChartConfigDijitsChanged()},
_updateDijitBackgroundColor:function(){var a=this.bgColor.getSingleColor();this.dijit.setBackgroundColor(a)},_onChartColorChanged:function(){this._onChartConfigDijitsChanged()},_onUseLayerSymbolChange:function(a){var b=this.config.type;a?(this.chartColor.disable(),this.legendTogglePocket&&"pie"!==b&&(this.legendTogglePocket.setState(!1),this._hideLegend())):(this.chartColor.enable(),"pie"!==b&&this._showLegend());this._onChartConfigDijitsChanged()},_hideLegend:function(){this.legendTogglePocket&&
this.legendTogglePocket.hide()},_showLegend:function(){this.legendTogglePocket&&this.legendTogglePocket.show()},_onLegendTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onLegendTextColorChanged:function(){this._onChartConfigDijitsChanged()},_onHorTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onHorColorChanged:function(){this._onChartConfigDijitsChanged()},_onVerTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onVerColorChanged:function(){this._onChartConfigDijitsChanged()},
_onDataLabelsTogglePocketChanged:function(){this._onChartConfigDijitsChanged()},_onDataLabelColorChanged:function(){this._onChartConfigDijitsChanged()},_onChartConfigDijitsChanged:function(){this.ignoreChangeEvents||this.getConfig()&&this._tryUpdatePreview()},_updateChartTypes:function(){var a=this.valueFields.getSelectedFieldNames().length,b=this.chartModeSelect.get("value"),c=this.config.type,e=c+"-type",f=m(".section-item",this.displaySection);k.forEach(f,d.hitch(this,function(a){g.hasClass(a,
e)?this._showSectionItem(a):this._hideSectionItem(a)}));"pie"===c?this.chartColor.setMode(!1):"feature"===b||"category"===b?1===a?this.chartColor.setMode(!0):this.chartColor.setMode(!1):this.chartColor.setMode(!0)},_showSectionItem:function(a){g.removeClass(a,"hide")},_hideSectionItem:function(a){g.addClass(a,"hide")},_tryUpdatePreview:function(){var a=this.getConfig();this.dijit.setConfig(a)},_getDefStatus:function(a){return a?a.isFulfilled()?a.isResolved()?2:-1:1:0},_isDateField:function(a){return(a=
this._getFieldInfo(a,1))?"esriFieldTypeDate"===a.type:!1},_getOptionOfFieldSelect:function(){return d.clone(this.layerDefinition.fields).map(function(a){return{label:a.alias||a.name,value:a.name}})},_getFieldAliasByFieldName:function(a){var b=a;if(a=this._getFieldInfo(a,1))b=a.alias;return b},_getFieldInfo:function(a,b){var c=null;if(this.layerDefinition)for(var d=this.layerDefinition.fields,f=0;f<d.length;f++)if(1===b&&d[f].name===a)c=d[f];else if(2===b&&d[f].alias===a)c=d[f];else if(d[f].alias===
a||d[f].name===a)c=d[f];return c}})});