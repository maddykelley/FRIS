// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/ParcelDrafter/NewTraverse.html":'\x3cdiv\x3e\r\n    \x3c!-- Traverse grid container--\x3e\r\n    \x3cdiv class\x3d"esriCTNewTraverseContainer"\x3e\r\n        \x3c!-- Traverse grid title--\x3e\r\n        \x3cdiv class\x3d"esriCTNewTraverseLabelDiv"\x3e\r\n            \x3cdiv class\x3d"esriCTGridEmptyLabel"\x3e\r\n                \x26nbsp\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis esriCTGridBearingLabel" title\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n                ${nls.traverseSettings.bearingLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n                ${nls.traverseSettings.lengthLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.radiusLabel}"\x3e\r\n                ${nls.traverseSettings.radiusLabel}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid items--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseGrid" class\x3d"esriCTTraverseGrid"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid initial entry row--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseEntryNode" class\x3d"esriCTEntrtyNodeContent esriCTRow"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lineSymbolNode" class\x3d"esriCTSymbolContainer"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"bearingNode" class\x3d"esriCTBearingRow" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lengthNode" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"radiusNode" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTAddRow"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"addButton" class\x3d"esriCTAddIcon"\r\n                title\x3d"${nls.traverseSettings.addButtonTitle}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid tools container--\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseTool"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseToolContainer"\x3e\r\n                \x3c!-- Screen digitization tool--\x3e\r\n                \x3cdiv class\x3d"esriCTTraverseToolIcons ecriCTLocationIcon esriCTCursorPointer" title\x3d"${nls.planSettings.onScreenDigitizationTooltipText}"\r\n                    data-dojo-attach-point\x3d"screenDigitizationNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Zoom tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden esriCTTraverseToolIcons ecriCTZoomToIcon esriCTCursorPointer" title\x3d"${nls.planSettings.zoomToLocationTooltipText}"\r\n                    data-dojo-attach-point\x3d"zoomToNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Expand/Collapse grid tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden  esriCTTraverseToolIcons esriCTCollapse esriCTCursorPointer" title\x3d"${nls.planSettings.collapseGridTooltipText}"\r\n                    data-dojo-attach-point\x3d"expandCollapseNode"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Misclose details container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"misCloseDetailsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel tools (rotation/scale) container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"parcelToolsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel info (polygon layer fields) \x26 save/cancle button container--\x3e\r\n    \x3cdiv class\x3d"esriCTPlanInfoNode" data-dojo-attach-point\x3d"planInfoNode"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./NewTraverse.html dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dnd/Source dojo/on dijit/form/ValidationTextBox ./SymbolSelector ./MiscloseDetails ./ParcelTools ./PlanInfo ./geometryUtils ./utils esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/graphicsUtils dojo/dom-attr dojo/query esri/SpatialReference dojo/keys dijit/focus dijit/TooltipDialog dijit/popup dojo/Deferred esri/geometry/Extent dojo/dom-geometry".split(" "),
function(D,E,F,G,H,f,t,k,m,z,I,q,J,K,L,M,N,g,n,v,A,w,O,p,x,B,r,u,P,C,Q,R,y){return D([E,F,G],{baseClass:"jimu-widget-ParcelDrafter",templateString:H,parcelLinesGraphicsLayer:null,parcelPointsGraphicsLayer:null,parcelPolygonGraphicsLayer:null,lineLayerSpatialReference:null,polygonLayerSpatialReference:null,_itemList:[],_nodes:[],_dndContainer:null,startPoint:null,_startPointForNextLine:null,_planSettings:null,_arrayOfAllBoundaryLines:[],_rotationAngle:0,_scaleValue:1,polygonDeleteArr:[],polylineDeleteArr:[],
_popupDialog:null,_popupCoords:null,numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],lengthFieldPlaces:2,radiusFieldPlaces:2,miscloseDistanceFieldPlaces:2,postCreate:function(){this.numberFieldTypes=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];this.polygonDeleteArr=[];this.polylineDeleteArr=[];this._arrayOfAllBoundaryLines=[];this._nodes=[];this._itemList=[];k.add(this.domNode,"esriCTNewTraverseGrid");
this._addGraphicsLayer();this._createTraverseGrid();this._setValidatorForInitialRow();this._handleEventsOnInitialRow();this._symbolSelector=this._createLineSelector(this.lineSymbolNode,null);this.own(q(this.screenDigitizationNode,"click",f.hitch(this,this._onDigitizationButtonClicked)));this.own(q(this.zoomToNode,"click",f.hitch(this,this._onZoomButtonClicked)));this.own(q(this.expandCollapseNode,"click",f.hitch(this,this._onExpandCollapseClicked)));this.own(q(this.addButton,"click",f.hitch(this,
function(){this._addNewItem(!1)})));this._createMiscloseDetails();this._createParcelTools();this._createPlanInfo();this._createTooltip();this.config.polylineLayer&&this.config.polylineLayer.popupInfo&&this.config.polylineLayer.popupInfo.fieldInfos&&t.forEach(this.config.polylineLayer.popupInfo.fieldInfos,f.hitch(this,function(a){a.fieldName===this.config.polylineLayer.bearing.name&&a.format&&(n.bearingFieldPlaces=a.format.places);a.fieldName===this.config.polylineLayer.distance.name&&a.format&&(this.lengthFieldPlaces=
a.format.places);a.fieldName===this.config.polylineLayer.radius.name&&a.format&&(this.radiusFieldPlaces=a.format.places)}));this.config.polygonLayer&&this.config.polygonLayer.popupInfo&&this.config.polygonLayer.popupInfo.fieldInfos&&t.forEach(this.config.polygonLayer.popupInfo.fieldInfos,f.hitch(this,function(a){a.fieldName===this.config.polygonLayer.miscloseDistance.name&&a.format&&(this.miscloseDistanceFieldPlaces=a.format.places)}))},_addGraphicsLayer:function(){this.parcelPolygonGraphicsLayer=
new w;this.parcelLinesGraphicsLayer=new w;this.parcelPointsGraphicsLayer=new w;this.map.addLayer(this.parcelPolygonGraphicsLayer);this.map.addLayer(this.parcelLinesGraphicsLayer);this.map.addLayer(this.parcelPointsGraphicsLayer)},_setValidatorForInitialRow:function(){this.bearingNode.validator=f.hitch(this,function(a){return this._bearingValidator(a,["*","*tb"])});this.bearingNode.invalidMessage=this.nls.newTraverse.invalidBearingMessage;this.lengthNode.validator=f.hitch(this,function(a){if("*"===
a&&this._itemList&&0<this._itemList.length)return!0;if(""===this.radiusNode.get("value")&&0>parseFloat(a))return this.lengthNode.invalidMessage=this.nls.newTraverse.negativeLengthMessage,!1;this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;return this._lengthValidator(a)});this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;this.radiusNode.validator=f.hitch(this,function(a){var d;if("*"===a&&this._itemList&&0<this._itemList.length)return!0;d=this._radiusValidator(a);
if(""!==a)if((a=this.lengthNode.isValid())&&d){if(!this._validateLengthRadiusProportion(d,a))return null;d&&(a=this.lengthNode.value,this.lengthNode.reset(),this.lengthNode.set("value",a))}else d=null;return d});this.radiusNode.invalidMessage=this.nls.newTraverse.invalidRadiusMessage},_bearingValidator:function(a,d){return-1!==d.indexOf(a)&&this._itemList&&0<this._itemList.length?!0:this._validateBearing(a,d)},_lengthValidator:function(a,d){return""===a||"0"===a||0===a?!1:this._validateLength(a,d)},
_radiusValidator:function(a,d){return""===a?!0:this._validateLength(a,d)},_handleEventsOnInitialRow:function(){this.own(q(this.bearingNode,"keypress",f.hitch(this,this._bearingValueEntered)));this.own(q(this.lengthNode,"keypress",f.hitch(this,this._lengthValueEntered)));this.own(q(this.radiusNode,"keypress",f.hitch(this,this._radiusValueEntered)))},_copyPrevValue:function(a){switch(a){case "Bearing":a=this.bearingNode.get("value");"*"===a&&0<this._itemList.length&&(a=this._itemList[this._itemList.length-
1].BearingConversions?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",a));break;case "Length":a=this.lengthNode.get("value");"*"===a&&0<this._itemList.length&&(a="radiusAndArcLength"===this._planSettings.circularCurveParameters&&this._itemList[this._itemList.length-1].ArcLengthConversions?this._itemList[this._itemList.length-1].ArcLengthConversions[this._planSettings.distanceAndLengthUnits]:
this._itemList[this._itemList.length-1].LengthConversions?this._itemList[this._itemList.length-1].LengthConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].Length,this.lengthNode.set("value",a));break;case "Radius":a=this.radiusNode.get("value"),"*"===a&&0<this._itemList.length&&(a=this._itemList[this._itemList.length-1].RadiusConversions?this._itemList[this._itemList.length-1].RadiusConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-
1].Radius,this.radiusNode.set("value",a))}},_bearingValueEntered:function(a){a=a.charCode||a.keyCode;a===r.ENTER||a===r.TAB?(this.bearingNode.get("value"),this._copyPrevValue("Bearing"),a===r.ENTER&&this.bearingNode.isValid()?u.focus(this.lengthNode):this.bearingNode.validate(!1)):setTimeout(f.hitch(this,function(){this.bearingNode.validate(!1)}),100)},_lengthValueEntered:function(a){a=a.charCode||a.keyCode;a===r.ENTER||a===r.TAB?(this.lengthNode.get("value"),this._copyPrevValue("Length"),a===r.ENTER&&
this.lengthNode.isValid()?u.focus(this.radiusNode):this.lengthNode.validate(!1)):setTimeout(f.hitch(this,function(){this.lengthNode.validate(!1)}),100)},_radiusValueEntered:function(a){a=a.charCode||a.keyCode;a===r.ENTER||a===r.TAB?(a=this.radiusNode.get("value"),this._copyPrevValue("Radius"),""===a||this.radiusNode.isValid()?this.bearingNode.isValid()?this.lengthNode.isValid()?(this._addNewItem(),u.focus(this.bearingNode)):(this.lengthNode.validate(!1),u.focus(this.lengthNode)):(this.bearingNode.validate(!1),
u.focus(this.bearingNode)):this.radiusNode.validate(!1)):setTimeout(f.hitch(this,function(){this.radiusNode.validate(!1)}),100)},_validateBearing:function(a){return(a=n.categorizeBearingFormat(a,this._planSettings))?a:null},_validateLength:function(a,d){var b;switch(d){case "feets":b=n.categorizeLengthFormatForFeet(a);break;case "meters":b=n.categorizeLengthFormat(a,"meters");break;case "uSSurveyFeet":b=n.categorizeLengthFormat(a,"uSSurveyFeet");break;default:b=n.categorizeLengthFormat(a,this._planSettings.distanceAndLengthUnits)}return b?
b:null},_validateLengthRadiusProportion:function(a,d){var b,c;return a&&d&&(c=a[this._planSettings.distanceAndLengthUnits],b=d[this._planSettings.distanceAndLengthUnits],0!==c&&(c=2*parseFloat(Math.abs(c)),"radiusAndArcLength"===this._planSettings.circularCurveParameters&&(c*=Math.PI),c<parseFloat(Math.abs(b))))?null:!0},_getValidatedValues:function(a,d,b){var c={},e;a?(c=a,d&&("Bearing"!==d&&c.BearingConversions&&(c.Bearing=this._getBearingAccordingToPlanSettings(c.BearingConversions)),"Length"!==
d&&c.LengthConversions&&(c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits]),"Radius"!==d&&c.RadiusConversions&&(c.Radius=c.RadiusConversions[this._planSettings.distanceAndLengthUnits]),"Bearing"===d&&"*tb"===c.Bearing.toString().toLowerCase()&&0<this._itemList.length&&0!==b&&(c.isTB=!0))):(this._copyPrevValue("Bearing"),this._copyPrevValue("Length"),this._copyPrevValue("Radius"),c.LineSymbol=this._symbolSelector.selectedSymbol,c.Bearing=this.bearingNode.get("value"),c.Length=
this.lengthNode.get("value"),c.Radius=this.radiusNode.get("value"),"*tb"===c.Bearing.toString().toLowerCase()&&0<this._itemList.length?c.isTB=!0:c.isTB=!1);if(""!==f.trim(c.Bearing.toString())&&""!==f.trim(c.Length.toString())&&((d=this._validateBearing(c.Bearing))||c.isTB)){c.BearingConversions=d;if(""===f.trim(c.Length.toString())&&""===f.trim(c.Radius.toString()))return null;if(""!==f.trim(c.Length.toString()))if((d=this._validateLength(c.Length))&&0!==d.meters){if(""!==f.trim(c.Radius.toString()))if(e=
this._validateLength(c.Radius)){if(!this._validateLengthRadiusProportion(e,d))return null;c.RadiusConversions=e}else return null;else{if(0>parseInt(d.meters,10))return null;c.RadiusConversions=null}c.LengthConversions=d}else return null;c.RadiusConversions&&(c=this._createValuesForArc(c));c.isTB&&(a=a&&!isNaN(b)?this._itemList[b-1]:this._itemList[this._itemList.length-1],c=this._setTangentBearing(c,a))}else return null;return c},_setTangentBearing:function(a,d){var b,c;c=f.clone(this._planSettings);
c.directionOrAngleType="northAzimuth";c.directionOrAngleUnits="decimalDegree";b=d.BearingConversions.naDD;d.RadiusConversions&&0!==d.RadiusConversions.meters&&(b=g.chordBearingToTangentBearing(b,d.RadiusConversions.meters,d.ChordLengthConversions.meters));a.RadiusConversions&&0!==a.RadiusConversions.meters?(b=g.tangentBearingToChordBearing(b,a.RadiusConversions.meters,a.ChordLengthConversions.meters),a.Bearing=b,a.BearingConversions=n.categorizeBearingFormat(a.Bearing,c)):d.RadiusConversions&&0!==
d.RadiusConversions.meters?(a.Bearing=b,a.BearingConversions=n.categorizeBearingFormat(a.Bearing,c)):(a.Bearing=d.Bearing,a.BearingConversions=f.clone(d.BearingConversions));return a},_updateTBFromIndex:function(a){var d;for(d=!1;a<this._itemList.length;a++)if(this._itemList[a]&&this._itemList[a].isTB)this._itemList[a]=this._setTangentBearing(this._itemList[a],this._itemList[a-1]),d=!0;else break;return d},_onZoomButtonClicked:function(){this._setExtentToLayer(this.parcelLinesGraphicsLayer,!0)},_onExpandCollapseClicked:function(){k.toggle(this.traverseGrid,
"esriCTHidden");k.contains(this.expandCollapseNode,"esriCTExpand")?(p.set(this.expandCollapseNode,"title",this.nls.planSettings.collapseGridTooltipText),k.replace(this.expandCollapseNode,"esriCTCollapse","esriCTExpand")):(p.set(this.expandCollapseNode,"title",this.nls.planSettings.expandGridTooltipText),k.replace(this.expandCollapseNode,"esriCTExpand","esriCTCollapse"))},setRotation:function(a){a=g.getRotationAngleBetweenPoints(this.startPoint,a);0<this._itemList.length&&(a-=this._itemList[0].BearingConversions.naDDRound);
360===a&&(a=0);this._parcelToolInstance.setRotation(a)},setScaling:function(a){a=g.getScaleDistanceBetweenPoints(this.startPoint,a);this.distance?(a/=this.distance,.1>a&&(a=.1),this._parcelToolInstance.setScale(a)):this.distance=a},_addNewItem:function(a){var d,b;(d=this._getValidatedValues())?(a&&this._rotationAngle&&(b=d.BearingConversions.naDD-this._rotationAngle,b=this.getAngleFromDDTOQB(360<=b?b%360:b),d.Bearing=b,d.BearingConversions=this._validateBearing(b)),b=f.trim(d.Radius.toString()),this._itemList.push(d),
this._createRow(d,this._itemList.length-1),this._resetEntryRow(a),this.appliedCompassRule?this.setParcelClosure():(""===b||"0"===b||0===b?this._drawStraightLine(d,!0):this._drawArc(d,!0),this._showHideTraverseTools())):this.bearingNode.isValid()?""!==this.lengthNode.get("value")&&this.lengthNode.isValid()?""===this.radiusNode.get("value")||this.radiusNode.isValid()||(u.focus(this.radiusNode),this.radiusNode.validate(!1)):(u.focus(this.lengthNode),this.lengthNode.validate(!1)):(u.focus(this.bearingNode),
this.bearingNode.validate(!1))},_createValuesForArc:function(a){var d;a.RadiusConversions?(d=a.RadiusConversions.meters,"radiusAndArcLength"===this._planSettings.circularCurveParameters?(a.ArcLength=a.LengthConversions.meters,a.ArcLengthConversions=f.clone(a.LengthConversions),a.ChordLength=g.getChordLengthFromArcLength(a.ArcLength,d),a.ChordLengthConversions=this._validateLength(a.ChordLength,"meters")):(a.ChordLength=a.LengthConversions.meters,a.ChordLengthConversions=f.clone(a.LengthConversions),
a.ArcLength=g.getArcLengthFromChordLength(a.ChordLength,d),a.ArcLengthConversions=this._validateLength(a.ArcLength,"meters"))):("radiusAndArcLength"===this._planSettings.circularCurveParameters&&a.ArcLengthConversions&&(a.Length=a.ArcLength,a.LengthConversions=f.clone(a.ArcLengthConversions)),a.ChordLength=0,a.ChordLengthConversions=null,a.ArcLength=0,a.ArcLengthConversions=null);return a},_onDigitizationButtonClicked:function(){k.toggle(this.screenDigitizationNode,"esriCTEnableButton");k.contains(this.screenDigitizationNode,
"esriCTEnableButton")?this.emit("activateDigitizationTool"):this.emit("deActivateDigitizationTool")},_createMiscloseDetails:function(){this._misCloseDetailsInstance=new L({nls:this.nls,config:this.config,appConfig:this.appConfig,numberFieldTypes:this.numberFieldTypes,validateNumericField:this.validateNumericField},m.create("div",{},this.misCloseDetailsNode));this._misCloseDetailsInstance.setMiscloseDetails(null)},_createParcelTools:function(){this._parcelToolInstance=new M({nls:this.nls,config:this.config},
m.create("div",{},this.parcelToolsNode));this.own(this._parcelToolInstance.on("rotateGeometries",f.hitch(this,function(a){a!==this._rotationAngle&&(this._rotationAngle=a,this._itemList&&0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("scaleGeometries",f.hitch(this,function(a){a!==this._scaleValue&&(this._scaleValue=a,this._itemList&&0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("toggleRotating",
f.hitch(this,function(a){this.emit("toggleRotating",a)})));this.own(this._parcelToolInstance.on("toggleScaling",f.hitch(this,function(a){this.emit("toggleScaling",a)})))},_createPlanInfo:function(){this._planInfoInstance=new N({map:this.map,nls:this.nls,config:this.config,loading:this.loading,numberFieldTypes:this.numberFieldTypes,validateNumericField:this.validateNumericField,geometryService:this.geometryService,parcelPolygonGraphicsLayer:this.parcelPolygonGraphicsLayer,parcelLinesGraphicsLayer:this.parcelLinesGraphicsLayer,
polylineLayerUnit:g.getUnitValueForSR(this.lineLayerSpatialReference),polygonLayerUnit:g.getUnitValueForSR(this.polygonLayerSpatialReference)},m.create("div",{},this.planInfoNode));this.own(this._planInfoInstance.on("cancelTraversedParcel",f.hitch(this,function(){this.emit("cancelTraverse")})));this.own(this._planInfoInstance.on("showMessage",f.hitch(this,function(a){this._showMessage(a)})));this.own(this._planInfoInstance.on("saveTraversedParcel",f.hitch(this,function(){var a;this.closePopup();if(this._itemList&&
0<this._itemList.length){var d;d=this._misCloseDetailsInstance.traverseStatedArea.get("value").trim();a=this._planInfoInstance.validateParcelDetails(d);a.status?(""===this._misCloseDetailsInstance.traverseStatedArea.get("value")&&(d=null),a={},a.itemList=this._itemList,a.statedArea=d,a.rotation=this._rotationAngle,a.scale=this._scaleValue,a.appliedCompassRule=this.appliedCompassRule,a.miscloseDetails=this._misCloseDetailsInstance.getMiscloseDetails(),a.polygonDeleteArr=this.polygonDeleteArr,a.polylineDeleteArr=
this.polylineDeleteArr,a.planSettings=this._planSettings,this._planInfoInstance.saveData(a)):this._showMessage(a.message)}else this._showMessage(this.nls.newTraverse.enterValidParcelInfoMessage)})));this.own(this._planInfoInstance.on("displayMainPageAfterSave",f.hitch(this,function(){this.emit("displayMainPageAfterSave")})))},_createTraverseGrid:function(){var a;this._nodes=[];m.empty(this.traverseGrid);this._dndContainer=new I(this.traverseGrid,{skipForm:!0,singular:!0});this._dndContainer.copyState=
function(){return!1};for(a=0;a<this._itemList.length;a++)this._createRow(this._itemList[a],a);this.own(this._dndContainer.on("DndDrop",f.hitch(this,this._onDndDrop)));this._dndContainer.insertNodes(!1,this._nodes)},_createFieldInputs:function(a,d,b,c){var e=new J({value:d,"class":b?b:""});e.placeAt(a);"esriCTBearingRow"===b?(e.validator=f.hitch(this,function(a){"*tb"!==a&&"*"===a.charAt(0)&&(a=a.slice(1));return this._bearingValidator(a,["*tb"])}),e.invalidMessage=this.nls.newTraverse.invalidBearingMessage):
"esriCTLengthRow"===b?(e.validator=f.hitch(this,this._lengthValidator),e.invalidMessage=this.nls.newTraverse.invalidLengthMessage):"esriCTRadiusRow"===b&&(e.validator=f.hitch(this,this._radiusValidator),e.invalidMessage=this.nls.newTraverse.invalidRadiusMessage);this.own(q(e,"blur",f.hitch(this,function(){var b=parseInt(p.get(a,"rowIndex"),10);this._updateParcelValues(e,b,c)})));this.own(q(e,"keypress",f.hitch(this,function(b){(b.charCode||b.keyCode)===r.ENTER&&(b=parseInt(p.get(a,"rowIndex"),10),
this._updateParcelValues(e,b,c));setTimeout(f.hitch(this,function(){e.validate(!1)}),100)})))},_createRow:function(a,d){var b,c,e;b=m.create("div",{"class":"dojoDndItem esriCTRow",rowIndex:d});c=m.create("div",{rowIndex:d},b);this._createLineSelector(c,a.LineSymbol,d);c=this._getBearingAccordingToPlanSettings(a.BearingConversions);a.isTB&&(c="*"+c);this._createFieldInputs(b,c,"esriCTBearingRow");a.RadiusConversions?(c=this._getRoundedValue(a.RadiusConversions,"Radius"),e="radiusAndArcLength"===this._planSettings.circularCurveParameters?
this._getRoundedValue(a.ArcLengthConversions,"Length"):this._getRoundedValue(a.ChordLengthConversions,"Length")):(c="",e=this._getRoundedValue(a.LengthConversions,"Length"));this._createFieldInputs(b,e,"esriCTLengthRow");this._createFieldInputs(b,c,"esriCTRadiusRow");this._createDeleteButton(b,d);this._nodes.push(b);this._dndContainer.clearItems();this._dndContainer.insertNodes(!1,this._nodes)},_createLineSelector:function(a,d,b){var c;c=new K({hideOnSelect:!0,symbolData:this.config.lineTypes},a);
k.add(c.domNode,"esriCTSymbolContainer");d?(c.selectSymbol(d),p.set(c.domNode,"rowIndex",b),c.onSelect=f.hitch(this,function(a){var b;b=parseInt(p.get(c.domNode,"rowIndex"),10);this._itemList[b].LineSymbol=a;this.setStartPoint(this.startPoint)})):c.setDefault();return c},_createDeleteButton:function(a,d){var b;b=m.create("div",{"class":"esriCTDeleteRow"},a);b=m.create("div",{"class":"esriCTDeleteIcon",rowIndex:d,title:this.nls.traverseSettings.deleteButtonTitle},b);this.own(q(b,"click",f.hitch(this,
function(b){b=parseInt(p.get(b.currentTarget,"rowIndex"),10);this._deleteRow(a,b)})))},_deleteRow:function(a,d){var b;if(this._itemList.length){this._dndContainer.delItem(a.id);m.destroy(a);this._nodes.splice(d,1);this._itemList.splice(d,1);this._dndContainer.sync();this._updateRowIndexes();if(this._itemList[d]&&this._itemList[d].isTB){if(1===this._itemList.length||0===d)this._itemList[0].isTB=!1,d++;1<this._itemList.length&&(b=this._updateTBFromIndex(d))}this.appliedCompassRule?this.setParcelClosure(!0):
this.setStartPoint(this.startPoint);b&&this._reGenerateTraverseGrid();this._showHideTraverseTools()}},_updateRowIndexes:function(){var a;a=x(".esriCTRow",this.traverseGrid);t.forEach(a,f.hitch(this,function(a,b){var c;p.set(a,"rowIndex",b);(c=x(".esriCTDeleteIcon",a)[0])&&p.set(c,"rowIndex",b);(c=x(".esriCTSymbolContainer",a)[0])&&p.set(c,"rowIndex",b)}))},_onDndDrop:function(){var a,d=[],b;this._dndContainer.sync();a=this._dndContainer.getAllNodes();a.forEach(f.hitch(this,function(a){a=parseInt(p.get(a,
"rowIndex"),10);d.push(this._itemList[a])}));this._nodes=a;this._itemList=[];this._itemList=d;this._updateRowIndexes();for(a=0;a<this._itemList.length;a++)0===a&&this._itemList[a].isTB&&(this._itemList[a].isTB=!1,b=!0),this._itemList[a]&&this._itemList[a].isTB&&(this._itemList[a]=this._setTangentBearing(this._itemList[a],this._itemList[a-1]),b=!0);this.setStartPoint(this.startPoint);b&&this._reGenerateTraverseGrid()},_updateParcelValues:function(a,d,b){var c,e,h,l=!1,g;if(c=this._itemList[d])if(h=
(h=a.get("value"))?f.trim(h.toString()):"",k.contains(a.domNode,"esriCTBearingRow")&&String(this._getBearingAccordingToPlanSettings(c.BearingConversions))!==h?(e="Bearing",c.Bearing=h,l=!0,-1===h.indexOf("*")&&(c.isTB=!1)):k.contains(a.domNode,"esriCTLengthRow")&&String(this._getRoundedValue(c.LengthConversions,"Length"))!==h?(e="Length",c.Length=h,l=!0):k.contains(a.domNode,"esriCTRadiusRow")&&String(c.Radius)!==h&&(c.RadiusConversions?String(this._getRoundedValue(c.RadiusConversions,"Radius"))!==
h&&(e="Radius",c.Radius=h,l=!0):(e="Radius",c.Radius=h,l=!0)),l)if(h=this._getValidatedValues(c,e,d)){if("Bearing"===e?(e=this._getBearingAccordingToPlanSettings(h.BearingConversions),c.Bearing=this._getBearingAccordingToPlanSettings(h.BearingConversions,!0),c.isTB&&(e="*"+e),a.set("value",e),g=this._updateTBFromIndex(d+1)):"Length"===e?(e=this._getRoundedValue(c.LengthConversions,"Length"),c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits],c.RadiusConversions&&(c=this._createValuesForArc(c)),
a.set("value",e),g=this._updateTBFromIndex(d)):"Radius"===e&&(c.RadiusConversions?(c.Radius=c.RadiusConversions[this._planSettings.distanceAndLengthUnits],e=this._getRoundedValue(c.RadiusConversions,"Radius")):e=c.Radius="",c=this._createValuesForArc(c),a.set("value",e),g=this._updateTBFromIndex(d)),this.appliedCompassRule?this.setParcelClosure(!0):this.setStartPoint(this.startPoint),g||b)this._reGenerateTraverseGrid(),b&&this._popupCoords&&this._openPopup(this._popupCoords)}else this._updateValues(c,
e,a)},_updateValues:function(a,d,b){var c;"Bearing"===d?(a.Bearing=this._getBearingAccordingToPlanSettings(a.BearingConversions,!0),c=this._getBearingAccordingToPlanSettings(a.BearingConversions)):"Length"===d?(a.Length=a.LengthConversions[this._planSettings.distanceAndLengthUnits],c=this._getRoundedValue(a.LengthConversions,"Length")):"Radius"===d&&(a.RadiusConversions?(a.Radius=a.RadiusConversions[this._planSettings.distanceAndLengthUnits],c=this._getRoundedValue(a.RadiusConversions,"Radius")):
c=a.Radius="");b.set("value",c)},_showHideTraverseTools:function(){this._itemList&&0<this._itemList.length?(k.remove(this.expandCollapseNode,"esriCTHidden"),k.remove(this.zoomToNode,"esriCTHidden")):(k.add(this.expandCollapseNode,"esriCTHidden"),k.add(this.zoomToNode,"esriCTHidden"))},_getBearingAccordingToPlanSettings:function(a,d){if("northAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return d?a.naDD:a.naDDRound;if("northAzimuth"===
this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.naDMS;if("southAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return d?a.saDD:a.saDDRound;if("southAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.saDMS;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return d?
a.qb3DD:a.qb3DDRound;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.qb3DMS},_getRoundedValue:function(a,d){var b,c;c=a[this._planSettings.distanceAndLengthUnits];switch(d){case "Length":b=this.lengthFieldPlaces;break;case "Radius":b=this.radiusFieldPlaces;break;case "MiscloseDistance":b=this.miscloseDistanceFieldPlaces}return n.honourPopupRounding(b,c)},_resetEntryRow:function(a){this.bearingNode.set("value",
"");this.lengthNode.set("value","");this.radiusNode.set("value","");this.bearingNode.reset();this.lengthNode.reset();this.radiusNode.reset();0<this._itemList.length&&(a=this._itemList[this._itemList.length-1].isTB?"*tb":a?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",a),this.bearingNode.textbox.setSelectionRange(0,a.length))},_reGenerateTraverseGrid:function(){this._dndContainer&&
(this._dndContainer.destroy(),this._dndContainer=null);m.empty(this.traverseGrid);this._createTraverseGrid()},_reDrawParcel:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();this._arrayOfAllBoundaryLines=[];this._drawPoint(this.startPoint);t.forEach(this._itemList,f.hitch(this,function(a){""===a.Radius||"0"===a.Radius||0===a.Radius?this._drawStraightLine(a,!1):this._drawArc(a,!1)}));this._setExtentToLayer(this.parcelLinesGraphicsLayer);this.setParcelClosure()},
setStartPoint:function(a){var d=new B(4326);g.getProjectedGeometry(a,d,this.geometryService).then(f.hitch(this,function(b){this.startPoint=b;this._startPointForNextLine=f.clone(b);this._orgStartPointForNextLine=f.clone(b);this.appliedCompassRule=!1;0<this._itemList.length?this._reDrawParcel():(this.parcelPointsGraphicsLayer.clear(),this.parcelLinesGraphicsLayer.clear(),this._arrayOfAllBoundaryLines=[],this._drawPoint(a))}))},_addProjectedGraphic:function(a,d,b,c){var e,h={};h.rowIndex=a.graphics.length;
d.attributes=h;4326!==this.map.spatialReference.wkid?g.getProjectedGeometry(d.geometry,this.map.spatialReference,this.geometryService).then(f.hitch(this,function(f){f&&(e=new v(f),e.setAttributes(h),e.setSymbol(d.symbol),a.add(e),b&&(this._setExtentToLayer(a),c&&this.setParcelClosure()))})):(a.add(d),b&&(this._setExtentToLayer(a),c&&this.setParcelClosure()))},_drawPoint:function(a){a=new v(a,A.fromJson(this.config.pointSymbol));this._addProjectedGraphic(this.parcelPointsGraphicsLayer,a,!1,!1)},_drawLineAndEndPoint:function(a,
d,b,c){var e;e=!0;a?(d=g.getLineBetweenPoints(d))?(b=new v(d,A.fromJson(b.LineSymbol.symbol)),this._addProjectedGraphic(this.parcelLinesGraphicsLayer,b,c,!0),this._startPointForNextLine=f.clone(a),this.appliedCompassRule&&this.parcelLinesGraphicsLayer.graphics.length===this._itemList.length&&(e=!1),e&&this._drawPoint(a)):this._showMessage(this.nls.newTraverse.unableToDrawLineMessage):this._showMessage(this.nls.newTraverse.invalidEndPointMessage)},setInfoForCalculatingMisclose:function(a,d,b){a.startPoint=
f.clone(this._orgStartPointForNextLine);a.endpoint=f.clone(d);b=g.getLineBetweenPoints(b);if(a.LineSymbol.type===this.config.BoundaryLineType)for(var c=0;c<b.paths.length;c++)this._arrayOfAllBoundaryLines.push(b.paths[c]);this._orgStartPointForNextLine=f.clone(d);return a},getArcInfo:function(a,d,b,c){var e,f,l;e=g.getDestinationPoint(a,d,Math.abs(c));f=Math.abs(c)/2;l=g.getDestinationPoint(a,d,f);a={distance:c,radius:b,initBearing:d,chordMidPoint:l,centerAndChordDistance:Math.sqrt(Math.abs(b*b-f*
f)),chordEndPoint:e,chordStartPoint:a};d=g.getArcParam(a);d.startAngle=d.startAngle>d.endAngle?d.startAngle-360:d.startAngle;d=g.getPointsForArc(d.startAngle,d.endAngle,d.centerPoint,b);0===d.length&&(d.push(a.chordStartPoint),d.push(a.chordEndPoint));0>b&&d.reverse();return{endPoint:e,arcGeometryPointsArray:d}},_drawStraightLine:function(a,d){var b,c,e;b=a.BearingConversions.naDD;c=a.LengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){b=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||
0>a.adjustedValues.lat)b=a.adjustedValues.adjustedBearingNADD;c=a.adjustedValues.adjustedLength;this.appliedCompassRule=!0}this._rotationAngle&&(b=Number(b)+this._rotationAngle);this._scaleValue&&(c*=this._scaleValue);e=g.getDestinationPoint(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.LengthConversions.meters);b=g.getDestinationPoint(this._startPointForNextLine,b,c);a=this.setInfoForCalculatingMisclose(a,e,[this._orgStartPointForNextLine,e]);this._drawLineAndEndPoint(b,[this._startPointForNextLine,
b],a,d)},_drawArc:function(a,d){var b,c,e,f;e=a.BearingConversions.naDD;b=a.RadiusConversions.meters;c=a.ChordLengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){e=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||0>a.adjustedValues.lat)e=a.adjustedValues.adjustedBearingNADD;c=a.adjustedValues.adjustedLength;0>a.ChordLengthConversions.meters&&(c*=-1);this.appliedCompassRule=!0}this._rotationAngle&&(e=Number(e)+this._rotationAngle);this._scaleValue&&
(c*=this._scaleValue,b*=this._scaleValue);f=this.getArcInfo(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.RadiusConversions.meters,a.ChordLengthConversions.meters);a=this.setInfoForCalculatingMisclose(a,f.endPoint,f.arcGeometryPointsArray);b=this.getArcInfo(this._startPointForNextLine,e,b,c);this._drawLineAndEndPoint(b.endPoint,b.arcGeometryPointsArray,a,d)},_setExtentToLayer:function(a,d){var b;0<a.graphics.length&&(b=O.graphicsExtent(a.graphics),!d&&this.map.extent.contains(b)||this.map.setExtent(b.expand(1.5)))},
_showMessage:function(a){this.emit("showMessage",a)},updateAccordingToPlanSettings:function(a){this._planSettings=a;this.bearingNode.set("placeHolder",this._getAbbreviatedUnits(a.directionOrAngleUnits));this.lengthNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));this.radiusNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));this._reGenerateTraverseGrid();this._misCloseDetailsInstance&&(a=this._misCloseDetailsInstance.getMiscloseDetails())&&(a=this._getMiscloseDetailsAccordingToPlanSettings(a),
this._misCloseDetailsInstance.updateAccordingToPlanSettings(a))},deActivateDigitizationTool:function(){k.remove(this.screenDigitizationNode,"esriCTEnableButton")},pointAddedFromDigitization:function(a){var d,b,c,e;e=new B(4326);g.getProjectedGeometry(a,e,this.geometryService).then(f.hitch(this,function(a){d=g.getAngleBetweenPoints(this._startPointForNextLine,a);360===d&&(d=0);b=g.getDistanceBetweenPoints(this._startPointForNextLine,a);c=this.getAngleFromDDTOQB(d);this.bearingNode.set("value",c);"uSSurveyFeet"===
this._planSettings.distanceAndLengthUnits&&(b=n.metersToUSSurveyFeet(b));0<this._scaleValue&&(b/=this._scaleValue);this.lengthNode.set("value",b);this.radiusNode.set("value","");this._addNewItem(!0)}))},getParcelCloseDetails:function(){var a,d,b,c,e;d={isClosed:!1,compassStartPoint:null,compassEndPoint:null};b=!0;a=0;t.forEach(this._itemList,f.hitch(this,function(d,f){d.LineSymbol.type===this.config.BoundaryLineType?(0===a?c=d.startPoint:e=d.endpoint,a++):0<f&&0!==a&&(b=!1)}));1<a&&b&&(d.isClosed=
!0,d.compassStartPoint=c,d.compassEndPoint=e);return d},setParcelClosure:function(a){var d;d=this.getParcelCloseDetails();if(d.isClosed)d=this.getCalculatedMiscloseDetails(d.compassStartPoint,d.compassEndPoint),this._misCloseDetailsInstance.setMiscloseDetails(d),d.adjustPoints?((this.adjustPoints=this._applyCompassRule(d))&&!this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint):(this.adjustPoints=!1,(this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint));else if(this._misCloseDetailsInstance.setMiscloseDetails(null),
this.adjustPoints=!1,this.appliedCompassRule||a)this.appliedCompassRule=!1,this.setStartPoint(this.startPoint)},_getMiscloseDetailsAccordingToPlanSettings:function(a){var d,b;d={};a.BearingConversions&&(d.miscloseBearing=this._getBearingAccordingToPlanSettings(a.BearingConversions));b=this._getRoundedValue(a.LengthConversions,"MiscloseDistance");d.miscloseDistance=b+" "+this._getAbbreviatedUnits(this._planSettings.distanceAndLengthUnits);a.AreaConversions?(a=a.AreaConversions[this._planSettings.areaUnits],
isNaN(parseFloat(a))||(a=parseFloat(a).toFixed(3))):a=0;a=a+" "+this._getAbbreviatedUnits(this._planSettings.areaUnits);d.calculatedArea=a;return d},getCalculatedMiscloseDetails:function(a,d){var b,c,e={};b=b=c=0;var h=!1,l;if(d&&a){b=g.getAngleBetweenPoints(d,a);c=g.getDistanceBetweenPoints(d,a);0===c&&(b=0);b=this.getAngleFromDDTOQB(b);if(b=n.categorizeBearingFormat(b,this._planSettings))e.BearingConversions=b;e.AreaConversions=this._getCalculatedArea();l=this._getMiscloseRatioInfo(c);b=l.miscloseRatio;
e.miscloseValue=l.miscloseValue;c=n.categorizeLengthFormat(c,"meters");e.LengthConversions=c;c=c[this.config.miscloseSnapDistanceUnit+"Round"];1E5<=b&&(h=!0);e.miscloseRatio=b;e.accuracy=h;e=f.mixin(e,this._getMiscloseDetailsAccordingToPlanSettings(e));if(0<c&&c<=this.config.miscloseSnapDistance||isFinite(b)&&b>=this.config.miscloseRatioSnap)e.adjustPoints=!0,e.compassCompleteLength=l.compassCompleteLength}return e},_getCalculatedArea:function(){var a,d;this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&
(d=g.getPolygonFromPolyLines(this._arrayOfAllBoundaryLines,!0))&&(a=new v(d),this.parcelPolygonGraphicsLayer.clear(),this.parcelPolygonGraphicsLayer.add(a),a=g.getAreaOfGeometry(d));return a},_applyCompassRule:function(a){var d,b,c,e,f,g;f=e=0;g={};for(c=0;c<this._itemList.length;c++)b=this._itemList[c],b.LineSymbol.type===this.config.BoundaryLineType&&(""===b.Radius||"0"===b.Radius||0===b.Radius?d=b.LengthConversions.meters:b.ChordLengthConversions&&(d=b.ChordLengthConversions.meters),d=Math.abs(d),
b.lat=d*Math.cos(Math.PI/180*b.BearingConversions.naDD),b.dep=d*Math.sin(Math.PI/180*b.BearingConversions.naDD),e+=b.lat,f+=b.dep);g.sumOfLat=e;g.sumOfDep=f;g.sumOfAllLinesLength=a.compassCompleteLength;for(c=0;c<this._itemList.length;c++)b=this._itemList[c],""===b.Radius||"0"===b.Radius||0===b.Radius?d=b.LengthConversions.meters:b.ChordLengthConversions&&(d=b.ChordLengthConversions.meters),d=Math.abs(d),b.LineSymbol.type===this.config.BoundaryLineType&&(b.adjustedValues=this._adjustBearingAndDistance(b.lat,
b.dep,d,g));for(c=d=a=0;c<this._itemList.length;c++)b=this._itemList[c],b.LineSymbol.type===this.config.BoundaryLineType&&(a+=parseFloat(b.adjustedValues.lat.toFixed(2)),d+=parseFloat(b.adjustedValues.dep.toFixed(2)),a=parseFloat(a.toFixed(2)),d=parseFloat(d.toFixed(2)));return 0===parseInt(a,10)&&0===parseInt(d,10)?!0:!1},_adjustBearingAndDistance:function(a,d,b,c){var e,f;e={};a=parseFloat(a.toFixed(6));d=parseFloat(d.toFixed(6));b=parseFloat(b.toFixed(6));f=-c.sumOfLat/c.sumOfAllLinesLength*b;
b*=-c.sumOfDep/c.sumOfAllLinesLength;f=parseFloat(f.toFixed(6));b=parseFloat(b.toFixed(6));d+=b;a=parseFloat((a+f).toFixed(6));d=parseFloat(d.toFixed(6));f=Math.sqrt(Math.pow(a,2)+Math.pow(d,2));b=Math.atan(d/a);b=parseFloat(b.toFixed(6));e.lat=a;e.dep=d;e.adjustedLength=f;e.adjustedBearing=180/Math.PI*b;a=n.categorizeBearingFormat(e.adjustedBearing,{directionOrAngleType:"southAzimuth",directionOrAngleUnits:"decimalDegree"});e.adjustedBearingNADD=a.naDD;return e},_getMiscloseRatioInfo:function(a){var d,
b=d=0,c;c=0;this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&(d=g.getPolyLineFromPaths(this._arrayOfAllBoundaryLines),d=g.getLengthOfGeometry(d),0<d&&(b=1/(a/d),10>b?b=0:1E5>b&&(c=parseInt(b,10),b="1:"+parseInt(b,10))));return{miscloseRatio:b,miscloseValue:c,compassCompleteLength:d}},getAngleFromDDTOQB:function(a){var d,b;b=f.clone(this._planSettings);b.directionOrAngleType="northAzimuth";b.directionOrAngleUnits="decimalDegree";(a=n.categorizeBearingFormat(a,b))&&(d="degreeMinuteSeconds"===
this._planSettings.directionOrAngleUnits?a.qb3DMS:a.qb3DD);return d},initEditing:function(a,d,b){var c,e,h,l,k;this._planInfoInstance.setParcelInformation(this.polygonDeleteArr);c=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.rotation.name];(h=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.scale.name])||(h=1);e=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.statedArea.name];this._parcelToolInstance.setRotation(c);this._parcelToolInstance.setScale(h);null!==
e&&void 0!==e&&this._misCloseDetailsInstance.traverseStatedArea.set("value",e);h=[];l=g.getUnitValueForSR(b);k=f.clone(this._planSettings);k.directionOrAngleType="northAzimuth";k.directionOrAngleUnits="decimalDegree";for(b=0;b<d.features.length;b++){c={};c.Bearing=d.features[b].attributes[this.config.polylineLayer.bearing.name];c.BearingConversions=n.categorizeBearingFormat(c.Bearing,k);c.Bearing=this._getBearingAccordingToPlanSettings(c.BearingConversions,!0);c.Length=d.features[b].attributes[this.config.polylineLayer.distance.name];
null!==c.Length&&""!==c.Length&&(c.LengthConversions=this._validateLength(c.Length,l),c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits]);if(e=this.getLineSymbolForType(d.features[b].attributes[this.config.polylineLayer.lineType.name]))c.LineSymbol=e;c.Radius=d.features[b].attributes[this.config.polylineLayer.radius.name];null!==c.Radius&&""!==c.Radius?(c.RadiusConversions=this._validateLength(c.Radius,l),c.Radius=c.RadiusConversions[this._planSettings.distanceAndLengthUnits],
c.ArcLength=d.features[b].attributes[this.config.polylineLayer.arcLength.name],null!==c.ArcLength&&""!==c.ArcLength&&(c.ArcLengthConversions=this._validateLength(c.ArcLength,l),c.ArcLength=c.ArcLengthConversions[this._planSettings.distanceAndLengthUnits]),c.ChordLength=d.features[b].attributes[this.config.polylineLayer.chordLength.name],null!==c.ChordLength&&""!==c.ChordLength&&(c.ChordLengthConversions=this._validateLength(c.ChordLength,l),c.ChordLength=c.ChordLengthConversions[this._planSettings.distanceAndLengthUnits]),
"radiusAndArcLength"===this._planSettings.circularCurveParameters?(c.Length=c.ArcLength,c.LengthConversions=f.clone(c.ArcLengthConversions)):(c.Length=c.ChordLength,c.LengthConversions=f.clone(c.ChordLengthConversions))):(c.Radius="",c.RadiusConversions=null);h.push(c)}this._itemList=h;this._reGenerateTraverseGrid();this._showHideTraverseTools();this.setStartPoint(a);this.setBoundaryLineSymbol()},setBoundaryLineSymbol:function(){this._symbolSelector&&t.some(this.config.lineTypes,f.hitch(this,function(a){if(this.config.BoundaryLineType===
a.type)return this._symbolSelector.selectSymbol(a),!1}))},getLineSymbolForType:function(a){var d;t.some(this.config.lineTypes,f.hitch(this,function(b){if(b.type===a)return d=f.clone(b),!0}));return d},deactivateParcelTools:function(){this._parcelToolInstance.disableRotating();this._parcelToolInstance.disableScaling()},clearAll:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();this.parcelPolygonGraphicsLayer.clear();this._resetEntryRow();this._dndContainer.clearItems();
m.empty(this.traverseGrid);this._itemList=[];this._nodes=[];this._showHideTraverseTools();this._orgStartPointForNextLine=this._startPointForNextLine=this.startPoint=null;this._rotationAngle=0;this._scaleValue=1;this._symbolSelector.setDefault();k.remove(this.screenDigitizationNode,"esriCTEnableButton");this._parcelToolInstance.resetTools();this.deactivateParcelTools();this._misCloseDetailsInstance.setMiscloseDetails(null);this._arrayOfAllBoundaryLines=[];this.polygonDeleteArr=[];this.polylineDeleteArr=
[];this.domNode.scrollTop=0;this._planInfoInstance.resetValues();this._misCloseDetailsInstance.traverseStatedArea.set("value",null);this.closePopup()},_showParcelPopup:function(a){var d,b,c=[];d=new Q;b=this._pointToExtent(a.mapPoint,8);c=t.filter(this.parcelLinesGraphicsLayer.graphics,function(a){return b.intersects(a.geometry)});c[0]?(this._createPopupContent(a,c[0]),d.resolve(!0)):(this.closePopup(),d.resolve(!1));return d},_getAbbreviatedUnits:function(a){return window.jimuNls.units[a+"Abbr"]},
_pointToExtent:function(a,d){var b;b=this.map.extent.getWidth()/this.map.width;b*=d;return new R(a.x-b,a.y-b,a.x+b,a.y+b,this.map.spatialReference)},_createPopupContent:function(a,d){var b,c,e,f;if(f=this._itemList[d.attributes.rowIndex])b=m.create("div",{"class":"esriCTParcelInfoPopup "+this.baseClass},null),c=m.create("div",{"class":"esriCTLabelRows"},b),this._createFieldLabels(c,this.nls.traverseSettings.bearingLabel),this._createFieldLabels(c,this.nls.traverseSettings.lengthLabel),this._createFieldLabels(c,
this.nls.traverseSettings.radiusLabel),c=m.create("div",{"class":"esriCTRowContainer esriCTRow",rowIndex:d.attributes.rowIndex},b),this._createFieldInputs(c,this._getBearingAccordingToPlanSettings(f.BearingConversions),"esriCTBearingRow",!0),(e=f.RadiusConversions)?(e=this._getRoundedValue(f.RadiusConversions,"Radius"),f="radiusAndArcLength"===this._planSettings.circularCurveParameters?this._getRoundedValue(f.ArcLengthConversions,"Length"):this._getRoundedValue(f.ChordLengthConversions,"Length")):
(e="",f=this._getRoundedValue(f.LengthConversions,"Length")),this._createFieldInputs(c,f,"esriCTLengthRow",!0),this._createFieldInputs(c,e,"esriCTRadiusRow",!0),y.position(this.traverseEntryNode)&&y.position(this.traverseEntryNode).w&&(c=y.position(this.traverseEntryNode).w-42,z.set(this._popupDialog.domNode,"width",c+"px")),this._popupDialog.setContent(b),this._popupCoords={pageX:a.pageX,pageY:a.pageY},this._openPopup(a)},_openPopup:function(a){z.set(this._popupDialog.domNode,"opacity",.9);C.open({popup:this._popupDialog,
x:a.pageX,y:a.pageY})},closePopup:function(){this._popupDialog&&C.close(this._popupDialog)},_createFieldLabels:function(a,d){m.create("div",{innerHTML:d,title:d,"class":"esriCTParcelInfoLabels"},a)},_createTooltip:function(){this._popupDialog=new P({"class":"esriCTEditParcelDialog"});this._popupDialog.startup()},validateNumericField:function(a,d){var b,c=/^[-+]?[0-9]+\.[0-9]+$/,e=/^[-+]?[0-9]+$/;a=f.trim(a);switch(d){case "esriFieldTypeSmallInteger":b=parseInt(a,10);b=a.match(e)&&-32768<=b&&32767>=
b&&0!==a.length?!0:!1;break;case "esriFieldTypeInteger":b=parseInt(a,10);b=a.match(e)&&-2147483648<=b&&2147483647>=b&&0!==a.length?!0:!1;break;case "esriFieldTypeSingle":b=parseFloat(a);b=(a.match(e)||a.match(c))&&b>=-3.4*Math.pow(10,38)&&b<=1.2*Math.pow(10,38)&&0!==a.length?!0:!1;break;case "esriFieldTypeDouble":b=parseFloat(a),b=(a.match(e)||a.match(c))&&b>=-2.2*Math.pow(10,308)&&b<=1.8*Math.pow(10,38)&&0!==a.length?!0:!1}return b}})});